\doxysection{ecas.\+py}
\hypertarget{ecas_8py_source}{}\label{ecas_8py_source}\index{micro\_automatizacion\_ecas/app/api/ecas.py@{micro\_automatizacion\_ecas/app/api/ecas.py}}
\mbox{\hyperlink{ecas_8py}{Ir a la documentación de este archivo.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{\Hypertarget{ecas_8py_source_l00001}\mbox{\hyperlink{namespaceecas}{00001}}\ \textcolor{keyword}{from}\ fastapi\ \textcolor{keyword}{import}\ APIRouter,\ Depends,\ HTTPException,\ Query}
\DoxyCodeLine{\Hypertarget{ecas_8py_source_l00002}00002\ \textcolor{keyword}{from}\ \mbox{\hyperlink{namespacefastapi_1_1responses}{fastapi.responses}}\ \textcolor{keyword}{import}\ JSONResponse}
\DoxyCodeLine{\Hypertarget{ecas_8py_source_l00003}00003\ }
\DoxyCodeLine{\Hypertarget{ecas_8py_source_l00004}00004\ \textcolor{keyword}{from}\ application.dtos\ \textcolor{keyword}{import}\ ECAResponse,\ ECAStateRequest,\ MakeContractRequest}
\DoxyCodeLine{\Hypertarget{ecas_8py_source_l00005}00005\ \textcolor{keyword}{from}\ deps\ \textcolor{keyword}{import}\ get\_eca\_service}
\DoxyCodeLine{\Hypertarget{ecas_8py_source_l00006}00006\ \textcolor{keyword}{from}\ application.eca\_service\ \textcolor{keyword}{import}\ EcaService}
\DoxyCodeLine{\Hypertarget{ecas_8py_source_l00007}00007\ \textcolor{keyword}{from}\ application.dtos\ \textcolor{keyword}{import}\ SendCommandRequest}
\DoxyCodeLine{\Hypertarget{ecas_8py_source_l00008}00008\ }
\DoxyCodeLine{\Hypertarget{ecas_8py_source_l00009}00009\ }
\DoxyCodeLine{\Hypertarget{ecas_8py_source_l00010}00010\ }
\DoxyCodeLine{\Hypertarget{ecas_8py_source_l00011}\mbox{\hyperlink{namespaceecas_a762142ec0f597370702c4fb407b2046c}{00011}}\ router\ =\ \mbox{\hyperlink{classfastapi_1_1routing_1_1_a_p_i_router}{APIRouter}}(prefix=\textcolor{stringliteral}{"{}/eca"{}},\ tags=[\textcolor{stringliteral}{"{}ECAs"{}}])}
\DoxyCodeLine{\Hypertarget{ecas_8py_source_l00012}00012\ }
\DoxyCodeLine{\Hypertarget{ecas_8py_source_l00013}00013\ \textcolor{comment}{\#\ Crear\ nueva\ ECA}}
\DoxyCodeLine{\Hypertarget{ecas_8py_source_l00014}00014\ \textcolor{preprocessor}{@router.post("{}/"{})}}
\DoxyCodeLine{\Hypertarget{ecas_8py_source_l00015}\mbox{\hyperlink{namespaceecas_a811c103a3379f109090abd7e14033547}{00015}}\ \textcolor{keyword}{async\ def\ }\mbox{\hyperlink{namespaceecas_a811c103a3379f109090abd7e14033547}{crear\_eca}}(eca:\ MakeContractRequest,\ service:\ EcaService\ =\ Depends(get\_eca\_service)):\ \ }
\DoxyCodeLine{\Hypertarget{ecas_8py_source_l00016}00016\ \ \ \ \ \textcolor{stringliteral}{"{}"{}"{}Crear\ una\ nueva\ regla\ ECA."{}"{}"{}}}
\DoxyCodeLine{\Hypertarget{ecas_8py_source_l00017}00017\ \ \ \ \ \textcolor{keywordflow}{try}:}
\DoxyCodeLine{\Hypertarget{ecas_8py_source_l00018}00018\ \ \ \ \ \ \ \ \ result\ =\ await\ service.crear\_eca(eca)}
\DoxyCodeLine{\Hypertarget{ecas_8py_source_l00019}00019\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ result}
\DoxyCodeLine{\Hypertarget{ecas_8py_source_l00020}00020\ \ \ \ \ \textcolor{keywordflow}{except}\ Exception\ \textcolor{keyword}{as}\ e:}
\DoxyCodeLine{\Hypertarget{ecas_8py_source_l00021}00021\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{raise}\ \mbox{\hyperlink{classfastapi_1_1exceptions_1_1_h_t_t_p_exception}{HTTPException}}(status\_code=400,\ detail=str(e))}
\DoxyCodeLine{\Hypertarget{ecas_8py_source_l00022}00022\ \textcolor{preprocessor}{@router.get("{}/"{})}}
\DoxyCodeLine{\Hypertarget{ecas_8py_source_l00023}\mbox{\hyperlink{namespaceecas_afe79ca421ad8c56d8095b681a549b16e}{00023}}\ \textcolor{keyword}{async\ def\ }\mbox{\hyperlink{namespaceecas_afe79ca421ad8c56d8095b681a549b16e}{listar\_ecas}}(osid:\ str\ =\ Query(...,\ description=\textcolor{stringliteral}{"{}ID\ del\ objeto\ inteligente"{}}),service:\ EcaService\ =\ Depends(get\_eca\_service)):}
\DoxyCodeLine{\Hypertarget{ecas_8py_source_l00024}00024\ \ \ \ \ \textcolor{stringliteral}{"{}"{}"{}Listar\ todas\ las\ ECAs\ del\ objeto\ inteligente."{}"{}"{}}}
\DoxyCodeLine{\Hypertarget{ecas_8py_source_l00025}00025\ \ \ \ \ \textcolor{keywordflow}{try}:}
\DoxyCodeLine{\Hypertarget{ecas_8py_source_l00026}00026\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ await\ service.listar\_ecas(osid)}
\DoxyCodeLine{\Hypertarget{ecas_8py_source_l00027}00027\ \ \ \ \ \textcolor{keywordflow}{except}\ Exception\ \textcolor{keyword}{as}\ e:}
\DoxyCodeLine{\Hypertarget{ecas_8py_source_l00028}00028\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{raise}\ \mbox{\hyperlink{classfastapi_1_1exceptions_1_1_h_t_t_p_exception}{HTTPException}}(status\_code=500,\ detail=str(e))}
\DoxyCodeLine{\Hypertarget{ecas_8py_source_l00029}00029\ \textcolor{preprocessor}{@router.patch("{}/"{})}}
\DoxyCodeLine{\Hypertarget{ecas_8py_source_l00030}\mbox{\hyperlink{namespaceecas_ac4a0b1caa96d3fba9ccfc78b5531417a}{00030}}\ \textcolor{keyword}{async\ def\ }\mbox{\hyperlink{namespaceecas_ac4a0b1caa96d3fba9ccfc78b5531417a}{apagar\_ecas}}(osid:\ str\ =\ Query(...,\ description=\textcolor{stringliteral}{"{}ID\ del\ objeto\ inteligente"{}}),service:\ EcaService\ =\ Depends(get\_eca\_service)):}
\DoxyCodeLine{\Hypertarget{ecas_8py_source_l00031}00031\ \ \ \ \ \textcolor{stringliteral}{"{}"{}"{}Apagar\ todas\ las\ ECAs\ del\ objeto\ inteligente."{}"{}"{}}}
\DoxyCodeLine{\Hypertarget{ecas_8py_source_l00032}00032\ \ \ \ \ \textcolor{keywordflow}{try}:}
\DoxyCodeLine{\Hypertarget{ecas_8py_source_l00033}00033\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ await\ service.apagar\_ecas(osid)}
\DoxyCodeLine{\Hypertarget{ecas_8py_source_l00034}00034\ \ \ \ \ \textcolor{keywordflow}{except}\ Exception\ \textcolor{keyword}{as}\ e:}
\DoxyCodeLine{\Hypertarget{ecas_8py_source_l00035}00035\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{raise}\ \mbox{\hyperlink{classfastapi_1_1exceptions_1_1_h_t_t_p_exception}{HTTPException}}(status\_code=500,\ detail=str(e))}
\DoxyCodeLine{\Hypertarget{ecas_8py_source_l00036}00036\ \textcolor{preprocessor}{@router.delete("{}/"{})}}
\DoxyCodeLine{\Hypertarget{ecas_8py_source_l00037}\mbox{\hyperlink{namespaceecas_ab9693b463b35ec24299e6d5403ac9fde}{00037}}\ \textcolor{keyword}{async\ def\ }\mbox{\hyperlink{namespaceecas_ab9693b463b35ec24299e6d5403ac9fde}{eliminar\_eca}}(}
\DoxyCodeLine{\Hypertarget{ecas_8py_source_l00038}00038\ \ \ \ \ osid:str=Query(...,\ description=\textcolor{stringliteral}{"{}ID\ del\ objeto\ inteligente"{}}),}
\DoxyCodeLine{\Hypertarget{ecas_8py_source_l00039}00039\ \ \ \ \ eca\_name:\ str\ =\ Query(...,\ description=\textcolor{stringliteral}{"{}Nombre\ del\ ECA\ a\ eliminar"{}}),}
\DoxyCodeLine{\Hypertarget{ecas_8py_source_l00040}00040\ \ \ \ \ user\_eca:\ str\ =\ Query(...,\ description=\textcolor{stringliteral}{"{}Usuario\ dueño\ del\ ECA"{}}),\ }
\DoxyCodeLine{\Hypertarget{ecas_8py_source_l00041}00041\ \ \ \ \ service:\ EcaService\ =\ Depends(get\_eca\_service)):}
\DoxyCodeLine{\Hypertarget{ecas_8py_source_l00042}00042\ \ \ \ \ \textcolor{keywordflow}{try}:\ \ \ \ \ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{ecas_8py_source_l00043}00043\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ await\ service.eliminar\_eca(osid,eca\_name,\ user\_eca)}
\DoxyCodeLine{\Hypertarget{ecas_8py_source_l00044}00044\ \ \ \ \ \textcolor{keywordflow}{except}\ Exception\ \textcolor{keyword}{as}\ e:}
\DoxyCodeLine{\Hypertarget{ecas_8py_source_l00045}00045\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{raise}\ \mbox{\hyperlink{classfastapi_1_1exceptions_1_1_h_t_t_p_exception}{HTTPException}}(status\_code=400,\ detail=str(e))}
\DoxyCodeLine{\Hypertarget{ecas_8py_source_l00046}00046\ \textcolor{preprocessor}{@router.put("{}/state"{})}}
\DoxyCodeLine{\Hypertarget{ecas_8py_source_l00047}\mbox{\hyperlink{namespaceecas_a279d2c0099ec418dfc5ec8e35de33f5b}{00047}}\ \textcolor{keyword}{async\ def\ }\mbox{\hyperlink{namespaceecas_a279d2c0099ec418dfc5ec8e35de33f5b}{cambiar\_estado}}(request:\ ECAStateRequest,\ service:\ EcaService\ =\ Depends(get\_eca\_service)):}
\DoxyCodeLine{\Hypertarget{ecas_8py_source_l00048}00048\ \ \ \ \ \textcolor{keywordflow}{try}:}
\DoxyCodeLine{\Hypertarget{ecas_8py_source_l00049}00049\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ await\ service.cambiar\_estado\_eca(request)\ \ \ \ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{ecas_8py_source_l00050}00050\ \ \ \ \ \textcolor{keywordflow}{except}\ Exception\ \textcolor{keyword}{as}\ e:}
\DoxyCodeLine{\Hypertarget{ecas_8py_source_l00051}00051\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{raise}\ \mbox{\hyperlink{classfastapi_1_1exceptions_1_1_h_t_t_p_exception}{HTTPException}}(status\_code=400,\ detail=str(e))}
\DoxyCodeLine{\Hypertarget{ecas_8py_source_l00052}00052\ \textcolor{preprocessor}{@router.put("{}/edit"{})}}
\DoxyCodeLine{\Hypertarget{ecas_8py_source_l00053}\mbox{\hyperlink{namespaceecas_a0c1efa8b41b044389a46fa0d6b78189b}{00053}}\ \textcolor{keyword}{async\ def\ }\mbox{\hyperlink{namespaceecas_a0c1efa8b41b044389a46fa0d6b78189b}{editar\_eca}}(eca:\ MakeContractRequest,\ service:\ EcaService\ =\ Depends(get\_eca\_service)):}
\DoxyCodeLine{\Hypertarget{ecas_8py_source_l00054}00054\ \ \ \ \ \textcolor{keywordflow}{try}:}
\DoxyCodeLine{\Hypertarget{ecas_8py_source_l00055}00055\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ await\ service.editar\_eca(eca)\ \ \ \ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{ecas_8py_source_l00056}00056\ \ \ \ \ \textcolor{keywordflow}{except}\ Exception\ \textcolor{keyword}{as}\ e:}
\DoxyCodeLine{\Hypertarget{ecas_8py_source_l00057}00057\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{raise}\ \mbox{\hyperlink{classfastapi_1_1exceptions_1_1_h_t_t_p_exception}{HTTPException}}(status\_code=400,\ detail=str(e))}
\DoxyCodeLine{\Hypertarget{ecas_8py_source_l00058}00058\ \textcolor{preprocessor}{@router.post("{}/send\_command"{})}}
\DoxyCodeLine{\Hypertarget{ecas_8py_source_l00059}\mbox{\hyperlink{namespaceecas_a2c295cd12c9dd5717ea32d0fdc7264b2}{00059}}\ \textcolor{keyword}{async\ def\ }\mbox{\hyperlink{namespaceecas_a2c295cd12c9dd5717ea32d0fdc7264b2}{send\_command}}(request:\ SendCommandRequest,\ service:\ EcaService\ =\ Depends(get\_eca\_service)):}
\DoxyCodeLine{\Hypertarget{ecas_8py_source_l00060}00060\ \ \ \ \ \textcolor{stringliteral}{"{}"{}"{}Envía\ un\ comando\ a\ un\ datastream\ actuador\ si\ existe\ un\ contrato."{}"{}"{}}}
\DoxyCodeLine{\Hypertarget{ecas_8py_source_l00061}00061\ \ \ \ \ \textcolor{keywordflow}{try}:}
\DoxyCodeLine{\Hypertarget{ecas_8py_source_l00062}00062\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ await\ service.send\_command(request)}
\DoxyCodeLine{\Hypertarget{ecas_8py_source_l00063}00063\ \ \ \ \ \textcolor{keywordflow}{except}\ Exception\ \textcolor{keyword}{as}\ e:}
\DoxyCodeLine{\Hypertarget{ecas_8py_source_l00064}00064\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{raise}\ \mbox{\hyperlink{classfastapi_1_1exceptions_1_1_h_t_t_p_exception}{HTTPException}}(status\_code=400,\ detail=str(e))}

\end{DoxyCode}
