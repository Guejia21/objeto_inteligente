\doxysection{test\+\_\+send\+\_\+state\+\_\+component.\+py}
\hypertarget{test__send__state__component_8py_source}{}\label{test__send__state__component_8py_source}\index{microservicio\_data\_stream/tests/test\_send\_state\_component.py@{microservicio\_data\_stream/tests/test\_send\_state\_component.py}}
\mbox{\hyperlink{test__send__state__component_8py}{Ir a la documentación de este archivo.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{\Hypertarget{test__send__state__component_8py_source_l00001}\mbox{\hyperlink{namespacetest__send__state__component}{00001}}\ \textcolor{comment}{\#\ tests/test\_send\_state\_component.py}}
\DoxyCodeLine{\Hypertarget{test__send__state__component_8py_source_l00002}00002\ }
\DoxyCodeLine{\Hypertarget{test__send__state__component_8py_source_l00003}00003\ \textcolor{keyword}{from}\ \mbox{\hyperlink{namespaceservices_1_1datastream__service}{services.datastream\_service}}\ \textcolor{keyword}{import}\ DatastreamService}
\DoxyCodeLine{\Hypertarget{test__send__state__component_8py_source_l00004}00004\ \textcolor{keyword}{from}\ config\ \textcolor{keyword}{import}\ Config}
\DoxyCodeLine{\Hypertarget{test__send__state__component_8py_source_l00005}00005\ }
\DoxyCodeLine{\Hypertarget{test__send__state__component_8py_source_l00006}00006\ }
\DoxyCodeLine{\Hypertarget{test__send__state__component_8py_source_l00007}\mbox{\hyperlink{classtest__send__state__component_1_1_fake_m_q_t_t_client}{00007}}\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classtest__send__state__component_1_1_fake_m_q_t_t_client}{FakeMQTTClient}}:}
\DoxyCodeLine{\Hypertarget{test__send__state__component_8py_source_l00008}00008\ \ \ \ \ \textcolor{stringliteral}{"{}"{}"{}Simula\ el\ adaptador\ MQTT."{}"{}"{}}}
\DoxyCodeLine{\Hypertarget{test__send__state__component_8py_source_l00009}00009\ \ \ \ \ \textcolor{keyword}{def\ }\_\_init\_\_(self):}
\DoxyCodeLine{\Hypertarget{test__send__state__component_8py_source_l00010}\mbox{\hyperlink{classtest__send__state__component_1_1_fake_m_q_t_t_client_af69bd7d544ddb3f7ef23801f01311e65}{00010}}\ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classtest__send__state__component_1_1_fake_m_q_t_t_client_af69bd7d544ddb3f7ef23801f01311e65}{published}}\ =\ []}
\DoxyCodeLine{\Hypertarget{test__send__state__component_8py_source_l00011}00011\ }
\DoxyCodeLine{\Hypertarget{test__send__state__component_8py_source_l00012}\mbox{\hyperlink{classtest__send__state__component_1_1_fake_m_q_t_t_client_acccc5bca3b15e44fbde625ab7bb8c739}{00012}}\ \ \ \ \ \textcolor{keyword}{def\ }\mbox{\hyperlink{classtest__send__state__component_1_1_fake_m_q_t_t_client_acccc5bca3b15e44fbde625ab7bb8c739}{publish}}(self,\ topic,\ payload):}
\DoxyCodeLine{\Hypertarget{test__send__state__component_8py_source_l00013}00013\ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classtest__send__state__component_1_1_fake_m_q_t_t_client_af69bd7d544ddb3f7ef23801f01311e65}{published}}.append((topic,\ payload))}
\DoxyCodeLine{\Hypertarget{test__send__state__component_8py_source_l00014}00014\ }
\DoxyCodeLine{\Hypertarget{test__send__state__component_8py_source_l00015}00015\ }
\DoxyCodeLine{\Hypertarget{test__send__state__component_8py_source_l00016}\mbox{\hyperlink{classtest__send__state__component_1_1_fake_response}{00016}}\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classtest__send__state__component_1_1_fake_response}{FakeResponse}}:}
\DoxyCodeLine{\Hypertarget{test__send__state__component_8py_source_l00017}00017\ \ \ \ \ \textcolor{stringliteral}{"{}"{}"{}Simula\ ResponseHelper.send\_state\_response."{}"{}"{}}}
\DoxyCodeLine{\Hypertarget{test__send__state__component_8py_source_l00018}00018\ \ \ \ \ \textcolor{keyword}{def\ }\_\_init\_\_(self):}
\DoxyCodeLine{\Hypertarget{test__send__state__component_8py_source_l00019}\mbox{\hyperlink{classtest__send__state__component_1_1_fake_response_ac041fa38fff2ae64d648508235a5db2d}{00019}}\ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classtest__send__state__component_1_1_fake_response_ac041fa38fff2ae64d648508235a5db2d}{last}}\ =\ \textcolor{keywordtype}{None}}
\DoxyCodeLine{\Hypertarget{test__send__state__component_8py_source_l00020}00020\ }
\DoxyCodeLine{\Hypertarget{test__send__state__component_8py_source_l00021}\mbox{\hyperlink{classtest__send__state__component_1_1_fake_response_a592ada746bd34cee771cfb539e5c6590}{00021}}\ \ \ \ \ \textcolor{keyword}{def\ }\mbox{\hyperlink{classtest__send__state__component_1_1_fake_response_a592ada746bd34cee771cfb539e5c6590}{send\_state\_response}}(self,\ osid,\ state):}
\DoxyCodeLine{\Hypertarget{test__send__state__component_8py_source_l00022}00022\ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classtest__send__state__component_1_1_fake_response_ac041fa38fff2ae64d648508235a5db2d}{last}}\ =\ (osid,\ state)}
\DoxyCodeLine{\Hypertarget{test__send__state__component_8py_source_l00023}00023\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \{}
\DoxyCodeLine{\Hypertarget{test__send__state__component_8py_source_l00024}00024\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}osid"{}}:\ osid,}
\DoxyCodeLine{\Hypertarget{test__send__state__component_8py_source_l00025}00025\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}state"{}}:\ state,}
\DoxyCodeLine{\Hypertarget{test__send__state__component_8py_source_l00026}00026\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{test__send__state__component_8py_source_l00027}00027\ }
\DoxyCodeLine{\Hypertarget{test__send__state__component_8py_source_l00028}00028\ }
\DoxyCodeLine{\Hypertarget{test__send__state__component_8py_source_l00029}\mbox{\hyperlink{namespacetest__send__state__component_a9d25d89ebec7316b1c96b143baf5dfad}{00029}}\ \textcolor{keyword}{def\ }\mbox{\hyperlink{namespacetest__send__state__component_a9d25d89ebec7316b1c96b143baf5dfad}{test\_send\_state\_publica\_en\_mqtt\_y\_responde}}():}
\DoxyCodeLine{\Hypertarget{test__send__state__component_8py_source_l00030}00030\ \ \ \ \ \textcolor{stringliteral}{"{}"{}"{}Prueba\ de\ componente:\ servicio\ +\ MQTT\ (fake)\ +\ Response\ (fake)."{}"{}"{}}}
\DoxyCodeLine{\Hypertarget{test__send__state__component_8py_source_l00031}00031\ \ \ \ \ service\ =\ \mbox{\hyperlink{classservices_1_1datastream__service_1_1_datastream_service}{DatastreamService}}()}
\DoxyCodeLine{\Hypertarget{test__send__state__component_8py_source_l00032}00032\ }
\DoxyCodeLine{\Hypertarget{test__send__state__component_8py_source_l00033}00033\ \ \ \ \ \textcolor{comment}{\#\ Configuramos\ el\ estado\ del\ servicio}}
\DoxyCodeLine{\Hypertarget{test__send__state__component_8py_source_l00034}00034\ \ \ \ \ Config.OSID\ =\ \textcolor{stringliteral}{"{}ESP32\_LED\_01"{}}}
\DoxyCodeLine{\Hypertarget{test__send__state__component_8py_source_l00035}00035\ }
\DoxyCodeLine{\Hypertarget{test__send__state__component_8py_source_l00036}00036\ \ \ \ \ \textcolor{comment}{\#\ Inyectamos\ dependencias\ simuladas}}
\DoxyCodeLine{\Hypertarget{test__send__state__component_8py_source_l00037}00037\ \ \ \ \ fake\_mqtt\ =\ \mbox{\hyperlink{classtest__send__state__component_1_1_fake_m_q_t_t_client}{FakeMQTTClient}}()}
\DoxyCodeLine{\Hypertarget{test__send__state__component_8py_source_l00038}00038\ \ \ \ \ fake\_resp\ =\ \mbox{\hyperlink{classtest__send__state__component_1_1_fake_response}{FakeResponse}}()}
\DoxyCodeLine{\Hypertarget{test__send__state__component_8py_source_l00039}00039\ }
\DoxyCodeLine{\Hypertarget{test__send__state__component_8py_source_l00040}00040\ \ \ \ \ \textcolor{comment}{\#\ Estos\ atributos\ deben\ existir\ en\ tu\ DatastreamService;}}
\DoxyCodeLine{\Hypertarget{test__send__state__component_8py_source_l00041}00041\ \ \ \ \ \textcolor{comment}{\#\ si\ tienen\ otros\ nombres,\ ajústalos\ aquí.}}
\DoxyCodeLine{\Hypertarget{test__send__state__component_8py_source_l00042}00042\ \ \ \ \ service.mqtt\_client\ =\ fake\_mqtt}
\DoxyCodeLine{\Hypertarget{test__send__state__component_8py_source_l00043}00043\ \ \ \ \ service.response\ =\ fake\_resp}
\DoxyCodeLine{\Hypertarget{test__send__state__component_8py_source_l00044}00044\ }
\DoxyCodeLine{\Hypertarget{test__send__state__component_8py_source_l00045}00045\ \ \ \ \ \textcolor{comment}{\#\ Simulamos\ que\ send\_state\ arma\ un\ "{}estado"{}\ simple}}
\DoxyCodeLine{\Hypertarget{test__send__state__component_8py_source_l00046}00046\ \ \ \ \ result\ =\ service.send\_state(osid=\textcolor{stringliteral}{"{}ESP32\_LED\_01"{}})}
\DoxyCodeLine{\Hypertarget{test__send__state__component_8py_source_l00047}00047\ }
\DoxyCodeLine{\Hypertarget{test__send__state__component_8py_source_l00048}00048\ \ \ \ \ \textcolor{comment}{\#\ 1)\ Se\ publica\ algo\ en\ MQTT\ (fake)}}
\DoxyCodeLine{\Hypertarget{test__send__state__component_8py_source_l00049}00049\ \ \ \ \ \textcolor{keyword}{assert}\ len(fake\_mqtt.published)\ >=\ 0\ \ \textcolor{comment}{\#\ si\ en\ tu\ implementación\ no\ publica,\ cambia\ o\ comenta\ este\ assert}}
\DoxyCodeLine{\Hypertarget{test__send__state__component_8py_source_l00050}00050\ }
\DoxyCodeLine{\Hypertarget{test__send__state__component_8py_source_l00051}00051\ \ \ \ \ \textcolor{comment}{\#\ 2)\ La\ respuesta\ que\ devuelve\ es\ coherente}}
\DoxyCodeLine{\Hypertarget{test__send__state__component_8py_source_l00052}00052\ \ \ \ \ \textcolor{keyword}{assert}\ result[\textcolor{stringliteral}{"{}osid"{}}]\ ==\ \textcolor{stringliteral}{"{}ESP32\_LED\_01"{}}}

\end{DoxyCode}
