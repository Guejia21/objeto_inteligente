\doxysection{httptools\+\_\+impl.\+py}
\hypertarget{httptools__impl_8py_source}{}\label{httptools__impl_8py_source}\index{micro\_gestion\_objetos/venv/Lib/site-\/packages/uvicorn/protocols/http/httptools\_impl.py@{micro\_gestion\_objetos/venv/Lib/site-\/packages/uvicorn/protocols/http/httptools\_impl.py}}
\mbox{\hyperlink{httptools__impl_8py}{Ir a la documentaci√≥n de este archivo.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00001}\mbox{\hyperlink{namespaceuvicorn_1_1protocols_1_1http_1_1httptools__impl}{00001}}\ \textcolor{keyword}{from}\ \_\_future\_\_\ \textcolor{keyword}{import}\ annotations}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00002}00002\ }
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00003}00003\ \textcolor{keyword}{import}\ asyncio}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00004}00004\ \textcolor{keyword}{import}\ http}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00005}00005\ \textcolor{keyword}{import}\ logging}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00006}00006\ \textcolor{keyword}{import}\ re}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00007}00007\ \textcolor{keyword}{import}\ urllib}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00008}00008\ \textcolor{keyword}{from}\ asyncio.events\ \textcolor{keyword}{import}\ TimerHandle}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00009}00009\ \textcolor{keyword}{from}\ collections\ \textcolor{keyword}{import}\ deque}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00010}00010\ \textcolor{keyword}{from}\ typing\ \textcolor{keyword}{import}\ Any,\ Callable,\ Literal,\ cast}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00011}00011\ }
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00012}00012\ \textcolor{keyword}{import}\ httptools}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00013}00013\ }
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00014}00014\ \textcolor{keyword}{from}\ \mbox{\hyperlink{namespaceuvicorn_1_1__types}{uvicorn.\_types}}\ \textcolor{keyword}{import}\ (}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00015}00015\ \ \ \ \ ASGI3Application,}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00016}00016\ \ \ \ \ ASGIReceiveEvent,}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00017}00017\ \ \ \ \ ASGISendEvent,}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00018}00018\ \ \ \ \ HTTPRequestEvent,}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00019}00019\ \ \ \ \ HTTPResponseStartEvent,}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00020}00020\ \ \ \ \ HTTPScope,}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00021}00021\ )}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00022}00022\ \textcolor{keyword}{from}\ \mbox{\hyperlink{namespaceuvicorn_1_1config}{uvicorn.config}}\ \textcolor{keyword}{import}\ Config}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00023}00023\ \textcolor{keyword}{from}\ \mbox{\hyperlink{namespaceuvicorn_1_1logging}{uvicorn.logging}}\ \textcolor{keyword}{import}\ TRACE\_LOG\_LEVEL}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00024}00024\ \textcolor{keyword}{from}\ \mbox{\hyperlink{namespaceuvicorn_1_1protocols_1_1http_1_1flow__control}{uvicorn.protocols.http.flow\_control}}\ \textcolor{keyword}{import}\ CLOSE\_HEADER,\ HIGH\_WATER\_LIMIT,\ FlowControl,\ service\_unavailable}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00025}00025\ \textcolor{keyword}{from}\ \mbox{\hyperlink{namespaceuvicorn_1_1protocols_1_1utils}{uvicorn.protocols.utils}}\ \textcolor{keyword}{import}\ get\_client\_addr,\ get\_local\_addr,\ get\_path\_with\_query\_string,\ get\_remote\_addr,\ is\_ssl}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00026}00026\ \textcolor{keyword}{from}\ \mbox{\hyperlink{namespaceuvicorn_1_1server}{uvicorn.server}}\ \textcolor{keyword}{import}\ ServerState}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00027}00027\ }
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00028}\mbox{\hyperlink{namespaceuvicorn_1_1protocols_1_1http_1_1httptools__impl_addbddec8db0f0d746e743ae6f71bc36e}{00028}}\ HEADER\_RE\ =\ re.compile(b\textcolor{stringliteral}{'[\(\backslash\)x00-\/\(\backslash\)x1f\(\backslash\)x7f()<>@,;:[]=\{\}\ \(\backslash\)t\(\backslash\)\(\backslash\)"{}]'})}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00029}\mbox{\hyperlink{namespaceuvicorn_1_1protocols_1_1http_1_1httptools__impl_ab58cf269b9de336847edc4e97d82ae3a}{00029}}\ HEADER\_VALUE\_RE\ =\ re.compile(b\textcolor{stringliteral}{"{}[\(\backslash\)x00-\/\(\backslash\)x08\(\backslash\)x0a-\/\(\backslash\)x1f\(\backslash\)x7f]"{}})}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00030}00030\ }
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00031}00031\ }
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00032}\mbox{\hyperlink{namespaceuvicorn_1_1protocols_1_1http_1_1httptools__impl_a7f37d7692bdf2a6ec8611fb13b143b1a}{00032}}\ \textcolor{keyword}{def\ }\mbox{\hyperlink{namespaceuvicorn_1_1protocols_1_1http_1_1httptools__impl_a7f37d7692bdf2a6ec8611fb13b143b1a}{\_get\_status\_line}}(status\_code:\ int)\ -\/>\ bytes:}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00033}00033\ \ \ \ \ \textcolor{keywordflow}{try}:}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00034}00034\ \ \ \ \ \ \ \ \ phrase\ =\ http.HTTPStatus(status\_code).phrase.encode()}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00035}00035\ \ \ \ \ \textcolor{keywordflow}{except}\ ValueError:}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00036}00036\ \ \ \ \ \ \ \ \ phrase\ =\ b\textcolor{stringliteral}{"{}"{}}}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00037}00037\ \ \ \ \ \textcolor{keywordflow}{return}\ b\textcolor{stringliteral}{"{}"{}}.join([b\textcolor{stringliteral}{"{}HTTP/1.1\ "{}},\ str(status\_code).encode(),\ b\textcolor{stringliteral}{"{}\ "{}},\ phrase,\ b\textcolor{stringliteral}{"{}\(\backslash\)r\(\backslash\)n"{}}])}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00038}00038\ }
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00039}00039\ }
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00040}\mbox{\hyperlink{namespaceuvicorn_1_1protocols_1_1http_1_1httptools__impl_a45dfb3423e6164e9fc9146564912d4f2}{00040}}\ STATUS\_LINE\ =\ \{status\_code:\ \mbox{\hyperlink{namespaceuvicorn_1_1protocols_1_1http_1_1httptools__impl_a7f37d7692bdf2a6ec8611fb13b143b1a}{\_get\_status\_line}}(status\_code)\ \textcolor{keywordflow}{for}\ status\_code\ \textcolor{keywordflow}{in}\ range(100,\ 600)\}}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00041}00041\ }
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00042}00042\ }
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00043}\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_http_tools_protocol}{00043}}\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_http_tools_protocol}{HttpToolsProtocol}}(asyncio.Protocol):}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00044}00044\ \ \ \ \ \textcolor{keyword}{def\ }\_\_init\_\_(}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00045}00045\ \ \ \ \ \ \ \ \ self,}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00046}00046\ \ \ \ \ \ \ \ \ config:\ Config,}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00047}00047\ \ \ \ \ \ \ \ \ server\_state:\ ServerState,}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00048}00048\ \ \ \ \ \ \ \ \ app\_state:\ dict[str,\ Any],}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00049}00049\ \ \ \ \ \ \ \ \ \_loop:\ asyncio.AbstractEventLoop\ |\ \textcolor{keywordtype}{None}\ =\ \textcolor{keywordtype}{None},}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00050}00050\ \ \ \ \ )\ -\/>\ \textcolor{keywordtype}{None}:}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00051}00051\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ \textcolor{keywordflow}{not}\ config.loaded:}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00052}00052\ \ \ \ \ \ \ \ \ \ \ \ \ config.load()}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00053}00053\ }
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00054}\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_http_tools_protocol_adfc84d59c178b29d79c9b6ec50c060f1}{00054}}\ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_http_tools_protocol_adfc84d59c178b29d79c9b6ec50c060f1}{config}}\ =\ config}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00055}\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_http_tools_protocol_a46d80f4c1103a1ce84fe0b1309003764}{00055}}\ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_http_tools_protocol_a46d80f4c1103a1ce84fe0b1309003764}{app}}\ =\ config.loaded\_app}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00056}\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_http_tools_protocol_ad32672c008cd4e7c2cc711967024de6e}{00056}}\ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_http_tools_protocol_ad32672c008cd4e7c2cc711967024de6e}{loop}}\ =\ \_loop\ \textcolor{keywordflow}{or}\ asyncio.get\_event\_loop()}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00057}\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_http_tools_protocol_a65d922eb9699d1d93cd19d64d65985f7}{00057}}\ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_http_tools_protocol_a65d922eb9699d1d93cd19d64d65985f7}{logger}}\ =\ logging.getLogger(\textcolor{stringliteral}{"{}uvicorn.error"{}})}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00058}\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_http_tools_protocol_ab5f44fd3142921f160d4ecadaaaf5a72}{00058}}\ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_http_tools_protocol_ab5f44fd3142921f160d4ecadaaaf5a72}{access\_logger}}\ =\ logging.getLogger(\textcolor{stringliteral}{"{}uvicorn.access"{}})}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00059}\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_http_tools_protocol_a24d17822c08747ebe9c91d9a9351af16}{00059}}\ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_http_tools_protocol_a24d17822c08747ebe9c91d9a9351af16}{access\_log}}\ =\ self.\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_http_tools_protocol_ab5f44fd3142921f160d4ecadaaaf5a72}{access\_logger}}.hasHandlers()}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00060}\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_http_tools_protocol_a455e8f8f8be8a97d9500ca87e5cd8b24}{00060}}\ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_http_tools_protocol_a455e8f8f8be8a97d9500ca87e5cd8b24}{parser}}\ =\ httptools.HttpRequestParser(self)}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00061}00061\ }
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00062}00062\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{try}:}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00063}00063\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ Enable\ dangerous\ leniencies\ to\ allow\ server\ to\ a\ response\ on\ the\ first\ request\ from\ a\ pipelined\ request.}}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00064}00064\ \ \ \ \ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_http_tools_protocol_a455e8f8f8be8a97d9500ca87e5cd8b24}{parser}}.set\_dangerous\_leniencies(lenient\_data\_after\_close=\textcolor{keyword}{True})}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00065}00065\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{except}\ AttributeError:\ \ \textcolor{comment}{\#\ pragma:\ no\ cover}}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00066}00066\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ httptools\ <\ 0.6.3}}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00067}00067\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{pass}}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00068}00068\ }
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00069}\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_http_tools_protocol_a63e8053f75ccc10c1ac05f4af4d79b34}{00069}}\ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_http_tools_protocol_a63e8053f75ccc10c1ac05f4af4d79b34}{ws\_protocol\_class}}\ =\ config.ws\_protocol\_class}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00070}\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_http_tools_protocol_a9bb4db9509df8a5cea25ed6bc7eaf1e9}{00070}}\ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_http_tools_protocol_a9bb4db9509df8a5cea25ed6bc7eaf1e9}{root\_path}}\ =\ config.root\_path}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00071}\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_http_tools_protocol_a795a4b3d36f9f92eb12b5d336bc50a43}{00071}}\ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_http_tools_protocol_a795a4b3d36f9f92eb12b5d336bc50a43}{limit\_concurrency}}\ =\ config.limit\_concurrency}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00072}\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_http_tools_protocol_accde2ce68f4719f00cc0b4b540195c14}{00072}}\ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_http_tools_protocol_accde2ce68f4719f00cc0b4b540195c14}{app\_state}}\ =\ app\_state}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00073}00073\ }
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00074}00074\ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ Timeouts}}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00075}\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_http_tools_protocol_a76d119508305a5632a45a10f14a8b05e}{00075}}\ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_http_tools_protocol_a76d119508305a5632a45a10f14a8b05e}{timeout\_keep\_alive\_task}}:\ TimerHandle\ |\ \textcolor{keywordtype}{None}\ =\ \textcolor{keywordtype}{None}}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00076}\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_http_tools_protocol_afe6453539b1df4dfebda9e8edbbf8bea}{00076}}\ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_http_tools_protocol_afe6453539b1df4dfebda9e8edbbf8bea}{timeout\_keep\_alive}}\ =\ config.timeout\_keep\_alive}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00077}00077\ }
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00078}00078\ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ Global\ state}}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00079}\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_http_tools_protocol_a1c098a68d34e3db3aa43ae1607c528b6}{00079}}\ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_http_tools_protocol_a1c098a68d34e3db3aa43ae1607c528b6}{server\_state}}\ =\ server\_state}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00080}\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_http_tools_protocol_a2562e06d487d8528ea05a565e9f873bf}{00080}}\ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_http_tools_protocol_a2562e06d487d8528ea05a565e9f873bf}{connections}}\ =\ server\_state.connections}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00081}\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_http_tools_protocol_ada081511f13f47de3dbeada1c50eb707}{00081}}\ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_http_tools_protocol_ada081511f13f47de3dbeada1c50eb707}{tasks}}\ =\ server\_state.tasks}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00082}00082\ }
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00083}00083\ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ Per-\/connection\ state}}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00084}\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_http_tools_protocol_a3c8866a6951a73a8c4f9077b480b346e}{00084}}\ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_http_tools_protocol_a3c8866a6951a73a8c4f9077b480b346e}{transport}}:\ asyncio.Transport\ =\ \textcolor{keywordtype}{None}\ \ \textcolor{comment}{\#\ type:\ ignore[assignment]}}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00085}\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_http_tools_protocol_a272900f438b37f306aa6d99ae3104ac5}{00085}}\ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_http_tools_protocol_a272900f438b37f306aa6d99ae3104ac5}{flow}}:\ FlowControl\ =\ \textcolor{keywordtype}{None}\ \ \textcolor{comment}{\#\ type:\ ignore[assignment]}}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00086}\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_http_tools_protocol_a374dc4648cdbb8adaff9fe1aa71a22b3}{00086}}\ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_http_tools_protocol_a374dc4648cdbb8adaff9fe1aa71a22b3}{server}}:\ tuple[str,\ int]\ |\ \textcolor{keywordtype}{None}\ =\ \textcolor{keywordtype}{None}}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00087}\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_http_tools_protocol_adb47d8042cc799f15294256d87d747b7}{00087}}\ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_http_tools_protocol_adb47d8042cc799f15294256d87d747b7}{client}}:\ tuple[str,\ int]\ |\ \textcolor{keywordtype}{None}\ =\ \textcolor{keywordtype}{None}}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00088}\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_http_tools_protocol_a2470c7b33934f59c53053c929fbbe14d}{00088}}\ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_http_tools_protocol_a2470c7b33934f59c53053c929fbbe14d}{scheme}}:\ Literal[\textcolor{stringliteral}{"{}http"{}},\ \textcolor{stringliteral}{"{}https"{}}]\ |\ \textcolor{keywordtype}{None}\ =\ \textcolor{keywordtype}{None}}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00089}\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_http_tools_protocol_ac923c9ee7a3508dc5c5fab3e4a0e4d6f}{00089}}\ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_http_tools_protocol_ac923c9ee7a3508dc5c5fab3e4a0e4d6f}{pipeline}}:\ deque[tuple[RequestResponseCycle,\ ASGI3Application]]\ =\ deque()}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00090}00090\ }
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00091}00091\ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ Per-\/request\ state}}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00092}\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_http_tools_protocol_af3c269fb643d846fe42df88fb2a91604}{00092}}\ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_http_tools_protocol_af3c269fb643d846fe42df88fb2a91604}{scope}}:\ HTTPScope\ =\ \textcolor{keywordtype}{None}\ \ \textcolor{comment}{\#\ type:\ ignore[assignment]}}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00093}\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_http_tools_protocol_aaa770f3aadf3c45f47ec7e5573ca3e01}{00093}}\ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_http_tools_protocol_aaa770f3aadf3c45f47ec7e5573ca3e01}{headers}}:\ list[tuple[bytes,\ bytes]]\ =\ \textcolor{keywordtype}{None}\ \ \textcolor{comment}{\#\ type:\ ignore[assignment]}}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00094}\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_http_tools_protocol_ab3a3133ad27c492e1beeb2d8085ce055}{00094}}\ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_http_tools_protocol_ab3a3133ad27c492e1beeb2d8085ce055}{expect\_100\_continue}}\ =\ \textcolor{keyword}{False}}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00095}\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_http_tools_protocol_a7389c98217997621f1e1b2828af727a3}{00095}}\ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_http_tools_protocol_a7389c98217997621f1e1b2828af727a3}{cycle}}:\ RequestResponseCycle\ =\ \textcolor{keywordtype}{None}\ \ \textcolor{comment}{\#\ type:\ ignore[assignment]}}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00096}00096\ }
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00097}00097\ \ \ \ \ \textcolor{comment}{\#\ Protocol\ interface}}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00098}\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_http_tools_protocol_a4cece86b74cfe6d075129114a63e291b}{00098}}\ \ \ \ \ \textcolor{keyword}{def\ }\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_http_tools_protocol_a4cece86b74cfe6d075129114a63e291b}{connection\_made}}(\ \ \textcolor{comment}{\#\ type:\ ignore[override]}}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00099}00099\ \ \ \ \ \ \ \ \ self,\ transport:\ asyncio.Transport}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00100}00100\ \ \ \ \ )\ -\/>\ \textcolor{keywordtype}{None}:}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00101}00101\ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_http_tools_protocol_a2562e06d487d8528ea05a565e9f873bf}{connections}}.add(self)}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00102}00102\ }
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00103}00103\ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_http_tools_protocol_a3c8866a6951a73a8c4f9077b480b346e}{transport}}\ =\ transport}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00104}00104\ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_http_tools_protocol_a272900f438b37f306aa6d99ae3104ac5}{flow}}\ =\ \mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1flow__control_1_1_flow_control}{FlowControl}}(transport)}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00105}00105\ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_http_tools_protocol_a374dc4648cdbb8adaff9fe1aa71a22b3}{server}}\ =\ get\_local\_addr(transport)}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00106}00106\ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_http_tools_protocol_adb47d8042cc799f15294256d87d747b7}{client}}\ =\ get\_remote\_addr(transport)}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00107}00107\ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_http_tools_protocol_a2470c7b33934f59c53053c929fbbe14d}{scheme}}\ =\ \textcolor{stringliteral}{"{}https"{}}\ \textcolor{keywordflow}{if}\ is\_ssl(transport)\ \textcolor{keywordflow}{else}\ \textcolor{stringliteral}{"{}http"{}}}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00108}00108\ }
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00109}00109\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ self.\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_http_tools_protocol_a65d922eb9699d1d93cd19d64d65985f7}{logger}}.level\ <=\ TRACE\_LOG\_LEVEL:}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00110}00110\ \ \ \ \ \ \ \ \ \ \ \ \ prefix\ =\ \textcolor{stringliteral}{"{}\%s:\%d\ -\/\ "{}}\ \%\ self.\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_http_tools_protocol_adb47d8042cc799f15294256d87d747b7}{client}}\ \textcolor{keywordflow}{if}\ self.\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_http_tools_protocol_adb47d8042cc799f15294256d87d747b7}{client}}\ \textcolor{keywordflow}{else}\ \textcolor{stringliteral}{"{}"{}}}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00111}00111\ \ \ \ \ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_http_tools_protocol_a65d922eb9699d1d93cd19d64d65985f7}{logger}}.log(TRACE\_LOG\_LEVEL,\ \textcolor{stringliteral}{"{}\%sHTTP\ connection\ made"{}},\ prefix)}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00112}00112\ }
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00113}\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_http_tools_protocol_aabcabc598f9e43965d8b6139acea14ba}{00113}}\ \ \ \ \ \textcolor{keyword}{def\ }\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_http_tools_protocol_aabcabc598f9e43965d8b6139acea14ba}{connection\_lost}}(self,\ exc:\ Exception\ |\ \textcolor{keywordtype}{None})\ -\/>\ \textcolor{keywordtype}{None}:}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00114}00114\ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_http_tools_protocol_a2562e06d487d8528ea05a565e9f873bf}{connections}}.discard(self)}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00115}00115\ }
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00116}00116\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ self.\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_http_tools_protocol_a65d922eb9699d1d93cd19d64d65985f7}{logger}}.level\ <=\ TRACE\_LOG\_LEVEL:}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00117}00117\ \ \ \ \ \ \ \ \ \ \ \ \ prefix\ =\ \textcolor{stringliteral}{"{}\%s:\%d\ -\/\ "{}}\ \%\ self.\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_http_tools_protocol_adb47d8042cc799f15294256d87d747b7}{client}}\ \textcolor{keywordflow}{if}\ self.\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_http_tools_protocol_adb47d8042cc799f15294256d87d747b7}{client}}\ \textcolor{keywordflow}{else}\ \textcolor{stringliteral}{"{}"{}}}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00118}00118\ \ \ \ \ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_http_tools_protocol_a65d922eb9699d1d93cd19d64d65985f7}{logger}}.log(TRACE\_LOG\_LEVEL,\ \textcolor{stringliteral}{"{}\%sHTTP\ connection\ lost"{}},\ prefix)}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00119}00119\ }
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00120}00120\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ self.\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_http_tools_protocol_a7389c98217997621f1e1b2828af727a3}{cycle}}\ \textcolor{keywordflow}{and}\ \textcolor{keywordflow}{not}\ self.\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_http_tools_protocol_a7389c98217997621f1e1b2828af727a3}{cycle}}.response\_complete:}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00121}00121\ \ \ \ \ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_http_tools_protocol_a7389c98217997621f1e1b2828af727a3}{cycle}}.disconnected\ =\ \textcolor{keyword}{True}}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00122}00122\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ self.\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_http_tools_protocol_a7389c98217997621f1e1b2828af727a3}{cycle}}\ \textcolor{keywordflow}{is}\ \textcolor{keywordflow}{not}\ \textcolor{keywordtype}{None}:}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00123}00123\ \ \ \ \ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_http_tools_protocol_a7389c98217997621f1e1b2828af727a3}{cycle}}.message\_event.set()}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00124}00124\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ self.\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_http_tools_protocol_a272900f438b37f306aa6d99ae3104ac5}{flow}}\ \textcolor{keywordflow}{is}\ \textcolor{keywordflow}{not}\ \textcolor{keywordtype}{None}:}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00125}00125\ \ \ \ \ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_http_tools_protocol_a272900f438b37f306aa6d99ae3104ac5}{flow}}.\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_http_tools_protocol_acfd00682e9af296b69dba07dc9f83603}{resume\_writing}}()}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00126}00126\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ exc\ \textcolor{keywordflow}{is}\ \textcolor{keywordtype}{None}:}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00127}00127\ \ \ \ \ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_http_tools_protocol_a3c8866a6951a73a8c4f9077b480b346e}{transport}}.close()}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00128}00128\ \ \ \ \ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_http_tools_protocol_a50379f4907595ac4593d5c4893f4d300}{\_unset\_keepalive\_if\_required}}()}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00129}00129\ }
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00130}00130\ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_http_tools_protocol_a455e8f8f8be8a97d9500ca87e5cd8b24}{parser}}\ =\ \textcolor{keywordtype}{None}}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00131}00131\ }
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00132}\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_http_tools_protocol_affc7a08fb8df9256b0d12b5ee58f9c76}{00132}}\ \ \ \ \ \textcolor{keyword}{def\ }\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_http_tools_protocol_affc7a08fb8df9256b0d12b5ee58f9c76}{eof\_received}}(self)\ -\/>\ None:}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00133}00133\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{pass}}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00134}00134\ }
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00135}\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_http_tools_protocol_a50379f4907595ac4593d5c4893f4d300}{00135}}\ \ \ \ \ \textcolor{keyword}{def\ }\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_http_tools_protocol_a50379f4907595ac4593d5c4893f4d300}{\_unset\_keepalive\_if\_required}}(self)\ -\/>\ None:}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00136}00136\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ self.timeout\_keep\_alive\_task\ \textcolor{keywordflow}{is}\ \textcolor{keywordflow}{not}\ \textcolor{keywordtype}{None}:}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00137}00137\ \ \ \ \ \ \ \ \ \ \ \ \ self.timeout\_keep\_alive\_task.cancel()}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00138}00138\ \ \ \ \ \ \ \ \ \ \ \ \ self.timeout\_keep\_alive\_task\ =\ \textcolor{keywordtype}{None}}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00139}00139\ }
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00140}\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_http_tools_protocol_a7263752813d819d77d11f608b8e4716c}{00140}}\ \ \ \ \ \textcolor{keyword}{def\ }\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_http_tools_protocol_a7263752813d819d77d11f608b8e4716c}{\_get\_upgrade}}(self)\ -\/>\ bytes\ |\ None:}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00141}00141\ \ \ \ \ \ \ \ \ connection\ =\ []}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00142}00142\ \ \ \ \ \ \ \ \ upgrade\ =\ \textcolor{keywordtype}{None}}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00143}00143\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ name,\ value\ \textcolor{keywordflow}{in}\ self.\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_http_tools_protocol_aaa770f3aadf3c45f47ec7e5573ca3e01}{headers}}:}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00144}00144\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ name\ ==\ b\textcolor{stringliteral}{"{}connection"{}}:}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00145}00145\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ connection\ =\ [token.lower().strip()\ \textcolor{keywordflow}{for}\ token\ \textcolor{keywordflow}{in}\ value.split(b\textcolor{stringliteral}{"{},"{}})]}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00146}00146\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ name\ ==\ b\textcolor{stringliteral}{"{}upgrade"{}}:}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00147}00147\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ upgrade\ =\ value.lower()}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00148}00148\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ b\textcolor{stringliteral}{"{}upgrade"{}}\ \textcolor{keywordflow}{in}\ connection:}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00149}00149\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ upgrade}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00150}00150\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keywordtype}{None}\ \ \textcolor{comment}{\#\ pragma:\ full\ coverage}}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00151}00151\ }
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00152}\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_http_tools_protocol_a09371357e1715b807b646fd0865f42e0}{00152}}\ \ \ \ \ \textcolor{keyword}{def\ }\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_http_tools_protocol_a09371357e1715b807b646fd0865f42e0}{\_should\_upgrade\_to\_ws}}(self)\ -\/>\ bool:}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00153}00153\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ self.\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_http_tools_protocol_a63e8053f75ccc10c1ac05f4af4d79b34}{ws\_protocol\_class}}\ \textcolor{keywordflow}{is}\ \textcolor{keywordtype}{None}:}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00154}00154\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{False}}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00155}00155\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keyword}{True}}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00156}00156\ }
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00157}\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_http_tools_protocol_a75261aff2e4643357eb3c06868866651}{00157}}\ \ \ \ \ \textcolor{keyword}{def\ }\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_http_tools_protocol_a75261aff2e4643357eb3c06868866651}{\_unsupported\_upgrade\_warning}}(self)\ -\/>\ None:}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00158}00158\ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_http_tools_protocol_a65d922eb9699d1d93cd19d64d65985f7}{logger}}.warning(\textcolor{stringliteral}{"{}Unsupported\ upgrade\ request."{}})}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00159}00159\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ \textcolor{keywordflow}{not}\ self.\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_http_tools_protocol_a09371357e1715b807b646fd0865f42e0}{\_should\_upgrade\_to\_ws}}():}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00160}00160\ \ \ \ \ \ \ \ \ \ \ \ \ msg\ =\ \textcolor{stringliteral}{"{}No\ supported\ WebSocket\ library\ detected.\ Please\ use\ \(\backslash\)"{}pip\ install\ 'uvicorn[standard]'\(\backslash\)"{},\ or\ install\ 'websockets'\ or\ 'wsproto'\ manually."{}}\ \ \textcolor{comment}{\#\ noqa:\ E501}}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00161}00161\ \ \ \ \ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_http_tools_protocol_a65d922eb9699d1d93cd19d64d65985f7}{logger}}.warning(msg)}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00162}00162\ }
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00163}\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_http_tools_protocol_a8cffb8e9a439328fb104a9991c6f2c0b}{00163}}\ \ \ \ \ \textcolor{keyword}{def\ }\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_http_tools_protocol_a8cffb8e9a439328fb104a9991c6f2c0b}{\_should\_upgrade}}(self)\ -\/>\ bool:}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00164}00164\ \ \ \ \ \ \ \ \ upgrade\ =\ self.\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_http_tools_protocol_a7263752813d819d77d11f608b8e4716c}{\_get\_upgrade}}()}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00165}00165\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ upgrade\ ==\ b\textcolor{stringliteral}{"{}websocket"{}}\ \textcolor{keywordflow}{and}\ self.\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_http_tools_protocol_a09371357e1715b807b646fd0865f42e0}{\_should\_upgrade\_to\_ws}}()}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00166}00166\ }
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00167}\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_http_tools_protocol_a34b976349dccf5b1784c9677bb717932}{00167}}\ \ \ \ \ \textcolor{keyword}{def\ }\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_http_tools_protocol_a34b976349dccf5b1784c9677bb717932}{data\_received}}(self,\ data:\ bytes)\ -\/>\ \textcolor{keywordtype}{None}:}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00168}00168\ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_http_tools_protocol_a50379f4907595ac4593d5c4893f4d300}{\_unset\_keepalive\_if\_required}}()}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00169}00169\ }
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00170}00170\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{try}:}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00171}00171\ \ \ \ \ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_http_tools_protocol_a455e8f8f8be8a97d9500ca87e5cd8b24}{parser}}.feed\_data(data)}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00172}00172\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{except}\ httptools.HttpParserError:}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00173}00173\ \ \ \ \ \ \ \ \ \ \ \ \ msg\ =\ \textcolor{stringliteral}{"{}Invalid\ HTTP\ request\ received."{}}}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00174}00174\ \ \ \ \ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_http_tools_protocol_a65d922eb9699d1d93cd19d64d65985f7}{logger}}.warning(msg)}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00175}00175\ \ \ \ \ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_http_tools_protocol_a1197faadae1e8eff5aa5735353cc9649}{send\_400\_response}}(msg)}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00176}00176\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00177}00177\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{except}\ httptools.HttpParserUpgrade:}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00178}00178\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ self.\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_http_tools_protocol_a8cffb8e9a439328fb104a9991c6f2c0b}{\_should\_upgrade}}():}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00179}00179\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_http_tools_protocol_abd2bb10b9b45828f176d6dd777e34e17}{handle\_websocket\_upgrade}}()}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00180}00180\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}:}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00181}00181\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_http_tools_protocol_a75261aff2e4643357eb3c06868866651}{\_unsupported\_upgrade\_warning}}()}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00182}00182\ }
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00183}\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_http_tools_protocol_abd2bb10b9b45828f176d6dd777e34e17}{00183}}\ \ \ \ \ \textcolor{keyword}{def\ }\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_http_tools_protocol_abd2bb10b9b45828f176d6dd777e34e17}{handle\_websocket\_upgrade}}(self)\ -\/>\ None:}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00184}00184\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ self.\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_http_tools_protocol_a65d922eb9699d1d93cd19d64d65985f7}{logger}}.level\ <=\ TRACE\_LOG\_LEVEL:}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00185}00185\ \ \ \ \ \ \ \ \ \ \ \ \ prefix\ =\ \textcolor{stringliteral}{"{}\%s:\%d\ -\/\ "{}}\ \%\ self.\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_http_tools_protocol_adb47d8042cc799f15294256d87d747b7}{client}}\ \textcolor{keywordflow}{if}\ self.\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_http_tools_protocol_adb47d8042cc799f15294256d87d747b7}{client}}\ \textcolor{keywordflow}{else}\ \textcolor{stringliteral}{"{}"{}}}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00186}00186\ \ \ \ \ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_http_tools_protocol_a65d922eb9699d1d93cd19d64d65985f7}{logger}}.log(TRACE\_LOG\_LEVEL,\ \textcolor{stringliteral}{"{}\%sUpgrading\ to\ WebSocket"{}},\ prefix)}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00187}00187\ }
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00188}00188\ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_http_tools_protocol_a2562e06d487d8528ea05a565e9f873bf}{connections}}.discard(self)}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00189}00189\ \ \ \ \ \ \ \ \ method\ =\ self.\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_http_tools_protocol_af3c269fb643d846fe42df88fb2a91604}{scope}}[\textcolor{stringliteral}{"{}method"{}}].encode()}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00190}00190\ \ \ \ \ \ \ \ \ output\ =\ [method,\ b\textcolor{stringliteral}{"{}\ "{}},\ self.\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_http_tools_protocol_a87d1dccc9bdf9831eeb62cb2ad62e1bd}{url}},\ b\textcolor{stringliteral}{"{}\ HTTP/1.1\(\backslash\)r\(\backslash\)n"{}}]}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00191}00191\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ name,\ value\ \textcolor{keywordflow}{in}\ self.\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_http_tools_protocol_af3c269fb643d846fe42df88fb2a91604}{scope}}[\textcolor{stringliteral}{"{}headers"{}}]:}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00192}00192\ \ \ \ \ \ \ \ \ \ \ \ \ output\ +=\ [name,\ b\textcolor{stringliteral}{"{}:\ "{}},\ value,\ b\textcolor{stringliteral}{"{}\(\backslash\)r\(\backslash\)n"{}}]}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00193}00193\ \ \ \ \ \ \ \ \ output.append(b\textcolor{stringliteral}{"{}\(\backslash\)r\(\backslash\)n"{}})}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00194}00194\ \ \ \ \ \ \ \ \ protocol\ =\ self.\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_http_tools_protocol_a63e8053f75ccc10c1ac05f4af4d79b34}{ws\_protocol\_class}}(\ \ \textcolor{comment}{\#\ type:\ ignore[call-\/arg,\ misc]}}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00195}00195\ \ \ \ \ \ \ \ \ \ \ \ \ config=self.\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_http_tools_protocol_adfc84d59c178b29d79c9b6ec50c060f1}{config}},}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00196}00196\ \ \ \ \ \ \ \ \ \ \ \ \ server\_state=self.\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_http_tools_protocol_a1c098a68d34e3db3aa43ae1607c528b6}{server\_state}},}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00197}00197\ \ \ \ \ \ \ \ \ \ \ \ \ app\_state=self.\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_http_tools_protocol_accde2ce68f4719f00cc0b4b540195c14}{app\_state}},}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00198}00198\ \ \ \ \ \ \ \ \ )}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00199}00199\ \ \ \ \ \ \ \ \ protocol.connection\_made(self.\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_http_tools_protocol_a3c8866a6951a73a8c4f9077b480b346e}{transport}})}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00200}00200\ \ \ \ \ \ \ \ \ protocol.data\_received(b\textcolor{stringliteral}{"{}"{}}.join(output))}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00201}00201\ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_http_tools_protocol_a3c8866a6951a73a8c4f9077b480b346e}{transport}}.set\_protocol(protocol)}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00202}00202\ }
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00203}\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_http_tools_protocol_a1197faadae1e8eff5aa5735353cc9649}{00203}}\ \ \ \ \ \textcolor{keyword}{def\ }\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_http_tools_protocol_a1197faadae1e8eff5aa5735353cc9649}{send\_400\_response}}(self,\ msg:\ str)\ -\/>\ \textcolor{keywordtype}{None}:}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00204}00204\ \ \ \ \ \ \ \ \ content\ =\ [STATUS\_LINE[400]]}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00205}00205\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ name,\ value\ \textcolor{keywordflow}{in}\ self.\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_http_tools_protocol_a1c098a68d34e3db3aa43ae1607c528b6}{server\_state}}.default\_headers:}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00206}00206\ \ \ \ \ \ \ \ \ \ \ \ \ content.extend([name,\ b\textcolor{stringliteral}{"{}:\ "{}},\ value,\ b\textcolor{stringliteral}{"{}\(\backslash\)r\(\backslash\)n"{}}])\ \ \textcolor{comment}{\#\ pragma:\ full\ coverage}}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00207}00207\ \ \ \ \ \ \ \ \ content.extend(}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00208}00208\ \ \ \ \ \ \ \ \ \ \ \ \ [}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00209}00209\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ b\textcolor{stringliteral}{"{}content-\/type:\ text/plain;\ charset=utf-\/8\(\backslash\)r\(\backslash\)n"{}},}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00210}00210\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ b\textcolor{stringliteral}{"{}content-\/length:\ "{}}\ +\ str(len(msg)).encode(\textcolor{stringliteral}{"{}ascii"{}})\ +\ b\textcolor{stringliteral}{"{}\(\backslash\)r\(\backslash\)n"{}},}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00211}00211\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ b\textcolor{stringliteral}{"{}connection:\ close\(\backslash\)r\(\backslash\)n"{}},}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00212}00212\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ b\textcolor{stringliteral}{"{}\(\backslash\)r\(\backslash\)n"{}},}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00213}00213\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ msg.encode(\textcolor{stringliteral}{"{}ascii"{}}),}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00214}00214\ \ \ \ \ \ \ \ \ \ \ \ \ ]}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00215}00215\ \ \ \ \ \ \ \ \ )}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00216}00216\ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_http_tools_protocol_a3c8866a6951a73a8c4f9077b480b346e}{transport}}.write(b\textcolor{stringliteral}{"{}"{}}.join(content))}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00217}00217\ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_http_tools_protocol_a3c8866a6951a73a8c4f9077b480b346e}{transport}}.close()}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00218}00218\ }
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00219}\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_http_tools_protocol_a6b5845fcdb07d309581f12ad0c96e9c8}{00219}}\ \ \ \ \ \textcolor{keyword}{def\ }\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_http_tools_protocol_a6b5845fcdb07d309581f12ad0c96e9c8}{on\_message\_begin}}(self)\ -\/>\ None:}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00220}\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_http_tools_protocol_a87d1dccc9bdf9831eeb62cb2ad62e1bd}{00220}}\ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_http_tools_protocol_a87d1dccc9bdf9831eeb62cb2ad62e1bd}{url}}\ =\ b\textcolor{stringliteral}{"{}"{}}}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00221}00221\ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_http_tools_protocol_ab3a3133ad27c492e1beeb2d8085ce055}{expect\_100\_continue}}\ =\ \textcolor{keyword}{False}}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00222}00222\ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_http_tools_protocol_aaa770f3aadf3c45f47ec7e5573ca3e01}{headers}}\ =\ []}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00223}00223\ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_http_tools_protocol_af3c269fb643d846fe42df88fb2a91604}{scope}}\ =\ \{\ \ \textcolor{comment}{\#\ type:\ ignore[typeddict-\/item]}}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00224}00224\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}type"{}}:\ \textcolor{stringliteral}{"{}http"{}},}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00225}00225\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}asgi"{}}:\ \{\textcolor{stringliteral}{"{}version"{}}:\ self.\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_http_tools_protocol_adfc84d59c178b29d79c9b6ec50c060f1}{config}}.asgi\_version,\ \textcolor{stringliteral}{"{}spec\_version"{}}:\ \textcolor{stringliteral}{"{}2.3"{}}\},}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00226}00226\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}http\_version"{}}:\ \textcolor{stringliteral}{"{}1.1"{}},}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00227}00227\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}server"{}}:\ self.\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_http_tools_protocol_a374dc4648cdbb8adaff9fe1aa71a22b3}{server}},}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00228}00228\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}client"{}}:\ self.\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_http_tools_protocol_adb47d8042cc799f15294256d87d747b7}{client}},}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00229}00229\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}scheme"{}}:\ self.\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_http_tools_protocol_a2470c7b33934f59c53053c929fbbe14d}{scheme}},\ \ \textcolor{comment}{\#\ type:\ ignore[typeddict-\/item]}}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00230}00230\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}root\_path"{}}:\ self.\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_http_tools_protocol_a9bb4db9509df8a5cea25ed6bc7eaf1e9}{root\_path}},}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00231}00231\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}headers"{}}:\ self.\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_http_tools_protocol_aaa770f3aadf3c45f47ec7e5573ca3e01}{headers}},}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00232}00232\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}state"{}}:\ self.\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_http_tools_protocol_accde2ce68f4719f00cc0b4b540195c14}{app\_state}}.copy(),}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00233}00233\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00234}00234\ }
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00235}00235\ \ \ \ \ \textcolor{comment}{\#\ Parser\ callbacks}}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00236}\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_http_tools_protocol_adf812e88d6d5a779388682e8fd44356a}{00236}}\ \ \ \ \ \textcolor{keyword}{def\ }\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_http_tools_protocol_adf812e88d6d5a779388682e8fd44356a}{on\_url}}(self,\ url:\ bytes)\ -\/>\ \textcolor{keywordtype}{None}:}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00237}00237\ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_http_tools_protocol_a87d1dccc9bdf9831eeb62cb2ad62e1bd}{url}}\ +=\ url}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00238}00238\ }
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00239}\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_http_tools_protocol_aa1f68c377a5b0aab0dbc0fcb917c107f}{00239}}\ \ \ \ \ \textcolor{keyword}{def\ }\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_http_tools_protocol_aa1f68c377a5b0aab0dbc0fcb917c107f}{on\_header}}(self,\ name:\ bytes,\ value:\ bytes)\ -\/>\ \textcolor{keywordtype}{None}:}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00240}00240\ \ \ \ \ \ \ \ \ name\ =\ name.lower()}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00241}00241\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ name\ ==\ b\textcolor{stringliteral}{"{}expect"{}}\ \textcolor{keywordflow}{and}\ value.lower()\ ==\ b\textcolor{stringliteral}{"{}100-\/continue"{}}:}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00242}00242\ \ \ \ \ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_http_tools_protocol_ab3a3133ad27c492e1beeb2d8085ce055}{expect\_100\_continue}}\ =\ \textcolor{keyword}{True}}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00243}00243\ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_http_tools_protocol_aaa770f3aadf3c45f47ec7e5573ca3e01}{headers}}.append((name,\ value))}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00244}00244\ }
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00245}\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_http_tools_protocol_ae7bdd66ecfc58647ec5b68dfac3cae65}{00245}}\ \ \ \ \ \textcolor{keyword}{def\ }\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_http_tools_protocol_ae7bdd66ecfc58647ec5b68dfac3cae65}{on\_headers\_complete}}(self)\ -\/>\ None:}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00246}00246\ \ \ \ \ \ \ \ \ http\_version\ =\ self.\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_http_tools_protocol_a455e8f8f8be8a97d9500ca87e5cd8b24}{parser}}.get\_http\_version()}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00247}00247\ \ \ \ \ \ \ \ \ method\ =\ self.\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_http_tools_protocol_a455e8f8f8be8a97d9500ca87e5cd8b24}{parser}}.get\_method()}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00248}00248\ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_http_tools_protocol_af3c269fb643d846fe42df88fb2a91604}{scope}}[\textcolor{stringliteral}{"{}method"{}}]\ =\ method.decode(\textcolor{stringliteral}{"{}ascii"{}})}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00249}00249\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ http\_version\ !=\ \textcolor{stringliteral}{"{}1.1"{}}:}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00250}00250\ \ \ \ \ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_http_tools_protocol_af3c269fb643d846fe42df88fb2a91604}{scope}}[\textcolor{stringliteral}{"{}http\_version"{}}]\ =\ http\_version}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00251}00251\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ self.\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_http_tools_protocol_a455e8f8f8be8a97d9500ca87e5cd8b24}{parser}}.should\_upgrade()\ \textcolor{keywordflow}{and}\ self.\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_http_tools_protocol_a8cffb8e9a439328fb104a9991c6f2c0b}{\_should\_upgrade}}():}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00252}00252\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00253}00253\ \ \ \ \ \ \ \ \ parsed\_url\ =\ httptools.parse\_url(self.\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_http_tools_protocol_a87d1dccc9bdf9831eeb62cb2ad62e1bd}{url}})}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00254}00254\ \ \ \ \ \ \ \ \ raw\_path\ =\ parsed\_url.path}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00255}00255\ \ \ \ \ \ \ \ \ path\ =\ raw\_path.decode(\textcolor{stringliteral}{"{}ascii"{}})}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00256}00256\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ \textcolor{stringliteral}{"{}\%"{}}\ \textcolor{keywordflow}{in}\ path:}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00257}00257\ \ \ \ \ \ \ \ \ \ \ \ \ path\ =\ urllib.parse.unquote(path)}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00258}00258\ \ \ \ \ \ \ \ \ full\_path\ =\ self.\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_http_tools_protocol_a9bb4db9509df8a5cea25ed6bc7eaf1e9}{root\_path}}\ +\ path}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00259}00259\ \ \ \ \ \ \ \ \ full\_raw\_path\ =\ self.\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_http_tools_protocol_a9bb4db9509df8a5cea25ed6bc7eaf1e9}{root\_path}}.encode(\textcolor{stringliteral}{"{}ascii"{}})\ +\ raw\_path}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00260}00260\ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_http_tools_protocol_af3c269fb643d846fe42df88fb2a91604}{scope}}[\textcolor{stringliteral}{"{}path"{}}]\ =\ full\_path}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00261}00261\ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_http_tools_protocol_af3c269fb643d846fe42df88fb2a91604}{scope}}[\textcolor{stringliteral}{"{}raw\_path"{}}]\ =\ full\_raw\_path}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00262}00262\ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_http_tools_protocol_af3c269fb643d846fe42df88fb2a91604}{scope}}[\textcolor{stringliteral}{"{}query\_string"{}}]\ =\ parsed\_url.query\ \textcolor{keywordflow}{or}\ b\textcolor{stringliteral}{"{}"{}}}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00263}00263\ }
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00264}00264\ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ Handle\ 503\ responses\ when\ 'limit\_concurrency'\ is\ exceeded.}}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00265}00265\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ self.\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_http_tools_protocol_a795a4b3d36f9f92eb12b5d336bc50a43}{limit\_concurrency}}\ \textcolor{keywordflow}{is}\ \textcolor{keywordflow}{not}\ \textcolor{keywordtype}{None}\ \textcolor{keywordflow}{and}\ (}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00266}00266\ \ \ \ \ \ \ \ \ \ \ \ \ len(self.\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_http_tools_protocol_a2562e06d487d8528ea05a565e9f873bf}{connections}})\ >=\ self.\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_http_tools_protocol_a795a4b3d36f9f92eb12b5d336bc50a43}{limit\_concurrency}}\ \textcolor{keywordflow}{or}\ len(self.\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_http_tools_protocol_ada081511f13f47de3dbeada1c50eb707}{tasks}})\ >=\ self.\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_http_tools_protocol_a795a4b3d36f9f92eb12b5d336bc50a43}{limit\_concurrency}}}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00267}00267\ \ \ \ \ \ \ \ \ ):}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00268}00268\ \ \ \ \ \ \ \ \ \ \ \ \ app\ =\ service\_unavailable}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00269}00269\ \ \ \ \ \ \ \ \ \ \ \ \ message\ =\ \textcolor{stringliteral}{"{}Exceeded\ concurrency\ limit."{}}}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00270}00270\ \ \ \ \ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_http_tools_protocol_a65d922eb9699d1d93cd19d64d65985f7}{logger}}.warning(message)}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00271}00271\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}:}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00272}00272\ \ \ \ \ \ \ \ \ \ \ \ \ app\ =\ self.\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_http_tools_protocol_a46d80f4c1103a1ce84fe0b1309003764}{app}}}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00273}00273\ }
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00274}00274\ \ \ \ \ \ \ \ \ existing\_cycle\ =\ self.\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_http_tools_protocol_a7389c98217997621f1e1b2828af727a3}{cycle}}}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00275}00275\ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_http_tools_protocol_a7389c98217997621f1e1b2828af727a3}{cycle}}\ =\ \mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_request_response_cycle}{RequestResponseCycle}}(}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00276}00276\ \ \ \ \ \ \ \ \ \ \ \ \ scope=self.\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_http_tools_protocol_af3c269fb643d846fe42df88fb2a91604}{scope}},}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00277}00277\ \ \ \ \ \ \ \ \ \ \ \ \ transport=self.\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_http_tools_protocol_a3c8866a6951a73a8c4f9077b480b346e}{transport}},}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00278}00278\ \ \ \ \ \ \ \ \ \ \ \ \ flow=self.\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_http_tools_protocol_a272900f438b37f306aa6d99ae3104ac5}{flow}},}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00279}00279\ \ \ \ \ \ \ \ \ \ \ \ \ logger=self.\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_http_tools_protocol_a65d922eb9699d1d93cd19d64d65985f7}{logger}},}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00280}00280\ \ \ \ \ \ \ \ \ \ \ \ \ access\_logger=self.\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_http_tools_protocol_ab5f44fd3142921f160d4ecadaaaf5a72}{access\_logger}},}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00281}00281\ \ \ \ \ \ \ \ \ \ \ \ \ access\_log=self.\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_http_tools_protocol_a24d17822c08747ebe9c91d9a9351af16}{access\_log}},}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00282}00282\ \ \ \ \ \ \ \ \ \ \ \ \ default\_headers=self.\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_http_tools_protocol_a1c098a68d34e3db3aa43ae1607c528b6}{server\_state}}.default\_headers,}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00283}00283\ \ \ \ \ \ \ \ \ \ \ \ \ message\_event=asyncio.Event(),}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00284}00284\ \ \ \ \ \ \ \ \ \ \ \ \ expect\_100\_continue=self.\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_http_tools_protocol_ab3a3133ad27c492e1beeb2d8085ce055}{expect\_100\_continue}},}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00285}00285\ \ \ \ \ \ \ \ \ \ \ \ \ keep\_alive=http\_version\ !=\ \textcolor{stringliteral}{"{}1.0"{}},}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00286}00286\ \ \ \ \ \ \ \ \ \ \ \ \ on\_response=self.\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_http_tools_protocol_a857c07c632fe0f29f104bae44f56c999}{on\_response\_complete}},}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00287}00287\ \ \ \ \ \ \ \ \ )}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00288}00288\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ existing\_cycle\ \textcolor{keywordflow}{is}\ \textcolor{keywordtype}{None}\ \textcolor{keywordflow}{or}\ existing\_cycle.response\_complete:}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00289}00289\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ Standard\ case\ -\/\ start\ processing\ the\ request.}}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00290}00290\ \ \ \ \ \ \ \ \ \ \ \ \ task\ =\ self.\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_http_tools_protocol_ad32672c008cd4e7c2cc711967024de6e}{loop}}.create\_task(self.\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_http_tools_protocol_a7389c98217997621f1e1b2828af727a3}{cycle}}.run\_asgi(app))}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00291}00291\ \ \ \ \ \ \ \ \ \ \ \ \ task.add\_done\_callback(self.\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_http_tools_protocol_ada081511f13f47de3dbeada1c50eb707}{tasks}}.discard)}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00292}00292\ \ \ \ \ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_http_tools_protocol_ada081511f13f47de3dbeada1c50eb707}{tasks}}.add(task)}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00293}00293\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}:}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00294}00294\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ Pipelined\ HTTP\ requests\ need\ to\ be\ queued\ up.}}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00295}00295\ \ \ \ \ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_http_tools_protocol_a272900f438b37f306aa6d99ae3104ac5}{flow}}.pause\_reading()}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00296}00296\ \ \ \ \ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_http_tools_protocol_ac923c9ee7a3508dc5c5fab3e4a0e4d6f}{pipeline}}.appendleft((self.\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_http_tools_protocol_a7389c98217997621f1e1b2828af727a3}{cycle}},\ app))}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00297}00297\ }
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00298}\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_http_tools_protocol_aae2e15bd836c1248cce399d6997b6d08}{00298}}\ \ \ \ \ \textcolor{keyword}{def\ }\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_http_tools_protocol_aae2e15bd836c1248cce399d6997b6d08}{on\_body}}(self,\ body:\ bytes)\ -\/>\ \textcolor{keywordtype}{None}:}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00299}00299\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (self.\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_http_tools_protocol_a455e8f8f8be8a97d9500ca87e5cd8b24}{parser}}.should\_upgrade()\ \textcolor{keywordflow}{and}\ self.\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_http_tools_protocol_a8cffb8e9a439328fb104a9991c6f2c0b}{\_should\_upgrade}}())\ \textcolor{keywordflow}{or}\ self.\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_http_tools_protocol_a7389c98217997621f1e1b2828af727a3}{cycle}}.response\_complete:}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00300}00300\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00301}00301\ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_http_tools_protocol_a7389c98217997621f1e1b2828af727a3}{cycle}}.body\ +=\ body}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00302}00302\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ len(self.\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_http_tools_protocol_a7389c98217997621f1e1b2828af727a3}{cycle}}.body)\ >\ HIGH\_WATER\_LIMIT:}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00303}00303\ \ \ \ \ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_http_tools_protocol_a272900f438b37f306aa6d99ae3104ac5}{flow}}.pause\_reading()}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00304}00304\ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_http_tools_protocol_a7389c98217997621f1e1b2828af727a3}{cycle}}.message\_event.set()}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00305}00305\ }
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00306}\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_http_tools_protocol_a2f4392c28c90972d474bc25a82d1ea55}{00306}}\ \ \ \ \ \textcolor{keyword}{def\ }\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_http_tools_protocol_a2f4392c28c90972d474bc25a82d1ea55}{on\_message\_complete}}(self)\ -\/>\ None:}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00307}00307\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (self.\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_http_tools_protocol_a455e8f8f8be8a97d9500ca87e5cd8b24}{parser}}.should\_upgrade()\ \textcolor{keywordflow}{and}\ self.\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_http_tools_protocol_a8cffb8e9a439328fb104a9991c6f2c0b}{\_should\_upgrade}}())\ \textcolor{keywordflow}{or}\ self.\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_http_tools_protocol_a7389c98217997621f1e1b2828af727a3}{cycle}}.response\_complete:}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00308}00308\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00309}00309\ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_http_tools_protocol_a7389c98217997621f1e1b2828af727a3}{cycle}}.more\_body\ =\ \textcolor{keyword}{False}}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00310}00310\ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_http_tools_protocol_a7389c98217997621f1e1b2828af727a3}{cycle}}.message\_event.set()}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00311}00311\ }
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00312}\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_http_tools_protocol_a857c07c632fe0f29f104bae44f56c999}{00312}}\ \ \ \ \ \textcolor{keyword}{def\ }\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_http_tools_protocol_a857c07c632fe0f29f104bae44f56c999}{on\_response\_complete}}(self)\ -\/>\ None:}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00313}00313\ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ Callback\ for\ pipelined\ HTTP\ requests\ to\ be\ started.}}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00314}00314\ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_http_tools_protocol_a1c098a68d34e3db3aa43ae1607c528b6}{server\_state}}.total\_requests\ +=\ 1}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00315}00315\ }
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00316}00316\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ self.\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_http_tools_protocol_a3c8866a6951a73a8c4f9077b480b346e}{transport}}.is\_closing():}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00317}00317\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00318}00318\ }
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00319}00319\ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_http_tools_protocol_a50379f4907595ac4593d5c4893f4d300}{\_unset\_keepalive\_if\_required}}()}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00320}00320\ }
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00321}00321\ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ Unpause\ data\ reads\ if\ needed.}}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00322}00322\ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_http_tools_protocol_a272900f438b37f306aa6d99ae3104ac5}{flow}}.resume\_reading()}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00323}00323\ }
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00324}00324\ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ Unblock\ any\ pipelined\ events.\ If\ there\ are\ none,\ arm\ the}}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00325}00325\ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ Keep-\/Alive\ timeout\ instead.}}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00326}00326\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ self.\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_http_tools_protocol_ac923c9ee7a3508dc5c5fab3e4a0e4d6f}{pipeline}}:}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00327}00327\ \ \ \ \ \ \ \ \ \ \ \ \ cycle,\ app\ =\ self.\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_http_tools_protocol_ac923c9ee7a3508dc5c5fab3e4a0e4d6f}{pipeline}}.pop()}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00328}00328\ \ \ \ \ \ \ \ \ \ \ \ \ task\ =\ self.\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_http_tools_protocol_ad32672c008cd4e7c2cc711967024de6e}{loop}}.create\_task(cycle.run\_asgi(app))}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00329}00329\ \ \ \ \ \ \ \ \ \ \ \ \ task.add\_done\_callback(self.\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_http_tools_protocol_ada081511f13f47de3dbeada1c50eb707}{tasks}}.discard)}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00330}00330\ \ \ \ \ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_http_tools_protocol_ada081511f13f47de3dbeada1c50eb707}{tasks}}.add(task)}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00331}00331\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}:}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00332}00332\ \ \ \ \ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_http_tools_protocol_a76d119508305a5632a45a10f14a8b05e}{timeout\_keep\_alive\_task}}\ =\ self.\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_http_tools_protocol_ad32672c008cd4e7c2cc711967024de6e}{loop}}.call\_later(}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00333}00333\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_http_tools_protocol_afe6453539b1df4dfebda9e8edbbf8bea}{timeout\_keep\_alive}},\ self.\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_http_tools_protocol_aa75d9f93ab8a0ba70667a80ccd09d1d9}{timeout\_keep\_alive\_handler}}}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00334}00334\ \ \ \ \ \ \ \ \ \ \ \ \ )}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00335}00335\ }
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00336}\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_http_tools_protocol_a44940aa1c9387033619d824f941f2971}{00336}}\ \ \ \ \ \textcolor{keyword}{def\ }\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_http_tools_protocol_a44940aa1c9387033619d824f941f2971}{shutdown}}(self)\ -\/>\ None:}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00337}00337\ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}"{}"{}}}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00338}00338\ \textcolor{stringliteral}{\ \ \ \ \ \ \ \ Called\ by\ the\ server\ to\ commence\ a\ graceful\ shutdown.}}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00339}00339\ \textcolor{stringliteral}{\ \ \ \ \ \ \ \ "{}"{}"{}}}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00340}00340\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ self.\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_http_tools_protocol_a7389c98217997621f1e1b2828af727a3}{cycle}}\ \textcolor{keywordflow}{is}\ \textcolor{keywordtype}{None}\ \textcolor{keywordflow}{or}\ self.\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_http_tools_protocol_a7389c98217997621f1e1b2828af727a3}{cycle}}.response\_complete:}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00341}00341\ \ \ \ \ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_http_tools_protocol_a3c8866a6951a73a8c4f9077b480b346e}{transport}}.close()}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00342}00342\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}:}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00343}00343\ \ \ \ \ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_http_tools_protocol_a7389c98217997621f1e1b2828af727a3}{cycle}}.keep\_alive\ =\ \textcolor{keyword}{False}}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00344}00344\ }
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00345}\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_http_tools_protocol_a37d16289e0c75f181e82ec353407128f}{00345}}\ \ \ \ \ \textcolor{keyword}{def\ }\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_http_tools_protocol_a37d16289e0c75f181e82ec353407128f}{pause\_writing}}(self)\ -\/>\ None:}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00346}00346\ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}"{}"{}}}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00347}00347\ \textcolor{stringliteral}{\ \ \ \ \ \ \ \ Called\ by\ the\ transport\ when\ the\ write\ buffer\ exceeds\ the\ high\ water\ mark.}}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00348}00348\ \textcolor{stringliteral}{\ \ \ \ \ \ \ \ "{}"{}"{}}}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00349}00349\ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_http_tools_protocol_a272900f438b37f306aa6d99ae3104ac5}{flow}}.\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_http_tools_protocol_a37d16289e0c75f181e82ec353407128f}{pause\_writing}}()\ \ \textcolor{comment}{\#\ pragma:\ full\ coverage}}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00350}00350\ }
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00351}\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_http_tools_protocol_acfd00682e9af296b69dba07dc9f83603}{00351}}\ \ \ \ \ \textcolor{keyword}{def\ }\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_http_tools_protocol_acfd00682e9af296b69dba07dc9f83603}{resume\_writing}}(self)\ -\/>\ None:}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00352}00352\ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}"{}"{}}}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00353}00353\ \textcolor{stringliteral}{\ \ \ \ \ \ \ \ Called\ by\ the\ transport\ when\ the\ write\ buffer\ drops\ below\ the\ low\ water\ mark.}}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00354}00354\ \textcolor{stringliteral}{\ \ \ \ \ \ \ \ "{}"{}"{}}}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00355}00355\ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_http_tools_protocol_a272900f438b37f306aa6d99ae3104ac5}{flow}}.\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_http_tools_protocol_acfd00682e9af296b69dba07dc9f83603}{resume\_writing}}()\ \ \textcolor{comment}{\#\ pragma:\ full\ coverage}}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00356}00356\ }
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00357}\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_http_tools_protocol_aa75d9f93ab8a0ba70667a80ccd09d1d9}{00357}}\ \ \ \ \ \textcolor{keyword}{def\ }\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_http_tools_protocol_aa75d9f93ab8a0ba70667a80ccd09d1d9}{timeout\_keep\_alive\_handler}}(self)\ -\/>\ None:}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00358}00358\ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}"{}"{}}}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00359}00359\ \textcolor{stringliteral}{\ \ \ \ \ \ \ \ Called\ on\ a\ keep-\/alive\ connection\ if\ no\ new\ data\ is\ received\ after\ a\ short}}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00360}00360\ \textcolor{stringliteral}{\ \ \ \ \ \ \ \ delay.}}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00361}00361\ \textcolor{stringliteral}{\ \ \ \ \ \ \ \ "{}"{}"{}}}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00362}00362\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ \textcolor{keywordflow}{not}\ self.\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_http_tools_protocol_a3c8866a6951a73a8c4f9077b480b346e}{transport}}.is\_closing():}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00363}00363\ \ \ \ \ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_http_tools_protocol_a3c8866a6951a73a8c4f9077b480b346e}{transport}}.close()}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00364}00364\ }
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00365}00365\ }
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00366}\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_request_response_cycle}{00366}}\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_request_response_cycle}{RequestResponseCycle}}:}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00367}00367\ \ \ \ \ \textcolor{keyword}{def\ }\_\_init\_\_(}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00368}00368\ \ \ \ \ \ \ \ \ self,}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00369}00369\ \ \ \ \ \ \ \ \ scope:\ HTTPScope,}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00370}00370\ \ \ \ \ \ \ \ \ transport:\ asyncio.Transport,}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00371}00371\ \ \ \ \ \ \ \ \ flow:\ FlowControl,}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00372}00372\ \ \ \ \ \ \ \ \ logger:\ logging.Logger,}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00373}00373\ \ \ \ \ \ \ \ \ access\_logger:\ logging.Logger,}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00374}00374\ \ \ \ \ \ \ \ \ access\_log:\ bool,}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00375}00375\ \ \ \ \ \ \ \ \ default\_headers:\ list[tuple[bytes,\ bytes]],}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00376}00376\ \ \ \ \ \ \ \ \ message\_event:\ asyncio.Event,}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00377}00377\ \ \ \ \ \ \ \ \ expect\_100\_continue:\ bool,}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00378}00378\ \ \ \ \ \ \ \ \ keep\_alive:\ bool,}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00379}00379\ \ \ \ \ \ \ \ \ on\_response:\ Callable[...,\ \textcolor{keywordtype}{None}],}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00380}00380\ \ \ \ \ ):}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00381}\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_request_response_cycle_a7df261ea4fce132817f79391ac4c48ef}{00381}}\ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_request_response_cycle_a7df261ea4fce132817f79391ac4c48ef}{scope}}\ =\ scope}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00382}\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_request_response_cycle_a71133a73ede8d69d0618a311e8b9f1a6}{00382}}\ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_request_response_cycle_a71133a73ede8d69d0618a311e8b9f1a6}{transport}}\ =\ transport}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00383}\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_request_response_cycle_ab58a45c6476b039a4600a021c4b8a6cd}{00383}}\ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_request_response_cycle_ab58a45c6476b039a4600a021c4b8a6cd}{flow}}\ =\ flow}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00384}\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_request_response_cycle_a1b49a9eba1afbdc2685505e972c72ad3}{00384}}\ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_request_response_cycle_a1b49a9eba1afbdc2685505e972c72ad3}{logger}}\ =\ logger}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00385}\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_request_response_cycle_a34c41b47cdaec04c8c6df3b81725e0fb}{00385}}\ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_request_response_cycle_a34c41b47cdaec04c8c6df3b81725e0fb}{access\_logger}}\ =\ access\_logger}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00386}\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_request_response_cycle_acffa1bf7dcda7261edc25ae9aebfa221}{00386}}\ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_request_response_cycle_acffa1bf7dcda7261edc25ae9aebfa221}{access\_log}}\ =\ access\_log}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00387}\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_request_response_cycle_a4fcf264afff0d7e5db40d0d9cfd69250}{00387}}\ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_request_response_cycle_a4fcf264afff0d7e5db40d0d9cfd69250}{default\_headers}}\ =\ default\_headers}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00388}\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_request_response_cycle_a55008802268cc96319bf29555145157b}{00388}}\ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_request_response_cycle_a55008802268cc96319bf29555145157b}{message\_event}}\ =\ message\_event}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00389}\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_request_response_cycle_a93dfefd61810baf9d00159c745f104ea}{00389}}\ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_request_response_cycle_a93dfefd61810baf9d00159c745f104ea}{on\_response}}\ =\ on\_response}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00390}00390\ }
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00391}00391\ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ Connection\ state}}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00392}\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_request_response_cycle_a1fdd3a8bb82821f4de6a9a5b90567b03}{00392}}\ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_request_response_cycle_a1fdd3a8bb82821f4de6a9a5b90567b03}{disconnected}}\ =\ \textcolor{keyword}{False}}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00393}\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_request_response_cycle_a5f67a9e0991181d2d55479b6e32b4319}{00393}}\ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_request_response_cycle_a5f67a9e0991181d2d55479b6e32b4319}{keep\_alive}}\ =\ keep\_alive}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00394}\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_request_response_cycle_ac5cc4773975a91c8ccc748cfbfd0a2c1}{00394}}\ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_request_response_cycle_ac5cc4773975a91c8ccc748cfbfd0a2c1}{waiting\_for\_100\_continue}}\ =\ expect\_100\_continue}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00395}00395\ }
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00396}00396\ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ Request\ state}}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00397}\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_request_response_cycle_ab9efe35aa11548f92b75407f6a407fef}{00397}}\ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_request_response_cycle_ab9efe35aa11548f92b75407f6a407fef}{body}}\ =\ b\textcolor{stringliteral}{"{}"{}}}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00398}\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_request_response_cycle_af5ca7ff813fc3d67b2ee45a75e9b603d}{00398}}\ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_request_response_cycle_af5ca7ff813fc3d67b2ee45a75e9b603d}{more\_body}}\ =\ \textcolor{keyword}{True}}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00399}00399\ }
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00400}00400\ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ Response\ state}}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00401}\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_request_response_cycle_a8dcbf7aa071e2f08323ce7ee5271ef9d}{00401}}\ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_request_response_cycle_a8dcbf7aa071e2f08323ce7ee5271ef9d}{response\_started}}\ =\ \textcolor{keyword}{False}}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00402}\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_request_response_cycle_a5119f86c900f56ecc1911dbe942b238a}{00402}}\ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_request_response_cycle_a5119f86c900f56ecc1911dbe942b238a}{response\_complete}}\ =\ \textcolor{keyword}{False}}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00403}\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_request_response_cycle_aa221aa0eb65bbf4af1e20cca5a290d79}{00403}}\ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_request_response_cycle_aa221aa0eb65bbf4af1e20cca5a290d79}{chunked\_encoding}}:\ bool\ |\ \textcolor{keywordtype}{None}\ =\ \textcolor{keywordtype}{None}}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00404}\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_request_response_cycle_adf43450bd9ac71e3401e8030e6d85f83}{00404}}\ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_request_response_cycle_adf43450bd9ac71e3401e8030e6d85f83}{expected\_content\_length}}\ =\ 0}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00405}00405\ }
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00406}00406\ \ \ \ \ \textcolor{comment}{\#\ ASGI\ exception\ wrapper}}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00407}\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_request_response_cycle_a170db0018138f009faec0ab0f6e35672}{00407}}\ \ \ \ \ \textcolor{keyword}{async\ def\ }\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_request_response_cycle_a170db0018138f009faec0ab0f6e35672}{run\_asgi}}(self,\ app:\ ASGI3Application)\ -\/>\ \textcolor{keywordtype}{None}:}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00408}00408\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{try}:}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00409}00409\ \ \ \ \ \ \ \ \ \ \ \ \ result\ =\ await\ \mbox{\hyperlink{namespaceapp}{app}}(\ \ \textcolor{comment}{\#\ type:\ ignore[func-\/returns-\/value]}}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00410}00410\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_request_response_cycle_a7df261ea4fce132817f79391ac4c48ef}{scope}},\ self.\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_request_response_cycle_a0160cc0a31ecbd5d8d932c327d43dd19}{receive}},\ self.\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_request_response_cycle_a778509b726fa986d6d4174fafa065359}{send}}}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00411}00411\ \ \ \ \ \ \ \ \ \ \ \ \ )}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00412}00412\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{except}\ BaseException\ \textcolor{keyword}{as}\ exc:}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00413}00413\ \ \ \ \ \ \ \ \ \ \ \ \ msg\ =\ \textcolor{stringliteral}{"{}Exception\ in\ ASGI\ application\(\backslash\)n"{}}}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00414}00414\ \ \ \ \ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_request_response_cycle_a1b49a9eba1afbdc2685505e972c72ad3}{logger}}.error(msg,\ exc\_info=exc)}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00415}00415\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ \textcolor{keywordflow}{not}\ self.\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_request_response_cycle_a8dcbf7aa071e2f08323ce7ee5271ef9d}{response\_started}}:}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00416}00416\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ await\ self.\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_request_response_cycle_a55ef32838d0da5f1a5a7100dc4480140}{send\_500\_response}}()}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00417}00417\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}:}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00418}00418\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_request_response_cycle_a71133a73ede8d69d0618a311e8b9f1a6}{transport}}.close()}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00419}00419\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}:}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00420}00420\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ result\ \textcolor{keywordflow}{is}\ \textcolor{keywordflow}{not}\ \textcolor{keywordtype}{None}:}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00421}00421\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ msg\ =\ \textcolor{stringliteral}{"{}ASGI\ callable\ should\ return\ None,\ but\ returned\ '\%s'."{}}}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00422}00422\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_request_response_cycle_a1b49a9eba1afbdc2685505e972c72ad3}{logger}}.error(msg,\ result)}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00423}00423\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_request_response_cycle_a71133a73ede8d69d0618a311e8b9f1a6}{transport}}.close()}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00424}00424\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{elif}\ \textcolor{keywordflow}{not}\ self.\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_request_response_cycle_a8dcbf7aa071e2f08323ce7ee5271ef9d}{response\_started}}\ \textcolor{keywordflow}{and}\ \textcolor{keywordflow}{not}\ self.\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_request_response_cycle_a1fdd3a8bb82821f4de6a9a5b90567b03}{disconnected}}:}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00425}00425\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ msg\ =\ \textcolor{stringliteral}{"{}ASGI\ callable\ returned\ without\ starting\ response."{}}}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00426}00426\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_request_response_cycle_a1b49a9eba1afbdc2685505e972c72ad3}{logger}}.error(msg)}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00427}00427\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ await\ self.\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_request_response_cycle_a55ef32838d0da5f1a5a7100dc4480140}{send\_500\_response}}()}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00428}00428\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{elif}\ \textcolor{keywordflow}{not}\ self.\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_request_response_cycle_a5119f86c900f56ecc1911dbe942b238a}{response\_complete}}\ \textcolor{keywordflow}{and}\ \textcolor{keywordflow}{not}\ self.\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_request_response_cycle_a1fdd3a8bb82821f4de6a9a5b90567b03}{disconnected}}:}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00429}00429\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ msg\ =\ \textcolor{stringliteral}{"{}ASGI\ callable\ returned\ without\ completing\ response."{}}}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00430}00430\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_request_response_cycle_a1b49a9eba1afbdc2685505e972c72ad3}{logger}}.error(msg)}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00431}00431\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_request_response_cycle_a71133a73ede8d69d0618a311e8b9f1a6}{transport}}.close()}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00432}00432\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{finally}:}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00433}00433\ \ \ \ \ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_request_response_cycle_a93dfefd61810baf9d00159c745f104ea}{on\_response}}\ =\ \textcolor{keyword}{lambda}:\ \textcolor{keywordtype}{None}}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00434}00434\ }
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00435}\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_request_response_cycle_a55ef32838d0da5f1a5a7100dc4480140}{00435}}\ \ \ \ \ \textcolor{keyword}{async\ def\ }\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_request_response_cycle_a55ef32838d0da5f1a5a7100dc4480140}{send\_500\_response}}(self)\ -\/>\ None:}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00436}00436\ \ \ \ \ \ \ \ \ await\ self.\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_request_response_cycle_a778509b726fa986d6d4174fafa065359}{send}}(}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00437}00437\ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00438}00438\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}type"{}}:\ \textcolor{stringliteral}{"{}http.response.start"{}},}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00439}00439\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}status"{}}:\ 500,}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00440}00440\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}headers"{}}:\ [}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00441}00441\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (b\textcolor{stringliteral}{"{}content-\/type"{}},\ b\textcolor{stringliteral}{"{}text/plain;\ charset=utf-\/8"{}}),}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00442}00442\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (b\textcolor{stringliteral}{"{}content-\/length"{}},\ b\textcolor{stringliteral}{"{}21"{}}),}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00443}00443\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (b\textcolor{stringliteral}{"{}connection"{}},\ b\textcolor{stringliteral}{"{}close"{}}),}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00444}00444\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ],}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00445}00445\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00446}00446\ \ \ \ \ \ \ \ \ )}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00447}00447\ \ \ \ \ \ \ \ \ await\ self.\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_request_response_cycle_a778509b726fa986d6d4174fafa065359}{send}}(\{\textcolor{stringliteral}{"{}type"{}}:\ \textcolor{stringliteral}{"{}http.response.body"{}},\ \textcolor{stringliteral}{"{}body"{}}:\ b\textcolor{stringliteral}{"{}Internal\ Server\ Error"{}},\ \textcolor{stringliteral}{"{}more\_body"{}}:\ \textcolor{keyword}{False}\})}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00448}00448\ }
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00449}00449\ \ \ \ \ \textcolor{comment}{\#\ ASGI\ interface}}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00450}\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_request_response_cycle_a778509b726fa986d6d4174fafa065359}{00450}}\ \ \ \ \ \textcolor{keyword}{async\ def\ }\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_request_response_cycle_a778509b726fa986d6d4174fafa065359}{send}}(self,\ message:\ ASGISendEvent)\ -\/>\ \textcolor{keywordtype}{None}:}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00451}00451\ \ \ \ \ \ \ \ \ message\_type\ =\ message[\textcolor{stringliteral}{"{}type"{}}]}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00452}00452\ }
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00453}00453\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ self.\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_request_response_cycle_ab58a45c6476b039a4600a021c4b8a6cd}{flow}}.write\_paused\ \textcolor{keywordflow}{and}\ \textcolor{keywordflow}{not}\ self.\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_request_response_cycle_a1fdd3a8bb82821f4de6a9a5b90567b03}{disconnected}}:}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00454}00454\ \ \ \ \ \ \ \ \ \ \ \ \ await\ self.\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_request_response_cycle_ab58a45c6476b039a4600a021c4b8a6cd}{flow}}.drain()\ \ \textcolor{comment}{\#\ pragma:\ full\ coverage}}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00455}00455\ }
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00456}00456\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ self.\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_request_response_cycle_a1fdd3a8bb82821f4de6a9a5b90567b03}{disconnected}}:}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00457}00457\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \ \textcolor{comment}{\#\ pragma:\ full\ coverage}}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00458}00458\ }
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00459}00459\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ \textcolor{keywordflow}{not}\ self.\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_request_response_cycle_a8dcbf7aa071e2f08323ce7ee5271ef9d}{response\_started}}:}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00460}00460\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ Sending\ response\ status\ line\ and\ headers}}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00461}00461\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ message\_type\ !=\ \textcolor{stringliteral}{"{}http.response.start"{}}:}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00462}00462\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ msg\ =\ \textcolor{stringliteral}{"{}Expected\ ASGI\ message\ 'http.response.start',\ but\ got\ '\%s'."{}}}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00463}00463\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{raise}\ RuntimeError(msg\ \%\ message\_type)}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00464}00464\ \ \ \ \ \ \ \ \ \ \ \ \ message\ =\ cast(\textcolor{stringliteral}{"{}HTTPResponseStartEvent"{}},\ message)}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00465}00465\ }
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00466}00466\ \ \ \ \ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_request_response_cycle_a8dcbf7aa071e2f08323ce7ee5271ef9d}{response\_started}}\ =\ \textcolor{keyword}{True}}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00467}00467\ \ \ \ \ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_request_response_cycle_ac5cc4773975a91c8ccc748cfbfd0a2c1}{waiting\_for\_100\_continue}}\ =\ \textcolor{keyword}{False}}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00468}00468\ }
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00469}00469\ \ \ \ \ \ \ \ \ \ \ \ \ status\_code\ =\ message[\textcolor{stringliteral}{"{}status"{}}]}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00470}00470\ \ \ \ \ \ \ \ \ \ \ \ \ headers\ =\ self.\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_request_response_cycle_a4fcf264afff0d7e5db40d0d9cfd69250}{default\_headers}}\ +\ list(message.get(\textcolor{stringliteral}{"{}headers"{}},\ []))}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00471}00471\ }
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00472}00472\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ CLOSE\_HEADER\ \textcolor{keywordflow}{in}\ self.\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_request_response_cycle_a7df261ea4fce132817f79391ac4c48ef}{scope}}[\textcolor{stringliteral}{"{}headers"{}}]\ \textcolor{keywordflow}{and}\ CLOSE\_HEADER\ \textcolor{keywordflow}{not}\ \textcolor{keywordflow}{in}\ headers:}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00473}00473\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ headers\ =\ headers\ +\ [CLOSE\_HEADER]}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00474}00474\ }
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00475}00475\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ self.\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_request_response_cycle_acffa1bf7dcda7261edc25ae9aebfa221}{access\_log}}:}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00476}00476\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_request_response_cycle_a34c41b47cdaec04c8c6df3b81725e0fb}{access\_logger}}.info(}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00477}00477\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{'\%s\ -\/\ "{}\%s\ \%s\ HTTP/\%s"{}\ \%d'},}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00478}00478\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ get\_client\_addr(self.\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_request_response_cycle_a7df261ea4fce132817f79391ac4c48ef}{scope}}),}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00479}00479\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_request_response_cycle_a7df261ea4fce132817f79391ac4c48ef}{scope}}[\textcolor{stringliteral}{"{}method"{}}],}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00480}00480\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ get\_path\_with\_query\_string(self.\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_request_response_cycle_a7df261ea4fce132817f79391ac4c48ef}{scope}}),}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00481}00481\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_request_response_cycle_a7df261ea4fce132817f79391ac4c48ef}{scope}}[\textcolor{stringliteral}{"{}http\_version"{}}],}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00482}00482\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ status\_code,}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00483}00483\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ )}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00484}00484\ }
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00485}00485\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ Write\ response\ status\ line\ and\ headers}}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00486}00486\ \ \ \ \ \ \ \ \ \ \ \ \ content\ =\ [STATUS\_LINE[status\_code]]}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00487}00487\ }
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00488}00488\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ name,\ value\ \textcolor{keywordflow}{in}\ headers:}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00489}00489\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ HEADER\_RE.search(name):}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00490}00490\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{raise}\ RuntimeError(\textcolor{stringliteral}{"{}Invalid\ HTTP\ header\ name."{}})\ \ \textcolor{comment}{\#\ pragma:\ full\ coverage}}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00491}00491\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ HEADER\_VALUE\_RE.search(value):}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00492}00492\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{raise}\ RuntimeError(\textcolor{stringliteral}{"{}Invalid\ HTTP\ header\ value."{}})}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00493}00493\ }
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00494}00494\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ name\ =\ name.lower()}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00495}00495\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ name\ ==\ b\textcolor{stringliteral}{"{}content-\/length"{}}\ \textcolor{keywordflow}{and}\ self.\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_request_response_cycle_aa221aa0eb65bbf4af1e20cca5a290d79}{chunked\_encoding}}\ \textcolor{keywordflow}{is}\ \textcolor{keywordtype}{None}:}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00496}00496\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_request_response_cycle_adf43450bd9ac71e3401e8030e6d85f83}{expected\_content\_length}}\ =\ int(value.decode())}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00497}00497\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_request_response_cycle_aa221aa0eb65bbf4af1e20cca5a290d79}{chunked\_encoding}}\ =\ \textcolor{keyword}{False}}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00498}00498\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{elif}\ name\ ==\ b\textcolor{stringliteral}{"{}transfer-\/encoding"{}}\ \textcolor{keywordflow}{and}\ value.lower()\ ==\ b\textcolor{stringliteral}{"{}chunked"{}}:}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00499}00499\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_request_response_cycle_adf43450bd9ac71e3401e8030e6d85f83}{expected\_content\_length}}\ =\ 0}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00500}00500\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_request_response_cycle_aa221aa0eb65bbf4af1e20cca5a290d79}{chunked\_encoding}}\ =\ \textcolor{keyword}{True}}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00501}00501\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{elif}\ name\ ==\ b\textcolor{stringliteral}{"{}connection"{}}\ \textcolor{keywordflow}{and}\ value.lower()\ ==\ b\textcolor{stringliteral}{"{}close"{}}:}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00502}00502\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_request_response_cycle_a5f67a9e0991181d2d55479b6e32b4319}{keep\_alive}}\ =\ \textcolor{keyword}{False}}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00503}00503\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ content.extend([name,\ b\textcolor{stringliteral}{"{}:\ "{}},\ value,\ b\textcolor{stringliteral}{"{}\(\backslash\)r\(\backslash\)n"{}}])}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00504}00504\ }
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00505}00505\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ self.\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_request_response_cycle_aa221aa0eb65bbf4af1e20cca5a290d79}{chunked\_encoding}}\ \textcolor{keywordflow}{is}\ \textcolor{keywordtype}{None}\ \textcolor{keywordflow}{and}\ self.\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_request_response_cycle_a7df261ea4fce132817f79391ac4c48ef}{scope}}[\textcolor{stringliteral}{"{}method"{}}]\ !=\ \textcolor{stringliteral}{"{}HEAD"{}}\ \textcolor{keywordflow}{and}\ status\_code\ \textcolor{keywordflow}{not}\ \textcolor{keywordflow}{in}\ (204,\ 304):}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00506}00506\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ Neither\ content-\/length\ nor\ transfer-\/encoding\ specified}}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00507}00507\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_request_response_cycle_aa221aa0eb65bbf4af1e20cca5a290d79}{chunked\_encoding}}\ =\ \textcolor{keyword}{True}}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00508}00508\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ content.append(b\textcolor{stringliteral}{"{}transfer-\/encoding:\ chunked\(\backslash\)r\(\backslash\)n"{}})}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00509}00509\ }
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00510}00510\ \ \ \ \ \ \ \ \ \ \ \ \ content.append(b\textcolor{stringliteral}{"{}\(\backslash\)r\(\backslash\)n"{}})}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00511}00511\ \ \ \ \ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_request_response_cycle_a71133a73ede8d69d0618a311e8b9f1a6}{transport}}.write(b\textcolor{stringliteral}{"{}"{}}.join(content))}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00512}00512\ }
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00513}00513\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{elif}\ \textcolor{keywordflow}{not}\ self.\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_request_response_cycle_a5119f86c900f56ecc1911dbe942b238a}{response\_complete}}:}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00514}00514\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ Sending\ response\ body}}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00515}00515\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ message\_type\ !=\ \textcolor{stringliteral}{"{}http.response.body"{}}:}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00516}00516\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ msg\ =\ \textcolor{stringliteral}{"{}Expected\ ASGI\ message\ 'http.response.body',\ but\ got\ '\%s'."{}}}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00517}00517\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{raise}\ RuntimeError(msg\ \%\ message\_type)}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00518}00518\ }
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00519}00519\ \ \ \ \ \ \ \ \ \ \ \ \ body\ =\ cast(bytes,\ message.get(\textcolor{stringliteral}{"{}body"{}},\ b\textcolor{stringliteral}{"{}"{}}))}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00520}00520\ \ \ \ \ \ \ \ \ \ \ \ \ more\_body\ =\ message.get(\textcolor{stringliteral}{"{}more\_body"{}},\ \textcolor{keyword}{False})}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00521}00521\ }
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00522}00522\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ Write\ response\ body}}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00523}00523\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ self.\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_request_response_cycle_a7df261ea4fce132817f79391ac4c48ef}{scope}}[\textcolor{stringliteral}{"{}method"{}}]\ ==\ \textcolor{stringliteral}{"{}HEAD"{}}:}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00524}00524\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_request_response_cycle_adf43450bd9ac71e3401e8030e6d85f83}{expected\_content\_length}}\ =\ 0}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00525}00525\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{elif}\ self.\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_request_response_cycle_aa221aa0eb65bbf4af1e20cca5a290d79}{chunked\_encoding}}:}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00526}00526\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ body:}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00527}00527\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ content\ =\ [b\textcolor{stringliteral}{"{}\%x\(\backslash\)r\(\backslash\)n"{}}\ \%\ len(body),\ body,\ b\textcolor{stringliteral}{"{}\(\backslash\)r\(\backslash\)n"{}}]}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00528}00528\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}:}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00529}00529\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ content\ =\ []}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00530}00530\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ \textcolor{keywordflow}{not}\ more\_body:}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00531}00531\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ content.append(b\textcolor{stringliteral}{"{}0\(\backslash\)r\(\backslash\)n\(\backslash\)r\(\backslash\)n"{}})}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00532}00532\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_request_response_cycle_a71133a73ede8d69d0618a311e8b9f1a6}{transport}}.write(b\textcolor{stringliteral}{"{}"{}}.join(content))}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00533}00533\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}:}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00534}00534\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ num\_bytes\ =\ len(body)}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00535}00535\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ num\_bytes\ >\ self.\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_request_response_cycle_adf43450bd9ac71e3401e8030e6d85f83}{expected\_content\_length}}:}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00536}00536\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{raise}\ RuntimeError(\textcolor{stringliteral}{"{}Response\ content\ longer\ than\ Content-\/Length"{}})}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00537}00537\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}:}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00538}00538\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_request_response_cycle_adf43450bd9ac71e3401e8030e6d85f83}{expected\_content\_length}}\ -\/=\ num\_bytes}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00539}00539\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_request_response_cycle_a71133a73ede8d69d0618a311e8b9f1a6}{transport}}.write(body)}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00540}00540\ }
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00541}00541\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ Handle\ response\ completion}}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00542}00542\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ \textcolor{keywordflow}{not}\ more\_body:}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00543}00543\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ self.\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_request_response_cycle_adf43450bd9ac71e3401e8030e6d85f83}{expected\_content\_length}}\ !=\ 0:}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00544}00544\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{raise}\ RuntimeError(\textcolor{stringliteral}{"{}Response\ content\ shorter\ than\ Content-\/Length"{}})}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00545}00545\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_request_response_cycle_a5119f86c900f56ecc1911dbe942b238a}{response\_complete}}\ =\ \textcolor{keyword}{True}}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00546}00546\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_request_response_cycle_a55008802268cc96319bf29555145157b}{message\_event}}.set()}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00547}00547\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ \textcolor{keywordflow}{not}\ self.\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_request_response_cycle_a5f67a9e0991181d2d55479b6e32b4319}{keep\_alive}}:}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00548}00548\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_request_response_cycle_a71133a73ede8d69d0618a311e8b9f1a6}{transport}}.close()}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00549}00549\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_request_response_cycle_a93dfefd61810baf9d00159c745f104ea}{on\_response}}()}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00550}00550\ }
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00551}00551\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}:}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00552}00552\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ Response\ already\ sent}}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00553}00553\ \ \ \ \ \ \ \ \ \ \ \ \ msg\ =\ \textcolor{stringliteral}{"{}Unexpected\ ASGI\ message\ '\%s'\ sent,\ after\ response\ already\ completed."{}}}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00554}00554\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{raise}\ RuntimeError(msg\ \%\ message\_type)}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00555}00555\ }
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00556}\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_request_response_cycle_a0160cc0a31ecbd5d8d932c327d43dd19}{00556}}\ \ \ \ \ \textcolor{keyword}{async\ def\ }\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_request_response_cycle_a0160cc0a31ecbd5d8d932c327d43dd19}{receive}}(self)\ -\/>\ ASGIReceiveEvent:}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00557}00557\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ self.\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_request_response_cycle_ac5cc4773975a91c8ccc748cfbfd0a2c1}{waiting\_for\_100\_continue}}\ \textcolor{keywordflow}{and}\ \textcolor{keywordflow}{not}\ self.\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_request_response_cycle_a71133a73ede8d69d0618a311e8b9f1a6}{transport}}.is\_closing():}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00558}00558\ \ \ \ \ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_request_response_cycle_a71133a73ede8d69d0618a311e8b9f1a6}{transport}}.write(b\textcolor{stringliteral}{"{}HTTP/1.1\ 100\ Continue\(\backslash\)r\(\backslash\)n\(\backslash\)r\(\backslash\)n"{}})}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00559}00559\ \ \ \ \ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_request_response_cycle_ac5cc4773975a91c8ccc748cfbfd0a2c1}{waiting\_for\_100\_continue}}\ =\ \textcolor{keyword}{False}}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00560}00560\ }
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00561}00561\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ \textcolor{keywordflow}{not}\ self.\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_request_response_cycle_a1fdd3a8bb82821f4de6a9a5b90567b03}{disconnected}}\ \textcolor{keywordflow}{and}\ \textcolor{keywordflow}{not}\ self.\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_request_response_cycle_a5119f86c900f56ecc1911dbe942b238a}{response\_complete}}:}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00562}00562\ \ \ \ \ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_request_response_cycle_ab58a45c6476b039a4600a021c4b8a6cd}{flow}}.resume\_reading()}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00563}00563\ \ \ \ \ \ \ \ \ \ \ \ \ await\ self.\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_request_response_cycle_a55008802268cc96319bf29555145157b}{message\_event}}.wait()}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00564}00564\ \ \ \ \ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_request_response_cycle_a55008802268cc96319bf29555145157b}{message\_event}}.clear()}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00565}00565\ }
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00566}00566\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ self.\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_request_response_cycle_a1fdd3a8bb82821f4de6a9a5b90567b03}{disconnected}}\ \textcolor{keywordflow}{or}\ self.\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_request_response_cycle_a5119f86c900f56ecc1911dbe942b238a}{response\_complete}}:}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00567}00567\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \{\textcolor{stringliteral}{"{}type"{}}:\ \textcolor{stringliteral}{"{}http.disconnect"{}}\}}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00568}00568\ \ \ \ \ \ \ \ \ message:\ HTTPRequestEvent\ =\ \{\textcolor{stringliteral}{"{}type"{}}:\ \textcolor{stringliteral}{"{}http.request"{}},\ \textcolor{stringliteral}{"{}body"{}}:\ self.\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_request_response_cycle_ab9efe35aa11548f92b75407f6a407fef}{body}},\ \textcolor{stringliteral}{"{}more\_body"{}}:\ self.\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_request_response_cycle_af5ca7ff813fc3d67b2ee45a75e9b603d}{more\_body}}\}}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00569}00569\ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classuvicorn_1_1protocols_1_1http_1_1httptools__impl_1_1_request_response_cycle_ab9efe35aa11548f92b75407f6a407fef}{body}}\ =\ b\textcolor{stringliteral}{"{}"{}}}
\DoxyCodeLine{\Hypertarget{httptools__impl_8py_source_l00570}00570\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ message}

\end{DoxyCode}
