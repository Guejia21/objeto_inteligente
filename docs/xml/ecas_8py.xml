<?xml version='1.0' encoding='UTF-8' standalone='no'?>
<doxygen xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="compound.xsd" version="1.15.0" xml:lang="es">
  <compounddef id="ecas_8py" kind="file" language="Python">
    <compoundname>ecas.py</compoundname>
    <innernamespace refid="namespaceecas">ecas</innernamespace>
    <briefdescription>
    </briefdescription>
    <detaileddescription>
    </detaileddescription>
    <programlisting>
<codeline lineno="1" refid="namespaceecas" refkind="compound"><highlight class="keyword">from</highlight><highlight class="normal"><sp/>fastapi<sp/></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>APIRouter,<sp/>Depends,<sp/>HTTPException,<sp/>Query</highlight></codeline>
<codeline lineno="2"><highlight class="normal"></highlight><highlight class="keyword">from</highlight><highlight class="normal"><sp/><ref refid="namespacefastapi_1_1responses" kindref="compound">fastapi.responses</ref><sp/></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>JSONResponse</highlight></codeline>
<codeline lineno="3"><highlight class="normal"></highlight></codeline>
<codeline lineno="4"><highlight class="normal"></highlight><highlight class="keyword">from</highlight><highlight class="normal"><sp/>application.dtos<sp/></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>ECAResponse,<sp/>ECAStateRequest,<sp/>MakeContractRequest</highlight></codeline>
<codeline lineno="5"><highlight class="normal"></highlight><highlight class="keyword">from</highlight><highlight class="normal"><sp/>deps<sp/></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>get_eca_service</highlight></codeline>
<codeline lineno="6"><highlight class="normal"></highlight><highlight class="keyword">from</highlight><highlight class="normal"><sp/>application.eca_service<sp/></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>EcaService</highlight></codeline>
<codeline lineno="7"><highlight class="normal"></highlight><highlight class="keyword">from</highlight><highlight class="normal"><sp/>application.dtos<sp/></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>SendCommandRequest</highlight></codeline>
<codeline lineno="8"><highlight class="normal"></highlight></codeline>
<codeline lineno="9"><highlight class="normal"></highlight></codeline>
<codeline lineno="10"><highlight class="normal"></highlight></codeline>
<codeline lineno="11" refid="namespaceecas_1a762142ec0f597370702c4fb407b2046c" refkind="member"><highlight class="normal">router<sp/>=<sp/><ref refid="classfastapi_1_1routing_1_1_a_p_i_router" kindref="compound">APIRouter</ref>(prefix=</highlight><highlight class="stringliteral">&quot;/eca&quot;</highlight><highlight class="normal">,<sp/>tags=[</highlight><highlight class="stringliteral">&quot;ECAs&quot;</highlight><highlight class="normal">])</highlight></codeline>
<codeline lineno="12"><highlight class="normal"></highlight></codeline>
<codeline lineno="13"><highlight class="normal"></highlight><highlight class="comment">#<sp/>Crear<sp/>nueva<sp/>ECA</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="14"><highlight class="normal"></highlight><highlight class="preprocessor">@router.post(&quot;/&quot;)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="15" refid="namespaceecas_1a811c103a3379f109090abd7e14033547" refkind="member"><highlight class="normal"></highlight><highlight class="keyword">async<sp/>def<sp/></highlight><highlight class="normal"><ref refid="namespaceecas_1a811c103a3379f109090abd7e14033547" kindref="member">crear_eca</ref>(eca:<sp/>MakeContractRequest,<sp/>service:<sp/>EcaService<sp/>=<sp/>Depends(get_eca_service)):<sp/><sp/></highlight></codeline>
<codeline lineno="16"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;&quot;&quot;Crear<sp/>una<sp/>nueva<sp/>regla<sp/>ECA.&quot;&quot;&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="17"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">try</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="18"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>result<sp/>=<sp/>await<sp/>service.crear_eca(eca)</highlight></codeline>
<codeline lineno="19"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>result</highlight></codeline>
<codeline lineno="20"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">except</highlight><highlight class="normal"><sp/>Exception<sp/></highlight><highlight class="keyword">as</highlight><highlight class="normal"><sp/>e:</highlight></codeline>
<codeline lineno="21"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">raise</highlight><highlight class="normal"><sp/><ref refid="classfastapi_1_1exceptions_1_1_h_t_t_p_exception" kindref="compound">HTTPException</ref>(status_code=400,<sp/>detail=str(e))</highlight></codeline>
<codeline lineno="22"><highlight class="normal"></highlight><highlight class="preprocessor">@router.get(&quot;/&quot;)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="23" refid="namespaceecas_1afe79ca421ad8c56d8095b681a549b16e" refkind="member"><highlight class="normal"></highlight><highlight class="keyword">async<sp/>def<sp/></highlight><highlight class="normal"><ref refid="namespaceecas_1afe79ca421ad8c56d8095b681a549b16e" kindref="member">listar_ecas</ref>(osid:<sp/>str<sp/>=<sp/>Query(...,<sp/>description=</highlight><highlight class="stringliteral">&quot;ID<sp/>del<sp/>objeto<sp/>inteligente&quot;</highlight><highlight class="normal">),service:<sp/>EcaService<sp/>=<sp/>Depends(get_eca_service)):</highlight></codeline>
<codeline lineno="24"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;&quot;&quot;Listar<sp/>todas<sp/>las<sp/>ECAs<sp/>del<sp/>objeto<sp/>inteligente.&quot;&quot;&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="25"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">try</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="26"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>await<sp/>service.listar_ecas(osid)</highlight></codeline>
<codeline lineno="27"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">except</highlight><highlight class="normal"><sp/>Exception<sp/></highlight><highlight class="keyword">as</highlight><highlight class="normal"><sp/>e:</highlight></codeline>
<codeline lineno="28"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">raise</highlight><highlight class="normal"><sp/><ref refid="classfastapi_1_1exceptions_1_1_h_t_t_p_exception" kindref="compound">HTTPException</ref>(status_code=500,<sp/>detail=str(e))</highlight></codeline>
<codeline lineno="29"><highlight class="normal"></highlight><highlight class="preprocessor">@router.patch(&quot;/&quot;)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="30" refid="namespaceecas_1ac4a0b1caa96d3fba9ccfc78b5531417a" refkind="member"><highlight class="normal"></highlight><highlight class="keyword">async<sp/>def<sp/></highlight><highlight class="normal"><ref refid="namespaceecas_1ac4a0b1caa96d3fba9ccfc78b5531417a" kindref="member">apagar_ecas</ref>(osid:<sp/>str<sp/>=<sp/>Query(...,<sp/>description=</highlight><highlight class="stringliteral">&quot;ID<sp/>del<sp/>objeto<sp/>inteligente&quot;</highlight><highlight class="normal">),service:<sp/>EcaService<sp/>=<sp/>Depends(get_eca_service)):</highlight></codeline>
<codeline lineno="31"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;&quot;&quot;Apagar<sp/>todas<sp/>las<sp/>ECAs<sp/>del<sp/>objeto<sp/>inteligente.&quot;&quot;&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="32"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">try</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="33"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>await<sp/>service.apagar_ecas(osid)</highlight></codeline>
<codeline lineno="34"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">except</highlight><highlight class="normal"><sp/>Exception<sp/></highlight><highlight class="keyword">as</highlight><highlight class="normal"><sp/>e:</highlight></codeline>
<codeline lineno="35"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">raise</highlight><highlight class="normal"><sp/><ref refid="classfastapi_1_1exceptions_1_1_h_t_t_p_exception" kindref="compound">HTTPException</ref>(status_code=500,<sp/>detail=str(e))</highlight></codeline>
<codeline lineno="36"><highlight class="normal"></highlight><highlight class="preprocessor">@router.delete(&quot;/&quot;)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="37" refid="namespaceecas_1ab9693b463b35ec24299e6d5403ac9fde" refkind="member"><highlight class="normal"></highlight><highlight class="keyword">async<sp/>def<sp/></highlight><highlight class="normal"><ref refid="namespaceecas_1ab9693b463b35ec24299e6d5403ac9fde" kindref="member">eliminar_eca</ref>(</highlight></codeline>
<codeline lineno="38"><highlight class="normal"><sp/><sp/><sp/><sp/>osid:str=Query(...,<sp/>description=</highlight><highlight class="stringliteral">&quot;ID<sp/>del<sp/>objeto<sp/>inteligente&quot;</highlight><highlight class="normal">),</highlight></codeline>
<codeline lineno="39"><highlight class="normal"><sp/><sp/><sp/><sp/>eca_name:<sp/>str<sp/>=<sp/>Query(...,<sp/>description=</highlight><highlight class="stringliteral">&quot;Nombre<sp/>del<sp/>ECA<sp/>a<sp/>eliminar&quot;</highlight><highlight class="normal">),</highlight></codeline>
<codeline lineno="40"><highlight class="normal"><sp/><sp/><sp/><sp/>user_eca:<sp/>str<sp/>=<sp/>Query(...,<sp/>description=</highlight><highlight class="stringliteral">&quot;Usuario<sp/>dueño<sp/>del<sp/>ECA&quot;</highlight><highlight class="normal">),<sp/></highlight></codeline>
<codeline lineno="41"><highlight class="normal"><sp/><sp/><sp/><sp/>service:<sp/>EcaService<sp/>=<sp/>Depends(get_eca_service)):</highlight></codeline>
<codeline lineno="42"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">try</highlight><highlight class="normal">:<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="43"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>await<sp/>service.eliminar_eca(osid,eca_name,<sp/>user_eca)</highlight></codeline>
<codeline lineno="44"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">except</highlight><highlight class="normal"><sp/>Exception<sp/></highlight><highlight class="keyword">as</highlight><highlight class="normal"><sp/>e:</highlight></codeline>
<codeline lineno="45"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">raise</highlight><highlight class="normal"><sp/><ref refid="classfastapi_1_1exceptions_1_1_h_t_t_p_exception" kindref="compound">HTTPException</ref>(status_code=400,<sp/>detail=str(e))</highlight></codeline>
<codeline lineno="46"><highlight class="normal"></highlight><highlight class="preprocessor">@router.put(&quot;/state&quot;)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="47" refid="namespaceecas_1a279d2c0099ec418dfc5ec8e35de33f5b" refkind="member"><highlight class="normal"></highlight><highlight class="keyword">async<sp/>def<sp/></highlight><highlight class="normal"><ref refid="namespaceecas_1a279d2c0099ec418dfc5ec8e35de33f5b" kindref="member">cambiar_estado</ref>(request:<sp/>ECAStateRequest,<sp/>service:<sp/>EcaService<sp/>=<sp/>Depends(get_eca_service)):</highlight></codeline>
<codeline lineno="48"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">try</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="49"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>await<sp/>service.cambiar_estado_eca(request)<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="50"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">except</highlight><highlight class="normal"><sp/>Exception<sp/></highlight><highlight class="keyword">as</highlight><highlight class="normal"><sp/>e:</highlight></codeline>
<codeline lineno="51"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">raise</highlight><highlight class="normal"><sp/><ref refid="classfastapi_1_1exceptions_1_1_h_t_t_p_exception" kindref="compound">HTTPException</ref>(status_code=400,<sp/>detail=str(e))</highlight></codeline>
<codeline lineno="52"><highlight class="normal"></highlight><highlight class="preprocessor">@router.put(&quot;/edit&quot;)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="53" refid="namespaceecas_1a0c1efa8b41b044389a46fa0d6b78189b" refkind="member"><highlight class="normal"></highlight><highlight class="keyword">async<sp/>def<sp/></highlight><highlight class="normal"><ref refid="namespaceecas_1a0c1efa8b41b044389a46fa0d6b78189b" kindref="member">editar_eca</ref>(eca:<sp/>MakeContractRequest,<sp/>service:<sp/>EcaService<sp/>=<sp/>Depends(get_eca_service)):</highlight></codeline>
<codeline lineno="54"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">try</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="55"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>await<sp/>service.editar_eca(eca)<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="56"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">except</highlight><highlight class="normal"><sp/>Exception<sp/></highlight><highlight class="keyword">as</highlight><highlight class="normal"><sp/>e:</highlight></codeline>
<codeline lineno="57"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">raise</highlight><highlight class="normal"><sp/><ref refid="classfastapi_1_1exceptions_1_1_h_t_t_p_exception" kindref="compound">HTTPException</ref>(status_code=400,<sp/>detail=str(e))</highlight></codeline>
<codeline lineno="58"><highlight class="normal"></highlight><highlight class="preprocessor">@router.post(&quot;/send_command&quot;)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="59" refid="namespaceecas_1a2c295cd12c9dd5717ea32d0fdc7264b2" refkind="member"><highlight class="normal"></highlight><highlight class="keyword">async<sp/>def<sp/></highlight><highlight class="normal"><ref refid="namespaceecas_1a2c295cd12c9dd5717ea32d0fdc7264b2" kindref="member">send_command</ref>(request:<sp/>SendCommandRequest,<sp/>service:<sp/>EcaService<sp/>=<sp/>Depends(get_eca_service)):</highlight></codeline>
<codeline lineno="60"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;&quot;&quot;Envía<sp/>un<sp/>comando<sp/>a<sp/>un<sp/>datastream<sp/>actuador<sp/>si<sp/>existe<sp/>un<sp/>contrato.&quot;&quot;&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="61"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">try</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="62"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>await<sp/>service.send_command(request)</highlight></codeline>
<codeline lineno="63"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">except</highlight><highlight class="normal"><sp/>Exception<sp/></highlight><highlight class="keyword">as</highlight><highlight class="normal"><sp/>e:</highlight></codeline>
<codeline lineno="64"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">raise</highlight><highlight class="normal"><sp/><ref refid="classfastapi_1_1exceptions_1_1_h_t_t_p_exception" kindref="compound">HTTPException</ref>(status_code=400,<sp/>detail=str(e))</highlight></codeline>
    </programlisting>
    <location file="micro_automatizacion_ecas/app/api/ecas.py"/>
  </compounddef>
</doxygen>
