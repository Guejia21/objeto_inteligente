<?xml version='1.0' encoding='UTF-8' standalone='no'?>
<doxygen xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="compound.xsd" version="1.15.0" xml:lang="es">
  <compounddef id="classapp_1_1domain_1_1services_1_1personalizacion__service_1_1_personalizacion_service" kind="class" language="Python" prot="public">
    <compoundname>app::domain::services::personalizacion_service::PersonalizacionService</compoundname>
    <sectiondef kind="public-attrib">
      <memberdef kind="variable" id="classapp_1_1domain_1_1services_1_1personalizacion__service_1_1_personalizacion_service_1a2df7c70f0f7919efa7f194a49ea7eda7" prot="public" static="no" mutable="no">
        <type></type>
        <definition>app.domain.services.personalizacion_service.PersonalizacionService::osid</definition>
        <argsstring></argsstring>
        <name>osid</name>
        <qualifiedname>app.domain.services.personalizacion_service.PersonalizacionService.osid</qualifiedname>
        <initializer>=  <ref refid="namespaceapp_1_1domain_1_1services_1_1ontology__service_1ab76596007fb6ef1a07fee898cacd8f50" kindref="member">ontology_service.get_osid</ref>()</initializer>
        <briefdescription>
<para>Consulta los Ecas que tiene la ontologia del Usuario OjO Cambias esto &gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;. </para>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="microservicio_personalizacion/app/domain/services/personalizacion_service.py" line="83" column="1" bodyfile="microservicio_personalizacion/app/domain/services/personalizacion_service.py" bodystart="83" bodyend="-1"/>
      </memberdef>
      <memberdef kind="variable" id="classapp_1_1domain_1_1services_1_1personalizacion__service_1_1_personalizacion_service_1a05889f39107a5a88b2b8cc262d826376" prot="public" static="no" mutable="no">
        <type>str</type>
        <definition>str app.domain.services.personalizacion_service.PersonalizacionService::ipServidorPU</definition>
        <argsstring></argsstring>
        <name>ipServidorPU</name>
        <qualifiedname>app.domain.services.personalizacion_service.PersonalizacionService.ipServidorPU</qualifiedname>
        <initializer>=  &quot;http://localhost&quot;</initializer>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="microservicio_personalizacion/app/domain/services/personalizacion_service.py" line="84" column="1" bodyfile="microservicio_personalizacion/app/domain/services/personalizacion_service.py" bodystart="84" bodyend="-1"/>
      </memberdef>
      <memberdef kind="variable" id="classapp_1_1domain_1_1services_1_1personalizacion__service_1_1_personalizacion_service_1a1a5c9f2533eee6882439e5737d2ebcb4" prot="public" static="no" mutable="no">
        <type></type>
        <definition>app.domain.services.personalizacion_service.PersonalizacionService::path</definition>
        <argsstring></argsstring>
        <name>path</name>
        <qualifiedname>app.domain.services.personalizacion_service.PersonalizacionService.path</qualifiedname>
        <initializer>= settings.PATH_ECAS</initializer>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="microservicio_personalizacion/app/domain/services/personalizacion_service.py" line="85" column="1" bodyfile="microservicio_personalizacion/app/domain/services/personalizacion_service.py" bodystart="85" bodyend="-1"/>
        <referencedby refid="classpip_1_1__internal_1_1models_1_1link_1_1_link_1a5fb02f5a5a42909c89a18745b74cf998" compoundref="micro__gestion__objetos_2venv_2_lib_2site-packages_2pip_2__internal_2models_2link_8py" startline="417" endline="429">pip._internal.models.link.Link.filename</referencedby>
        <referencedby refid="classpkg__resources_1_1__vendor_1_1importlib__resources_1_1__compat_1_1_traversable_resources_loader_1a52be3372eeba946cbbf590cfc98cead8" compoundref="microservicio__data__stream_2venv_2_lib_2site-packages_2pkg__resources_2__vendor_2importlib__resources_2__compat_8py" startline="44" endline="87">pkg_resources._vendor.importlib_resources._compat.TraversableResourcesLoader.get_resource_reader</referencedby>
        <referencedby refid="classsetuptools_1_1__vendor_1_1importlib__resources_1_1__compat_1_1_traversable_resources_loader_1a9c4a8e6f4f086d8cb3a92b6374b07a3b" compoundref="microservicio__data__stream_2venv_2_lib_2site-packages_2setuptools_2__vendor_2importlib__resources_2__compat_8py" startline="44" endline="87">setuptools._vendor.importlib_resources._compat.TraversableResourcesLoader.get_resource_reader</referencedby>
        <referencedby refid="classpip_1_1__vendor_1_1urllib3_1_1util_1_1url_1_1_url_1a21848b565d3a9298c6fd2d9fe3a99822" compoundref="micro__gestion__objetos_2venv_2_lib_2site-packages_2pip_2__vendor_2urllib3_2util_2url_8py" startline="115" endline="123">pip._vendor.urllib3.util.url.Url.request_uri</referencedby>
        <referencedby refid="classurllib3_1_1util_1_1url_1_1_url_1a15086dfcfa65946b2f3cabee9e8f43ac" compoundref="micro__gestion__objetos_2venv_2_lib_2site-packages_2urllib3_2util_2url_8py" startline="122" endline="130">urllib3.util.url.Url.request_uri</referencedby>
        <referencedby refid="classpip_1_1__internal_1_1models_1_1link_1_1_link_1a09fc0c6b6ee11bd18101e0faba1389b1" compoundref="micro__gestion__objetos_2venv_2_lib_2site-packages_2pip_2__internal_2models_2link_8py" startline="449" endline="451">pip._internal.models.link.Link.splitext</referencedby>
      </memberdef>
      <memberdef kind="variable" id="classapp_1_1domain_1_1services_1_1personalizacion__service_1_1_personalizacion_service_1a89c26b2ae8d32fabdfb479de10e33c2b" prot="public" static="no" mutable="no">
        <type></type>
        <definition>app.domain.services.personalizacion_service.PersonalizacionService::conexion_pu</definition>
        <argsstring></argsstring>
        <name>conexion_pu</name>
        <qualifiedname>app.domain.services.personalizacion_service.PersonalizacionService.conexion_pu</qualifiedname>
        <initializer>=  <ref refid="classapp_1_1domain_1_1services_1_1_conexion_pu_1_1_conexion_pu" kindref="compound">ConexionPu</ref>()</initializer>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="microservicio_personalizacion/app/domain/services/personalizacion_service.py" line="86" column="1" bodyfile="microservicio_personalizacion/app/domain/services/personalizacion_service.py" bodystart="86" bodyend="-1"/>
      </memberdef>
      <memberdef kind="variable" id="classapp_1_1domain_1_1services_1_1personalizacion__service_1_1_personalizacion_service_1ade88b01890801c7f7f1fd686c0ea3644" prot="public" static="no" mutable="no">
        <type></type>
        <definition>app.domain.services.personalizacion_service.PersonalizacionService::Log</definition>
        <argsstring></argsstring>
        <name>Log</name>
        <qualifiedname>app.domain.services.personalizacion_service.PersonalizacionService.Log</qualifiedname>
        <initializer>=  log</initializer>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="microservicio_personalizacion/app/domain/services/personalizacion_service.py" line="87" column="1" bodyfile="microservicio_personalizacion/app/domain/services/personalizacion_service.py" bodystart="87" bodyend="-1"/>
      </memberdef>
      <memberdef kind="variable" id="classapp_1_1domain_1_1services_1_1personalizacion__service_1_1_personalizacion_service_1af900dcd3f19174ccd07a52e248799c0d" prot="public" static="no" mutable="no">
        <type>str</type>
        <definition>app.domain.services.personalizacion_service.PersonalizacionService::user_eca</definition>
        <argsstring></argsstring>
        <name>user_eca</name>
        <qualifiedname>app.domain.services.personalizacion_service.PersonalizacionService.user_eca</qualifiedname>
        <initializer>=  <ref refid="namespaceapp_1_1domain_1_1services_1_1ontology__service_1a8663fc24b0f4e97b8fe519cb12d24f41" kindref="member">ontology_service.consultar_email_usuario</ref>()</initializer>
        <briefdescription>
<para>Cada Usuario va a tener un archivo email.txt donde se almacena el nombre del ECA y su estado. </para>
        </briefdescription>
        <detaileddescription>
<para>Si no se puede comunicar con el servidor que las consulte localmente. </para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="microservicio_personalizacion/app/domain/services/personalizacion_service.py" line="187" column="1" bodyfile="microservicio_personalizacion/app/domain/services/personalizacion_service.py" bodystart="187" bodyend="-1"/>
      </memberdef>
      <memberdef kind="variable" id="classapp_1_1domain_1_1services_1_1personalizacion__service_1_1_personalizacion_service_1a615aae7687732f1ab49adca9619d2a2c" prot="public" static="no" mutable="no">
        <type>int</type>
        <definition>int app.domain.services.personalizacion_service.PersonalizacionService::ecasUsuario</definition>
        <argsstring></argsstring>
        <name>ecasUsuario</name>
        <qualifiedname>app.domain.services.personalizacion_service.PersonalizacionService.ecasUsuario</qualifiedname>
        <initializer>=  json.loads(resp)</initializer>
        <briefdescription>
<para>Si no se puede comunicar con el servidor que las consulte localmente. </para>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="microservicio_personalizacion/app/domain/services/personalizacion_service.py" line="199" column="1" bodyfile="microservicio_personalizacion/app/domain/services/personalizacion_service.py" bodystart="199" bodyend="-1"/>
      </memberdef>
      <memberdef kind="variable" id="classapp_1_1domain_1_1services_1_1personalizacion__service_1_1_personalizacion_service_1ae2b7d0f2d862d4fa88497a472ef0ff44" prot="public" static="no" mutable="no">
        <type>str</type>
        <definition>app.domain.services.personalizacion_service.PersonalizacionService::pathEcasUsuario</definition>
        <argsstring></argsstring>
        <name>pathEcasUsuario</name>
        <qualifiedname>app.domain.services.personalizacion_service.PersonalizacionService.pathEcasUsuario</qualifiedname>
        <initializer>=  self.path + self.user_eca +&quot;.txt&quot;</initializer>
        <briefdescription>
<para>Si no se puede comunicar con el servidor que las consulte localmente. </para>
        </briefdescription>
        <detaileddescription>
<para>OjO Cambias esto &gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; </para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="microservicio_personalizacion/app/domain/services/personalizacion_service.py" line="212" column="1" bodyfile="microservicio_personalizacion/app/domain/services/personalizacion_service.py" bodystart="212" bodyend="-1"/>
      </memberdef>
    </sectiondef>
    <sectiondef kind="public-func">
      <memberdef kind="function" id="classapp_1_1domain_1_1services_1_1personalizacion__service_1_1_personalizacion_service_1ab600a1b7c03aff746520b47301524f01" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type><ref refid="classstarlette_1_1responses_1_1_j_s_o_n_response" kindref="compound">JSONResponse</ref></type>
        <definition> JSONResponse app.domain.services.personalizacion_service.PersonalizacionService.recibir_ontologia</definition>
        <argsstring>(self, UploadFile file, str nombre, str ipCoordinador)</argsstring>
        <name>recibir_ontologia</name>
        <qualifiedname>app.domain.services.personalizacion_service.PersonalizacionService.recibir_ontologia</qualifiedname>
        <param>
          <type>self</type>
          <defname>self</defname>
        </param>
        <param>
          <type><ref refid="classfastapi_1_1datastructures_1_1_upload_file" kindref="compound">UploadFile</ref></type>
          <declname>file</declname>
        </param>
        <param>
          <type>str</type>
          <declname>nombre</declname>
        </param>
        <param>
          <type>str</type>
          <declname>ipCoordinador</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para><verbatim>    @brief Recibe una ontología desde el coordinador y la envía al microservicio de ontologías.

    @param file Archivo .owl con la ontología de usuario.
    @param nombre Identificador/nombre de la ontología.
    @param ipCoordinador IP del coordinador que envía la ontología (para tracking).

    @return JSONResponse con status 200 si exitoso, o error 400/500.
    
    @exception ValueError Si el archivo no es .owl.
    @exception RuntimeError Si falla el envío a micro_gestion_conocimiento.
    
    @details
    Flujo:
    1. Valida que el archivo sea .owl
    2. Delega carga en ontology_service (que se comunica con micro_gestion_conocimiento)
    3. Guarda IP del coordinador en archivo (para auditoría)
    4. Activa ECAs del usuario actual
    
    @note Esta operación es distribuida: coordina con micro_gestion_conocimiento
          y micro_automatizacion. Considerar saga si falla en mitad.
    
    @see ontology_service.cargar_ontologia()
    @see activarEcasUsuario()
</verbatim> </para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="microservicio_personalizacion/app/domain/services/personalizacion_service.py" line="88" column="1" bodyfile="microservicio_personalizacion/app/domain/services/personalizacion_service.py" bodystart="88" bodyend="136"/>
        <references refid="classapp_1_1domain_1_1services_1_1personalizacion__service_1_1_personalizacion_service_1acfcfbaf38f85ed2d82abef2f60a8338d" compoundref="personalizacion__service_8py" startline="185" endline="218">app.domain.services.personalizacion_service.PersonalizacionService.activarEcasUsuario</references>
      </memberdef>
      <memberdef kind="function" id="classapp_1_1domain_1_1services_1_1personalizacion__service_1_1_personalizacion_service_1a189ff6db69d330c419702b0785997c77" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type><ref refid="classstarlette_1_1responses_1_1_j_s_o_n_response" kindref="compound">JSONResponse</ref></type>
        <definition> JSONResponse app.domain.services.personalizacion_service.PersonalizacionService.crear_preferencia</definition>
        <argsstring>(self, MakeContractRequest data)</argsstring>
        <name>crear_preferencia</name>
        <qualifiedname>app.domain.services.personalizacion_service.PersonalizacionService.crear_preferencia</qualifiedname>
        <param>
          <type>self</type>
          <defname>self</defname>
        </param>
        <param>
          <type><ref refid="classapp_1_1application_1_1dtos_1_1request__dtos_1_1_make_contract_request" kindref="compound">MakeContractRequest</ref></type>
          <declname>data</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para><verbatim>    @brief Crea una nueva preferencia/contrato ECA para el usuario.
    
    @param data DTO MakeContractRequest con definición del contrato.
    
    @return JSONResponse con status 200 si exitoso, o error 400/500.
    
    @exception ValueError Si email no coincide con usuario actual.
    @exception RuntimeError Si falla comunicación con micro_automatizacion.
    
    @details
    Flujo:
    1. Valida que el email del DTO coincida con el usuario activo
    2. Envía solicitud POST a micro_automatizacion
    3. Si es exitoso, registra preferencia en ontología de usuario
    
    @note Operación distribuida: requiere coordinación con micro_automatizacion.
          Si micro_automatizacion responde error, la preferencia no se registra.
    
    @see MakeContractRequest DTO
    @see settings.AUTOMATIZACION_MS_URL Para endpoint remoto
</verbatim> </para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="microservicio_personalizacion/app/domain/services/personalizacion_service.py" line="137" column="1" bodyfile="microservicio_personalizacion/app/domain/services/personalizacion_service.py" bodystart="137" bodyend="182"/>
      </memberdef>
      <memberdef kind="function" id="classapp_1_1domain_1_1services_1_1personalizacion__service_1_1_personalizacion_service_1acfcfbaf38f85ed2d82abef2f60a8338d" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type></type>
        <definition>app.domain.services.personalizacion_service.PersonalizacionService.activarEcasUsuario</definition>
        <argsstring>(self)</argsstring>
        <name>activarEcasUsuario</name>
        <qualifiedname>app.domain.services.personalizacion_service.PersonalizacionService.activarEcasUsuario</qualifiedname>
        <param>
          <type>self</type>
          <defname>self</defname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="microservicio_personalizacion/app/domain/services/personalizacion_service.py" line="185" column="1" bodyfile="microservicio_personalizacion/app/domain/services/personalizacion_service.py" bodystart="185" bodyend="218"/>
        <referencedby refid="classapp_1_1domain_1_1services_1_1personalizacion__service_1_1_personalizacion_service_1ab600a1b7c03aff746520b47301524f01" compoundref="personalizacion__service_8py" startline="88" endline="136">app.domain.services.personalizacion_service.PersonalizacionService.recibir_ontologia</referencedby>
      </memberdef>
    </sectiondef>
    <briefdescription>
    </briefdescription>
    <detaileddescription>
<para><verbatim>    @class PersonalizacionService
    @brief Servicio de aplicación para gestión de preferencias e interacciones de usuario.
    
    @details
    Responsabilidades:
    - Orquestar carga de ontologías de perfil de usuario
    - Coordinar creación de preferencias/ECAs con micro_automatizacion
    - Activar/desactivar ECAs del usuario
    - Registrar interacciones usuario-objeto para personalización
    - Mantener conexión con servidor de perfil de usuario (ConexionPu)
    
    Atributos:
    - osid: ID del objeto inteligente activo
    - ipServidorPU: dirección del servidor de perfil de usuario
    - path: ruta donde se guardan las ECAs
    - conexion_pu: cliente para comunicación con servidor perfil
    - Log: cliente MQTT para logging distribuido
    
    @note Esta clase coordina múltiples microservicios de forma distribuida.
          Considerar implementar sagas/compensación para operaciones compuestas.
    
    @author Sistema Objeto Inteligente
    @date 2025-01-10
</verbatim> </para>
    </detaileddescription>
    <location file="microservicio_personalizacion/app/domain/services/personalizacion_service.py" line="48" column="1" bodyfile="microservicio_personalizacion/app/domain/services/personalizacion_service.py" bodystart="48" bodyend="218"/>
    <listofallmembers>
      <member refid="classapp_1_1domain_1_1services_1_1personalizacion__service_1_1_personalizacion_service_1acfcfbaf38f85ed2d82abef2f60a8338d" prot="public" virt="non-virtual"><scope>app::domain::services::personalizacion_service::PersonalizacionService</scope><name>activarEcasUsuario</name></member>
      <member refid="classapp_1_1domain_1_1services_1_1personalizacion__service_1_1_personalizacion_service_1a89c26b2ae8d32fabdfb479de10e33c2b" prot="public" virt="non-virtual"><scope>app::domain::services::personalizacion_service::PersonalizacionService</scope><name>conexion_pu</name></member>
      <member refid="classapp_1_1domain_1_1services_1_1personalizacion__service_1_1_personalizacion_service_1a189ff6db69d330c419702b0785997c77" prot="public" virt="non-virtual"><scope>app::domain::services::personalizacion_service::PersonalizacionService</scope><name>crear_preferencia</name></member>
      <member refid="classapp_1_1domain_1_1services_1_1personalizacion__service_1_1_personalizacion_service_1a615aae7687732f1ab49adca9619d2a2c" prot="public" virt="non-virtual"><scope>app::domain::services::personalizacion_service::PersonalizacionService</scope><name>ecasUsuario</name></member>
      <member refid="classapp_1_1domain_1_1services_1_1personalizacion__service_1_1_personalizacion_service_1a05889f39107a5a88b2b8cc262d826376" prot="public" virt="non-virtual"><scope>app::domain::services::personalizacion_service::PersonalizacionService</scope><name>ipServidorPU</name></member>
      <member refid="classapp_1_1domain_1_1services_1_1personalizacion__service_1_1_personalizacion_service_1ade88b01890801c7f7f1fd686c0ea3644" prot="public" virt="non-virtual"><scope>app::domain::services::personalizacion_service::PersonalizacionService</scope><name>Log</name></member>
      <member refid="classapp_1_1domain_1_1services_1_1personalizacion__service_1_1_personalizacion_service_1a2df7c70f0f7919efa7f194a49ea7eda7" prot="public" virt="non-virtual"><scope>app::domain::services::personalizacion_service::PersonalizacionService</scope><name>osid</name></member>
      <member refid="classapp_1_1domain_1_1services_1_1personalizacion__service_1_1_personalizacion_service_1a1a5c9f2533eee6882439e5737d2ebcb4" prot="public" virt="non-virtual"><scope>app::domain::services::personalizacion_service::PersonalizacionService</scope><name>path</name></member>
      <member refid="classapp_1_1domain_1_1services_1_1personalizacion__service_1_1_personalizacion_service_1ae2b7d0f2d862d4fa88497a472ef0ff44" prot="public" virt="non-virtual"><scope>app::domain::services::personalizacion_service::PersonalizacionService</scope><name>pathEcasUsuario</name></member>
      <member refid="classapp_1_1domain_1_1services_1_1personalizacion__service_1_1_personalizacion_service_1ab600a1b7c03aff746520b47301524f01" prot="public" virt="non-virtual"><scope>app::domain::services::personalizacion_service::PersonalizacionService</scope><name>recibir_ontologia</name></member>
      <member refid="classapp_1_1domain_1_1services_1_1personalizacion__service_1_1_personalizacion_service_1af900dcd3f19174ccd07a52e248799c0d" prot="public" virt="non-virtual"><scope>app::domain::services::personalizacion_service::PersonalizacionService</scope><name>user_eca</name></member>
    </listofallmembers>
  </compounddef>
</doxygen>
