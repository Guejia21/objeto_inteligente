<?xml version='1.0' encoding='UTF-8' standalone='no'?>
<doxygen xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="compound.xsd" version="1.15.0" xml:lang="es">
  <compounddef id="objeto__controller_8py" kind="file" language="Python">
    <compoundname>objeto_controller.py</compoundname>
    <innernamespace refid="namespaceobjeto__controller">objeto_controller</innernamespace>
    <briefdescription>
    </briefdescription>
    <detaileddescription>
    </detaileddescription>
    <programlisting>
<codeline lineno="1" refid="namespaceobjeto__controller" refkind="compound"><highlight class="stringliteral">&quot;&quot;&quot;</highlight></codeline>
<codeline lineno="2"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>@file<sp/>objeto_controller.py</highlight></codeline>
<codeline lineno="3"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>@brief<sp/>Controlador<sp/>REST<sp/>para<sp/>gestión<sp/>de<sp/>objetos<sp/>inteligentes.</highlight></codeline>
<codeline lineno="4"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>@details</highlight></codeline>
<codeline lineno="5"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>Proporciona<sp/>endpoints<sp/>para<sp/>operaciones<sp/>CRUD<sp/>y<sp/>consultas<sp/>sobre<sp/>objetos<sp/>inteligentes.</highlight></codeline>
<codeline lineno="6"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>Los<sp/>endpoints<sp/>disponibles<sp/>son:</highlight></codeline>
<codeline lineno="7"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>-<sp/>GET<sp/>/objeto/Identificator:<sp/>obtener<sp/>metadatos<sp/>del<sp/>objeto</highlight></codeline>
<codeline lineno="8"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>-<sp/>POST<sp/>/objeto/StartObject:<sp/>iniciar/crear<sp/>un<sp/>nuevo<sp/>objeto<sp/>inteligente</highlight></codeline>
<codeline lineno="9"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>-<sp/>GET<sp/>/objeto/SendState:<sp/>obtener<sp/>estado<sp/>actual<sp/>de<sp/>datastreams</highlight></codeline>
<codeline lineno="10"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>-<sp/>GET<sp/>/objeto/SendData:<sp/>enviar<sp/>datos<sp/>al<sp/>objeto</highlight></codeline>
<codeline lineno="11"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>-<sp/>GET<sp/>/objeto/SendServiceState:<sp/>verificar<sp/>disponibilidad<sp/>del<sp/>servicio</highlight></codeline>
<codeline lineno="12"><highlight class="stringliteral"><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="13"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>@note<sp/>Todos<sp/>los<sp/>endpoints<sp/>requieren<sp/>validación<sp/>de<sp/>osid<sp/>(ID<sp/>del<sp/>objeto<sp/>inteligente).</highlight></codeline>
<codeline lineno="14"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>@note<sp/>Las<sp/>operaciones<sp/>asincrónicas<sp/>usan<sp/>asyncio.to_thread()<sp/>para<sp/>operaciones<sp/>bloqueantes.</highlight></codeline>
<codeline lineno="15"><highlight class="stringliteral"><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="16"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>@author<sp/><sp/>NexTech</highlight></codeline>
<codeline lineno="17"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>@version<sp/>1.0</highlight></codeline>
<codeline lineno="18"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>@date<sp/>2025-01-10</highlight></codeline>
<codeline lineno="19"><highlight class="stringliteral"><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="20"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>@see<sp/>ObjetoService<sp/>Para<sp/>lógica<sp/>de<sp/>negocio</highlight></codeline>
<codeline lineno="21"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>@see<sp/>docs/diagrams/flow_diagrams.md<sp/>Para<sp/>diagramas<sp/>de<sp/>secuencia</highlight></codeline>
<codeline lineno="22"><highlight class="stringliteral">&quot;&quot;&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="23"><highlight class="normal"></highlight></codeline>
<codeline lineno="24"><highlight class="normal"></highlight><highlight class="keyword">from</highlight><highlight class="normal"><sp/>fastapi<sp/></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>APIRouter,<sp/>Depends,<sp/>Query,<sp/>HTTPException</highlight></codeline>
<codeline lineno="25"><highlight class="normal"></highlight><highlight class="keyword">from</highlight><highlight class="normal"><sp/><ref refid="namespacefastapi_1_1responses" kindref="compound">fastapi.responses</ref><sp/></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>JSONResponse</highlight></codeline>
<codeline lineno="26"><highlight class="normal"></highlight></codeline>
<codeline lineno="27"><highlight class="normal"></highlight><highlight class="keyword">from</highlight><highlight class="normal"><sp/>application.objeto_service<sp/></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>ObjetoService</highlight></codeline>
<codeline lineno="28"><highlight class="normal"></highlight><highlight class="keyword">from</highlight><highlight class="normal"><sp/>deps<sp/></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>get_objeto_service</highlight></codeline>
<codeline lineno="29"><highlight class="normal"></highlight><highlight class="keyword">from</highlight><highlight class="normal"><sp/>application.dtos<sp/></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>ObjectData</highlight></codeline>
<codeline lineno="30"><highlight class="normal"></highlight></codeline>
<codeline lineno="31"><highlight class="normal"></highlight></codeline>
<codeline lineno="32" refid="namespaceobjeto__controller_1a032a188678b092efd0b10de226f78836" refkind="member"><highlight class="normal">router<sp/>=<sp/><ref refid="classfastapi_1_1routing_1_1_a_p_i_router" kindref="compound">APIRouter</ref>(prefix=</highlight><highlight class="stringliteral">&quot;/objeto&quot;</highlight><highlight class="normal">,<sp/>tags=[</highlight><highlight class="stringliteral">&quot;Gestión<sp/>de<sp/>objeto<sp/>inteligente&quot;</highlight><highlight class="normal">])</highlight></codeline>
<codeline lineno="33"><highlight class="normal"></highlight><highlight class="stringliteral">&quot;&quot;&quot;@var<sp/>router<sp/>Router<sp/>principal<sp/>para<sp/>endpoints<sp/>de<sp/>objeto<sp/>inteligente.&quot;&quot;&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="34"><highlight class="normal"></highlight></codeline>
<codeline lineno="35"><highlight class="normal"></highlight><highlight class="preprocessor">@router.get(&quot;/Identificator&quot;)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="36" refid="namespaceobjeto__controller_1af05241f784ab7fa3a30deecc788c1b74" refkind="member"><highlight class="normal"></highlight><highlight class="keyword">async<sp/>def<sp/></highlight><highlight class="normal"><ref refid="namespaceobjeto__controller_1af05241f784ab7fa3a30deecc788c1b74" kindref="member">get_identificator</ref>(osid:<sp/>str<sp/>=<sp/>Query(...,<sp/>description=</highlight><highlight class="stringliteral">&quot;ID<sp/>del<sp/>objeto<sp/>inteligente&quot;</highlight><highlight class="normal">),<sp/>objeto_service:<sp/>ObjetoService<sp/>=<sp/>Depends(get_objeto_service)):</highlight></codeline>
<codeline lineno="37"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;&quot;&quot;</highlight></codeline>
<codeline lineno="38"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>@brief<sp/>Obtiene<sp/>los<sp/>metadatos<sp/>del<sp/>objeto<sp/>inteligente.</highlight></codeline>
<codeline lineno="39"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="40"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>@param<sp/>osid<sp/>Identificador<sp/>único<sp/>del<sp/>objeto<sp/>inteligente<sp/>(OSID).</highlight></codeline>
<codeline lineno="41"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>@param<sp/>objeto_service<sp/>Instancia<sp/>del<sp/>servicio<sp/>de<sp/>objetos<sp/>(inyectada<sp/>por<sp/>dependencia).</highlight></codeline>
<codeline lineno="42"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="43"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>@return<sp/>JSONResponse<sp/>con<sp/>status<sp/>200<sp/>y<sp/>metadatos<sp/>del<sp/>objeto<sp/>si<sp/>es<sp/>exitoso,</highlight></codeline>
<codeline lineno="44"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>o<sp/>error<sp/>400/500<sp/>si<sp/>falla.</highlight></codeline>
<codeline lineno="45"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="46"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>@exception<sp/>ValueError<sp/>Si<sp/>el<sp/>osid<sp/>no<sp/>es<sp/>válido.</highlight></codeline>
<codeline lineno="47"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>@exception<sp/>RuntimeError<sp/>Si<sp/>hay<sp/>error<sp/>en<sp/>la<sp/>persistencia.</highlight></codeline>
<codeline lineno="48"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="49"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>@details</highlight></codeline>
<codeline lineno="50"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>Flujo:</highlight></codeline>
<codeline lineno="51"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>1.<sp/>Valida<sp/>que<sp/>el<sp/>osid<sp/>coincida<sp/>con<sp/>el<sp/>objeto<sp/>inteligente<sp/>activo</highlight></codeline>
<codeline lineno="52"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>2.<sp/>Verifica<sp/>que<sp/>existan<sp/>metadatos<sp/>en<sp/>persistencia</highlight></codeline>
<codeline lineno="53"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>3.<sp/>Retorna<sp/>los<sp/>metadatos<sp/>en<sp/>formato<sp/>JSON</highlight></codeline>
<codeline lineno="54"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>4.<sp/>Registra<sp/>logs<sp/>y<sp/>eventos<sp/>en<sp/>el<sp/>panel<sp/>MQTT</highlight></codeline>
<codeline lineno="55"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="56"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>@see<sp/>ObjetoService.getIdentificator()</highlight></codeline>
<codeline lineno="57"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="58"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>@example</highlight></codeline>
<codeline lineno="59"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>GET<sp/>/objeto/Identificator?osid=obj_001</highlight></codeline>
<codeline lineno="60"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>200<sp/>OK</highlight></codeline>
<codeline lineno="61"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="62"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&quot;status&quot;:<sp/>&quot;success&quot;,</highlight></codeline>
<codeline lineno="63"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&quot;message&quot;:<sp/>&quot;Metadatos<sp/>del<sp/>objeto<sp/>inteligente<sp/>obtenidos<sp/>correctamente.&quot;,</highlight></codeline>
<codeline lineno="64"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&quot;data&quot;:<sp/>{&quot;id&quot;:<sp/>&quot;obj_001&quot;,<sp/>&quot;title&quot;:<sp/>&quot;Sensor<sp/>Temperatura&quot;,<sp/>...}</highlight></codeline>
<codeline lineno="65"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="66"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&quot;&quot;&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="67"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">try</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="68"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>await<sp/>objeto_service.getIdentificator(osid)</highlight></codeline>
<codeline lineno="69"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">except</highlight><highlight class="normal"><sp/>ValueError<sp/></highlight><highlight class="keyword">as</highlight><highlight class="normal"><sp/>e:</highlight></codeline>
<codeline lineno="70"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">raise</highlight><highlight class="normal"><sp/><ref refid="classfastapi_1_1exceptions_1_1_h_t_t_p_exception" kindref="compound">HTTPException</ref>(status_code=400,<sp/>detail=str(e))</highlight></codeline>
<codeline lineno="71"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">except</highlight><highlight class="normal"><sp/>RuntimeError<sp/></highlight><highlight class="keyword">as</highlight><highlight class="normal"><sp/>e:</highlight></codeline>
<codeline lineno="72"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">raise</highlight><highlight class="normal"><sp/><ref refid="classfastapi_1_1exceptions_1_1_h_t_t_p_exception" kindref="compound">HTTPException</ref>(status_code=500,<sp/>detail=str(e))</highlight></codeline>
<codeline lineno="73"><highlight class="normal"></highlight></codeline>
<codeline lineno="74"><highlight class="normal"></highlight></codeline>
<codeline lineno="75"><highlight class="normal"></highlight><highlight class="preprocessor">@router.post(&quot;/StartObject&quot;)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="76" refid="namespaceobjeto__controller_1ae5f1ef3cecaa7f2b0ee40d30bbeed98b" refkind="member"><highlight class="normal"></highlight><highlight class="keyword">async<sp/>def<sp/></highlight><highlight class="normal"><ref refid="namespaceobjeto__controller_1ae5f1ef3cecaa7f2b0ee40d30bbeed98b" kindref="member">start_object</ref>(data:<sp/>ObjectData,<sp/>objeto_service:<sp/>ObjetoService<sp/>=<sp/>Depends(get_objeto_service)):</highlight></codeline>
<codeline lineno="77"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;&quot;&quot;</highlight></codeline>
<codeline lineno="78"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>@brief<sp/>Inicia<sp/>un<sp/>nuevo<sp/>objeto<sp/>inteligente<sp/>con<sp/>datos<sp/>proporcionados.</highlight></codeline>
<codeline lineno="79"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="80"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>@param<sp/>data<sp/>DTO<sp/>ObjectData<sp/>con<sp/>configuración<sp/>del<sp/>objeto<sp/>(feed,<sp/>datastreams,<sp/>etc.)</highlight></codeline>
<codeline lineno="81"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>@param<sp/>objeto_service<sp/>Servicio<sp/>de<sp/>objetos<sp/>(inyectado).</highlight></codeline>
<codeline lineno="82"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="83"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>@return<sp/>JSONResponse<sp/>con<sp/>status<sp/>200<sp/>si<sp/>es<sp/>exitoso,<sp/>o<sp/>error<sp/>400/500.</highlight></codeline>
<codeline lineno="84"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="85"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>@exception<sp/>ValueError<sp/>Si<sp/>los<sp/>datos<sp/>del<sp/>DTO<sp/>son<sp/>inválidos.</highlight></codeline>
<codeline lineno="86"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>@exception<sp/>RuntimeError<sp/>Si<sp/>falla<sp/>poblar<sp/>ontología<sp/>o<sp/>persistencia.</highlight></codeline>
<codeline lineno="87"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="88"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>@details</highlight></codeline>
<codeline lineno="89"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>Operación<sp/>compuesta<sp/>que:</highlight></codeline>
<codeline lineno="90"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>1.<sp/>Verifica<sp/>que<sp/>la<sp/>ontología<sp/>no<sp/>esté<sp/>ya<sp/>activa</highlight></codeline>
<codeline lineno="91"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>2.<sp/>Estructura<sp/>los<sp/>datos<sp/>del<sp/>objeto<sp/>inteligente</highlight></codeline>
<codeline lineno="92"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>3.<sp/>Puebla<sp/>la<sp/>ontología<sp/>(crea<sp/>individuos<sp/>y<sp/>relaciones<sp/>OWL)</highlight></codeline>
<codeline lineno="93"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>4.<sp/>Persiste<sp/>metadatos<sp/>en<sp/>JSON/DB</highlight></codeline>
<codeline lineno="94"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>5.<sp/>Crea<sp/>dispositivo<sp/>en<sp/>ThingsBoard<sp/>(IoT<sp/>Platform)</highlight></codeline>
<codeline lineno="95"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>6.<sp/>Registra<sp/>datastreams<sp/>en<sp/>microservicio_data_stream</highlight></codeline>
<codeline lineno="96"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>7.<sp/>Registra<sp/>evento<sp/>en<sp/>panel<sp/>MQTT</highlight></codeline>
<codeline lineno="97"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="98"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>@note<sp/>Esta<sp/>es<sp/>una<sp/>operación<sp/>distribuida<sp/>que<sp/>requiere<sp/>coordinación<sp/>entre</highlight></codeline>
<codeline lineno="99"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>múltiples<sp/>microservicios.<sp/>Considerar<sp/>implementar<sp/>saga/compensación.</highlight></codeline>
<codeline lineno="100"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="101"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>@see<sp/>ObjetoService.startObject()</highlight></codeline>
<codeline lineno="102"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>@see<sp/>docs/diagrams/flow_diagrams.md<sp/>(StartObject<sp/>sequence<sp/>diagram)</highlight></codeline>
<codeline lineno="103"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="104"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>@example</highlight></codeline>
<codeline lineno="105"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>POST<sp/>/objeto/StartObject</highlight></codeline>
<codeline lineno="106"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>Content-Type:<sp/>application/json</highlight></codeline>
<codeline lineno="107"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="108"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&quot;feed&quot;:<sp/>{</highlight></codeline>
<codeline lineno="109"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&quot;id&quot;:<sp/>&quot;obj_sensor_001&quot;,</highlight></codeline>
<codeline lineno="110"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&quot;title&quot;:<sp/>&quot;Sensor<sp/>Temperatura<sp/>Sala&quot;,</highlight></codeline>
<codeline lineno="111"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&quot;description&quot;:<sp/>&quot;Sensor<sp/>DHT22<sp/>en<sp/>sala<sp/>A&quot;,</highlight></codeline>
<codeline lineno="112"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&quot;datastreams&quot;:<sp/>[&quot;temp&quot;,<sp/>&quot;humidity&quot;]</highlight></codeline>
<codeline lineno="113"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="114"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="115"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="116"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>200<sp/>OK</highlight></codeline>
<codeline lineno="117"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="118"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&quot;status&quot;:<sp/>&quot;success&quot;,</highlight></codeline>
<codeline lineno="119"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&quot;message&quot;:<sp/>&quot;Objeto<sp/>inteligente<sp/>iniciado<sp/>con<sp/>éxito.&quot;,</highlight></codeline>
<codeline lineno="120"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&quot;data&quot;:<sp/>{}</highlight></codeline>
<codeline lineno="121"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="122"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&quot;&quot;&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="123"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">try</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="124"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>await<sp/>objeto_service.startObject(data)</highlight></codeline>
<codeline lineno="125"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">except</highlight><highlight class="normal"><sp/>ValueError<sp/></highlight><highlight class="keyword">as</highlight><highlight class="normal"><sp/>e:</highlight></codeline>
<codeline lineno="126"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">raise</highlight><highlight class="normal"><sp/><ref refid="classfastapi_1_1exceptions_1_1_h_t_t_p_exception" kindref="compound">HTTPException</ref>(status_code=400,<sp/>detail=str(e))</highlight></codeline>
<codeline lineno="127"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">except</highlight><highlight class="normal"><sp/>RuntimeError<sp/></highlight><highlight class="keyword">as</highlight><highlight class="normal"><sp/>e:</highlight></codeline>
<codeline lineno="128"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">raise</highlight><highlight class="normal"><sp/><ref refid="classfastapi_1_1exceptions_1_1_h_t_t_p_exception" kindref="compound">HTTPException</ref>(status_code=500,<sp/>detail=str(e))</highlight></codeline>
<codeline lineno="129"><highlight class="normal"></highlight></codeline>
<codeline lineno="130"><highlight class="normal"></highlight></codeline>
<codeline lineno="131"><highlight class="normal"></highlight><highlight class="preprocessor">@router.get(&quot;/SendState&quot;)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="132" refid="namespaceobjeto__controller_1a29e614f29e33f15dcc3f43278440926a" refkind="member"><highlight class="normal"></highlight><highlight class="keyword">async<sp/>def<sp/></highlight><highlight class="normal"><ref refid="namespaceobjeto__controller_1a29e614f29e33f15dcc3f43278440926a" kindref="member">get_state</ref>(osid:<sp/>str<sp/>=<sp/>Query(...,<sp/>description=</highlight><highlight class="stringliteral">&quot;ID<sp/>del<sp/>objeto<sp/>inteligente&quot;</highlight><highlight class="normal">),<sp/>objeto_service:<sp/>ObjetoService<sp/>=<sp/>Depends(get_objeto_service)):</highlight></codeline>
<codeline lineno="133"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;&quot;&quot;</highlight></codeline>
<codeline lineno="134"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>@brief<sp/>Obtiene<sp/>el<sp/>estado<sp/>actual<sp/>de<sp/>los<sp/>datastreams<sp/>del<sp/>objeto<sp/>inteligente.</highlight></codeline>
<codeline lineno="135"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="136"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>@param<sp/>osid<sp/>Identificador<sp/>único<sp/>del<sp/>objeto<sp/>inteligente.</highlight></codeline>
<codeline lineno="137"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>@param<sp/>objeto_service<sp/>Servicio<sp/>de<sp/>objetos.</highlight></codeline>
<codeline lineno="138"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="139"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>@return<sp/>JSONResponse<sp/>con<sp/>status<sp/>200<sp/>y<sp/>estado<sp/>de<sp/>datastreams<sp/>(valores,<sp/>tipos,<sp/>timestamps).</highlight></codeline>
<codeline lineno="140"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="141"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>@exception<sp/>ValueError<sp/>Si<sp/>osid<sp/>es<sp/>inválido.</highlight></codeline>
<codeline lineno="142"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>@exception<sp/>RuntimeError<sp/>Si<sp/>falla<sp/>la<sp/>consulta<sp/>al<sp/>microservicio<sp/>datastream.</highlight></codeline>
<codeline lineno="143"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="144"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>@details</highlight></codeline>
<codeline lineno="145"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>Flujo:</highlight></codeline>
<codeline lineno="146"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>1.<sp/>Valida<sp/>que<sp/>osid<sp/>coincida<sp/>con<sp/>el<sp/>objeto<sp/>inteligente<sp/>activo</highlight></codeline>
<codeline lineno="147"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>2.<sp/>Delega<sp/>consulta<sp/>a<sp/>microservicio_data_stream.send_state()</highlight></codeline>
<codeline lineno="148"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>3.<sp/>Normaliza<sp/>la<sp/>respuesta<sp/>(mapea<sp/>campos<sp/>a<sp/>estructura<sp/>uniforme)</highlight></codeline>
<codeline lineno="149"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>4.<sp/>Opcionalmente<sp/>enriquece<sp/>con<sp/>consultas<sp/>a<sp/>ontología</highlight></codeline>
<codeline lineno="150"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>5.<sp/>Retorna<sp/>estado<sp/>normalizado</highlight></codeline>
<codeline lineno="151"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="152"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>@note<sp/>Usa<sp/>asyncio.to_thread()<sp/>para<sp/>no<sp/>bloquear<sp/>event<sp/>loop<sp/>si<sp/>cliente<sp/>HTTP<sp/>es<sp/>síncrono.</highlight></codeline>
<codeline lineno="153"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="154"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>@see<sp/>ObjetoService.get_state()</highlight></codeline>
<codeline lineno="155"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>@see<sp/>docs/diagrams/flow_diagrams.md<sp/>(GetState<sp/>sequence<sp/>diagram)</highlight></codeline>
<codeline lineno="156"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="157"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>@example</highlight></codeline>
<codeline lineno="158"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>GET<sp/>/objeto/SendState?osid=obj_001</highlight></codeline>
<codeline lineno="159"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="160"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>200<sp/>OK</highlight></codeline>
<codeline lineno="161"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="162"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&quot;status&quot;:<sp/>&quot;success&quot;,</highlight></codeline>
<codeline lineno="163"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&quot;osid&quot;:<sp/>&quot;obj_001&quot;,</highlight></codeline>
<codeline lineno="164"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&quot;datastreams&quot;:<sp/>[</highlight></codeline>
<codeline lineno="165"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{&quot;variableEstado&quot;:<sp/>&quot;temp&quot;,<sp/>&quot;type&quot;:<sp/>&quot;float&quot;,<sp/>&quot;valor&quot;:<sp/>23.5,<sp/>&quot;dstype&quot;:<sp/>&quot;sensor&quot;},</highlight></codeline>
<codeline lineno="166"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{&quot;variableEstado&quot;:<sp/>&quot;humidity&quot;,<sp/>&quot;type&quot;:<sp/>&quot;float&quot;,<sp/>&quot;valor&quot;:<sp/>65.2,<sp/>&quot;dstype&quot;:<sp/>&quot;sensor&quot;}</highlight></codeline>
<codeline lineno="167"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>],</highlight></codeline>
<codeline lineno="168"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&quot;timestamp&quot;:<sp/>&quot;2025-01-10T15:30:45Z&quot;</highlight></codeline>
<codeline lineno="169"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="170"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&quot;&quot;&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="171"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">try</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="172"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>await<sp/>objeto_service.get_state(osid)</highlight></codeline>
<codeline lineno="173"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">except</highlight><highlight class="normal"><sp/>ValueError<sp/></highlight><highlight class="keyword">as</highlight><highlight class="normal"><sp/>e:</highlight></codeline>
<codeline lineno="174"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">raise</highlight><highlight class="normal"><sp/><ref refid="classfastapi_1_1exceptions_1_1_h_t_t_p_exception" kindref="compound">HTTPException</ref>(status_code=400,<sp/>detail=str(e))</highlight></codeline>
<codeline lineno="175"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">except</highlight><highlight class="normal"><sp/>RuntimeError<sp/></highlight><highlight class="keyword">as</highlight><highlight class="normal"><sp/>e:</highlight></codeline>
<codeline lineno="176"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">raise</highlight><highlight class="normal"><sp/><ref refid="classfastapi_1_1exceptions_1_1_h_t_t_p_exception" kindref="compound">HTTPException</ref>(status_code=500,<sp/>detail=str(e))</highlight></codeline>
<codeline lineno="177"><highlight class="normal"></highlight></codeline>
<codeline lineno="178"><highlight class="normal"></highlight><highlight class="preprocessor">@router.get(&quot;/SendData&quot;)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="179" refid="namespaceobjeto__controller_1a911533e9228d9e95deaee73a861a62e1" refkind="member"><highlight class="normal"></highlight><highlight class="keyword">async<sp/>def<sp/></highlight><highlight class="normal"><ref refid="namespaceobjeto__controller_1a911533e9228d9e95deaee73a861a62e1" kindref="member">send_data</ref>(</highlight></codeline>
<codeline lineno="180"><highlight class="normal"><sp/><sp/><sp/><sp/>osid:<sp/>str<sp/>=<sp/>Query(...,<sp/>description=</highlight><highlight class="stringliteral">&quot;ID<sp/>del<sp/>objeto<sp/>inteligente&quot;</highlight><highlight class="normal">),</highlight></codeline>
<codeline lineno="181"><highlight class="normal"><sp/><sp/><sp/><sp/>variableEstado:<sp/>str<sp/>=<sp/>Query(...,<sp/>description=</highlight><highlight class="stringliteral">&quot;Variable<sp/>del<sp/>estado<sp/>a<sp/>enviar&quot;</highlight><highlight class="normal">),</highlight></codeline>
<codeline lineno="182"><highlight class="normal"><sp/><sp/><sp/><sp/>tipove:<sp/>str<sp/>=<sp/>Query(</highlight><highlight class="stringliteral">&apos;1&apos;</highlight><highlight class="normal">,<sp/>description=</highlight><highlight class="stringliteral">&quot;Tipo<sp/>de<sp/>variable<sp/>(1=actuador,<sp/>2=sensor,<sp/>etc.)&quot;</highlight><highlight class="normal">),</highlight></codeline>
<codeline lineno="183"><highlight class="normal"><sp/><sp/><sp/><sp/>objeto_service:<sp/>ObjetoService<sp/>=<sp/>Depends(get_objeto_service)</highlight></codeline>
<codeline lineno="184"><highlight class="normal">):</highlight></codeline>
<codeline lineno="185"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;&quot;&quot;</highlight></codeline>
<codeline lineno="186"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>@brief<sp/>Envía<sp/>datos<sp/>a<sp/>un<sp/>datastream<sp/>específico<sp/>del<sp/>objeto<sp/>inteligente.</highlight></codeline>
<codeline lineno="187"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="188"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>@param<sp/>osid<sp/>Identificador<sp/>único<sp/>del<sp/>objeto<sp/>inteligente.</highlight></codeline>
<codeline lineno="189"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>@param<sp/>variableEstado<sp/>Nombre/ID<sp/>del<sp/>datastream<sp/>(p.<sp/>ej.<sp/>&apos;temp&apos;,<sp/>&apos;humidity&apos;).</highlight></codeline>
<codeline lineno="190"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>@param<sp/>tipove<sp/>Tipo<sp/>de<sp/>variable:<sp/>&apos;1&apos;<sp/>(actuador),<sp/>&apos;2&apos;<sp/>(sensor),<sp/>etc.</highlight></codeline>
<codeline lineno="191"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>@param<sp/>objeto_service<sp/>Servicio<sp/>de<sp/>objetos.</highlight></codeline>
<codeline lineno="192"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="193"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>@return<sp/>JSONResponse<sp/>con<sp/>status<sp/>200<sp/>y<sp/>resultado<sp/>de<sp/>envío.</highlight></codeline>
<codeline lineno="194"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="195"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>@exception<sp/>ValueError<sp/>Si<sp/>osid<sp/>o<sp/>variableEstado<sp/>son<sp/>inválidos.</highlight></codeline>
<codeline lineno="196"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>@exception<sp/>RuntimeError<sp/>Si<sp/>falla<sp/>la<sp/>comunicación<sp/>con<sp/>microservicio<sp/>datastream.</highlight></codeline>
<codeline lineno="197"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="198"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>@details</highlight></codeline>
<codeline lineno="199"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>Flujo:</highlight></codeline>
<codeline lineno="200"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>1.<sp/>Valida<sp/>que<sp/>osid<sp/>coincida<sp/>con<sp/>el<sp/>objeto<sp/>activo</highlight></codeline>
<codeline lineno="201"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>2.<sp/>Verifica<sp/>que<sp/>variableEstado<sp/>no<sp/>esté<sp/>vacío</highlight></codeline>
<codeline lineno="202"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>3.<sp/>Delega<sp/>en<sp/>dataStream_service.send_data()<sp/>con<sp/>asyncio.to_thread()</highlight></codeline>
<codeline lineno="203"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>4.<sp/>Registra<sp/>log<sp/>en<sp/>panel<sp/>MQTT</highlight></codeline>
<codeline lineno="204"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>5.<sp/>Retorna<sp/>respuesta<sp/>normalizada</highlight></codeline>
<codeline lineno="205"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="206"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>@see<sp/>ObjetoService.send_data()</highlight></codeline>
<codeline lineno="207"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>@see<sp/>microservicio_data_stream<sp/>Para<sp/>documentación<sp/>de<sp/>datastreams</highlight></codeline>
<codeline lineno="208"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="209"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>@example</highlight></codeline>
<codeline lineno="210"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>GET<sp/>/objeto/SendData?osid=obj_001&amp;variableEstado=temp&amp;tipove=1</highlight></codeline>
<codeline lineno="211"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="212"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>200<sp/>OK</highlight></codeline>
<codeline lineno="213"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{&quot;status&quot;:<sp/>&quot;success&quot;,<sp/>&quot;datastream&quot;:<sp/>&quot;temp&quot;,<sp/>&quot;sent&quot;:<sp/>true}</highlight></codeline>
<codeline lineno="214"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&quot;&quot;&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="215"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">try</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="216"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>await<sp/>objeto_service.send_data(osid,<sp/>variableEstado,<sp/>tipove)</highlight></codeline>
<codeline lineno="217"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">except</highlight><highlight class="normal"><sp/>ValueError<sp/></highlight><highlight class="keyword">as</highlight><highlight class="normal"><sp/>e:</highlight></codeline>
<codeline lineno="218"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">raise</highlight><highlight class="normal"><sp/><ref refid="classfastapi_1_1exceptions_1_1_h_t_t_p_exception" kindref="compound">HTTPException</ref>(status_code=400,<sp/>detail=str(e))</highlight></codeline>
<codeline lineno="219"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">except</highlight><highlight class="normal"><sp/>RuntimeError<sp/></highlight><highlight class="keyword">as</highlight><highlight class="normal"><sp/>e:</highlight></codeline>
<codeline lineno="220"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">raise</highlight><highlight class="normal"><sp/><ref refid="classfastapi_1_1exceptions_1_1_h_t_t_p_exception" kindref="compound">HTTPException</ref>(status_code=500,<sp/>detail=str(e))</highlight></codeline>
<codeline lineno="221"><highlight class="normal"></highlight></codeline>
<codeline lineno="222"><highlight class="normal"></highlight></codeline>
<codeline lineno="223"><highlight class="normal"></highlight><highlight class="preprocessor">@router.get(&quot;/SendServiceState&quot;)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="224" refid="namespaceobjeto__controller_1acbe0a134fad4fa3bb39b5ff5ef3a01ce" refkind="member"><highlight class="normal"></highlight><highlight class="keyword">async<sp/>def<sp/></highlight><highlight class="normal"><ref refid="namespaceobjeto__controller_1acbe0a134fad4fa3bb39b5ff5ef3a01ce" kindref="member">send_service_state</ref>(osid:<sp/>str<sp/>=<sp/>Query(...,<sp/>description=</highlight><highlight class="stringliteral">&quot;ID<sp/>del<sp/>objeto<sp/>inteligente&quot;</highlight><highlight class="normal">),<sp/>objeto_service:<sp/>ObjetoService<sp/>=<sp/>Depends(get_objeto_service)):</highlight></codeline>
<codeline lineno="225"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;&quot;&quot;</highlight></codeline>
<codeline lineno="226"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>@brief<sp/>Verifica<sp/>la<sp/>disponibilidad/salud<sp/>del<sp/>microservicio<sp/>de<sp/>datastreams.</highlight></codeline>
<codeline lineno="227"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="228"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>@param<sp/>osid<sp/>Identificador<sp/>del<sp/>objeto<sp/>inteligente<sp/>(se<sp/>incluye<sp/>en<sp/>respuesta<sp/>si<sp/>se<sp/>proporciona).</highlight></codeline>
<codeline lineno="229"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>@param<sp/>objeto_service<sp/>Servicio<sp/>de<sp/>objetos.</highlight></codeline>
<codeline lineno="230"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="231"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>@return<sp/>JSONResponse<sp/>con<sp/>status<sp/>200<sp/>y<sp/>disponibilidad<sp/>del<sp/>servicio.</highlight></codeline>
<codeline lineno="232"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="233"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>@exception<sp/>RuntimeError<sp/>Si<sp/>falla<sp/>la<sp/>comprobación<sp/>de<sp/>salud<sp/>del<sp/>servicio.</highlight></codeline>
<codeline lineno="234"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="235"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>@details</highlight></codeline>
<codeline lineno="236"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>Flujo:</highlight></codeline>
<codeline lineno="237"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>1.<sp/>Ejecuta<sp/>healthcheck<sp/>contra<sp/>microservicio_data_stream</highlight></codeline>
<codeline lineno="238"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>2.<sp/>Retorna<sp/>boolean<sp/>indicando<sp/>disponibilidad</highlight></codeline>
<codeline lineno="239"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>3.<sp/>Opcionalmente<sp/>incluye<sp/>osid<sp/>en<sp/>respuesta</highlight></codeline>
<codeline lineno="240"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="241"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>@note<sp/>No<sp/>requiere<sp/>validación<sp/>de<sp/>osid<sp/>contra<sp/>el<sp/>objeto<sp/>activo</highlight></codeline>
<codeline lineno="242"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>(es<sp/>un<sp/>check<sp/>genérico<sp/>de<sp/>disponibilidad<sp/>de<sp/>servicio).</highlight></codeline>
<codeline lineno="243"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="244"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>@see<sp/>ObjetoService.send_service_state()</highlight></codeline>
<codeline lineno="245"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="246"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>@example</highlight></codeline>
<codeline lineno="247"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>GET<sp/>/objeto/SendServiceState?osid=obj_001</highlight></codeline>
<codeline lineno="248"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="249"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>200<sp/>OK</highlight></codeline>
<codeline lineno="250"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{&quot;service_available&quot;:<sp/>true,<sp/>&quot;osid&quot;:<sp/>&quot;obj_001&quot;}</highlight></codeline>
<codeline lineno="251"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&quot;&quot;&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="252"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">try</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="253"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>await<sp/>objeto_service.send_service_state(osid)</highlight></codeline>
<codeline lineno="254"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">except</highlight><highlight class="normal"><sp/>ValueError<sp/></highlight><highlight class="keyword">as</highlight><highlight class="normal"><sp/>e:</highlight></codeline>
<codeline lineno="255"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">raise</highlight><highlight class="normal"><sp/><ref refid="classfastapi_1_1exceptions_1_1_h_t_t_p_exception" kindref="compound">HTTPException</ref>(status_code=400,<sp/>detail=str(e))</highlight></codeline>
<codeline lineno="256"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">except</highlight><highlight class="normal"><sp/>RuntimeError<sp/></highlight><highlight class="keyword">as</highlight><highlight class="normal"><sp/>e:</highlight></codeline>
<codeline lineno="257"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">raise</highlight><highlight class="normal"><sp/><ref refid="classfastapi_1_1exceptions_1_1_h_t_t_p_exception" kindref="compound">HTTPException</ref>(status_code=500,<sp/>detail=str(e))</highlight></codeline>
    </programlisting>
    <location file="micro_gestion_objetos/app/api/objeto_controller.py"/>
  </compounddef>
</doxygen>
