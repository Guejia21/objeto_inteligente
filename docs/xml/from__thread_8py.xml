<?xml version='1.0' encoding='UTF-8' standalone='no'?>
<doxygen xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="compound.xsd" version="1.15.0" xml:lang="es">
  <compounddef id="from__thread_8py" kind="file" language="Python">
    <compoundname>from_thread.py</compoundname>
    <innerclass refid="classanyio_1_1from__thread_1_1___blocking_async_context_manager" prot="protected">anyio::from_thread::_BlockingAsyncContextManager</innerclass>
    <innerclass refid="classanyio_1_1from__thread_1_1___blocking_portal_task_status" prot="protected">anyio::from_thread::_BlockingPortalTaskStatus</innerclass>
    <innerclass refid="classanyio_1_1from__thread_1_1_blocking_portal" prot="public">anyio::from_thread::BlockingPortal</innerclass>
    <innerclass refid="classanyio_1_1from__thread_1_1_blocking_portal_provider" prot="public">anyio::from_thread::BlockingPortalProvider</innerclass>
    <innernamespace refid="namespaceanyio">anyio</innernamespace>
    <innernamespace refid="namespaceanyio_1_1from__thread">anyio::from_thread</innernamespace>
    <briefdescription>
    </briefdescription>
    <detaileddescription>
    </detaileddescription>
    <programlisting>
<codeline lineno="1" refid="namespaceanyio_1_1from__thread" refkind="compound"><highlight class="keyword">from</highlight><highlight class="normal"><sp/>__future__<sp/></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>annotations</highlight></codeline>
<codeline lineno="2"><highlight class="normal"></highlight></codeline>
<codeline lineno="3"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>sys</highlight></codeline>
<codeline lineno="4"><highlight class="normal"></highlight><highlight class="keyword">from</highlight><highlight class="normal"><sp/><ref refid="namespacecollections_1_1abc" kindref="compound">collections.abc</ref><sp/></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>Awaitable,<sp/>Callable,<sp/>Generator</highlight></codeline>
<codeline lineno="5"><highlight class="normal"></highlight><highlight class="keyword">from</highlight><highlight class="normal"><sp/>concurrent.futures<sp/></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>Future</highlight></codeline>
<codeline lineno="6"><highlight class="normal"></highlight><highlight class="keyword">from</highlight><highlight class="normal"><sp/>contextlib<sp/></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>(</highlight></codeline>
<codeline lineno="7"><highlight class="normal"><sp/><sp/><sp/><sp/>AbstractAsyncContextManager,</highlight></codeline>
<codeline lineno="8"><highlight class="normal"><sp/><sp/><sp/><sp/>AbstractContextManager,</highlight></codeline>
<codeline lineno="9"><highlight class="normal"><sp/><sp/><sp/><sp/>contextmanager,</highlight></codeline>
<codeline lineno="10"><highlight class="normal">)</highlight></codeline>
<codeline lineno="11"><highlight class="normal"></highlight><highlight class="keyword">from</highlight><highlight class="normal"><sp/>dataclasses<sp/></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>dataclass,<sp/>field</highlight></codeline>
<codeline lineno="12"><highlight class="normal"></highlight><highlight class="keyword">from</highlight><highlight class="normal"><sp/>inspect<sp/></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>isawaitable</highlight></codeline>
<codeline lineno="13"><highlight class="normal"></highlight><highlight class="keyword">from</highlight><highlight class="normal"><sp/>threading<sp/></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>Lock,<sp/>Thread,<sp/>current_thread,<sp/>get_ident</highlight></codeline>
<codeline lineno="14"><highlight class="normal"></highlight><highlight class="keyword">from</highlight><highlight class="normal"><sp/>types<sp/></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>TracebackType</highlight></codeline>
<codeline lineno="15"><highlight class="normal"></highlight><highlight class="keyword">from</highlight><highlight class="normal"><sp/>typing<sp/></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>(</highlight></codeline>
<codeline lineno="16"><highlight class="normal"><sp/><sp/><sp/><sp/>Any,</highlight></codeline>
<codeline lineno="17"><highlight class="normal"><sp/><sp/><sp/><sp/>Generic,</highlight></codeline>
<codeline lineno="18"><highlight class="normal"><sp/><sp/><sp/><sp/>TypeVar,</highlight></codeline>
<codeline lineno="19"><highlight class="normal"><sp/><sp/><sp/><sp/>cast,</highlight></codeline>
<codeline lineno="20"><highlight class="normal"><sp/><sp/><sp/><sp/>overload,</highlight></codeline>
<codeline lineno="21"><highlight class="normal">)</highlight></codeline>
<codeline lineno="22"><highlight class="normal"></highlight></codeline>
<codeline lineno="23"><highlight class="normal"></highlight><highlight class="keyword">from</highlight><highlight class="normal"><sp/>._core._eventloop<sp/></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>(</highlight></codeline>
<codeline lineno="24"><highlight class="normal"><sp/><sp/><sp/><sp/>get_async_backend,</highlight></codeline>
<codeline lineno="25"><highlight class="normal"><sp/><sp/><sp/><sp/>get_cancelled_exc_class,</highlight></codeline>
<codeline lineno="26"><highlight class="normal"><sp/><sp/><sp/><sp/>threadlocals,</highlight></codeline>
<codeline lineno="27"><highlight class="normal">)</highlight></codeline>
<codeline lineno="28"><highlight class="normal"></highlight><highlight class="keyword">from</highlight><highlight class="normal"><sp/>._core._eventloop<sp/></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>run<sp/></highlight><highlight class="keyword">as</highlight><highlight class="normal"><sp/>run_eventloop</highlight></codeline>
<codeline lineno="29"><highlight class="normal"></highlight><highlight class="keyword">from</highlight><highlight class="normal"><sp/>._core._exceptions<sp/></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>NoEventLoopError</highlight></codeline>
<codeline lineno="30"><highlight class="normal"></highlight><highlight class="keyword">from</highlight><highlight class="normal"><sp/>._core._synchronization<sp/></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>Event</highlight></codeline>
<codeline lineno="31"><highlight class="normal"></highlight><highlight class="keyword">from</highlight><highlight class="normal"><sp/>._core._tasks<sp/></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>CancelScope,<sp/>create_task_group</highlight></codeline>
<codeline lineno="32"><highlight class="normal"></highlight><highlight class="keyword">from</highlight><highlight class="normal"><sp/>.abc._tasks<sp/></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>TaskStatus</highlight></codeline>
<codeline lineno="33"><highlight class="normal"></highlight><highlight class="keyword">from</highlight><highlight class="normal"><sp/>.lowlevel<sp/></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>EventLoopToken</highlight></codeline>
<codeline lineno="34"><highlight class="normal"></highlight></codeline>
<codeline lineno="35"><highlight class="normal"></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>sys.version_info<sp/>&gt;=<sp/>(3,<sp/>11):</highlight></codeline>
<codeline lineno="36"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">from</highlight><highlight class="normal"><sp/>typing<sp/></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>TypeVarTuple,<sp/>Unpack</highlight></codeline>
<codeline lineno="37"><highlight class="normal"></highlight><highlight class="keywordflow">else</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="38"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">from</highlight><highlight class="normal"><sp/>typing_extensions<sp/></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>TypeVarTuple,<sp/>Unpack</highlight></codeline>
<codeline lineno="39"><highlight class="normal"></highlight></codeline>
<codeline lineno="40" refid="namespaceanyio_1_1from__thread_1a43d2d243ce562b4cb8b1cb6de3210720" refkind="member"><highlight class="normal">T_Retval<sp/>=<sp/>TypeVar(</highlight><highlight class="stringliteral">&quot;T_Retval&quot;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="41" refid="namespaceanyio_1_1from__thread_1a8eb78d7a866e6acdd9111b5569deaf66" refkind="member"><highlight class="normal">T_co<sp/>=<sp/>TypeVar(</highlight><highlight class="stringliteral">&quot;T_co&quot;</highlight><highlight class="normal">,<sp/>covariant=</highlight><highlight class="keyword">True</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="42" refid="namespaceanyio_1_1from__thread_1aee5f472f2dec0abcf691e1c7485bf66e" refkind="member"><highlight class="normal">PosArgsT<sp/>=<sp/><ref refid="classtyping__extensions_1_1_type_var_tuple" kindref="compound">TypeVarTuple</ref>(</highlight><highlight class="stringliteral">&quot;PosArgsT&quot;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="43"><highlight class="normal"></highlight></codeline>
<codeline lineno="44"><highlight class="normal"></highlight></codeline>
<codeline lineno="45" refid="namespaceanyio_1_1from__thread_1a9c890666b4bd359216efd114a1671b74" refkind="member"><highlight class="normal"></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal"><ref refid="namespaceanyio_1_1from__thread_1a9c890666b4bd359216efd114a1671b74" kindref="member">_token_or_error</ref>(token:<sp/>EventLoopToken<sp/>|<sp/></highlight><highlight class="keywordtype">None</highlight><highlight class="normal">)<sp/>-&gt;<sp/>EventLoopToken:</highlight></codeline>
<codeline lineno="46"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>token<sp/></highlight><highlight class="keywordflow">is</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">not</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">None</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="47"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>token</highlight></codeline>
<codeline lineno="48"><highlight class="normal"></highlight></codeline>
<codeline lineno="49"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">try</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="50"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>threadlocals.current_token</highlight></codeline>
<codeline lineno="51"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">except</highlight><highlight class="normal"><sp/>AttributeError:</highlight></codeline>
<codeline lineno="52"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">raise</highlight><highlight class="normal"><sp/><ref refid="classanyio_1_1__core_1_1__exceptions_1_1_no_event_loop_error" kindref="compound">NoEventLoopError</ref>(</highlight></codeline>
<codeline lineno="53"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;Not<sp/>running<sp/>inside<sp/>an<sp/>AnyIO<sp/>worker<sp/>thread,<sp/>and<sp/>no<sp/>event<sp/>loop<sp/>token<sp/>was<sp/>&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="54"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;provided&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="55"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>)<sp/></highlight><highlight class="keyword">from</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">None</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="56"><highlight class="normal"></highlight></codeline>
<codeline lineno="57"><highlight class="normal"></highlight></codeline>
<codeline lineno="58" refid="namespaceanyio_1_1from__thread_1ac2911b6b1ebcefcb26196cc228110d6f" refkind="member"><highlight class="normal"></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal"><ref refid="namespaceanyio_1_1from__thread_1ac2911b6b1ebcefcb26196cc228110d6f" kindref="member">run</ref>(</highlight></codeline>
<codeline lineno="59"><highlight class="normal"><sp/><sp/><sp/><sp/>func:<sp/>Callable[[Unpack[PosArgsT]],<sp/>Awaitable[T_Retval]],</highlight></codeline>
<codeline lineno="60"><highlight class="normal"><sp/><sp/><sp/><sp/>*args:<sp/>Unpack[PosArgsT],</highlight></codeline>
<codeline lineno="61"><highlight class="normal"><sp/><sp/><sp/><sp/>token:<sp/>EventLoopToken<sp/>|<sp/></highlight><highlight class="keywordtype">None</highlight><highlight class="normal"><sp/>=<sp/></highlight><highlight class="keywordtype">None</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="62"><highlight class="normal">)<sp/>-&gt;<sp/>T_Retval:</highlight></codeline>
<codeline lineno="63"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;&quot;&quot;</highlight></codeline>
<codeline lineno="64"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>Call<sp/>a<sp/>coroutine<sp/>function<sp/>from<sp/>a<sp/>worker<sp/>thread.</highlight></codeline>
<codeline lineno="65"><highlight class="stringliteral"></highlight></codeline>
<codeline lineno="66"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>:param<sp/>func:<sp/>a<sp/>coroutine<sp/>function</highlight></codeline>
<codeline lineno="67"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>:param<sp/>args:<sp/>positional<sp/>arguments<sp/>for<sp/>the<sp/>callable</highlight></codeline>
<codeline lineno="68"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>:param<sp/>token:<sp/>an<sp/>event<sp/>loop<sp/>token<sp/>to<sp/>use<sp/>to<sp/>get<sp/>back<sp/>to<sp/>the<sp/>event<sp/>loop<sp/>thread</highlight></codeline>
<codeline lineno="69"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>(required<sp/>if<sp/>calling<sp/>this<sp/>function<sp/>from<sp/>outside<sp/>an<sp/>AnyIO<sp/>worker<sp/>thread)</highlight></codeline>
<codeline lineno="70"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>:return:<sp/>the<sp/>return<sp/>value<sp/>of<sp/>the<sp/>coroutine<sp/>function</highlight></codeline>
<codeline lineno="71"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>:raises<sp/>MissingTokenError:<sp/>if<sp/>no<sp/>token<sp/>was<sp/>provided<sp/>and<sp/>called<sp/>from<sp/>outside<sp/>an</highlight></codeline>
<codeline lineno="72"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>AnyIO<sp/>worker<sp/>thread</highlight></codeline>
<codeline lineno="73"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>:raises<sp/>RunFinishedError:<sp/>if<sp/>the<sp/>event<sp/>loop<sp/>tied<sp/>to<sp/>``token``<sp/>is<sp/>no<sp/>longer<sp/>running</highlight></codeline>
<codeline lineno="74"><highlight class="stringliteral"></highlight></codeline>
<codeline lineno="75"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>..<sp/>versionchanged::<sp/>4.11.0</highlight></codeline>
<codeline lineno="76"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>Added<sp/>the<sp/>``token``<sp/>parameter.</highlight></codeline>
<codeline lineno="77"><highlight class="stringliteral"></highlight></codeline>
<codeline lineno="78"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&quot;&quot;&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="79"><highlight class="normal"><sp/><sp/><sp/><sp/>explicit_token<sp/>=<sp/>token<sp/></highlight><highlight class="keywordflow">is</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">not</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">None</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="80"><highlight class="normal"><sp/><sp/><sp/><sp/>token<sp/>=<sp/><ref refid="namespaceanyio_1_1from__thread_1a9c890666b4bd359216efd114a1671b74" kindref="member">_token_or_error</ref>(token)</highlight></codeline>
<codeline lineno="81"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>token.backend_class.run_async_from_thread(</highlight></codeline>
<codeline lineno="82"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>func,<sp/>args,<sp/>token=token.native_token<sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>explicit_token<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">None</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="83"><highlight class="normal"><sp/><sp/><sp/><sp/>)</highlight></codeline>
<codeline lineno="84"><highlight class="normal"></highlight></codeline>
<codeline lineno="85"><highlight class="normal"></highlight></codeline>
<codeline lineno="86" refid="namespaceanyio_1_1from__thread_1aed9eb910caec4d85842b37736d2faebc" refkind="member"><highlight class="normal"></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal"><ref refid="namespaceanyio_1_1from__thread_1aed9eb910caec4d85842b37736d2faebc" kindref="member">run_sync</ref>(</highlight></codeline>
<codeline lineno="87"><highlight class="normal"><sp/><sp/><sp/><sp/>func:<sp/>Callable[[Unpack[PosArgsT]],<sp/>T_Retval],</highlight></codeline>
<codeline lineno="88"><highlight class="normal"><sp/><sp/><sp/><sp/>*args:<sp/>Unpack[PosArgsT],</highlight></codeline>
<codeline lineno="89"><highlight class="normal"><sp/><sp/><sp/><sp/>token:<sp/>EventLoopToken<sp/>|<sp/></highlight><highlight class="keywordtype">None</highlight><highlight class="normal"><sp/>=<sp/></highlight><highlight class="keywordtype">None</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="90"><highlight class="normal">)<sp/>-&gt;<sp/>T_Retval:</highlight></codeline>
<codeline lineno="91"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;&quot;&quot;</highlight></codeline>
<codeline lineno="92"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>Call<sp/>a<sp/>function<sp/>in<sp/>the<sp/>event<sp/>loop<sp/>thread<sp/>from<sp/>a<sp/>worker<sp/>thread.</highlight></codeline>
<codeline lineno="93"><highlight class="stringliteral"></highlight></codeline>
<codeline lineno="94"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>:param<sp/>func:<sp/>a<sp/>callable</highlight></codeline>
<codeline lineno="95"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>:param<sp/>args:<sp/>positional<sp/>arguments<sp/>for<sp/>the<sp/>callable</highlight></codeline>
<codeline lineno="96"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>:param<sp/>token:<sp/>an<sp/>event<sp/>loop<sp/>token<sp/>to<sp/>use<sp/>to<sp/>get<sp/>back<sp/>to<sp/>the<sp/>event<sp/>loop<sp/>thread</highlight></codeline>
<codeline lineno="97"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>(required<sp/>if<sp/>calling<sp/>this<sp/>function<sp/>from<sp/>outside<sp/>an<sp/>AnyIO<sp/>worker<sp/>thread)</highlight></codeline>
<codeline lineno="98"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>:return:<sp/>the<sp/>return<sp/>value<sp/>of<sp/>the<sp/>callable</highlight></codeline>
<codeline lineno="99"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>:raises<sp/>MissingTokenError:<sp/>if<sp/>no<sp/>token<sp/>was<sp/>provided<sp/>and<sp/>called<sp/>from<sp/>outside<sp/>an</highlight></codeline>
<codeline lineno="100"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>AnyIO<sp/>worker<sp/>thread</highlight></codeline>
<codeline lineno="101"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>:raises<sp/>RunFinishedError:<sp/>if<sp/>the<sp/>event<sp/>loop<sp/>tied<sp/>to<sp/>``token``<sp/>is<sp/>no<sp/>longer<sp/>running</highlight></codeline>
<codeline lineno="102"><highlight class="stringliteral"></highlight></codeline>
<codeline lineno="103"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>..<sp/>versionchanged::<sp/>4.11.0</highlight></codeline>
<codeline lineno="104"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>Added<sp/>the<sp/>``token``<sp/>parameter.</highlight></codeline>
<codeline lineno="105"><highlight class="stringliteral"></highlight></codeline>
<codeline lineno="106"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&quot;&quot;&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="107"><highlight class="normal"><sp/><sp/><sp/><sp/>explicit_token<sp/>=<sp/>token<sp/></highlight><highlight class="keywordflow">is</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">not</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">None</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="108"><highlight class="normal"><sp/><sp/><sp/><sp/>token<sp/>=<sp/><ref refid="namespaceanyio_1_1from__thread_1a9c890666b4bd359216efd114a1671b74" kindref="member">_token_or_error</ref>(token)</highlight></codeline>
<codeline lineno="109"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>token.backend_class.run_sync_from_thread(</highlight></codeline>
<codeline lineno="110"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>func,<sp/>args,<sp/>token=token.native_token<sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>explicit_token<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">None</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="111"><highlight class="normal"><sp/><sp/><sp/><sp/>)</highlight></codeline>
<codeline lineno="112"><highlight class="normal"></highlight></codeline>
<codeline lineno="113"><highlight class="normal"></highlight></codeline>
<codeline lineno="114" refid="classanyio_1_1from__thread_1_1___blocking_async_context_manager" refkind="compound"><highlight class="normal"></highlight><highlight class="keyword">class<sp/></highlight><highlight class="normal"><ref refid="classanyio_1_1from__thread_1_1___blocking_async_context_manager" kindref="compound">_BlockingAsyncContextManager</ref>(Generic[T_co],<sp/>AbstractContextManager):</highlight></codeline>
<codeline lineno="115" refid="classanyio_1_1from__thread_1_1___blocking_async_context_manager_1aeecc3b7bc1e9007bbcab887f45f7649a" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/>_enter_future:<sp/>Future[T_co]</highlight></codeline>
<codeline lineno="116" refid="classanyio_1_1from__thread_1_1___blocking_async_context_manager_1af2f5b74861bc4d34e06369fbddc827c4" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/>_exit_future:<sp/>Future[bool<sp/>|<sp/></highlight><highlight class="keywordtype">None</highlight><highlight class="normal">]</highlight></codeline>
<codeline lineno="117"><highlight class="normal"><sp/><sp/><sp/><sp/>_exit_event:<sp/>Event</highlight></codeline>
<codeline lineno="118" refid="classanyio_1_1from__thread_1_1___blocking_async_context_manager_1a9b1f4cb5e796087aa486f09c8ad4eb37" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/>_exit_exc_info:<sp/>tuple[</highlight></codeline>
<codeline lineno="119"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>type[BaseException]<sp/>|<sp/></highlight><highlight class="keywordtype">None</highlight><highlight class="normal">,<sp/>BaseException<sp/>|<sp/></highlight><highlight class="keywordtype">None</highlight><highlight class="normal">,<sp/>TracebackType<sp/>|<sp/></highlight><highlight class="keywordtype">None</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="120"><highlight class="normal"><sp/><sp/><sp/><sp/>]<sp/>=<sp/>(</highlight><highlight class="keywordtype">None</highlight><highlight class="normal">,<sp/></highlight><highlight class="keywordtype">None</highlight><highlight class="normal">,<sp/></highlight><highlight class="keywordtype">None</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="121"><highlight class="normal"></highlight></codeline>
<codeline lineno="122"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal">__init__(</highlight></codeline>
<codeline lineno="123"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self,<sp/>async_cm:<sp/>AbstractAsyncContextManager[T_co],<sp/>portal:<sp/>BlockingPortal</highlight></codeline>
<codeline lineno="124"><highlight class="normal"><sp/><sp/><sp/><sp/>):</highlight></codeline>
<codeline lineno="125" refid="classanyio_1_1from__thread_1_1___blocking_async_context_manager_1a6d00a394faf779edfd2af94b97a58bc6" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.<ref refid="classanyio_1_1from__thread_1_1___blocking_async_context_manager_1a6d00a394faf779edfd2af94b97a58bc6" kindref="member">_async_cm</ref><sp/>=<sp/>async_cm</highlight></codeline>
<codeline lineno="126" refid="classanyio_1_1from__thread_1_1___blocking_async_context_manager_1ad05ebdd6a032e986b845748ca576c3a9" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.<ref refid="classanyio_1_1from__thread_1_1___blocking_async_context_manager_1ad05ebdd6a032e986b845748ca576c3a9" kindref="member">_portal</ref><sp/>=<sp/>portal</highlight></codeline>
<codeline lineno="127"><highlight class="normal"></highlight></codeline>
<codeline lineno="128" refid="classanyio_1_1from__thread_1_1___blocking_async_context_manager_1a5de86d1792f3444fef39d464c3ea3afe" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">async<sp/>def<sp/></highlight><highlight class="normal"><ref refid="classanyio_1_1from__thread_1_1___blocking_async_context_manager_1a5de86d1792f3444fef39d464c3ea3afe" kindref="member">run_async_cm</ref>(self)<sp/>-&gt;<sp/>bool<sp/>|<sp/>None:</highlight></codeline>
<codeline lineno="129"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">try</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="130" refid="classanyio_1_1from__thread_1_1___blocking_async_context_manager_1a194da01cf47b820f13580c1464a409e8" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.<ref refid="classanyio_1_1from__thread_1_1___blocking_async_context_manager_1a194da01cf47b820f13580c1464a409e8" kindref="member">_exit_event</ref><sp/>=<sp/><ref refid="classanyio_1_1__core_1_1__synchronization_1_1_event" kindref="compound">Event</ref>()</highlight></codeline>
<codeline lineno="131"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>value<sp/>=<sp/>await<sp/>self.<ref refid="classanyio_1_1from__thread_1_1___blocking_async_context_manager_1a6d00a394faf779edfd2af94b97a58bc6" kindref="member">_async_cm</ref>.__aenter__()</highlight></codeline>
<codeline lineno="132"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">except</highlight><highlight class="normal"><sp/>BaseException<sp/></highlight><highlight class="keyword">as</highlight><highlight class="normal"><sp/>exc:</highlight></codeline>
<codeline lineno="133"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.<ref refid="classanyio_1_1from__thread_1_1___blocking_async_context_manager_1aeecc3b7bc1e9007bbcab887f45f7649a" kindref="member">_enter_future</ref>.set_exception(exc)</highlight></codeline>
<codeline lineno="134"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">raise</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="135"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="136"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.<ref refid="classanyio_1_1from__thread_1_1___blocking_async_context_manager_1aeecc3b7bc1e9007bbcab887f45f7649a" kindref="member">_enter_future</ref>.set_result(value)</highlight></codeline>
<codeline lineno="137"><highlight class="normal"></highlight></codeline>
<codeline lineno="138"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">try</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="139"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>Wait<sp/>for<sp/>the<sp/>sync<sp/>context<sp/>manager<sp/>to<sp/>exit.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="140"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>This<sp/>next<sp/>statement<sp/>can<sp/>raise<sp/>`get_cancelled_exc_class()`<sp/>if</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="141"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>something<sp/>went<sp/>wrong<sp/>in<sp/>a<sp/>task<sp/>group<sp/>in<sp/>this<sp/>async<sp/>context</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="142"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>manager.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="143"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>await<sp/>self.<ref refid="classanyio_1_1from__thread_1_1___blocking_async_context_manager_1a194da01cf47b820f13580c1464a409e8" kindref="member">_exit_event</ref>.wait()</highlight></codeline>
<codeline lineno="144"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">finally</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="145"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>In<sp/>case<sp/>of<sp/>cancellation,<sp/>it<sp/>could<sp/>be<sp/>that<sp/>we<sp/>end<sp/>up<sp/>here<sp/>before</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="146"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>`_BlockingAsyncContextManager.__exit__`<sp/>is<sp/>called,<sp/>and<sp/>an</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="147"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>`_exit_exc_info`<sp/>has<sp/>been<sp/>set.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="148"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>result<sp/>=<sp/>await<sp/>self.<ref refid="classanyio_1_1from__thread_1_1___blocking_async_context_manager_1a6d00a394faf779edfd2af94b97a58bc6" kindref="member">_async_cm</ref>.__aexit__(*self.<ref refid="classanyio_1_1from__thread_1_1___blocking_async_context_manager_1a9b1f4cb5e796087aa486f09c8ad4eb37" kindref="member">_exit_exc_info</ref>)</highlight></codeline>
<codeline lineno="149"><highlight class="normal"></highlight></codeline>
<codeline lineno="150"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>result</highlight></codeline>
<codeline lineno="151"><highlight class="normal"></highlight></codeline>
<codeline lineno="152"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal">__enter__(self)<sp/>-&gt;<sp/>T_co:</highlight></codeline>
<codeline lineno="153"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.<ref refid="classanyio_1_1from__thread_1_1___blocking_async_context_manager_1aeecc3b7bc1e9007bbcab887f45f7649a" kindref="member">_enter_future</ref><sp/>=<sp/>Future()</highlight></codeline>
<codeline lineno="154"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.<ref refid="classanyio_1_1from__thread_1_1___blocking_async_context_manager_1af2f5b74861bc4d34e06369fbddc827c4" kindref="member">_exit_future</ref><sp/>=<sp/>self.<ref refid="classanyio_1_1from__thread_1_1___blocking_async_context_manager_1ad05ebdd6a032e986b845748ca576c3a9" kindref="member">_portal</ref>.start_task_soon(self.<ref refid="classanyio_1_1from__thread_1_1___blocking_async_context_manager_1a5de86d1792f3444fef39d464c3ea3afe" kindref="member">run_async_cm</ref>)</highlight></codeline>
<codeline lineno="155"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>self.<ref refid="classanyio_1_1from__thread_1_1___blocking_async_context_manager_1aeecc3b7bc1e9007bbcab887f45f7649a" kindref="member">_enter_future</ref>.result()</highlight></codeline>
<codeline lineno="156"><highlight class="normal"></highlight></codeline>
<codeline lineno="157"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal">__exit__(</highlight></codeline>
<codeline lineno="158"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self,</highlight></codeline>
<codeline lineno="159"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>__exc_type:<sp/>type[BaseException]<sp/>|<sp/></highlight><highlight class="keywordtype">None</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="160"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>__exc_value:<sp/>BaseException<sp/>|<sp/></highlight><highlight class="keywordtype">None</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="161"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>__traceback:<sp/>TracebackType<sp/>|<sp/></highlight><highlight class="keywordtype">None</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="162"><highlight class="normal"><sp/><sp/><sp/><sp/>)<sp/>-&gt;<sp/>bool<sp/>|<sp/></highlight><highlight class="keywordtype">None</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="163"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.<ref refid="classanyio_1_1from__thread_1_1___blocking_async_context_manager_1a9b1f4cb5e796087aa486f09c8ad4eb37" kindref="member">_exit_exc_info</ref><sp/>=<sp/>__exc_type,<sp/>__exc_value,<sp/>__traceback</highlight></codeline>
<codeline lineno="164"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.<ref refid="classanyio_1_1from__thread_1_1___blocking_async_context_manager_1ad05ebdd6a032e986b845748ca576c3a9" kindref="member">_portal</ref>.call(self.<ref refid="classanyio_1_1from__thread_1_1___blocking_async_context_manager_1a194da01cf47b820f13580c1464a409e8" kindref="member">_exit_event</ref>.set)</highlight></codeline>
<codeline lineno="165"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>self.<ref refid="classanyio_1_1from__thread_1_1___blocking_async_context_manager_1af2f5b74861bc4d34e06369fbddc827c4" kindref="member">_exit_future</ref>.result()</highlight></codeline>
<codeline lineno="166"><highlight class="normal"></highlight></codeline>
<codeline lineno="167"><highlight class="normal"></highlight></codeline>
<codeline lineno="168" refid="classanyio_1_1from__thread_1_1___blocking_portal_task_status" refkind="compound"><highlight class="normal"></highlight><highlight class="keyword">class<sp/></highlight><highlight class="normal"><ref refid="classanyio_1_1from__thread_1_1___blocking_portal_task_status" kindref="compound">_BlockingPortalTaskStatus</ref>(<ref refid="classanyio_1_1abc_1_1__tasks_1_1_task_status" kindref="compound">TaskStatus</ref>):</highlight></codeline>
<codeline lineno="169"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal">__init__(self,<sp/>future:<sp/>Future):</highlight></codeline>
<codeline lineno="170" refid="classanyio_1_1from__thread_1_1___blocking_portal_task_status_1a80bad0242c008312cbf69d28efe7f6ab" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.<ref refid="classanyio_1_1from__thread_1_1___blocking_portal_task_status_1a80bad0242c008312cbf69d28efe7f6ab" kindref="member">_future</ref><sp/>=<sp/>future</highlight></codeline>
<codeline lineno="171"><highlight class="normal"></highlight></codeline>
<codeline lineno="172" refid="classanyio_1_1from__thread_1_1___blocking_portal_task_status_1aa32bd71d08ef5f1f091b0d6ecc620f81" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal"><ref refid="classanyio_1_1from__thread_1_1___blocking_portal_task_status_1aa32bd71d08ef5f1f091b0d6ecc620f81" kindref="member">started</ref>(self,<sp/>value:<sp/>object<sp/>=<sp/></highlight><highlight class="keywordtype">None</highlight><highlight class="normal">)<sp/>-&gt;<sp/></highlight><highlight class="keywordtype">None</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="173"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.<ref refid="classanyio_1_1from__thread_1_1___blocking_portal_task_status_1a80bad0242c008312cbf69d28efe7f6ab" kindref="member">_future</ref>.set_result(value)</highlight></codeline>
<codeline lineno="174"><highlight class="normal"></highlight></codeline>
<codeline lineno="175"><highlight class="normal"></highlight></codeline>
<codeline lineno="176" refid="classanyio_1_1from__thread_1_1_blocking_portal" refkind="compound"><highlight class="normal"></highlight><highlight class="keyword">class<sp/></highlight><highlight class="normal"><ref refid="classanyio_1_1from__thread_1_1_blocking_portal" kindref="compound">BlockingPortal</ref>:</highlight></codeline>
<codeline lineno="177"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;&quot;&quot;An<sp/>object<sp/>that<sp/>lets<sp/>external<sp/>threads<sp/>run<sp/>code<sp/>in<sp/>an<sp/>asynchronous<sp/>event<sp/>loop.&quot;&quot;&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="178"><highlight class="normal"></highlight></codeline>
<codeline lineno="179"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal">__new__(cls)<sp/>-&gt;<sp/>BlockingPortal:</highlight></codeline>
<codeline lineno="180"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>get_async_backend().create_blocking_portal()</highlight></codeline>
<codeline lineno="181"><highlight class="normal"></highlight></codeline>
<codeline lineno="182"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal">__init__(self)<sp/>-&gt;<sp/>None:</highlight></codeline>
<codeline lineno="183" refid="classanyio_1_1from__thread_1_1_blocking_portal_1a1920613b4be1d8fc3f954c75032b53d3" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.<ref refid="classanyio_1_1from__thread_1_1_blocking_portal_1a1920613b4be1d8fc3f954c75032b53d3" kindref="member">_event_loop_thread_id</ref>:<sp/>int<sp/>|<sp/></highlight><highlight class="keywordtype">None</highlight><highlight class="normal"><sp/>=<sp/>get_ident()</highlight></codeline>
<codeline lineno="184" refid="classanyio_1_1from__thread_1_1_blocking_portal_1a8a4b5805bd0bc26b053274fd21634cc7" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.<ref refid="classanyio_1_1from__thread_1_1_blocking_portal_1a8a4b5805bd0bc26b053274fd21634cc7" kindref="member">_stop_event</ref><sp/>=<sp/><ref refid="classanyio_1_1__core_1_1__synchronization_1_1_event" kindref="compound">Event</ref>()</highlight></codeline>
<codeline lineno="185" refid="classanyio_1_1from__thread_1_1_blocking_portal_1a8758409756ad99bd7fa7f0d3169e610c" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.<ref refid="classanyio_1_1from__thread_1_1_blocking_portal_1a8758409756ad99bd7fa7f0d3169e610c" kindref="member">_task_group</ref><sp/>=<sp/>create_task_group()</highlight></codeline>
<codeline lineno="186" refid="classanyio_1_1from__thread_1_1_blocking_portal_1a414a31ecbc6a48c6e010f7b7ccd1265c" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.<ref refid="classanyio_1_1from__thread_1_1_blocking_portal_1a414a31ecbc6a48c6e010f7b7ccd1265c" kindref="member">_cancelled_exc_class</ref><sp/>=<sp/>get_cancelled_exc_class()</highlight></codeline>
<codeline lineno="187"><highlight class="normal"></highlight></codeline>
<codeline lineno="188"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">async<sp/>def<sp/></highlight><highlight class="normal">__aenter__(self)<sp/>-&gt;<sp/>BlockingPortal:</highlight></codeline>
<codeline lineno="189"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>await<sp/>self.<ref refid="classanyio_1_1from__thread_1_1_blocking_portal_1a8758409756ad99bd7fa7f0d3169e610c" kindref="member">_task_group</ref>.__aenter__()</highlight></codeline>
<codeline lineno="190"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>self</highlight></codeline>
<codeline lineno="191"><highlight class="normal"></highlight></codeline>
<codeline lineno="192"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">async<sp/>def<sp/></highlight><highlight class="normal">__aexit__(</highlight></codeline>
<codeline lineno="193"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self,</highlight></codeline>
<codeline lineno="194"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>exc_type:<sp/>type[BaseException]<sp/>|<sp/></highlight><highlight class="keywordtype">None</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="195"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>exc_val:<sp/>BaseException<sp/>|<sp/></highlight><highlight class="keywordtype">None</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="196"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>exc_tb:<sp/>TracebackType<sp/>|<sp/></highlight><highlight class="keywordtype">None</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="197"><highlight class="normal"><sp/><sp/><sp/><sp/>)<sp/>-&gt;<sp/>bool:</highlight></codeline>
<codeline lineno="198"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>await<sp/>self.<ref refid="classanyio_1_1from__thread_1_1_blocking_portal_1ab2f07e3ab376dae2041b4cd241400264" kindref="member">stop</ref>()</highlight></codeline>
<codeline lineno="199"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>await<sp/>self.<ref refid="classanyio_1_1from__thread_1_1_blocking_portal_1a8758409756ad99bd7fa7f0d3169e610c" kindref="member">_task_group</ref>.__aexit__(exc_type,<sp/>exc_val,<sp/>exc_tb)</highlight></codeline>
<codeline lineno="200"><highlight class="normal"></highlight></codeline>
<codeline lineno="201" refid="classanyio_1_1from__thread_1_1_blocking_portal_1a1c7e2c8b207f3fa28b8b7dfd3b1fd520" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal"><ref refid="classanyio_1_1from__thread_1_1_blocking_portal_1a1c7e2c8b207f3fa28b8b7dfd3b1fd520" kindref="member">_check_running</ref>(self)<sp/>-&gt;<sp/>None:</highlight></codeline>
<codeline lineno="202"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>self.<ref refid="classanyio_1_1from__thread_1_1_blocking_portal_1a1920613b4be1d8fc3f954c75032b53d3" kindref="member">_event_loop_thread_id</ref><sp/></highlight><highlight class="keywordflow">is</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">None</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="203"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">raise</highlight><highlight class="normal"><sp/>RuntimeError(</highlight><highlight class="stringliteral">&quot;This<sp/>portal<sp/>is<sp/>not<sp/>running&quot;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="204"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>self.<ref refid="classanyio_1_1from__thread_1_1_blocking_portal_1a1920613b4be1d8fc3f954c75032b53d3" kindref="member">_event_loop_thread_id</ref><sp/>==<sp/>get_ident():</highlight></codeline>
<codeline lineno="205"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">raise</highlight><highlight class="normal"><sp/>RuntimeError(</highlight></codeline>
<codeline lineno="206"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;This<sp/>method<sp/>cannot<sp/>be<sp/>called<sp/>from<sp/>the<sp/>event<sp/>loop<sp/>thread&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="207"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>)</highlight></codeline>
<codeline lineno="208"><highlight class="normal"></highlight></codeline>
<codeline lineno="209" refid="classanyio_1_1from__thread_1_1_blocking_portal_1a6ec764d02fa3a54e7004cb978ed5f5d6" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">async<sp/>def<sp/></highlight><highlight class="normal"><ref refid="classanyio_1_1from__thread_1_1_blocking_portal_1a6ec764d02fa3a54e7004cb978ed5f5d6" kindref="member">sleep_until_stopped</ref>(self)<sp/>-&gt;<sp/>None:</highlight></codeline>
<codeline lineno="210"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;&quot;&quot;Sleep<sp/>until<sp/>:meth:`stop`<sp/>is<sp/>called.&quot;&quot;&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="211"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>await<sp/>self.<ref refid="classanyio_1_1from__thread_1_1_blocking_portal_1a8a4b5805bd0bc26b053274fd21634cc7" kindref="member">_stop_event</ref>.wait()</highlight></codeline>
<codeline lineno="212"><highlight class="normal"></highlight></codeline>
<codeline lineno="213" refid="classanyio_1_1from__thread_1_1_blocking_portal_1ab2f07e3ab376dae2041b4cd241400264" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">async<sp/>def<sp/></highlight><highlight class="normal"><ref refid="classanyio_1_1from__thread_1_1_blocking_portal_1ab2f07e3ab376dae2041b4cd241400264" kindref="member">stop</ref>(self,<sp/>cancel_remaining:<sp/>bool<sp/>=<sp/></highlight><highlight class="keyword">False</highlight><highlight class="normal">)<sp/>-&gt;<sp/></highlight><highlight class="keywordtype">None</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="214"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;&quot;&quot;</highlight></codeline>
<codeline lineno="215"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>Signal<sp/>the<sp/>portal<sp/>to<sp/>shut<sp/>down.</highlight></codeline>
<codeline lineno="216"><highlight class="stringliteral"></highlight></codeline>
<codeline lineno="217"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>This<sp/>marks<sp/>the<sp/>portal<sp/>as<sp/>no<sp/>longer<sp/>accepting<sp/>new<sp/>calls<sp/>and<sp/>exits<sp/>from</highlight></codeline>
<codeline lineno="218"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>:meth:`sleep_until_stopped`.</highlight></codeline>
<codeline lineno="219"><highlight class="stringliteral"></highlight></codeline>
<codeline lineno="220"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>:param<sp/>cancel_remaining:<sp/>``True``<sp/>to<sp/>cancel<sp/>all<sp/>the<sp/>remaining<sp/>tasks,<sp/>``False``</highlight></codeline>
<codeline lineno="221"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>to<sp/>let<sp/>them<sp/>finish<sp/>before<sp/>returning</highlight></codeline>
<codeline lineno="222"><highlight class="stringliteral"></highlight></codeline>
<codeline lineno="223"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&quot;&quot;&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="224"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.<ref refid="classanyio_1_1from__thread_1_1_blocking_portal_1a1920613b4be1d8fc3f954c75032b53d3" kindref="member">_event_loop_thread_id</ref><sp/>=<sp/></highlight><highlight class="keywordtype">None</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="225"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.<ref refid="classanyio_1_1from__thread_1_1_blocking_portal_1a8a4b5805bd0bc26b053274fd21634cc7" kindref="member">_stop_event</ref>.set()</highlight></codeline>
<codeline lineno="226"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>cancel_remaining:</highlight></codeline>
<codeline lineno="227"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.<ref refid="classanyio_1_1from__thread_1_1_blocking_portal_1a8758409756ad99bd7fa7f0d3169e610c" kindref="member">_task_group</ref>.cancel_scope.cancel(</highlight><highlight class="stringliteral">&quot;the<sp/>blocking<sp/>portal<sp/>is<sp/>shutting<sp/>down&quot;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="228"><highlight class="normal"></highlight></codeline>
<codeline lineno="229" refid="classanyio_1_1from__thread_1_1_blocking_portal_1a48536f0d82727c3ae792cac8b89d8830" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">async<sp/>def<sp/></highlight><highlight class="normal"><ref refid="classanyio_1_1from__thread_1_1_blocking_portal_1a48536f0d82727c3ae792cac8b89d8830" kindref="member">_call_func</ref>(</highlight></codeline>
<codeline lineno="230"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self,</highlight></codeline>
<codeline lineno="231"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>func:<sp/>Callable[[Unpack[PosArgsT]],<sp/>Awaitable[T_Retval]<sp/>|<sp/>T_Retval],</highlight></codeline>
<codeline lineno="232"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>args:<sp/>tuple[Unpack[PosArgsT]],</highlight></codeline>
<codeline lineno="233"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>kwargs:<sp/>dict[str,<sp/>Any],</highlight></codeline>
<codeline lineno="234"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>future:<sp/>Future[T_Retval],</highlight></codeline>
<codeline lineno="235"><highlight class="normal"><sp/><sp/><sp/><sp/>)<sp/>-&gt;<sp/></highlight><highlight class="keywordtype">None</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="236"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal">callback(f:<sp/>Future[T_Retval])<sp/>-&gt;<sp/></highlight><highlight class="keywordtype">None</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="237"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>f.cancelled()<sp/></highlight><highlight class="keywordflow">and</highlight><highlight class="normal"><sp/>self.<ref refid="classanyio_1_1from__thread_1_1_blocking_portal_1a1920613b4be1d8fc3f954c75032b53d3" kindref="member">_event_loop_thread_id</ref><sp/></highlight><highlight class="keywordflow">not</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">in</highlight><highlight class="normal"><sp/>(</highlight></codeline>
<codeline lineno="238"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">None</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="239"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>get_ident(),</highlight></codeline>
<codeline lineno="240"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>):</highlight></codeline>
<codeline lineno="241"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.<ref refid="classanyio_1_1from__thread_1_1_blocking_portal_1a31fb27be539cd591acfd98489688b57d" kindref="member">call</ref>(scope.cancel,<sp/></highlight><highlight class="stringliteral">&quot;the<sp/>future<sp/>was<sp/>cancelled&quot;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="242"><highlight class="normal"></highlight></codeline>
<codeline lineno="243"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">try</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="244"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>retval_or_awaitable<sp/>=<sp/>func(*args,<sp/>**kwargs)</highlight></codeline>
<codeline lineno="245"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>isawaitable(retval_or_awaitable):</highlight></codeline>
<codeline lineno="246"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">with</highlight><highlight class="normal"><sp/><ref refid="classanyio_1_1__core_1_1__tasks_1_1_cancel_scope" kindref="compound">CancelScope</ref>()<sp/></highlight><highlight class="keyword">as</highlight><highlight class="normal"><sp/>scope:</highlight></codeline>
<codeline lineno="247"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>future.cancelled():</highlight></codeline>
<codeline lineno="248"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>scope.cancel(</highlight><highlight class="stringliteral">&quot;the<sp/>future<sp/>was<sp/>cancelled&quot;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="249"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="250"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>future.add_done_callback(callback)</highlight></codeline>
<codeline lineno="251"><highlight class="normal"></highlight></codeline>
<codeline lineno="252"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>retval<sp/>=<sp/>await<sp/>retval_or_awaitable</highlight></codeline>
<codeline lineno="253"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="254"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>retval<sp/>=<sp/>retval_or_awaitable</highlight></codeline>
<codeline lineno="255"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">except</highlight><highlight class="normal"><sp/>self.<ref refid="classanyio_1_1from__thread_1_1_blocking_portal_1a414a31ecbc6a48c6e010f7b7ccd1265c" kindref="member">_cancelled_exc_class</ref>:</highlight></codeline>
<codeline lineno="256"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>future.cancel()</highlight></codeline>
<codeline lineno="257"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>future.set_running_or_notify_cancel()</highlight></codeline>
<codeline lineno="258"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">except</highlight><highlight class="normal"><sp/>BaseException<sp/></highlight><highlight class="keyword">as</highlight><highlight class="normal"><sp/>exc:</highlight></codeline>
<codeline lineno="259"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">not</highlight><highlight class="normal"><sp/>future.cancelled():</highlight></codeline>
<codeline lineno="260"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>future.set_exception(exc)</highlight></codeline>
<codeline lineno="261"><highlight class="normal"></highlight></codeline>
<codeline lineno="262"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>Let<sp/>base<sp/>exceptions<sp/>fall<sp/>through</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="263"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">not</highlight><highlight class="normal"><sp/>isinstance(exc,<sp/>Exception):</highlight></codeline>
<codeline lineno="264"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">raise</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="265"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="266"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">not</highlight><highlight class="normal"><sp/>future.cancelled():</highlight></codeline>
<codeline lineno="267"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>future.set_result(retval)</highlight></codeline>
<codeline lineno="268"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">finally</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="269"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>scope<sp/>=<sp/></highlight><highlight class="keywordtype">None</highlight><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">#<sp/>type:<sp/>ignore[assignment]</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="270"><highlight class="normal"></highlight></codeline>
<codeline lineno="271" refid="classanyio_1_1from__thread_1_1_blocking_portal_1a7450c66adeb71f733f69e14af497d7da" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal"><ref refid="classanyio_1_1from__thread_1_1_blocking_portal_1a7450c66adeb71f733f69e14af497d7da" kindref="member">_spawn_task_from_thread</ref>(</highlight></codeline>
<codeline lineno="272"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self,</highlight></codeline>
<codeline lineno="273"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>func:<sp/>Callable[[Unpack[PosArgsT]],<sp/>Awaitable[T_Retval]<sp/>|<sp/>T_Retval],</highlight></codeline>
<codeline lineno="274"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>args:<sp/>tuple[Unpack[PosArgsT]],</highlight></codeline>
<codeline lineno="275"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>kwargs:<sp/>dict[str,<sp/>Any],</highlight></codeline>
<codeline lineno="276"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>name:<sp/>object,</highlight></codeline>
<codeline lineno="277"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>future:<sp/>Future[T_Retval],</highlight></codeline>
<codeline lineno="278"><highlight class="normal"><sp/><sp/><sp/><sp/>)<sp/>-&gt;<sp/></highlight><highlight class="keywordtype">None</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="279"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;&quot;&quot;</highlight></codeline>
<codeline lineno="280"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>Spawn<sp/>a<sp/>new<sp/>task<sp/>using<sp/>the<sp/>given<sp/>callable.</highlight></codeline>
<codeline lineno="281"><highlight class="stringliteral"></highlight></codeline>
<codeline lineno="282"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>Implementers<sp/>must<sp/>ensure<sp/>that<sp/>the<sp/>future<sp/>is<sp/>resolved<sp/>when<sp/>the<sp/>task<sp/>finishes.</highlight></codeline>
<codeline lineno="283"><highlight class="stringliteral"></highlight></codeline>
<codeline lineno="284"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>:param<sp/>func:<sp/>a<sp/>callable</highlight></codeline>
<codeline lineno="285"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>:param<sp/>args:<sp/>positional<sp/>arguments<sp/>to<sp/>be<sp/>passed<sp/>to<sp/>the<sp/>callable</highlight></codeline>
<codeline lineno="286"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>:param<sp/>kwargs:<sp/>keyword<sp/>arguments<sp/>to<sp/>be<sp/>passed<sp/>to<sp/>the<sp/>callable</highlight></codeline>
<codeline lineno="287"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>:param<sp/>name:<sp/>name<sp/>of<sp/>the<sp/>task<sp/>(will<sp/>be<sp/>coerced<sp/>to<sp/>a<sp/>string<sp/>if<sp/>not<sp/>``None``)</highlight></codeline>
<codeline lineno="288"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>:param<sp/>future:<sp/>a<sp/>future<sp/>that<sp/>will<sp/>resolve<sp/>to<sp/>the<sp/>return<sp/>value<sp/>of<sp/>the<sp/>callable,</highlight></codeline>
<codeline lineno="289"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>or<sp/>the<sp/>exception<sp/>raised<sp/>during<sp/>its<sp/>execution</highlight></codeline>
<codeline lineno="290"><highlight class="stringliteral"></highlight></codeline>
<codeline lineno="291"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&quot;&quot;&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="292"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">raise</highlight><highlight class="normal"><sp/>NotImplementedError</highlight></codeline>
<codeline lineno="293"><highlight class="normal"></highlight></codeline>
<codeline lineno="294"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="preprocessor">@overload</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="295" refid="classanyio_1_1from__thread_1_1_blocking_portal_1a31fb27be539cd591acfd98489688b57d" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal"><ref refid="classanyio_1_1from__thread_1_1_blocking_portal_1a31fb27be539cd591acfd98489688b57d" kindref="member">call</ref>(</highlight></codeline>
<codeline lineno="296"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self,</highlight></codeline>
<codeline lineno="297"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>func:<sp/>Callable[[Unpack[PosArgsT]],<sp/>Awaitable[T_Retval]],</highlight></codeline>
<codeline lineno="298"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*args:<sp/>Unpack[PosArgsT],</highlight></codeline>
<codeline lineno="299"><highlight class="normal"><sp/><sp/><sp/><sp/>)<sp/>-&gt;<sp/>T_Retval:<sp/>...</highlight></codeline>
<codeline lineno="300"><highlight class="normal"></highlight></codeline>
<codeline lineno="301"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="preprocessor">@overload</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="302" refid="classanyio_1_1from__thread_1_1_blocking_portal_1aed887c15fa529e4652f71f08963d7d66" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal"><ref refid="classanyio_1_1from__thread_1_1_blocking_portal_1a31fb27be539cd591acfd98489688b57d" kindref="member">call</ref>(</highlight></codeline>
<codeline lineno="303"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self,<sp/>func:<sp/>Callable[[Unpack[PosArgsT]],<sp/>T_Retval],<sp/>*args:<sp/>Unpack[PosArgsT]</highlight></codeline>
<codeline lineno="304"><highlight class="normal"><sp/><sp/><sp/><sp/>)<sp/>-&gt;<sp/>T_Retval:<sp/>...</highlight></codeline>
<codeline lineno="305"><highlight class="normal"></highlight></codeline>
<codeline lineno="306" refid="classanyio_1_1from__thread_1_1_blocking_portal_1acb3d9d2f58f13d8788ddd0cc0d533062" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal"><ref refid="classanyio_1_1from__thread_1_1_blocking_portal_1a31fb27be539cd591acfd98489688b57d" kindref="member">call</ref>(</highlight></codeline>
<codeline lineno="307"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self,</highlight></codeline>
<codeline lineno="308"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>func:<sp/>Callable[[Unpack[PosArgsT]],<sp/>Awaitable[T_Retval]<sp/>|<sp/>T_Retval],</highlight></codeline>
<codeline lineno="309"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*args:<sp/>Unpack[PosArgsT],</highlight></codeline>
<codeline lineno="310"><highlight class="normal"><sp/><sp/><sp/><sp/>)<sp/>-&gt;<sp/>T_Retval:</highlight></codeline>
<codeline lineno="311"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;&quot;&quot;</highlight></codeline>
<codeline lineno="312"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>Call<sp/>the<sp/>given<sp/>function<sp/>in<sp/>the<sp/>event<sp/>loop<sp/>thread.</highlight></codeline>
<codeline lineno="313"><highlight class="stringliteral"></highlight></codeline>
<codeline lineno="314"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>If<sp/>the<sp/>callable<sp/>returns<sp/>a<sp/>coroutine<sp/>object,<sp/>it<sp/>is<sp/>awaited<sp/>on.</highlight></codeline>
<codeline lineno="315"><highlight class="stringliteral"></highlight></codeline>
<codeline lineno="316"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>:param<sp/>func:<sp/>any<sp/>callable</highlight></codeline>
<codeline lineno="317"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>:raises<sp/>RuntimeError:<sp/>if<sp/>the<sp/>portal<sp/>is<sp/>not<sp/>running<sp/>or<sp/>if<sp/>this<sp/>method<sp/>is<sp/>called</highlight></codeline>
<codeline lineno="318"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>from<sp/>within<sp/>the<sp/>event<sp/>loop<sp/>thread</highlight></codeline>
<codeline lineno="319"><highlight class="stringliteral"></highlight></codeline>
<codeline lineno="320"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&quot;&quot;&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="321"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>cast(T_Retval,<sp/>self.<ref refid="classanyio_1_1from__thread_1_1_blocking_portal_1a1aef949f7fed3687f4c4af6b9b522a72" kindref="member">start_task_soon</ref>(func,<sp/>*args).result())</highlight></codeline>
<codeline lineno="322"><highlight class="normal"></highlight></codeline>
<codeline lineno="323"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="preprocessor">@overload</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="324" refid="classanyio_1_1from__thread_1_1_blocking_portal_1a1aef949f7fed3687f4c4af6b9b522a72" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal"><ref refid="classanyio_1_1from__thread_1_1_blocking_portal_1a1aef949f7fed3687f4c4af6b9b522a72" kindref="member">start_task_soon</ref>(</highlight></codeline>
<codeline lineno="325"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self,</highlight></codeline>
<codeline lineno="326"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>func:<sp/>Callable[[Unpack[PosArgsT]],<sp/>Awaitable[T_Retval]],</highlight></codeline>
<codeline lineno="327"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*args:<sp/>Unpack[PosArgsT],</highlight></codeline>
<codeline lineno="328"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>name:<sp/>object<sp/>=<sp/></highlight><highlight class="keywordtype">None</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="329"><highlight class="normal"><sp/><sp/><sp/><sp/>)<sp/>-&gt;<sp/>Future[T_Retval]:<sp/>...</highlight></codeline>
<codeline lineno="330"><highlight class="normal"></highlight></codeline>
<codeline lineno="331"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="preprocessor">@overload</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="332" refid="classanyio_1_1from__thread_1_1_blocking_portal_1a56f702dcfc95fae2e2d6393150c1bf50" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal"><ref refid="classanyio_1_1from__thread_1_1_blocking_portal_1a1aef949f7fed3687f4c4af6b9b522a72" kindref="member">start_task_soon</ref>(</highlight></codeline>
<codeline lineno="333"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self,</highlight></codeline>
<codeline lineno="334"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>func:<sp/>Callable[[Unpack[PosArgsT]],<sp/>T_Retval],</highlight></codeline>
<codeline lineno="335"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*args:<sp/>Unpack[PosArgsT],</highlight></codeline>
<codeline lineno="336"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>name:<sp/>object<sp/>=<sp/></highlight><highlight class="keywordtype">None</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="337"><highlight class="normal"><sp/><sp/><sp/><sp/>)<sp/>-&gt;<sp/>Future[T_Retval]:<sp/>...</highlight></codeline>
<codeline lineno="338"><highlight class="normal"></highlight></codeline>
<codeline lineno="339" refid="classanyio_1_1from__thread_1_1_blocking_portal_1af527df7764c15be1ca75389b2ca0f08d" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal"><ref refid="classanyio_1_1from__thread_1_1_blocking_portal_1a1aef949f7fed3687f4c4af6b9b522a72" kindref="member">start_task_soon</ref>(</highlight></codeline>
<codeline lineno="340"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self,</highlight></codeline>
<codeline lineno="341"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>func:<sp/>Callable[[Unpack[PosArgsT]],<sp/>Awaitable[T_Retval]<sp/>|<sp/>T_Retval],</highlight></codeline>
<codeline lineno="342"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*args:<sp/>Unpack[PosArgsT],</highlight></codeline>
<codeline lineno="343"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>name:<sp/>object<sp/>=<sp/></highlight><highlight class="keywordtype">None</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="344"><highlight class="normal"><sp/><sp/><sp/><sp/>)<sp/>-&gt;<sp/>Future[T_Retval]:</highlight></codeline>
<codeline lineno="345"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;&quot;&quot;</highlight></codeline>
<codeline lineno="346"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>Start<sp/>a<sp/>task<sp/>in<sp/>the<sp/>portal&apos;s<sp/>task<sp/>group.</highlight></codeline>
<codeline lineno="347"><highlight class="stringliteral"></highlight></codeline>
<codeline lineno="348"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>The<sp/>task<sp/>will<sp/>be<sp/>run<sp/>inside<sp/>a<sp/>cancel<sp/>scope<sp/>which<sp/>can<sp/>be<sp/>cancelled<sp/>by<sp/>cancelling</highlight></codeline>
<codeline lineno="349"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>the<sp/>returned<sp/>future.</highlight></codeline>
<codeline lineno="350"><highlight class="stringliteral"></highlight></codeline>
<codeline lineno="351"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>:param<sp/>func:<sp/>the<sp/>target<sp/>function</highlight></codeline>
<codeline lineno="352"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>:param<sp/>args:<sp/>positional<sp/>arguments<sp/>passed<sp/>to<sp/>``func``</highlight></codeline>
<codeline lineno="353"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>:param<sp/>name:<sp/>name<sp/>of<sp/>the<sp/>task<sp/>(will<sp/>be<sp/>coerced<sp/>to<sp/>a<sp/>string<sp/>if<sp/>not<sp/>``None``)</highlight></codeline>
<codeline lineno="354"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>:return:<sp/>a<sp/>future<sp/>that<sp/>resolves<sp/>with<sp/>the<sp/>return<sp/>value<sp/>of<sp/>the<sp/>callable<sp/>if<sp/>the</highlight></codeline>
<codeline lineno="355"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>task<sp/>completes<sp/>successfully,<sp/>or<sp/>with<sp/>the<sp/>exception<sp/>raised<sp/>in<sp/>the<sp/>task</highlight></codeline>
<codeline lineno="356"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>:raises<sp/>RuntimeError:<sp/>if<sp/>the<sp/>portal<sp/>is<sp/>not<sp/>running<sp/>or<sp/>if<sp/>this<sp/>method<sp/>is<sp/>called</highlight></codeline>
<codeline lineno="357"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>from<sp/>within<sp/>the<sp/>event<sp/>loop<sp/>thread</highlight></codeline>
<codeline lineno="358"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>:rtype:<sp/>concurrent.futures.Future[T_Retval]</highlight></codeline>
<codeline lineno="359"><highlight class="stringliteral"></highlight></codeline>
<codeline lineno="360"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>..<sp/>versionadded::<sp/>3.0</highlight></codeline>
<codeline lineno="361"><highlight class="stringliteral"></highlight></codeline>
<codeline lineno="362"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&quot;&quot;&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="363"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.<ref refid="classanyio_1_1from__thread_1_1_blocking_portal_1a1c7e2c8b207f3fa28b8b7dfd3b1fd520" kindref="member">_check_running</ref>()</highlight></codeline>
<codeline lineno="364"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>f:<sp/>Future[T_Retval]<sp/>=<sp/>Future()</highlight></codeline>
<codeline lineno="365"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.<ref refid="classanyio_1_1from__thread_1_1_blocking_portal_1a7450c66adeb71f733f69e14af497d7da" kindref="member">_spawn_task_from_thread</ref>(func,<sp/>args,<sp/>{},<sp/>name,<sp/>f)</highlight></codeline>
<codeline lineno="366"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>f</highlight></codeline>
<codeline lineno="367"><highlight class="normal"></highlight></codeline>
<codeline lineno="368" refid="classanyio_1_1from__thread_1_1_blocking_portal_1ae3450b9f72e00fece219699950d3b62d" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal"><ref refid="classanyio_1_1from__thread_1_1_blocking_portal_1ae3450b9f72e00fece219699950d3b62d" kindref="member">start_task</ref>(</highlight></codeline>
<codeline lineno="369"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self,</highlight></codeline>
<codeline lineno="370"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>func:<sp/>Callable[...,<sp/>Awaitable[T_Retval]],</highlight></codeline>
<codeline lineno="371"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*args:<sp/>object,</highlight></codeline>
<codeline lineno="372"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>name:<sp/>object<sp/>=<sp/></highlight><highlight class="keywordtype">None</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="373"><highlight class="normal"><sp/><sp/><sp/><sp/>)<sp/>-&gt;<sp/>tuple[Future[T_Retval],<sp/>Any]:</highlight></codeline>
<codeline lineno="374"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;&quot;&quot;</highlight></codeline>
<codeline lineno="375"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>Start<sp/>a<sp/>task<sp/>in<sp/>the<sp/>portal&apos;s<sp/>task<sp/>group<sp/>and<sp/>wait<sp/>until<sp/>it<sp/>signals<sp/>for<sp/>readiness.</highlight></codeline>
<codeline lineno="376"><highlight class="stringliteral"></highlight></codeline>
<codeline lineno="377"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>This<sp/>method<sp/>works<sp/>the<sp/>same<sp/>way<sp/>as<sp/>:meth:`.abc.TaskGroup.start`.</highlight></codeline>
<codeline lineno="378"><highlight class="stringliteral"></highlight></codeline>
<codeline lineno="379"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>:param<sp/>func:<sp/>the<sp/>target<sp/>function</highlight></codeline>
<codeline lineno="380"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>:param<sp/>args:<sp/>positional<sp/>arguments<sp/>passed<sp/>to<sp/>``func``</highlight></codeline>
<codeline lineno="381"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>:param<sp/>name:<sp/>name<sp/>of<sp/>the<sp/>task<sp/>(will<sp/>be<sp/>coerced<sp/>to<sp/>a<sp/>string<sp/>if<sp/>not<sp/>``None``)</highlight></codeline>
<codeline lineno="382"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>:return:<sp/>a<sp/>tuple<sp/>of<sp/>(future,<sp/>task_status_value)<sp/>where<sp/>the<sp/>``task_status_value``</highlight></codeline>
<codeline lineno="383"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>is<sp/>the<sp/>value<sp/>passed<sp/>to<sp/>``task_status.started()``<sp/>from<sp/>within<sp/>the<sp/>target</highlight></codeline>
<codeline lineno="384"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>function</highlight></codeline>
<codeline lineno="385"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>:rtype:<sp/>tuple[concurrent.futures.Future[T_Retval],<sp/>Any]</highlight></codeline>
<codeline lineno="386"><highlight class="stringliteral"></highlight></codeline>
<codeline lineno="387"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>..<sp/>versionadded::<sp/>3.0</highlight></codeline>
<codeline lineno="388"><highlight class="stringliteral"></highlight></codeline>
<codeline lineno="389"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&quot;&quot;&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="390"><highlight class="normal"></highlight></codeline>
<codeline lineno="391"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal">task_done(future:<sp/>Future[T_Retval])<sp/>-&gt;<sp/></highlight><highlight class="keywordtype">None</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="392"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">not</highlight><highlight class="normal"><sp/>task_status_future.done():</highlight></codeline>
<codeline lineno="393"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>future.cancelled():</highlight></codeline>
<codeline lineno="394"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>task_status_future.cancel()</highlight></codeline>
<codeline lineno="395"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">elif</highlight><highlight class="normal"><sp/>future.exception():</highlight></codeline>
<codeline lineno="396"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>task_status_future.set_exception(future.exception())</highlight></codeline>
<codeline lineno="397"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="398"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>exc<sp/>=<sp/>RuntimeError(</highlight></codeline>
<codeline lineno="399"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;Task<sp/>exited<sp/>without<sp/>calling<sp/>task_status.started()&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="400"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>)</highlight></codeline>
<codeline lineno="401"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>task_status_future.set_exception(exc)</highlight></codeline>
<codeline lineno="402"><highlight class="normal"></highlight></codeline>
<codeline lineno="403"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.<ref refid="classanyio_1_1from__thread_1_1_blocking_portal_1a1c7e2c8b207f3fa28b8b7dfd3b1fd520" kindref="member">_check_running</ref>()</highlight></codeline>
<codeline lineno="404"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>task_status_future:<sp/>Future<sp/>=<sp/>Future()</highlight></codeline>
<codeline lineno="405"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>task_status<sp/>=<sp/><ref refid="classanyio_1_1from__thread_1_1___blocking_portal_task_status" kindref="compound">_BlockingPortalTaskStatus</ref>(task_status_future)</highlight></codeline>
<codeline lineno="406"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>f:<sp/>Future<sp/>=<sp/>Future()</highlight></codeline>
<codeline lineno="407"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>f.add_done_callback(task_done)</highlight></codeline>
<codeline lineno="408"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.<ref refid="classanyio_1_1from__thread_1_1_blocking_portal_1a7450c66adeb71f733f69e14af497d7da" kindref="member">_spawn_task_from_thread</ref>(func,<sp/>args,<sp/>{</highlight><highlight class="stringliteral">&quot;task_status&quot;</highlight><highlight class="normal">:<sp/>task_status},<sp/>name,<sp/>f)</highlight></codeline>
<codeline lineno="409"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>f,<sp/>task_status_future.result()</highlight></codeline>
<codeline lineno="410"><highlight class="normal"></highlight></codeline>
<codeline lineno="411" refid="classanyio_1_1from__thread_1_1_blocking_portal_1a86c2f3d0f1ebe60da3b890f6685e70c8" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal"><ref refid="classanyio_1_1from__thread_1_1_blocking_portal_1a86c2f3d0f1ebe60da3b890f6685e70c8" kindref="member">wrap_async_context_manager</ref>(</highlight></codeline>
<codeline lineno="412"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self,<sp/>cm:<sp/>AbstractAsyncContextManager[T_co]</highlight></codeline>
<codeline lineno="413"><highlight class="normal"><sp/><sp/><sp/><sp/>)<sp/>-&gt;<sp/>AbstractContextManager[T_co]:</highlight></codeline>
<codeline lineno="414"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;&quot;&quot;</highlight></codeline>
<codeline lineno="415"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>Wrap<sp/>an<sp/>async<sp/>context<sp/>manager<sp/>as<sp/>a<sp/>synchronous<sp/>context<sp/>manager<sp/>via<sp/>this<sp/>portal.</highlight></codeline>
<codeline lineno="416"><highlight class="stringliteral"></highlight></codeline>
<codeline lineno="417"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>Spawns<sp/>a<sp/>task<sp/>that<sp/>will<sp/>call<sp/>both<sp/>``__aenter__()``<sp/>and<sp/>``__aexit__()``,<sp/>stopping</highlight></codeline>
<codeline lineno="418"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>in<sp/>the<sp/>middle<sp/>until<sp/>the<sp/>synchronous<sp/>context<sp/>manager<sp/>exits.</highlight></codeline>
<codeline lineno="419"><highlight class="stringliteral"></highlight></codeline>
<codeline lineno="420"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>:param<sp/>cm:<sp/>an<sp/>asynchronous<sp/>context<sp/>manager</highlight></codeline>
<codeline lineno="421"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>:return:<sp/>a<sp/>synchronous<sp/>context<sp/>manager</highlight></codeline>
<codeline lineno="422"><highlight class="stringliteral"></highlight></codeline>
<codeline lineno="423"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>..<sp/>versionadded::<sp/>2.1</highlight></codeline>
<codeline lineno="424"><highlight class="stringliteral"></highlight></codeline>
<codeline lineno="425"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&quot;&quot;&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="426"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="classanyio_1_1from__thread_1_1___blocking_async_context_manager" kindref="compound">_BlockingAsyncContextManager</ref>(cm,<sp/>self)</highlight></codeline>
<codeline lineno="427"><highlight class="normal"></highlight></codeline>
<codeline lineno="428"><highlight class="normal"></highlight></codeline>
<codeline lineno="429"><highlight class="normal"></highlight><highlight class="preprocessor">@dataclass</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="430" refid="classanyio_1_1from__thread_1_1_blocking_portal_provider" refkind="compound"><highlight class="normal"></highlight><highlight class="keyword">class<sp/></highlight><highlight class="normal"><ref refid="classanyio_1_1from__thread_1_1_blocking_portal_provider" kindref="compound">BlockingPortalProvider</ref>:</highlight></codeline>
<codeline lineno="431"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;&quot;&quot;</highlight></codeline>
<codeline lineno="432"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>A<sp/>manager<sp/>for<sp/>a<sp/>blocking<sp/>portal.<sp/>Used<sp/>as<sp/>a<sp/>context<sp/>manager.<sp/>The<sp/>first<sp/>thread<sp/>to</highlight></codeline>
<codeline lineno="433"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>enter<sp/>this<sp/>context<sp/>manager<sp/>causes<sp/>a<sp/>blocking<sp/>portal<sp/>to<sp/>be<sp/>started<sp/>with<sp/>the<sp/>specific</highlight></codeline>
<codeline lineno="434"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>parameters,<sp/>and<sp/>the<sp/>last<sp/>thread<sp/>to<sp/>exit<sp/>causes<sp/>the<sp/>portal<sp/>to<sp/>be<sp/>shut<sp/>down.<sp/>Thus,</highlight></codeline>
<codeline lineno="435"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>there<sp/>will<sp/>be<sp/>exactly<sp/>one<sp/>blocking<sp/>portal<sp/>running<sp/>in<sp/>this<sp/>context<sp/>as<sp/>long<sp/>as<sp/>at</highlight></codeline>
<codeline lineno="436"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>least<sp/>one<sp/>thread<sp/>has<sp/>entered<sp/>this<sp/>context<sp/>manager.</highlight></codeline>
<codeline lineno="437"><highlight class="stringliteral"></highlight></codeline>
<codeline lineno="438"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>The<sp/>parameters<sp/>are<sp/>the<sp/>same<sp/>as<sp/>for<sp/>:func:`~anyio.run`.</highlight></codeline>
<codeline lineno="439"><highlight class="stringliteral"></highlight></codeline>
<codeline lineno="440"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>:param<sp/>backend:<sp/>name<sp/>of<sp/>the<sp/>backend</highlight></codeline>
<codeline lineno="441"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>:param<sp/>backend_options:<sp/>backend<sp/>options</highlight></codeline>
<codeline lineno="442"><highlight class="stringliteral"></highlight></codeline>
<codeline lineno="443"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>..<sp/>versionadded::<sp/>4.4</highlight></codeline>
<codeline lineno="444"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&quot;&quot;&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="445"><highlight class="normal"></highlight></codeline>
<codeline lineno="446" refid="classanyio_1_1from__thread_1_1_blocking_portal_provider_1a748c45cbd8e22b8e1e15e58c0aa5966f" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/>backend:<sp/>str<sp/>=<sp/></highlight><highlight class="stringliteral">&quot;asyncio&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="447" refid="classanyio_1_1from__thread_1_1_blocking_portal_provider_1a4363d874e6d0873a2f3433cffc6b6fad" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/>backend_options:<sp/>dict[str,<sp/>Any]<sp/>|<sp/></highlight><highlight class="keywordtype">None</highlight><highlight class="normal"><sp/>=<sp/></highlight><highlight class="keywordtype">None</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="448" refid="classanyio_1_1from__thread_1_1_blocking_portal_provider_1affbbd763f0cc2f17defe2f04eb47795d" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/>_lock:<sp/>Lock<sp/>=<sp/>field(init=</highlight><highlight class="keyword">False</highlight><highlight class="normal">,<sp/>default_factory=Lock)</highlight></codeline>
<codeline lineno="449" refid="classanyio_1_1from__thread_1_1_blocking_portal_provider_1a0d2bcc0ab23f67be7ce5d983eb7a15f8" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/>_leases:<sp/>int<sp/>=<sp/>field(init=</highlight><highlight class="keyword">False</highlight><highlight class="normal">,<sp/>default=0)</highlight></codeline>
<codeline lineno="450" refid="classanyio_1_1from__thread_1_1_blocking_portal_provider_1a31e532498d9e2793ca76ff1ed578f900" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/>_portal:<sp/>BlockingPortal<sp/>=<sp/>field(init=</highlight><highlight class="keyword">False</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="451" refid="classanyio_1_1from__thread_1_1_blocking_portal_provider_1a55d6aa6307f3428ee5a084ce93e391ff" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/>_portal_cm:<sp/>AbstractContextManager[BlockingPortal]<sp/>|<sp/></highlight><highlight class="keywordtype">None</highlight><highlight class="normal"><sp/>=<sp/>field(</highlight></codeline>
<codeline lineno="452"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>init=</highlight><highlight class="keyword">False</highlight><highlight class="normal">,<sp/>default=</highlight><highlight class="keywordtype">None</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="453"><highlight class="normal"><sp/><sp/><sp/><sp/>)</highlight></codeline>
<codeline lineno="454"><highlight class="normal"></highlight></codeline>
<codeline lineno="455"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal">__enter__(self)<sp/>-&gt;<sp/>BlockingPortal:</highlight></codeline>
<codeline lineno="456"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">with</highlight><highlight class="normal"><sp/>self.<ref refid="classanyio_1_1from__thread_1_1_blocking_portal_provider_1affbbd763f0cc2f17defe2f04eb47795d" kindref="member">_lock</ref>:</highlight></codeline>
<codeline lineno="457"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>self.<ref refid="classanyio_1_1from__thread_1_1_blocking_portal_provider_1a55d6aa6307f3428ee5a084ce93e391ff" kindref="member">_portal_cm</ref><sp/></highlight><highlight class="keywordflow">is</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">None</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="458"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.<ref refid="classanyio_1_1from__thread_1_1_blocking_portal_provider_1a55d6aa6307f3428ee5a084ce93e391ff" kindref="member">_portal_cm</ref><sp/>=<sp/><ref refid="namespaceanyio_1_1from__thread_1af670520b4385160d851158b3c9aa30a7" kindref="member">start_blocking_portal</ref>(</highlight></codeline>
<codeline lineno="459"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.<ref refid="classanyio_1_1from__thread_1_1_blocking_portal_provider_1a748c45cbd8e22b8e1e15e58c0aa5966f" kindref="member">backend</ref>,<sp/>self.<ref refid="classanyio_1_1from__thread_1_1_blocking_portal_provider_1a4363d874e6d0873a2f3433cffc6b6fad" kindref="member">backend_options</ref></highlight></codeline>
<codeline lineno="460"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>)</highlight></codeline>
<codeline lineno="461"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.<ref refid="classanyio_1_1from__thread_1_1_blocking_portal_provider_1a31e532498d9e2793ca76ff1ed578f900" kindref="member">_portal</ref><sp/>=<sp/>self.<ref refid="classanyio_1_1from__thread_1_1_blocking_portal_provider_1a55d6aa6307f3428ee5a084ce93e391ff" kindref="member">_portal_cm</ref>.__enter__()</highlight></codeline>
<codeline lineno="462"><highlight class="normal"></highlight></codeline>
<codeline lineno="463"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.<ref refid="classanyio_1_1from__thread_1_1_blocking_portal_provider_1a0d2bcc0ab23f67be7ce5d983eb7a15f8" kindref="member">_leases</ref><sp/>+=<sp/>1</highlight></codeline>
<codeline lineno="464"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>self.<ref refid="classanyio_1_1from__thread_1_1_blocking_portal_provider_1a31e532498d9e2793ca76ff1ed578f900" kindref="member">_portal</ref></highlight></codeline>
<codeline lineno="465"><highlight class="normal"></highlight></codeline>
<codeline lineno="466"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal">__exit__(</highlight></codeline>
<codeline lineno="467"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self,</highlight></codeline>
<codeline lineno="468"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>exc_type:<sp/>type[BaseException]<sp/>|<sp/></highlight><highlight class="keywordtype">None</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="469"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>exc_val:<sp/>BaseException<sp/>|<sp/></highlight><highlight class="keywordtype">None</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="470"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>exc_tb:<sp/>TracebackType<sp/>|<sp/></highlight><highlight class="keywordtype">None</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="471"><highlight class="normal"><sp/><sp/><sp/><sp/>)<sp/>-&gt;<sp/></highlight><highlight class="keywordtype">None</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="472"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>portal_cm:<sp/>AbstractContextManager[BlockingPortal]<sp/>|<sp/></highlight><highlight class="keywordtype">None</highlight><highlight class="normal"><sp/>=<sp/></highlight><highlight class="keywordtype">None</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="473"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">with</highlight><highlight class="normal"><sp/>self.<ref refid="classanyio_1_1from__thread_1_1_blocking_portal_provider_1affbbd763f0cc2f17defe2f04eb47795d" kindref="member">_lock</ref>:</highlight></codeline>
<codeline lineno="474"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">assert</highlight><highlight class="normal"><sp/>self.<ref refid="classanyio_1_1from__thread_1_1_blocking_portal_provider_1a55d6aa6307f3428ee5a084ce93e391ff" kindref="member">_portal_cm</ref></highlight></codeline>
<codeline lineno="475"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">assert</highlight><highlight class="normal"><sp/>self.<ref refid="classanyio_1_1from__thread_1_1_blocking_portal_provider_1a0d2bcc0ab23f67be7ce5d983eb7a15f8" kindref="member">_leases</ref><sp/>&gt;<sp/>0</highlight></codeline>
<codeline lineno="476"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.<ref refid="classanyio_1_1from__thread_1_1_blocking_portal_provider_1a0d2bcc0ab23f67be7ce5d983eb7a15f8" kindref="member">_leases</ref><sp/>-=<sp/>1</highlight></codeline>
<codeline lineno="477"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">not</highlight><highlight class="normal"><sp/>self.<ref refid="classanyio_1_1from__thread_1_1_blocking_portal_provider_1a0d2bcc0ab23f67be7ce5d983eb7a15f8" kindref="member">_leases</ref>:</highlight></codeline>
<codeline lineno="478"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>portal_cm<sp/>=<sp/>self.<ref refid="classanyio_1_1from__thread_1_1_blocking_portal_provider_1a55d6aa6307f3428ee5a084ce93e391ff" kindref="member">_portal_cm</ref></highlight></codeline>
<codeline lineno="479"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.<ref refid="classanyio_1_1from__thread_1_1_blocking_portal_provider_1a55d6aa6307f3428ee5a084ce93e391ff" kindref="member">_portal_cm</ref><sp/>=<sp/></highlight><highlight class="keywordtype">None</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="480"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>del<sp/>self.<ref refid="classanyio_1_1from__thread_1_1_blocking_portal_provider_1a31e532498d9e2793ca76ff1ed578f900" kindref="member">_portal</ref></highlight></codeline>
<codeline lineno="481"><highlight class="normal"></highlight></codeline>
<codeline lineno="482"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>portal_cm:</highlight></codeline>
<codeline lineno="483"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>portal_cm.__exit__(</highlight><highlight class="keywordtype">None</highlight><highlight class="normal">,<sp/></highlight><highlight class="keywordtype">None</highlight><highlight class="normal">,<sp/></highlight><highlight class="keywordtype">None</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="484"><highlight class="normal"></highlight></codeline>
<codeline lineno="485"><highlight class="normal"></highlight></codeline>
<codeline lineno="486"><highlight class="normal"></highlight><highlight class="preprocessor">@contextmanager</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="487" refid="namespaceanyio_1_1from__thread_1af670520b4385160d851158b3c9aa30a7" refkind="member"><highlight class="normal"></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal"><ref refid="namespaceanyio_1_1from__thread_1af670520b4385160d851158b3c9aa30a7" kindref="member">start_blocking_portal</ref>(</highlight></codeline>
<codeline lineno="488"><highlight class="normal"><sp/><sp/><sp/><sp/>backend:<sp/>str<sp/>=<sp/></highlight><highlight class="stringliteral">&quot;asyncio&quot;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="489"><highlight class="normal"><sp/><sp/><sp/><sp/>backend_options:<sp/>dict[str,<sp/>Any]<sp/>|<sp/></highlight><highlight class="keywordtype">None</highlight><highlight class="normal"><sp/>=<sp/></highlight><highlight class="keywordtype">None</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="490"><highlight class="normal"><sp/><sp/><sp/><sp/>*,</highlight></codeline>
<codeline lineno="491"><highlight class="normal"><sp/><sp/><sp/><sp/>name:<sp/>str<sp/>|<sp/></highlight><highlight class="keywordtype">None</highlight><highlight class="normal"><sp/>=<sp/></highlight><highlight class="keywordtype">None</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="492"><highlight class="normal">)<sp/>-&gt;<sp/>Generator[BlockingPortal,<sp/>Any,<sp/></highlight><highlight class="keywordtype">None</highlight><highlight class="normal">]:</highlight></codeline>
<codeline lineno="493"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;&quot;&quot;</highlight></codeline>
<codeline lineno="494"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>Start<sp/>a<sp/>new<sp/>event<sp/>loop<sp/>in<sp/>a<sp/>new<sp/>thread<sp/>and<sp/>run<sp/>a<sp/>blocking<sp/>portal<sp/>in<sp/>its<sp/>main<sp/>task.</highlight></codeline>
<codeline lineno="495"><highlight class="stringliteral"></highlight></codeline>
<codeline lineno="496"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>The<sp/>parameters<sp/>are<sp/>the<sp/>same<sp/>as<sp/>for<sp/>:func:`~anyio.run`.</highlight></codeline>
<codeline lineno="497"><highlight class="stringliteral"></highlight></codeline>
<codeline lineno="498"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>:param<sp/>backend:<sp/>name<sp/>of<sp/>the<sp/>backend</highlight></codeline>
<codeline lineno="499"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>:param<sp/>backend_options:<sp/>backend<sp/>options</highlight></codeline>
<codeline lineno="500"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>:param<sp/>name:<sp/>name<sp/>of<sp/>the<sp/>thread</highlight></codeline>
<codeline lineno="501"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>:return:<sp/>a<sp/>context<sp/>manager<sp/>that<sp/>yields<sp/>a<sp/>blocking<sp/>portal</highlight></codeline>
<codeline lineno="502"><highlight class="stringliteral"></highlight></codeline>
<codeline lineno="503"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>..<sp/>versionchanged::<sp/>3.0</highlight></codeline>
<codeline lineno="504"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>Usage<sp/>as<sp/>a<sp/>context<sp/>manager<sp/>is<sp/>now<sp/>required.</highlight></codeline>
<codeline lineno="505"><highlight class="stringliteral"></highlight></codeline>
<codeline lineno="506"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&quot;&quot;&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="507"><highlight class="normal"></highlight></codeline>
<codeline lineno="508"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">async<sp/>def<sp/></highlight><highlight class="normal">run_portal()<sp/>-&gt;<sp/>None:</highlight></codeline>
<codeline lineno="509"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">async</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">with</highlight><highlight class="normal"><sp/><ref refid="classanyio_1_1from__thread_1_1_blocking_portal" kindref="compound">BlockingPortal</ref>()<sp/></highlight><highlight class="keyword">as</highlight><highlight class="normal"><sp/>portal_:</highlight></codeline>
<codeline lineno="510"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>name<sp/></highlight><highlight class="keywordflow">is</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">None</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="511"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>current_thread().name<sp/>=<sp/>f</highlight><highlight class="stringliteral">&quot;{backend}-portal-{id(portal_):x}&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="512"><highlight class="normal"></highlight></codeline>
<codeline lineno="513"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>future.set_result(portal_)</highlight></codeline>
<codeline lineno="514"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>await<sp/>portal_.sleep_until_stopped()</highlight></codeline>
<codeline lineno="515"><highlight class="normal"></highlight></codeline>
<codeline lineno="516"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal">run_blocking_portal()<sp/>-&gt;<sp/>None:</highlight></codeline>
<codeline lineno="517"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>future.set_running_or_notify_cancel():</highlight></codeline>
<codeline lineno="518"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">try</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="519"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>run_eventloop(</highlight></codeline>
<codeline lineno="520"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>run_portal,<sp/>backend=backend,<sp/>backend_options=backend_options</highlight></codeline>
<codeline lineno="521"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>)</highlight></codeline>
<codeline lineno="522"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">except</highlight><highlight class="normal"><sp/>BaseException<sp/></highlight><highlight class="keyword">as</highlight><highlight class="normal"><sp/>exc:</highlight></codeline>
<codeline lineno="523"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">not</highlight><highlight class="normal"><sp/>future.done():</highlight></codeline>
<codeline lineno="524"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>future.set_exception(exc)</highlight></codeline>
<codeline lineno="525"><highlight class="normal"></highlight></codeline>
<codeline lineno="526"><highlight class="normal"><sp/><sp/><sp/><sp/>future:<sp/>Future[BlockingPortal]<sp/>=<sp/>Future()</highlight></codeline>
<codeline lineno="527"><highlight class="normal"><sp/><sp/><sp/><sp/>thread<sp/>=<sp/>Thread(target=run_blocking_portal,<sp/>daemon=</highlight><highlight class="keyword">True</highlight><highlight class="normal">,<sp/>name=name)</highlight></codeline>
<codeline lineno="528"><highlight class="normal"><sp/><sp/><sp/><sp/>thread.start()</highlight></codeline>
<codeline lineno="529"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">try</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="530"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>cancel_remaining_tasks<sp/>=<sp/></highlight><highlight class="keyword">False</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="531"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>portal<sp/>=<sp/>future.result()</highlight></codeline>
<codeline lineno="532"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">try</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="533"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">yield</highlight><highlight class="normal"><sp/>portal</highlight></codeline>
<codeline lineno="534"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">except</highlight><highlight class="normal"><sp/>BaseException:</highlight></codeline>
<codeline lineno="535"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>cancel_remaining_tasks<sp/>=<sp/></highlight><highlight class="keyword">True</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="536"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">raise</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="537"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">finally</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="538"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">try</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="539"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>portal.call(portal.stop,<sp/>cancel_remaining_tasks)</highlight></codeline>
<codeline lineno="540"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">except</highlight><highlight class="normal"><sp/>RuntimeError:</highlight></codeline>
<codeline lineno="541"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">pass</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="542"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">finally</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="543"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>thread.join()</highlight></codeline>
<codeline lineno="544"><highlight class="normal"></highlight></codeline>
<codeline lineno="545"><highlight class="normal"></highlight></codeline>
<codeline lineno="546" refid="namespaceanyio_1_1from__thread_1a7083d3eaa22d40bfd4a43c771a49e082" refkind="member"><highlight class="normal"></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal"><ref refid="namespaceanyio_1_1from__thread_1a7083d3eaa22d40bfd4a43c771a49e082" kindref="member">check_cancelled</ref>()<sp/>-&gt;<sp/>None:</highlight></codeline>
<codeline lineno="547"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;&quot;&quot;</highlight></codeline>
<codeline lineno="548"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>Check<sp/>if<sp/>the<sp/>cancel<sp/>scope<sp/>of<sp/>the<sp/>host<sp/>task&apos;s<sp/>running<sp/>the<sp/>current<sp/>worker<sp/>thread<sp/>has</highlight></codeline>
<codeline lineno="549"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>been<sp/>cancelled.</highlight></codeline>
<codeline lineno="550"><highlight class="stringliteral"></highlight></codeline>
<codeline lineno="551"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>If<sp/>the<sp/>host<sp/>task&apos;s<sp/>current<sp/>cancel<sp/>scope<sp/>has<sp/>indeed<sp/>been<sp/>cancelled,<sp/>the</highlight></codeline>
<codeline lineno="552"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>backend-specific<sp/>cancellation<sp/>exception<sp/>will<sp/>be<sp/>raised.</highlight></codeline>
<codeline lineno="553"><highlight class="stringliteral"></highlight></codeline>
<codeline lineno="554"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>:raises<sp/>RuntimeError:<sp/>if<sp/>the<sp/>current<sp/>thread<sp/>was<sp/>not<sp/>spawned<sp/>by</highlight></codeline>
<codeline lineno="555"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>:func:`.to_thread.run_sync`</highlight></codeline>
<codeline lineno="556"><highlight class="stringliteral"></highlight></codeline>
<codeline lineno="557"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&quot;&quot;&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="558"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">try</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="559"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>token:<sp/>EventLoopToken<sp/>=<sp/>threadlocals.current_token</highlight></codeline>
<codeline lineno="560"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">except</highlight><highlight class="normal"><sp/>AttributeError:</highlight></codeline>
<codeline lineno="561"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">raise</highlight><highlight class="normal"><sp/><ref refid="classanyio_1_1__core_1_1__exceptions_1_1_no_event_loop_error" kindref="compound">NoEventLoopError</ref>(</highlight></codeline>
<codeline lineno="562"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;This<sp/>function<sp/>can<sp/>only<sp/>be<sp/>called<sp/>inside<sp/>an<sp/>AnyIO<sp/>worker<sp/>thread&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="563"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>)<sp/></highlight><highlight class="keyword">from</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">None</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="564"><highlight class="normal"></highlight></codeline>
<codeline lineno="565"><highlight class="normal"><sp/><sp/><sp/><sp/>token.backend_class.check_cancelled()</highlight></codeline>
    </programlisting>
    <location file="micro_gestion_objetos/venv/Lib/site-packages/anyio/from_thread.py"/>
  </compounddef>
</doxygen>
