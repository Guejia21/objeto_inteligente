<?xml version='1.0' encoding='UTF-8' standalone='no'?>
<doxygen xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="compound.xsd" version="1.15.0" xml:lang="es">
  <compounddef id="personalizacion__service_8py" kind="file" language="Python">
    <compoundname>personalizacion_service.py</compoundname>
    <innerclass refid="classapp_1_1domain_1_1services_1_1personalizacion__service_1_1_personalizacion_service" prot="public">app::domain::services::personalizacion_service::PersonalizacionService</innerclass>
    <innernamespace refid="namespaceapp">app</innernamespace>
    <innernamespace refid="namespaceapp_1_1domain">app::domain</innernamespace>
    <innernamespace refid="namespaceapp_1_1domain_1_1services">app::domain::services</innernamespace>
    <innernamespace refid="namespaceapp_1_1domain_1_1services_1_1personalizacion__service">app::domain::services::personalizacion_service</innernamespace>
    <briefdescription>
    </briefdescription>
    <detaileddescription>
    </detaileddescription>
    <programlisting>
<codeline lineno="1" refid="namespaceapp_1_1domain_1_1services_1_1personalizacion__service" refkind="compound"><highlight class="stringliteral">&quot;&quot;&quot;</highlight></codeline>
<codeline lineno="2"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>@file<sp/>personalizacion_service.py</highlight></codeline>
<codeline lineno="3"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>@brief<sp/>Servicio<sp/>de<sp/>aplicación<sp/>para<sp/>gestión<sp/>de<sp/>personalización<sp/>de<sp/>usuario.</highlight></codeline>
<codeline lineno="4"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>@details</highlight></codeline>
<codeline lineno="5"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>Implementa<sp/>la<sp/>lógica<sp/>de<sp/>negocio<sp/>para:</highlight></codeline>
<codeline lineno="6"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>-<sp/>Gestión<sp/>de<sp/>preferencias/contratos<sp/>ECA<sp/>del<sp/>usuario</highlight></codeline>
<codeline lineno="7"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>-<sp/>Carga<sp/>y<sp/>activación<sp/>de<sp/>ontologías<sp/>de<sp/>perfil</highlight></codeline>
<codeline lineno="8"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>-<sp/>Coordinación<sp/>con<sp/>microservicio<sp/>de<sp/>automatización</highlight></codeline>
<codeline lineno="9"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>-<sp/>Registro<sp/>de<sp/>interacciones<sp/>usuario-objeto</highlight></codeline>
<codeline lineno="10"><highlight class="stringliteral"><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="11"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>Patrón:<sp/>Application<sp/>Service<sp/>+<sp/>Domain<sp/>Service</highlight></codeline>
<codeline lineno="12"><highlight class="stringliteral"><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="13"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>Dependencias<sp/>externas:</highlight></codeline>
<codeline lineno="14"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>-<sp/>micro_gestion_conocimiento:<sp/>para<sp/>carga<sp/>de<sp/>ontologías</highlight></codeline>
<codeline lineno="15"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>-<sp/>micro_automatizacion:<sp/>para<sp/>creación/gestión<sp/>de<sp/>ECAs</highlight></codeline>
<codeline lineno="16"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>-<sp/>microservicio_data_stream:<sp/>para<sp/>registros<sp/>de<sp/>interacción</highlight></codeline>
<codeline lineno="17"><highlight class="stringliteral"><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="18"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>@author<sp/>Sistema<sp/>Objeto<sp/>Inteligente</highlight></codeline>
<codeline lineno="19"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>@version<sp/>1.0</highlight></codeline>
<codeline lineno="20"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>@date<sp/>2025-01-10</highlight></codeline>
<codeline lineno="21"><highlight class="stringliteral"><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="22"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>@see<sp/>PersonalizacionService<sp/>Para<sp/>endpoints</highlight></codeline>
<codeline lineno="23"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>@see<sp/>ontology_service<sp/>Para<sp/>operaciones<sp/>de<sp/>ontología</highlight></codeline>
<codeline lineno="24"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>@see<sp/>eca_service<sp/>Para<sp/>gestión<sp/>de<sp/>reglas<sp/>ECA</highlight></codeline>
<codeline lineno="25"><highlight class="stringliteral">&quot;&quot;&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="26"><highlight class="normal"></highlight></codeline>
<codeline lineno="27"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>json</highlight></codeline>
<codeline lineno="28"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>logging</highlight></codeline>
<codeline lineno="29"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>os</highlight></codeline>
<codeline lineno="30"><highlight class="normal"></highlight></codeline>
<codeline lineno="31"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>requests</highlight></codeline>
<codeline lineno="32"><highlight class="normal"></highlight><highlight class="keyword">from</highlight><highlight class="normal"><sp/>infrastructure<sp/></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>util</highlight></codeline>
<codeline lineno="33"><highlight class="normal"></highlight><highlight class="keyword">from</highlight><highlight class="normal"><sp/>datetime<sp/></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>time</highlight></codeline>
<codeline lineno="34"><highlight class="normal"></highlight></codeline>
<codeline lineno="35"><highlight class="normal"></highlight><highlight class="keyword">from</highlight><highlight class="normal"><sp/>fastapi<sp/></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>UploadFile</highlight></codeline>
<codeline lineno="36"><highlight class="normal"></highlight><highlight class="keyword">from</highlight><highlight class="normal"><sp/><ref refid="namespacefastapi_1_1responses" kindref="compound">fastapi.responses</ref><sp/></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>JSONResponse</highlight></codeline>
<codeline lineno="37"><highlight class="normal"></highlight></codeline>
<codeline lineno="38"><highlight class="normal"></highlight><highlight class="keyword">from</highlight><highlight class="normal"><sp/>config.settings<sp/></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>settings</highlight></codeline>
<codeline lineno="39"><highlight class="normal"></highlight><highlight class="keyword">from</highlight><highlight class="normal"><sp/>domain.services<sp/></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>ontology_service</highlight></codeline>
<codeline lineno="40"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>threading</highlight></codeline>
<codeline lineno="41"><highlight class="normal"></highlight></codeline>
<codeline lineno="42"><highlight class="normal"></highlight><highlight class="keyword">from</highlight><highlight class="normal"><sp/>domain.services<sp/></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>eca_service</highlight></codeline>
<codeline lineno="43"><highlight class="normal"></highlight><highlight class="keyword">from</highlight><highlight class="normal"><sp/>application.dtos.request_dtos<sp/></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>MakeContractRequest,<sp/>RegistroInteraccionDTO</highlight></codeline>
<codeline lineno="44"><highlight class="normal"></highlight><highlight class="keyword">from</highlight><highlight class="normal"><sp/>domain.services.ConexionPu<sp/></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>ConexionPu<sp/></highlight></codeline>
<codeline lineno="45"><highlight class="normal"></highlight><highlight class="keyword">from</highlight><highlight class="normal"><sp/>infrastructure.logging.ILogPanelMQTT<sp/></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>ILogPanelMQTT</highlight></codeline>
<codeline lineno="46"><highlight class="normal"></highlight><highlight class="keyword">from</highlight><highlight class="normal"><sp/>infrastructure.logging.Logging<sp/></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>logger</highlight></codeline>
<codeline lineno="47"><highlight class="normal"></highlight></codeline>
<codeline lineno="48" refid="classapp_1_1domain_1_1services_1_1personalizacion__service_1_1_personalizacion_service" refkind="compound"><highlight class="normal"></highlight><highlight class="keyword">class<sp/></highlight><highlight class="normal"><ref refid="classapp_1_1domain_1_1services_1_1personalizacion__service_1_1_personalizacion_service" kindref="compound">PersonalizacionService</ref>:</highlight></codeline>
<codeline lineno="49"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;&quot;&quot;</highlight></codeline>
<codeline lineno="50"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>@class<sp/>PersonalizacionService</highlight></codeline>
<codeline lineno="51"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>@brief<sp/>Servicio<sp/>de<sp/>aplicación<sp/>para<sp/>gestión<sp/>de<sp/>preferencias<sp/>e<sp/>interacciones<sp/>de<sp/>usuario.</highlight></codeline>
<codeline lineno="52"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="53"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>@details</highlight></codeline>
<codeline lineno="54"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>Responsabilidades:</highlight></codeline>
<codeline lineno="55"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>-<sp/>Orquestar<sp/>carga<sp/>de<sp/>ontologías<sp/>de<sp/>perfil<sp/>de<sp/>usuario</highlight></codeline>
<codeline lineno="56"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>-<sp/>Coordinar<sp/>creación<sp/>de<sp/>preferencias/ECAs<sp/>con<sp/>micro_automatizacion</highlight></codeline>
<codeline lineno="57"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>-<sp/>Activar/desactivar<sp/>ECAs<sp/>del<sp/>usuario</highlight></codeline>
<codeline lineno="58"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>-<sp/>Registrar<sp/>interacciones<sp/>usuario-objeto<sp/>para<sp/>personalización</highlight></codeline>
<codeline lineno="59"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>-<sp/>Mantener<sp/>conexión<sp/>con<sp/>servidor<sp/>de<sp/>perfil<sp/>de<sp/>usuario<sp/>(ConexionPu)</highlight></codeline>
<codeline lineno="60"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="61"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>Atributos:</highlight></codeline>
<codeline lineno="62"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>-<sp/>osid:<sp/>ID<sp/>del<sp/>objeto<sp/>inteligente<sp/>activo</highlight></codeline>
<codeline lineno="63"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>-<sp/>ipServidorPU:<sp/>dirección<sp/>del<sp/>servidor<sp/>de<sp/>perfil<sp/>de<sp/>usuario</highlight></codeline>
<codeline lineno="64"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>-<sp/>path:<sp/>ruta<sp/>donde<sp/>se<sp/>guardan<sp/>las<sp/>ECAs</highlight></codeline>
<codeline lineno="65"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>-<sp/>conexion_pu:<sp/>cliente<sp/>para<sp/>comunicación<sp/>con<sp/>servidor<sp/>perfil</highlight></codeline>
<codeline lineno="66"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>-<sp/>Log:<sp/>cliente<sp/>MQTT<sp/>para<sp/>logging<sp/>distribuido</highlight></codeline>
<codeline lineno="67"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="68"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>@note<sp/>Esta<sp/>clase<sp/>coordina<sp/>múltiples<sp/>microservicios<sp/>de<sp/>forma<sp/>distribuida.</highlight></codeline>
<codeline lineno="69"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>Considerar<sp/>implementar<sp/>sagas/compensación<sp/>para<sp/>operaciones<sp/>compuestas.</highlight></codeline>
<codeline lineno="70"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="71"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>@author<sp/>Sistema<sp/>Objeto<sp/>Inteligente</highlight></codeline>
<codeline lineno="72"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>@date<sp/>2025-01-10</highlight></codeline>
<codeline lineno="73"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&quot;&quot;&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="74"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal">__init__(self,<sp/>log<sp/>=<sp/>ILogPanelMQTT):</highlight></codeline>
<codeline lineno="75"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;&quot;&quot;</highlight></codeline>
<codeline lineno="76"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>@brief<sp/>Constructor<sp/>del<sp/>servicio<sp/>de<sp/>personalización.</highlight></codeline>
<codeline lineno="77"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="78"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>@param<sp/>log<sp/>Instancia<sp/>del<sp/>cliente<sp/>MQTT<sp/>para<sp/>logging<sp/>distribuido.</highlight></codeline>
<codeline lineno="79"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="80"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>@details</highlight></codeline>
<codeline lineno="81"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>Inicializa<sp/>conexiones<sp/>a<sp/>servicios<sp/>externos<sp/>y<sp/>configura<sp/>rutas.</highlight></codeline>
<codeline lineno="82"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&quot;&quot;&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="83" refid="classapp_1_1domain_1_1services_1_1personalizacion__service_1_1_personalizacion_service_1a2df7c70f0f7919efa7f194a49ea7eda7" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.<ref refid="classapp_1_1domain_1_1services_1_1personalizacion__service_1_1_personalizacion_service_1a2df7c70f0f7919efa7f194a49ea7eda7" kindref="member">osid</ref><sp/>=<sp/>ontology_service.get_osid()</highlight></codeline>
<codeline lineno="84" refid="classapp_1_1domain_1_1services_1_1personalizacion__service_1_1_personalizacion_service_1a05889f39107a5a88b2b8cc262d826376" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.<ref refid="classapp_1_1domain_1_1services_1_1personalizacion__service_1_1_personalizacion_service_1a05889f39107a5a88b2b8cc262d826376" kindref="member">ipServidorPU</ref><sp/>=<sp/></highlight><highlight class="stringliteral">&quot;http://localhost&quot;</highlight><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">#<sp/>Dirección<sp/>del<sp/>servidor<sp/>de<sp/>perfil<sp/>de<sp/>usuario<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="85" refid="classapp_1_1domain_1_1services_1_1personalizacion__service_1_1_personalizacion_service_1a1a5c9f2533eee6882439e5737d2ebcb4" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.<ref refid="classapp_1_1domain_1_1services_1_1personalizacion__service_1_1_personalizacion_service_1a1a5c9f2533eee6882439e5737d2ebcb4" kindref="member">path</ref><sp/>=settings.PATH_ECAS</highlight></codeline>
<codeline lineno="86" refid="classapp_1_1domain_1_1services_1_1personalizacion__service_1_1_personalizacion_service_1a89c26b2ae8d32fabdfb479de10e33c2b" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.<ref refid="classapp_1_1domain_1_1services_1_1personalizacion__service_1_1_personalizacion_service_1a89c26b2ae8d32fabdfb479de10e33c2b" kindref="member">conexion_pu</ref><sp/>=<sp/><ref refid="classapp_1_1domain_1_1services_1_1_conexion_pu_1_1_conexion_pu" kindref="compound">ConexionPu</ref>()</highlight></codeline>
<codeline lineno="87" refid="classapp_1_1domain_1_1services_1_1personalizacion__service_1_1_personalizacion_service_1ade88b01890801c7f7f1fd686c0ea3644" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.<ref refid="classapp_1_1domain_1_1services_1_1personalizacion__service_1_1_personalizacion_service_1ade88b01890801c7f7f1fd686c0ea3644" kindref="member">Log</ref><sp/>=<sp/>log</highlight></codeline>
<codeline lineno="88" refid="classapp_1_1domain_1_1services_1_1personalizacion__service_1_1_personalizacion_service_1ab600a1b7c03aff746520b47301524f01" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">async<sp/>def<sp/></highlight><highlight class="normal"><ref refid="classapp_1_1domain_1_1services_1_1personalizacion__service_1_1_personalizacion_service_1ab600a1b7c03aff746520b47301524f01" kindref="member">recibir_ontologia</ref>(self,file:UploadFile,<sp/>nombre:<sp/>str,<sp/>ipCoordinador:<sp/>str)<sp/>-&gt;<sp/>JSONResponse:</highlight></codeline>
<codeline lineno="89"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;&quot;&quot;</highlight></codeline>
<codeline lineno="90"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>@brief<sp/>Recibe<sp/>una<sp/>ontología<sp/>desde<sp/>el<sp/>coordinador<sp/>y<sp/>la<sp/>envía<sp/>al<sp/>microservicio<sp/>de<sp/>ontologías.</highlight></codeline>
<codeline lineno="91"><highlight class="stringliteral"></highlight></codeline>
<codeline lineno="92"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>@param<sp/>file<sp/>Archivo<sp/>.owl<sp/>con<sp/>la<sp/>ontología<sp/>de<sp/>usuario.</highlight></codeline>
<codeline lineno="93"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>@param<sp/>nombre<sp/>Identificador/nombre<sp/>de<sp/>la<sp/>ontología.</highlight></codeline>
<codeline lineno="94"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>@param<sp/>ipCoordinador<sp/>IP<sp/>del<sp/>coordinador<sp/>que<sp/>envía<sp/>la<sp/>ontología<sp/>(para<sp/>tracking).</highlight></codeline>
<codeline lineno="95"><highlight class="stringliteral"></highlight></codeline>
<codeline lineno="96"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>@return<sp/>JSONResponse<sp/>con<sp/>status<sp/>200<sp/>si<sp/>exitoso,<sp/>o<sp/>error<sp/>400/500.</highlight></codeline>
<codeline lineno="97"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="98"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>@exception<sp/>ValueError<sp/>Si<sp/>el<sp/>archivo<sp/>no<sp/>es<sp/>.owl.</highlight></codeline>
<codeline lineno="99"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>@exception<sp/>RuntimeError<sp/>Si<sp/>falla<sp/>el<sp/>envío<sp/>a<sp/>micro_gestion_conocimiento.</highlight></codeline>
<codeline lineno="100"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="101"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>@details</highlight></codeline>
<codeline lineno="102"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>Flujo:</highlight></codeline>
<codeline lineno="103"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>1.<sp/>Valida<sp/>que<sp/>el<sp/>archivo<sp/>sea<sp/>.owl</highlight></codeline>
<codeline lineno="104"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>2.<sp/>Delega<sp/>carga<sp/>en<sp/>ontology_service<sp/>(que<sp/>se<sp/>comunica<sp/>con<sp/>micro_gestion_conocimiento)</highlight></codeline>
<codeline lineno="105"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>3.<sp/>Guarda<sp/>IP<sp/>del<sp/>coordinador<sp/>en<sp/>archivo<sp/>(para<sp/>auditoría)</highlight></codeline>
<codeline lineno="106"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>4.<sp/>Activa<sp/>ECAs<sp/>del<sp/>usuario<sp/>actual</highlight></codeline>
<codeline lineno="107"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="108"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>@note<sp/>Esta<sp/>operación<sp/>es<sp/>distribuida:<sp/>coordina<sp/>con<sp/>micro_gestion_conocimiento</highlight></codeline>
<codeline lineno="109"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>y<sp/>micro_automatizacion.<sp/>Considerar<sp/>saga<sp/>si<sp/>falla<sp/>en<sp/>mitad.</highlight></codeline>
<codeline lineno="110"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="111"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>@see<sp/>ontology_service.cargar_ontologia()</highlight></codeline>
<codeline lineno="112"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>@see<sp/>activarEcasUsuario()</highlight></codeline>
<codeline lineno="113"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&quot;&quot;&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="114"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>logger.info(f</highlight><highlight class="stringliteral">&quot;Recibiendo<sp/>ontología:<sp/>{nombre}<sp/>desde<sp/>{ipCoordinador}&quot;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="115"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="116"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>Validar<sp/>tipo<sp/>de<sp/>archivo</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="117"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">not</highlight><highlight class="normal"><sp/>file.filename.endswith(</highlight><highlight class="stringliteral">&apos;.owl&apos;</highlight><highlight class="normal">):</highlight></codeline>
<codeline lineno="118"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="classstarlette_1_1responses_1_1_j_s_o_n_response" kindref="compound">JSONResponse</ref>(</highlight></codeline>
<codeline lineno="119"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>status_code=400,</highlight></codeline>
<codeline lineno="120"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>content={</highlight><highlight class="stringliteral">&quot;error&quot;</highlight><highlight class="normal">:<sp/></highlight><highlight class="stringliteral">&quot;Tipo<sp/>de<sp/>archivo<sp/>inválido.<sp/>Se<sp/>espera<sp/>un<sp/>archivo<sp/>.owl&quot;</highlight><highlight class="normal">}</highlight></codeline>
<codeline lineno="121"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>)</highlight></codeline>
<codeline lineno="122"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>Enviar<sp/>la<sp/>ontología<sp/>al<sp/>microservicio<sp/>de<sp/>ontologías</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="123"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>ontology_service.cargar_ontologia(file,<sp/>nombre,<sp/>ipCoordinador):</highlight></codeline>
<codeline lineno="124"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>logger.info(f</highlight><highlight class="stringliteral">&quot;Ontología<sp/>{nombre}<sp/>enviada<sp/>exitosamente<sp/>al<sp/>microservicio<sp/>de<sp/>ontologías&quot;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="125"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>util.guardarIpCoordinadorEnArchivo(ipCoordinador)</highlight></codeline>
<codeline lineno="126"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.<ref refid="classapp_1_1domain_1_1services_1_1personalizacion__service_1_1_personalizacion_service_1acfcfbaf38f85ed2d82abef2f60a8338d" kindref="member">activarEcasUsuario</ref>()</highlight></codeline>
<codeline lineno="127"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="classstarlette_1_1responses_1_1_j_s_o_n_response" kindref="compound">JSONResponse</ref>(</highlight></codeline>
<codeline lineno="128"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>status_code=200,</highlight></codeline>
<codeline lineno="129"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>content={</highlight><highlight class="stringliteral">&quot;mensaje&quot;</highlight><highlight class="normal">:<sp/></highlight><highlight class="stringliteral">&quot;Ontología<sp/>recibida<sp/>y<sp/>enviada<sp/>al<sp/>microservicio<sp/>de<sp/>ontologías<sp/>exitosamente&quot;</highlight><highlight class="normal">}</highlight></codeline>
<codeline lineno="130"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>)</highlight></codeline>
<codeline lineno="131"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="132"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>logger.error(f</highlight><highlight class="stringliteral">&quot;Error<sp/>enviando<sp/>ontología<sp/>{nombre}<sp/>al<sp/>microservicio<sp/>de<sp/>ontologías&quot;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="133"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="classstarlette_1_1responses_1_1_j_s_o_n_response" kindref="compound">JSONResponse</ref>(</highlight></codeline>
<codeline lineno="134"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>status_code=500,</highlight></codeline>
<codeline lineno="135"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>content={</highlight><highlight class="stringliteral">&quot;error&quot;</highlight><highlight class="normal">:<sp/></highlight><highlight class="stringliteral">&quot;Error<sp/>enviando<sp/>ontología<sp/>al<sp/>microservicio<sp/>de<sp/>ontologías&quot;</highlight><highlight class="normal">}</highlight></codeline>
<codeline lineno="136"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>)<sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="137" refid="classapp_1_1domain_1_1services_1_1personalizacion__service_1_1_personalizacion_service_1a189ff6db69d330c419702b0785997c77" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">async<sp/>def<sp/></highlight><highlight class="normal"><ref refid="classapp_1_1domain_1_1services_1_1personalizacion__service_1_1_personalizacion_service_1a189ff6db69d330c419702b0785997c77" kindref="member">crear_preferencia</ref>(self,<sp/>data:MakeContractRequest)<sp/>-&gt;<sp/>JSONResponse:</highlight></codeline>
<codeline lineno="138"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;&quot;&quot;</highlight></codeline>
<codeline lineno="139"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>@brief<sp/>Crea<sp/>una<sp/>nueva<sp/>preferencia/contrato<sp/>ECA<sp/>para<sp/>el<sp/>usuario.</highlight></codeline>
<codeline lineno="140"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="141"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>@param<sp/>data<sp/>DTO<sp/>MakeContractRequest<sp/>con<sp/>definición<sp/>del<sp/>contrato.</highlight></codeline>
<codeline lineno="142"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="143"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>@return<sp/>JSONResponse<sp/>con<sp/>status<sp/>200<sp/>si<sp/>exitoso,<sp/>o<sp/>error<sp/>400/500.</highlight></codeline>
<codeline lineno="144"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="145"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>@exception<sp/>ValueError<sp/>Si<sp/>email<sp/>no<sp/>coincide<sp/>con<sp/>usuario<sp/>actual.</highlight></codeline>
<codeline lineno="146"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>@exception<sp/>RuntimeError<sp/>Si<sp/>falla<sp/>comunicación<sp/>con<sp/>micro_automatizacion.</highlight></codeline>
<codeline lineno="147"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="148"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>@details</highlight></codeline>
<codeline lineno="149"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>Flujo:</highlight></codeline>
<codeline lineno="150"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>1.<sp/>Valida<sp/>que<sp/>el<sp/>email<sp/>del<sp/>DTO<sp/>coincida<sp/>con<sp/>el<sp/>usuario<sp/>activo</highlight></codeline>
<codeline lineno="151"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>2.<sp/>Envía<sp/>solicitud<sp/>POST<sp/>a<sp/>micro_automatizacion</highlight></codeline>
<codeline lineno="152"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>3.<sp/>Si<sp/>es<sp/>exitoso,<sp/>registra<sp/>preferencia<sp/>en<sp/>ontología<sp/>de<sp/>usuario</highlight></codeline>
<codeline lineno="153"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="154"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>@note<sp/>Operación<sp/>distribuida:<sp/>requiere<sp/>coordinación<sp/>con<sp/>micro_automatizacion.</highlight></codeline>
<codeline lineno="155"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>Si<sp/>micro_automatizacion<sp/>responde<sp/>error,<sp/>la<sp/>preferencia<sp/>no<sp/>se<sp/>registra.</highlight></codeline>
<codeline lineno="156"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="157"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>@see<sp/>MakeContractRequest<sp/>DTO</highlight></codeline>
<codeline lineno="158"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>@see<sp/>settings.AUTOMATIZACION_MS_URL<sp/>Para<sp/>endpoint<sp/>remoto</highlight></codeline>
<codeline lineno="159"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&quot;&quot;&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="160"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">try</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="161"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>response<sp/>=<sp/>requests.post(</highlight></codeline>
<codeline lineno="162"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>f</highlight><highlight class="stringliteral">&quot;{settings.AUTOMATIZACION_MS_URL}&quot;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="163"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>json=data.model_dump(),</highlight></codeline>
<codeline lineno="164"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>timeout=30.0</highlight></codeline>
<codeline lineno="165"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>)</highlight></codeline>
<codeline lineno="166"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>response.status_code<sp/>==<sp/>200:</highlight></codeline>
<codeline lineno="167"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="classstarlette_1_1responses_1_1_j_s_o_n_response" kindref="compound">JSONResponse</ref>(</highlight></codeline>
<codeline lineno="168"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>status_code=200,</highlight></codeline>
<codeline lineno="169"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>content={</highlight><highlight class="stringliteral">&quot;mensaje&quot;</highlight><highlight class="normal">:<sp/></highlight><highlight class="stringliteral">&quot;Preferencia<sp/>creada<sp/>exitosamente&quot;</highlight><highlight class="normal">}</highlight></codeline>
<codeline lineno="170"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>)</highlight></codeline>
<codeline lineno="171"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="172"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>logger.error(f</highlight><highlight class="stringliteral">&quot;Error<sp/>al<sp/>crear<sp/>preferencia:<sp/>{response.text}&quot;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="173"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="classstarlette_1_1responses_1_1_j_s_o_n_response" kindref="compound">JSONResponse</ref>(</highlight></codeline>
<codeline lineno="174"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>status_code=response.status_code,</highlight></codeline>
<codeline lineno="175"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>content={</highlight><highlight class="stringliteral">&quot;error&quot;</highlight><highlight class="normal">:<sp/></highlight><highlight class="stringliteral">&quot;Error<sp/>al<sp/>crear<sp/>preferencia<sp/>en<sp/>el<sp/>microservicio<sp/>de<sp/>automatización&quot;</highlight><highlight class="normal">}</highlight></codeline>
<codeline lineno="176"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>)</highlight></codeline>
<codeline lineno="177"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">except</highlight><highlight class="normal"><sp/><ref refid="classrequests_1_1exceptions_1_1_request_exception" kindref="compound">requests.RequestException</ref><sp/></highlight><highlight class="keyword">as</highlight><highlight class="normal"><sp/>e:</highlight></codeline>
<codeline lineno="178"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>logger.error(f</highlight><highlight class="stringliteral">&quot;Error<sp/>al<sp/>crear<sp/>preferencia:<sp/>{e}&quot;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="179"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="classstarlette_1_1responses_1_1_j_s_o_n_response" kindref="compound">JSONResponse</ref>(</highlight></codeline>
<codeline lineno="180"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>status_code=500,</highlight></codeline>
<codeline lineno="181"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>content={</highlight><highlight class="stringliteral">&quot;error&quot;</highlight><highlight class="normal">:<sp/></highlight><highlight class="stringliteral">&quot;Error<sp/>al<sp/>comunicarse<sp/>con<sp/>el<sp/>microservicio<sp/>de<sp/>automatización&quot;</highlight><highlight class="normal">}</highlight></codeline>
<codeline lineno="182"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>)</highlight></codeline>
<codeline lineno="183"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>Métodos<sp/>adaptados<sp/>desde<sp/>ModuloDePersonalizacion,<sp/>debido<sp/>a<sp/>que<sp/>no<sp/>se<sp/>tiene<sp/>comunicacion<sp/>con<sp/>el<sp/>servidor<sp/>de<sp/>PU</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="184"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>ni<sp/>a<sp/>la<sp/>ontologia<sp/>PU,<sp/>no<sp/>se<sp/>pueden<sp/>probar<sp/><sp/><sp/><sp/></highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="185" refid="classapp_1_1domain_1_1services_1_1personalizacion__service_1_1_personalizacion_service_1acfcfbaf38f85ed2d82abef2f60a8338d" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal"><ref refid="classapp_1_1domain_1_1services_1_1personalizacion__service_1_1_personalizacion_service_1acfcfbaf38f85ed2d82abef2f60a8338d" kindref="member">activarEcasUsuario</ref>(self):<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="186"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">##Cada<sp/>Usuario<sp/>va<sp/>a<sp/>tener<sp/>un<sp/>archivo<sp/>email.txt<sp/>donde<sp/>se<sp/>almacena<sp/>el<sp/>nombre<sp/>del<sp/>ECA<sp/>y<sp/>su<sp/>estado.<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="187" refid="classapp_1_1domain_1_1services_1_1personalizacion__service_1_1_personalizacion_service_1af900dcd3f19174ccd07a52e248799c0d" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.<ref refid="classapp_1_1domain_1_1services_1_1personalizacion__service_1_1_personalizacion_service_1af900dcd3f19174ccd07a52e248799c0d" kindref="member">user_eca</ref><sp/>=<sp/>ontology_service.consultar_email_usuario()</highlight></codeline>
<codeline lineno="188"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>self.<ref refid="classapp_1_1domain_1_1services_1_1personalizacion__service_1_1_personalizacion_service_1af900dcd3f19174ccd07a52e248799c0d" kindref="member">user_eca</ref><sp/>==<sp/></highlight><highlight class="stringliteral">&quot;&quot;</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="189"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>logger.info(</highlight><highlight class="stringliteral">&quot;No<sp/>se<sp/>pudo<sp/>consultar<sp/>el<sp/>email<sp/>del<sp/>usuario<sp/>desde<sp/>el<sp/>microservicio<sp/>de<sp/>ontologías&quot;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="190"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="191"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>logger.info(<sp/></highlight><highlight class="stringliteral">&quot;BIENVENIDO<sp/>&quot;</highlight><highlight class="normal"><sp/>+<sp/>self.<ref refid="classapp_1_1domain_1_1services_1_1personalizacion__service_1_1_personalizacion_service_1af900dcd3f19174ccd07a52e248799c0d" kindref="member">user_eca</ref>)</highlight></codeline>
<codeline lineno="192"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">##Consulta<sp/>los<sp/>Ecas<sp/>que<sp/>tiene<sp/>la<sp/>ontologia<sp/>del<sp/>Usuario</highlight></codeline>
<codeline lineno="193"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>##OjO<sp/>Cambias<sp/>esto<sp/>&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="194"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">try</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="195"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>logger.info(<sp/>time.ctime())</highlight></codeline>
<codeline lineno="196"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>logger.info(self.<ref refid="classapp_1_1domain_1_1services_1_1personalizacion__service_1_1_personalizacion_service_1a05889f39107a5a88b2b8cc262d826376" kindref="member">ipServidorPU</ref><sp/>+<sp/></highlight><highlight class="stringliteral">&apos;:8080/ConsultarEcasPorObjeto?email=&apos;</highlight><highlight class="normal">+self.<ref refid="classapp_1_1domain_1_1services_1_1personalizacion__service_1_1_personalizacion_service_1af900dcd3f19174ccd07a52e248799c0d" kindref="member">user_eca</ref>+</highlight><highlight class="stringliteral">&apos;&amp;osid=&apos;</highlight><highlight class="normal">+self.<ref refid="classapp_1_1domain_1_1services_1_1personalizacion__service_1_1_personalizacion_service_1a2df7c70f0f7919efa7f194a49ea7eda7" kindref="member">osid</ref>)</highlight></codeline>
<codeline lineno="197"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>r<sp/>=<sp/>requests.get(self.<ref refid="classapp_1_1domain_1_1services_1_1personalizacion__service_1_1_personalizacion_service_1a05889f39107a5a88b2b8cc262d826376" kindref="member">ipServidorPU</ref><sp/>+<sp/></highlight><highlight class="stringliteral">&apos;:8080/ConsultarEcasPorObjeto?email=&apos;</highlight><highlight class="normal"><sp/>+<sp/>self.<ref refid="classapp_1_1domain_1_1services_1_1personalizacion__service_1_1_personalizacion_service_1af900dcd3f19174ccd07a52e248799c0d" kindref="member">user_eca</ref><sp/>+<sp/></highlight><highlight class="stringliteral">&apos;&amp;osid=&apos;</highlight><highlight class="normal"><sp/>+<sp/>self.<ref refid="classapp_1_1domain_1_1services_1_1personalizacion__service_1_1_personalizacion_service_1a2df7c70f0f7919efa7f194a49ea7eda7" kindref="member">osid</ref>)</highlight></codeline>
<codeline lineno="198"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>resp<sp/>=<sp/>r.content</highlight></codeline>
<codeline lineno="199" refid="classapp_1_1domain_1_1services_1_1personalizacion__service_1_1_personalizacion_service_1a615aae7687732f1ab49adca9619d2a2c" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.<ref refid="classapp_1_1domain_1_1services_1_1personalizacion__service_1_1_personalizacion_service_1a615aae7687732f1ab49adca9619d2a2c" kindref="member">ecasUsuario</ref><sp/><sp/>=<sp/>json.loads(resp)</highlight></codeline>
<codeline lineno="200"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>logger.info(</highlight><highlight class="stringliteral">&quot;**************************Ecas<sp/>Usuario***********************************************<sp/>&quot;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="201"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>iten<sp/></highlight><highlight class="keywordflow">in</highlight><highlight class="normal"><sp/>self.<ref refid="classapp_1_1domain_1_1services_1_1personalizacion__service_1_1_personalizacion_service_1a615aae7687732f1ab49adca9619d2a2c" kindref="member">ecasUsuario</ref>:</highlight></codeline>
<codeline lineno="202"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>logger.info(iten[</highlight><highlight class="stringliteral">&apos;name_eca&apos;</highlight><highlight class="normal">]+</highlight><highlight class="stringliteral">&quot;<sp/>&quot;</highlight><highlight class="normal">+iten[</highlight><highlight class="stringliteral">&apos;state_eca&apos;</highlight><highlight class="normal">])</highlight></codeline>
<codeline lineno="203"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="204"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>logger.info(<sp/>time.ctime())</highlight></codeline>
<codeline lineno="205"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">except</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="206"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>logger.error(</highlight><highlight class="stringliteral">&quot;Error<sp/>en<sp/>el<sp/>modulo<sp/>de<sp/>personalizacion<sp/>no<sp/>se<sp/>puede<sp/>comunicar<sp/>con<sp/>el<sp/>servidor<sp/>de<sp/>personalizacion<sp/>de<sp/>usuario<sp/>&quot;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="207"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.<ref refid="classapp_1_1domain_1_1services_1_1personalizacion__service_1_1_personalizacion_service_1a615aae7687732f1ab49adca9619d2a2c" kindref="member">ecasUsuario</ref><sp/><sp/>=<sp/>ontology_service.consultar_lista_preferencias_por_osid(self.<ref refid="classapp_1_1domain_1_1services_1_1personalizacion__service_1_1_personalizacion_service_1a2df7c70f0f7919efa7f194a49ea7eda7" kindref="member">osid</ref>)<sp/></highlight><highlight class="comment">##<sp/>Si<sp/>no<sp/>se<sp/>puede<sp/>comunicar<sp/>con<sp/>el<sp/>servidor<sp/>que<sp/>las<sp/>consulte<sp/>localmente</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="208"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>len(self.<ref refid="classapp_1_1domain_1_1services_1_1personalizacion__service_1_1_personalizacion_service_1a615aae7687732f1ab49adca9619d2a2c" kindref="member">ecasUsuario</ref>)<sp/>==<sp/>0:</highlight></codeline>
<codeline lineno="209"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>logger.info(</highlight><highlight class="stringliteral">&quot;Desde<sp/>Modulo<sp/>personalizacion<sp/>NO<sp/>existen<sp/>ECAS<sp/>para<sp/>el<sp/>usuario<sp/>&quot;</highlight><highlight class="normal">+self.<ref refid="classapp_1_1domain_1_1services_1_1personalizacion__service_1_1_personalizacion_service_1af900dcd3f19174ccd07a52e248799c0d" kindref="member">user_eca</ref>)</highlight></codeline>
<codeline lineno="210"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="211"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">##OjO<sp/>Cambias<sp/>esto<sp/>&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="212" refid="classapp_1_1domain_1_1services_1_1personalizacion__service_1_1_personalizacion_service_1ae2b7d0f2d862d4fa88497a472ef0ff44" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.<ref refid="classapp_1_1domain_1_1services_1_1personalizacion__service_1_1_personalizacion_service_1ae2b7d0f2d862d4fa88497a472ef0ff44" kindref="member">pathEcasUsuario</ref><sp/>=<sp/>self.<ref refid="classapp_1_1domain_1_1services_1_1personalizacion__service_1_1_personalizacion_service_1a1a5c9f2533eee6882439e5737d2ebcb4" kindref="member">path</ref><sp/>+<sp/>self.<ref refid="classapp_1_1domain_1_1services_1_1personalizacion__service_1_1_personalizacion_service_1af900dcd3f19174ccd07a52e248799c0d" kindref="member">user_eca</ref><sp/>+</highlight><highlight class="stringliteral">&quot;.txt&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="213"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">not</highlight><highlight class="normal"><sp/>os.path.exists(self.<ref refid="classapp_1_1domain_1_1services_1_1personalizacion__service_1_1_personalizacion_service_1ae2b7d0f2d862d4fa88497a472ef0ff44" kindref="member">pathEcasUsuario</ref>):</highlight></codeline>
<codeline lineno="214"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>logger.info(</highlight><highlight class="stringliteral">&quot;Desde<sp/>Modulo<sp/>personalizacion<sp/>NO<sp/>existe<sp/>el<sp/>archivo<sp/>&quot;</highlight><highlight class="normal">+self.<ref refid="classapp_1_1domain_1_1services_1_1personalizacion__service_1_1_personalizacion_service_1ae2b7d0f2d862d4fa88497a472ef0ff44" kindref="member">pathEcasUsuario</ref>)</highlight></codeline>
<codeline lineno="215"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>archivo=open(self.<ref refid="classapp_1_1domain_1_1services_1_1personalizacion__service_1_1_personalizacion_service_1ae2b7d0f2d862d4fa88497a472ef0ff44" kindref="member">pathEcasUsuario</ref>,</highlight><highlight class="stringliteral">&apos;wb&apos;</highlight><highlight class="normal">)<sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="216"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>archivo.close()</highlight></codeline>
<codeline lineno="217"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ecasArchivo<sp/>=<sp/>[]<sp/></highlight><highlight class="comment">##<sp/>Contiene<sp/>diccionarios<sp/>{&quot;eca_name&quot;,<sp/>&quot;eca_state&quot;}</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="218"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ecasArchivo<sp/>=<sp/>self.ecasArchivoADiccionario()</highlight></codeline>
<codeline lineno="219"><highlight class="normal"></highlight><highlight class="comment">##listaEcasCrear<sp/>[{&apos;name_event_resource&apos;:<sp/>&apos;temperatura&apos;,<sp/>&apos;unit_action&apos;:<sp/>&apos;None&apos;,<sp/>&apos;type_variable_action&apos;:<sp/>&apos;bool&apos;,<sp/>&apos;comparator_action&apos;:<sp/>&apos;igual&apos;,<sp/>&apos;id_action_object&apos;:<sp/>&apos;708637323&apos;,<sp/>&apos;ip_action_object&apos;:<sp/>&apos;192.168.123.104&apos;,<sp/>&apos;name_eca&apos;:<sp/>&apos;subirTemperatura&apos;,<sp/>&apos;end_date_activity&apos;:<sp/>&apos;&apos;,<sp/>&apos;variable_condition&apos;:<sp/>&apos;20&apos;,<sp/>&apos;comparator_condition&apos;:<sp/>&apos;igual&apos;,<sp/>&apos;meaning_condition&apos;:<sp/>&apos;hace<sp/>calor&apos;,<sp/>&apos;state_eca&apos;:<sp/>&apos;on&apos;,<sp/>&apos;name_action_object&apos;:<sp/>&apos;Regulador<sp/>Temperatura&apos;,<sp/>&apos;id_action_resource&apos;:<sp/>&apos;ventilador&apos;,<sp/>&apos;start_date_activity&apos;:<sp/>&apos;&apos;,<sp/>&apos;name_activity&apos;:<sp/>&apos;&apos;,<sp/>&apos;meaning_action&apos;:<sp/>&apos;encender<sp/>ventilador&apos;,<sp/>&apos;name_event_object&apos;:<sp/>&apos;Regulador<sp/>Temperatura&apos;,<sp/>&apos;id_event_resource&apos;:<sp/>&apos;temperatura&apos;,<sp/>&apos;variable_action&apos;:<sp/>&apos;1&apos;,<sp/>&apos;ip_event_object&apos;:<sp/>&apos;192.168.123.104&apos;,<sp/>&apos;unit_condition&apos;:<sp/>&apos;%&apos;,<sp/>&apos;id_event_object&apos;:<sp/>&apos;708637323&apos;,<sp/>&apos;name_action_resource&apos;:<sp/>&apos;ventilador&apos;,<sp/>&apos;type_variable_condition&apos;:<sp/>&apos;float&apos;}]</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="220" refid="namespaceapp_1_1domain_1_1services_1_1personalizacion__service_1a9fd324616a5cf02beec186f5c58f7396" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>listaEcasEliminar<sp/>=<sp/>[]</highlight></codeline>
<codeline lineno="221" refid="namespaceapp_1_1domain_1_1services_1_1personalizacion__service_1ab684c89dfd4ec2f16c83f1335c5f299d" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>listaEcasIgualEstado<sp/>=<sp/>[]</highlight></codeline>
<codeline lineno="222" refid="namespaceapp_1_1domain_1_1services_1_1personalizacion__service_1aa2767b2af43986712ec841bdd37adef7" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>listaEcasModificarEstado<sp/>=<sp/>[]</highlight></codeline>
<codeline lineno="223" refid="namespaceapp_1_1domain_1_1services_1_1personalizacion__service_1a2ab48e5c318af295d5a8a4241fd5e2d7" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>listaEcasCrear<sp/>=<sp/>[]</highlight></codeline>
<codeline lineno="224" refid="namespaceapp_1_1domain_1_1services_1_1personalizacion__service_1aa3607d6ec3524b21192452bfeb5cb229" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>posicionesEcasEncontrados<sp/>=<sp/>[]</highlight></codeline>
<codeline lineno="225"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>item<sp/></highlight><highlight class="keywordflow">in</highlight><highlight class="normal"><sp/>self.ecasUsuario:</highlight></codeline>
<codeline lineno="226" refid="namespaceapp_1_1domain_1_1services_1_1personalizacion__service_1abfe38c85f4926f744caa654aac5cdb3f" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>posicion<sp/>=<sp/>self.posicionValor(ecasArchivo,<sp/></highlight><highlight class="stringliteral">&quot;name_eca&quot;</highlight><highlight class="normal">,<sp/>item[</highlight><highlight class="stringliteral">&quot;name_eca&quot;</highlight><highlight class="normal">])</highlight></codeline>
<codeline lineno="227"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/><sp/>posicion<sp/>!=<sp/>-1:<sp/></highlight><highlight class="comment">##Si<sp/>el<sp/>eca<sp/>del<sp/>archivo<sp/>esta<sp/>en<sp/>los<sp/>del<sp/>usuario,<sp/>hay<sp/>que<sp/>activarlo<sp/>osea<sp/>ecaArchivo<sp/>en<sp/>listaEcasUsuario</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="228" refid="namespaceapp_1_1domain_1_1services_1_1personalizacion__service_1aab64c7d2ba574c0c574c5babf009b8fa" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>itemEcaArchivo<sp/>=<sp/>ecasArchivo[posicion]<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="229"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>logger.info(item)<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="230"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>logger.info(itemEcaArchivo)</highlight></codeline>
<codeline lineno="231"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>itemEcaArchivo[</highlight><highlight class="stringliteral">&quot;state_eca&quot;</highlight><highlight class="normal">]<sp/>==<sp/>item[</highlight><highlight class="stringliteral">&apos;state_eca&apos;</highlight><highlight class="normal">]:</highlight></codeline>
<codeline lineno="232"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>listaEcasIgualEstado.append(item)</highlight></codeline>
<codeline lineno="233"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="234"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>listaEcasModificarEstado.append(item)</highlight></codeline>
<codeline lineno="235"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>posicionesEcasEncontrados.append(posicion)</highlight></codeline>
<codeline lineno="236"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal">:<sp/></highlight><highlight class="comment">##Esta<sp/>en<sp/>los<sp/>ecas<sp/>del<sp/>usuario,<sp/>pero<sp/>no<sp/>el<sp/>el<sp/>archivo</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="237"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>listaEcasCrear.append(item)</highlight></codeline>
<codeline lineno="238" refid="namespaceapp_1_1domain_1_1services_1_1personalizacion__service_1a32faaee5948602a5cc428e672b60401e" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>i<sp/>=<sp/>0</highlight></codeline>
<codeline lineno="239"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>item<sp/></highlight><highlight class="keywordflow">in</highlight><highlight class="normal"><sp/>ecasArchivo:</highlight></codeline>
<codeline lineno="240"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">not</highlight><highlight class="normal"><sp/>i<sp/></highlight><highlight class="keywordflow">in</highlight><highlight class="normal"><sp/>posicionesEcasEncontrados:</highlight></codeline>
<codeline lineno="241"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>listaEcasEliminar.append(ecasArchivo[i])</highlight></codeline>
<codeline lineno="242"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>i<sp/>=<sp/>i<sp/>+<sp/>1</highlight></codeline>
<codeline lineno="243"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="244"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>logger.info(</highlight><highlight class="stringliteral">&quot;Desde<sp/>modulo<sp/>de<sp/>personalizacion<sp/>ECAS<sp/>A<sp/>CREAR&quot;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="245"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>iten<sp/></highlight><highlight class="keywordflow">in</highlight><highlight class="normal"><sp/>listaEcasCrear:</highlight></codeline>
<codeline lineno="246"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>logger.info(iten[</highlight><highlight class="stringliteral">&apos;name_eca&apos;</highlight><highlight class="normal">])<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="247"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>logger.info(</highlight><highlight class="stringliteral">&quot;Desde<sp/>modulo<sp/>de<sp/>personalizacion<sp/>lista<sp/>ECAS<sp/>A<sp/>MODIFICAR<sp/>&quot;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="248"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>iten<sp/></highlight><highlight class="keywordflow">in</highlight><highlight class="normal"><sp/>listaEcasModificarEstado:</highlight></codeline>
<codeline lineno="249"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>logger.info(iten[</highlight><highlight class="stringliteral">&apos;name_eca&apos;</highlight><highlight class="normal">])<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="250"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>logger.info(</highlight><highlight class="stringliteral">&quot;Desde<sp/>modulo<sp/>de<sp/>personalizacion<sp/>lista<sp/>ECAS<sp/>A<sp/>ELIMINAR<sp/>&quot;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="251"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>iten<sp/></highlight><highlight class="keywordflow">in</highlight><highlight class="normal"><sp/>listaEcasEliminar:</highlight></codeline>
<codeline lineno="252"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>logger.info(iten[</highlight><highlight class="stringliteral">&apos;name_eca&apos;</highlight><highlight class="normal">])<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="253"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>logger.info(</highlight><highlight class="stringliteral">&quot;Desde<sp/>modulo<sp/>de<sp/>personalizacion<sp/>lista<sp/>ECAS<sp/>A<sp/>LANZAR&quot;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="254"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>iten<sp/></highlight><highlight class="keywordflow">in</highlight><highlight class="normal"><sp/>listaEcasIgualEstado:</highlight></codeline>
<codeline lineno="255"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>logger.info(iten[</highlight><highlight class="stringliteral">&apos;name_eca&apos;</highlight><highlight class="normal">])<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="256" refid="namespaceapp_1_1domain_1_1services_1_1personalizacion__service_1aba9d199425dd41013b56d9ed599066b4" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>hiloCrearEcas<sp/>=<sp/>threading.Thread(target<sp/>=<sp/>self.crearEcas,<sp/>name=</highlight><highlight class="stringliteral">&quot;HiloCrearEcas&quot;</highlight><highlight class="normal">,<sp/>args<sp/>=(listaEcasCrear,))</highlight></codeline>
<codeline lineno="257" refid="namespaceapp_1_1domain_1_1services_1_1personalizacion__service_1a4803b2c84d7fae4e8c9dffc490c2cf04" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>hiloinicializarEcasUsuario<sp/>=<sp/>threading.Thread(target<sp/>=<sp/>self.inicializarEcasUsuario,<sp/>name=</highlight><highlight class="stringliteral">&quot;HiloInicializarEcasUsuario&quot;</highlight><highlight class="normal">,<sp/>args<sp/>=(listaEcasIgualEstado,))</highlight></codeline>
<codeline lineno="258" refid="namespaceapp_1_1domain_1_1services_1_1personalizacion__service_1a0fa43818061d24da9623f8a6b9607323" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>hiloEliminarEcasUsurio<sp/>=<sp/>threading.Thread(target<sp/>=<sp/>self.eliminarEcas,<sp/>name=</highlight><highlight class="stringliteral">&quot;HiloEliminarEcasUsurio&quot;</highlight><highlight class="normal">,<sp/>args<sp/>=(listaEcasEliminar,))</highlight></codeline>
<codeline lineno="259"><highlight class="normal"></highlight><highlight class="comment">##</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="260"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>hiloCrearEcas.start()</highlight></codeline>
<codeline lineno="261"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>hiloinicializarEcasUsuario.start()</highlight></codeline>
<codeline lineno="262"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>hiloEliminarEcasUsurio.start()</highlight></codeline>
<codeline lineno="263"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">##Sobreescribo<sp/>el<sp/>archivo<sp/>para<sp/>que<sp/>solo<sp/>tenga<sp/>los<sp/>ecas<sp/>de<sp/>la<sp/>ontologia<sp/>del<sp/>usuario</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="264" refid="namespaceapp_1_1domain_1_1services_1_1personalizacion__service_1ad3d616e046a3a742a036cddfee1c692b" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>archivo=open(self.pathEcasUsuario,</highlight><highlight class="stringliteral">&apos;w+&apos;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="265" refid="namespaceapp_1_1domain_1_1services_1_1personalizacion__service_1ac0a5917d5a2b11da3b4b6639a71d7452" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>listaEcasArchivo<sp/>=<sp/>listaEcasCrear<sp/>+<sp/>listaEcasModificarEstado<sp/>+<sp/>listaEcasIgualEstado</highlight></codeline>
<codeline lineno="266"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>item<sp/></highlight><highlight class="keywordflow">in</highlight><highlight class="normal"><sp/>listaEcasArchivo<sp/>:</highlight></codeline>
<codeline lineno="267" refid="namespaceapp_1_1domain_1_1services_1_1personalizacion__service_1a8596c2ac7722136bba938e77f5f6d15d" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>linea<sp/>=<sp/>item[</highlight><highlight class="stringliteral">&quot;name_eca&quot;</highlight><highlight class="normal">]<sp/>+<sp/></highlight><highlight class="stringliteral">&quot;,&quot;</highlight><highlight class="normal"><sp/>+<sp/>item[</highlight><highlight class="stringliteral">&quot;state_eca&quot;</highlight><highlight class="normal">]<sp/>+<sp/></highlight><highlight class="stringliteral">&quot;\n&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="268"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>archivo.write(linea)</highlight></codeline>
<codeline lineno="269"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>archivo.close()</highlight></codeline>
<codeline lineno="270"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="271" refid="namespaceapp_1_1domain_1_1services_1_1personalizacion__service_1ac9bfbc073df7194be1288e9848e78270" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal"><ref refid="namespaceapp_1_1domain_1_1services_1_1personalizacion__service_1ac9bfbc073df7194be1288e9848e78270" kindref="member">desactivarEcasUsuarioActual</ref>(self)-&gt;JSONResponse:</highlight></codeline>
<codeline lineno="272"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">##Cada<sp/>Usuario<sp/>va<sp/>a<sp/>tener<sp/>un<sp/>archivo<sp/>email.txt<sp/>donde<sp/>se<sp/>almacena<sp/>el<sp/>nombre<sp/>del<sp/>ECA<sp/>y<sp/>su<sp/>estado.<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="273" refid="namespaceapp_1_1domain_1_1services_1_1personalizacion__service_1a049e403b3570389ff53d2cda29716360" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.user_eca<sp/>=<sp/>ontology_service.consultar_email_usuario()</highlight></codeline>
<codeline lineno="274"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>self.user_eca<sp/>==<sp/></highlight><highlight class="stringliteral">&quot;&quot;</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="275"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>logger.error(</highlight><highlight class="stringliteral">&quot;El<sp/>usuario<sp/>no<sp/>existe<sp/>en<sp/>la<sp/>ontologia<sp/>PU&quot;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="276"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="classstarlette_1_1responses_1_1_j_s_o_n_response" kindref="compound">JSONResponse</ref>(content={</highlight><highlight class="stringliteral">&quot;error&quot;</highlight><highlight class="normal">:<sp/></highlight><highlight class="stringliteral">&quot;No<sp/>se<sp/>pudo<sp/>consultar<sp/>el<sp/>email<sp/>del<sp/>usuario&quot;</highlight><highlight class="normal">},<sp/>status_code=500)</highlight></codeline>
<codeline lineno="277" refid="namespaceapp_1_1domain_1_1services_1_1personalizacion__service_1ab1961a46631ed1a1bbf3210d147cf507" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.pathEcasUsuario<sp/>=<sp/>self.path<sp/>+<sp/>self.user_eca<sp/>+</highlight><highlight class="stringliteral">&quot;.txt&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="278"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/><sp/>os.path.exists(self.pathEcasUsuario):</highlight></codeline>
<codeline lineno="279"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#ecasArchivo<sp/>=<sp/>self.ecasArchivoADiccionario()</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="280"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#Apaga<sp/>las<sp/>ecas<sp/>haciendo<sp/>un<sp/>llamado<sp/>al<sp/>micro<sp/>de<sp/>ecas</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="281"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#Suponemos<sp/>que<sp/>las<sp/>ecas<sp/>contenidas<sp/>en<sp/>el<sp/>archivo<sp/>.txt<sp/>equivalen<sp/>a<sp/>todas<sp/>las<sp/>ecas<sp/>del<sp/>usuario</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="282" refid="namespaceapp_1_1domain_1_1services_1_1personalizacion__service_1ae080dc3cb17cf25bcd6bc09cad492512" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>eca_service.apagar_ecas(self.osid):</highlight></codeline>
<codeline lineno="283"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>logger.info(</highlight><highlight class="stringliteral">&quot;ECAS<sp/>del<sp/>usuario<sp/>&quot;</highlight><highlight class="normal">+<sp/>self.user_eca<sp/>+</highlight><highlight class="stringliteral">&quot;<sp/>apagadas<sp/>correctamente&quot;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="284"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="285"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>logger.error(</highlight><highlight class="stringliteral">&quot;Error<sp/>apagando<sp/>las<sp/>ECAS<sp/>del<sp/>usuario<sp/>&quot;</highlight><highlight class="normal">+<sp/>self.user_eca)</highlight></codeline>
<codeline lineno="286"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="classstarlette_1_1responses_1_1_j_s_o_n_response" kindref="compound">JSONResponse</ref>(content={</highlight><highlight class="stringliteral">&quot;error&quot;</highlight><highlight class="normal">:<sp/></highlight><highlight class="stringliteral">&quot;Error<sp/>apagando<sp/>ECAs<sp/>del<sp/>usuario&quot;</highlight><highlight class="normal">},<sp/>status_code=500)</highlight></codeline>
<codeline lineno="287"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#Elimina<sp/>la<sp/>ontologia<sp/>del<sp/>usuario<sp/>en<sp/>el<sp/>micro<sp/>de<sp/>ontologias</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="288"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>ontology_service.eliminar_ontologia_usuario():</highlight></codeline>
<codeline lineno="289"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>logger.info(</highlight><highlight class="stringliteral">&quot;Ontologia<sp/>del<sp/>usuario<sp/>&quot;</highlight><highlight class="normal">+<sp/>self.user_eca<sp/>+</highlight><highlight class="stringliteral">&quot;<sp/>eliminada<sp/>correctamente&quot;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="290"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="291"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>logger.error(</highlight><highlight class="stringliteral">&quot;Error<sp/>eliminando<sp/>la<sp/>ontologia<sp/>del<sp/>usuario<sp/>&quot;</highlight><highlight class="normal">+<sp/>self.user_eca)</highlight></codeline>
<codeline lineno="292"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="classstarlette_1_1responses_1_1_j_s_o_n_response" kindref="compound">JSONResponse</ref>(content={</highlight><highlight class="stringliteral">&quot;error&quot;</highlight><highlight class="normal">:<sp/></highlight><highlight class="stringliteral">&quot;Error<sp/>eliminando<sp/>ontología<sp/>del<sp/>usuario&quot;</highlight><highlight class="normal">},<sp/>status_code=500)<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="293"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#modulo.setClean()</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="294"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="classstarlette_1_1responses_1_1_j_s_o_n_response" kindref="compound">JSONResponse</ref>(content={</highlight><highlight class="stringliteral">&quot;message&quot;</highlight><highlight class="normal">:<sp/></highlight><highlight class="stringliteral">&quot;Salida<sp/>de<sp/>usuario<sp/>procesada<sp/>exitosamente&quot;</highlight><highlight class="normal">},<sp/>status_code=200)</highlight></codeline>
<codeline lineno="295" refid="namespaceapp_1_1domain_1_1services_1_1personalizacion__service_1a7b805be6ce48f5c6a79d7d23b51097fe" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal"><ref refid="namespaceapp_1_1domain_1_1services_1_1personalizacion__service_1a7b805be6ce48f5c6a79d7d23b51097fe" kindref="member">crearEcas</ref>(self,<sp/>listaEcasCrear):</highlight></codeline>
<codeline lineno="296"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#Retorna<sp/>todos<sp/>los<sp/>datos<sp/>del<sp/>eca</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="297"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#?name_activity<sp/>?start_date_activity<sp/>?end_date_activity</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="298"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">##Se<sp/>deben<sp/>consultar<sp/>los<sp/>ecas<sp/>del<sp/>objeto<sp/>para<sp/>encender<sp/>los<sp/>que<sp/>son<sp/>del<sp/>usuario<sp/>y<sp/>apagar<sp/>lo0s<sp/>demas</highlight></codeline>
<codeline lineno="299"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>##Si<sp/>un<sp/>eca<sp/>no<sp/>existe,<sp/>debe<sp/>crearlo</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="300"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>print(<sp/></highlight><highlight class="stringliteral">&quot;<sp/><sp/><sp/>Creando<sp/>ECAs<sp/>Desde<sp/>el<sp/>Modulo<sp/>de<sp/>Personalizacion.&quot;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="301"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>print(<sp/></highlight><highlight class="stringliteral">&quot;Creando<sp/>un<sp/>total<sp/>de<sp/>&quot;</highlight><highlight class="normal"><sp/>+<sp/>str(len(listaEcasCrear))<sp/>+<sp/></highlight><highlight class="stringliteral">&quot;<sp/>ECAs&quot;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="302"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">##Lanza<sp/>todos<sp/>los<sp/>ecas<sp/>que<sp/>esten<sp/>en<sp/>ON</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="303"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>item<sp/></highlight><highlight class="keywordflow">in</highlight><highlight class="normal"><sp/>listaEcasCrear:</highlight></codeline>
<codeline lineno="304"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>print(<sp/></highlight><highlight class="stringliteral">&quot;Creando<sp/>Eca<sp/>&quot;</highlight><highlight class="normal"><sp/>+<sp/>item[</highlight><highlight class="stringliteral">&quot;name_activity&quot;</highlight><highlight class="normal">])</highlight></codeline>
<codeline lineno="305"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>print(<sp/></highlight><highlight class="stringliteral">&quot;&quot;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="306"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>item[</highlight><highlight class="stringliteral">&apos;user_eca&apos;</highlight><highlight class="normal">]<sp/>=<sp/>self.user_eca</highlight></codeline>
<codeline lineno="307"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>item[</highlight><highlight class="stringliteral">&quot;name_activity&quot;</highlight><highlight class="normal">]<sp/>!=<sp/></highlight><highlight class="stringliteral">&quot;&quot;</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="308"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>item[</highlight><highlight class="stringliteral">&quot;variable_condition&quot;</highlight><highlight class="normal">]<sp/>==<sp/></highlight><highlight class="stringliteral">&quot;1&quot;</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="309"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>item[</highlight><highlight class="stringliteral">&quot;variable_condition&quot;</highlight><highlight class="normal">]<sp/>=<sp/>item[</highlight><highlight class="stringliteral">&quot;start_date_activity&quot;</highlight><highlight class="normal">]</highlight></codeline>
<codeline lineno="310"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">elif</highlight><highlight class="normal"><sp/>item[</highlight><highlight class="stringliteral">&quot;variable_condition&quot;</highlight><highlight class="normal">]<sp/>==<sp/></highlight><highlight class="stringliteral">&quot;0&quot;</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="311"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>item[</highlight><highlight class="stringliteral">&quot;variable_condition&quot;</highlight><highlight class="normal">]<sp/>=<sp/>item[</highlight><highlight class="stringliteral">&quot;end_date_activity&quot;</highlight><highlight class="normal">]</highlight></codeline>
<codeline lineno="312"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="313"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">print</highlight><highlight class="normal"><sp/>(</highlight><highlight class="stringliteral">&quot;Desde<sp/>Personalizar,<sp/>el<sp/>eca<sp/>tiene<sp/>actividad,<sp/>pero<sp/>la<sp/>variable<sp/>condicion<sp/>no<sp/>es<sp/>0<sp/>ni<sp/>1:<sp/>&quot;</highlight><highlight class="normal">+<sp/>item[</highlight><highlight class="stringliteral">&apos;name_eca&apos;</highlight><highlight class="normal">])</highlight></codeline>
<codeline lineno="314"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.Log.PubUserLog(<sp/>self.user_eca<sp/>,self.osid<sp/>,<sp/></highlight><highlight class="stringliteral">&quot;ModuloDePersonalizacion&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;inicia<sp/>poblar<sp/>ecas<sp/>cantidad<sp/>&quot;</highlight><highlight class="normal">+str(len(listaEcasCrear)))</highlight></codeline>
<codeline lineno="315"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.eca.poblarListaEca(listaEcasCrear)</highlight></codeline>
<codeline lineno="316"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.Log.PubUserLog(<sp/>self.user_eca<sp/>,self.osid<sp/>,<sp/></highlight><highlight class="stringliteral">&quot;ModuloDePersonalizacion&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;fin<sp/>poblar<sp/>ecas<sp/>cantidad<sp/>&quot;</highlight><highlight class="normal">+str(len(listaEcasCrear)))</highlight></codeline>
<codeline lineno="317"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>print(<sp/></highlight><highlight class="stringliteral">&quot;ECAS<sp/>Creados<sp/>Desde<sp/>el<sp/>Modulo<sp/>de<sp/>Personalizacion&quot;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="318"><highlight class="normal"></highlight></codeline>
<codeline lineno="319" refid="namespaceapp_1_1domain_1_1services_1_1personalizacion__service_1aae7e5d20a9f355076b8d5f9903e06751" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal"><ref refid="namespaceapp_1_1domain_1_1services_1_1personalizacion__service_1aae7e5d20a9f355076b8d5f9903e06751" kindref="member">inicializarEcasUsuario</ref>(self,<sp/>listaEcasActivar):</highlight></codeline>
<codeline lineno="320"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>print(<sp/></highlight><highlight class="stringliteral">&quot;Inicializando<sp/>un<sp/>total<sp/>de<sp/>&quot;</highlight><highlight class="normal"><sp/>+<sp/>str(len(listaEcasActivar))<sp/>+<sp/></highlight><highlight class="stringliteral">&quot;<sp/>ECAs&quot;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="321"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.Log.PubUserLog(<sp/>self.user_eca<sp/>,self.osid<sp/>,<sp/></highlight><highlight class="stringliteral">&quot;ModuloDePersonalizacion&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;inicia<sp/>inicializando<sp/>ecas<sp/>cantidad<sp/>&quot;</highlight><highlight class="normal">+str(len(listaEcasActivar)))</highlight></codeline>
<codeline lineno="322"><highlight class="normal"></highlight></codeline>
<codeline lineno="323"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.eca.lanzarHiloListaEca(listaEcasActivar)</highlight></codeline>
<codeline lineno="324"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>print(<sp/></highlight><highlight class="stringliteral">&quot;ECAS<sp/>iniciados<sp/>Desde<sp/>el<sp/>Modulo<sp/>de<sp/>Personalizacion&quot;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="325"><highlight class="normal"></highlight></codeline>
<codeline lineno="326"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;&quot;&quot;def<sp/>modificarEstadoEcasUsuario(self,<sp/>listaEcasModificar):</highlight></codeline>
<codeline lineno="327"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>print(<sp/>&quot;Modificando<sp/>estado<sp/>de<sp/><sp/>un<sp/>total<sp/>de<sp/>&quot;<sp/>+<sp/>str(len(listaEcasModificar))<sp/>+<sp/>&quot;<sp/>ECAs&quot;)</highlight></codeline>
<codeline lineno="328"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.Log.PubUserLog(<sp/>self.user_eca<sp/>,self.osid<sp/>,<sp/>&quot;ModuloDePersonalizacion&quot;,<sp/>&quot;inicia<sp/>modificar<sp/>estado<sp/>ecas<sp/>cantidad<sp/>&quot;+str(len(listaEcasModificar)))</highlight></codeline>
<codeline lineno="329"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.eca.cambiarEstadoListaEcas(listaEcasModificar)</highlight></codeline>
<codeline lineno="330"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>print(<sp/>&quot;ECAS<sp/>con<sp/>estado<sp/>modificado<sp/>Desde<sp/>el<sp/>Modulo<sp/>de<sp/>Personalizacion&quot;)&quot;&quot;&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="331"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#Modificar<sp/>para<sp/>que<sp/>elimine<sp/>ecas<sp/>en<sp/>el<sp/>micro<sp/>de<sp/>ecas</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="332" refid="namespaceapp_1_1domain_1_1services_1_1personalizacion__service_1a2527f6f145c877b6a607575dd6f0efc8" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal"><ref refid="namespaceapp_1_1domain_1_1services_1_1personalizacion__service_1a2527f6f145c877b6a607575dd6f0efc8" kindref="member">eliminarEcas</ref>(self,<sp/>listaEcasEliminar):</highlight></codeline>
<codeline lineno="333"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>print(<sp/></highlight><highlight class="stringliteral">&quot;Eliminando<sp/>estado<sp/>de<sp/><sp/>un<sp/>total<sp/>de<sp/>&quot;</highlight><highlight class="normal"><sp/>+<sp/>str(len(listaEcasEliminar))<sp/>+<sp/></highlight><highlight class="stringliteral">&quot;<sp/>ECAs&quot;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="334"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.eca.eliminarListaEcas(listaEcasEliminar)</highlight></codeline>
<codeline lineno="335"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>print(<sp/></highlight><highlight class="stringliteral">&quot;ECAS<sp/>ELIMINADOS<sp/>Desde<sp/>el<sp/>Modulo<sp/>de<sp/>Personalizacion&quot;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="336"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="337" refid="namespaceapp_1_1domain_1_1services_1_1personalizacion__service_1a9c882b9e65c59f73c377ed5da559fa31" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal"><ref refid="namespaceapp_1_1domain_1_1services_1_1personalizacion__service_1a9c882b9e65c59f73c377ed5da559fa31" kindref="member">verificarUsuario</ref>(self,<sp/>email):</highlight></codeline>
<codeline lineno="338"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#Convertir<sp/>a<sp/>consulta<sp/>de<sp/>ontologia<sp/>de<sp/>perfil<sp/>de<sp/>usuario<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="339"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/><sp/>ontology_service.consultar_email_usuario()<sp/>==<sp/>email:</highlight></codeline>
<codeline lineno="340"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">True</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="341"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="342"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">False</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="343"><highlight class="normal"></highlight></codeline>
<codeline lineno="344"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;&quot;&quot;def<sp/>eliminarEcaUsuario(self,<sp/>listaEcasUsuario,<sp/>clave,<sp/>valor):</highlight></codeline>
<codeline lineno="345"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>for<sp/>item<sp/>in<sp/>listaEcasUsuario:</highlight></codeline>
<codeline lineno="346"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>if<sp/>item[clave]<sp/>==<sp/>valor:</highlight></codeline>
<codeline lineno="347"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>listaEcasUsuario.remove(item)</highlight></codeline>
<codeline lineno="348"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>return<sp/>listaEcasUsuario</highlight></codeline>
<codeline lineno="349"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>return<sp/>listaEcasUsuario&quot;&quot;&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="350"><highlight class="normal"></highlight></codeline>
<codeline lineno="351"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;&quot;&quot;def<sp/>estaValor(self,<sp/>listaDic,<sp/>clave,<sp/>valor):</highlight></codeline>
<codeline lineno="352"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>for<sp/>item<sp/>in<sp/>listaDic:</highlight></codeline>
<codeline lineno="353"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>if<sp/>item[clave]<sp/>==<sp/>valor:</highlight></codeline>
<codeline lineno="354"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>return<sp/>True</highlight></codeline>
<codeline lineno="355"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>return<sp/>False&quot;&quot;&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="356"><highlight class="normal"></highlight></codeline>
<codeline lineno="357" refid="namespaceapp_1_1domain_1_1services_1_1personalizacion__service_1a1fa87e44ae034f58574c2b7123f7cd95" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal"><ref refid="namespaceapp_1_1domain_1_1services_1_1personalizacion__service_1a1fa87e44ae034f58574c2b7123f7cd95" kindref="member">posicionValor</ref>(self,<sp/>listaDic,<sp/>clave,<sp/>valor):</highlight></codeline>
<codeline lineno="358"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>i<sp/>=<sp/>0</highlight></codeline>
<codeline lineno="359"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>item<sp/></highlight><highlight class="keywordflow">in</highlight><highlight class="normal"><sp/>listaDic:</highlight></codeline>
<codeline lineno="360"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>item[clave]<sp/>==<sp/>valor:</highlight></codeline>
<codeline lineno="361"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>i</highlight></codeline>
<codeline lineno="362"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>i<sp/>=<sp/>i<sp/>+<sp/>1</highlight></codeline>
<codeline lineno="363"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>-1</highlight></codeline>
<codeline lineno="364"><highlight class="normal"></highlight></codeline>
<codeline lineno="365"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;&quot;&quot;</highlight></codeline>
<codeline lineno="366"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>def<sp/>guardarEcasArchivo(self,<sp/>rutaArchivo,<sp/>listaEcas):</highlight></codeline>
<codeline lineno="367"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>archivo<sp/>=<sp/>open(rutaArchivo,<sp/><sp/>&apos;r+&apos;)</highlight></codeline>
<codeline lineno="368"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>for<sp/>item<sp/>in<sp/>listaEcas:</highlight></codeline>
<codeline lineno="369"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>linea<sp/>=<sp/>item[&quot;name_eca&quot;]<sp/>+<sp/>&quot;,&quot;<sp/>+<sp/>item[&quot;state_eca&quot;]</highlight></codeline>
<codeline lineno="370"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&quot;&quot;&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="371"><highlight class="normal"></highlight></codeline>
<codeline lineno="372" refid="namespaceapp_1_1domain_1_1services_1_1personalizacion__service_1ae4e2a7716d0b54ac26d2d56018214226" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal"><ref refid="namespaceapp_1_1domain_1_1services_1_1personalizacion__service_1ae4e2a7716d0b54ac26d2d56018214226" kindref="member">ecasArchivoADiccionario</ref>(self):</highlight></codeline>
<codeline lineno="373"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>rutaArchivo<sp/>=<sp/>self.pathEcasUsuario</highlight></codeline>
<codeline lineno="374"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>archivo<sp/>=<sp/>open(rutaArchivo,<sp/><sp/></highlight><highlight class="stringliteral">&apos;r+&apos;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="375"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>lineas<sp/>=<sp/>archivo.readlines()</highlight></codeline>
<codeline lineno="376"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>archivo.close()</highlight></codeline>
<codeline lineno="377"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ecasArchivo<sp/>=<sp/>[]</highlight></codeline>
<codeline lineno="378"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#TODO<sp/>Cambiar<sp/>el<sp/>archivo</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="379"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>linea<sp/></highlight><highlight class="keywordflow">in</highlight><highlight class="normal"><sp/>lineas:</highlight></codeline>
<codeline lineno="380"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>linea<sp/>=<sp/>linea.rstrip(</highlight><highlight class="stringliteral">&apos;\n&apos;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="381"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>split<sp/>=<sp/>linea.split(</highlight><highlight class="stringliteral">&quot;,&quot;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="382"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>nombreEca<sp/>=<sp/>split[0]</highlight></codeline>
<codeline lineno="383"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>estadoEca<sp/>=<sp/>split[1]</highlight></codeline>
<codeline lineno="384"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>dicEca<sp/>=<sp/>{</highlight><highlight class="stringliteral">&quot;name_eca&quot;</highlight><highlight class="normal">:<sp/>nombreEca,<sp/></highlight><highlight class="stringliteral">&quot;state_eca&quot;</highlight><highlight class="normal"><sp/>:<sp/>estadoEca}</highlight></codeline>
<codeline lineno="385"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ecasArchivo.append(dicEca)</highlight></codeline>
<codeline lineno="386"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>ecasArchivo</highlight></codeline>
<codeline lineno="387"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="388" refid="namespaceapp_1_1domain_1_1services_1_1personalizacion__service_1a30bb0c913de5516d6fcc3600afca1ce9" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal"><ref refid="namespaceapp_1_1domain_1_1services_1_1personalizacion__service_1a30bb0c913de5516d6fcc3600afca1ce9" kindref="member">registroInteraccionUsuarioObjeto</ref>(self,data:RegistroInteraccionDTO)-&gt;JSONResponse:</highlight></codeline>
<codeline lineno="389"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;&quot;&quot;if<sp/>os.path.exists(AppUtil.pathOWL<sp/>+<sp/>mac<sp/>+<sp/><sp/>&quot;.owl&quot;):</highlight></codeline>
<codeline lineno="390"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>poblador<sp/>=<sp/>PoblarPerfilUsuario(mac,<sp/>email,<sp/>&quot;CARGAR&quot;)</highlight></codeline>
<codeline lineno="391"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>poblador.registroInteraccionUsuarioObjeto(<sp/>email,<sp/>idDataStream,<sp/>comando,<sp/>osid,<sp/>dateInteraction)&quot;&quot;&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="392"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#Si<sp/>la<sp/>ontologia<sp/>existe,<sp/>se<sp/>registra<sp/>la<sp/>interaccion<sp/>en<sp/>el<sp/>micro<sp/>de<sp/>ontologias</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="393"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>ontology_service.verificar_perfil_activo():</highlight></codeline>
<codeline lineno="394"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>ontology_service.registrar_interaccion(data):</highlight></codeline>
<codeline lineno="395"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="classstarlette_1_1responses_1_1_j_s_o_n_response" kindref="compound">JSONResponse</ref>(content={</highlight><highlight class="stringliteral">&quot;message&quot;</highlight><highlight class="normal">:<sp/></highlight><highlight class="stringliteral">&quot;Interacción<sp/>registrada<sp/>exitosamente<sp/>en<sp/>el<sp/>microservicio<sp/>de<sp/>ontologías&quot;</highlight><highlight class="normal">},<sp/>status_code=200)</highlight></codeline>
<codeline lineno="396"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="397"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="classstarlette_1_1responses_1_1_j_s_o_n_response" kindref="compound">JSONResponse</ref>(content={</highlight><highlight class="stringliteral">&quot;error&quot;</highlight><highlight class="normal">:<sp/></highlight><highlight class="stringliteral">&quot;Error<sp/>registrando<sp/>la<sp/>interacción<sp/>en<sp/>el<sp/>microservicio<sp/>de<sp/>ontologías&quot;</highlight><highlight class="normal">},<sp/>status_code=500)</highlight></codeline>
<codeline lineno="398"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="399"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>logger.info(</highlight><highlight class="stringliteral">&quot;El<sp/>usuario<sp/>no<sp/>esta<sp/>en<sp/>la<sp/>casa,<sp/>notificando<sp/>al<sp/>servidor<sp/>de<sp/>perfil<sp/>usuario&quot;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="400"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#EL<sp/>usuario<sp/>no<sp/>esta<sp/>en<sp/>la<sp/>casa<sp/>actualmente,<sp/>por<sp/>eso<sp/>se<sp/>envia<sp/>la<sp/>peticion<sp/>al<sp/>servidor<sp/>perfil<sp/>de<sp/>usuario<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="401"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.conexion_pu.enviarRegistroInteraccionUsuarioObjetoAlServidorPerfilUsuario(data.email,data.idDataStream,<sp/>data.comando,data.osid,<sp/>data.mac,<sp/><sp/>data.dateInteraction)</highlight></codeline>
<codeline lineno="402"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="classstarlette_1_1responses_1_1_j_s_o_n_response" kindref="compound">JSONResponse</ref>(content={</highlight><highlight class="stringliteral">&quot;message&quot;</highlight><highlight class="normal">:<sp/></highlight><highlight class="stringliteral">&quot;La<sp/>interacción<sp/>fue<sp/>registrada<sp/>en<sp/>el<sp/>servidor<sp/>de<sp/>perfil<sp/>de<sp/>usuario&quot;</highlight><highlight class="normal">},<sp/>status_code=200)<sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="403"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;&quot;&quot;</highlight></codeline>
<codeline lineno="404"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>def<sp/>enviarRegistroInteraccionUsuarioObjetoAlCoordinador(self,<sp/>email,idDataStream,comando,<sp/>osid,<sp/>mac,<sp/>dateInteraction):</highlight></codeline>
<codeline lineno="405"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>conexion<sp/>=<sp/>ConexionPu()</highlight></codeline>
<codeline lineno="406"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>conexion.enviarRegistroInteraccionUsuarioObjetoAlCoordinador(email,<sp/>idDataStream,comando,<sp/>osid,<sp/>mac,<sp/>dateInteraction)</highlight></codeline>
<codeline lineno="407"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&quot;&quot;&quot;</highlight><highlight class="normal"></highlight></codeline>
    </programlisting>
    <location file="microservicio_personalizacion/app/domain/services/personalizacion_service.py"/>
  </compounddef>
</doxygen>
