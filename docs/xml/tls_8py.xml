<?xml version='1.0' encoding='UTF-8' standalone='no'?>
<doxygen xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="compound.xsd" version="1.15.0" xml:lang="es">
  <compounddef id="tls_8py" kind="file" language="Python">
    <compoundname>tls.py</compoundname>
    <innerclass refid="classanyio_1_1streams_1_1tls_1_1_t_l_s_attribute" prot="public">anyio::streams::tls::TLSAttribute</innerclass>
    <innerclass refid="classanyio_1_1streams_1_1tls_1_1_t_l_s_stream" prot="public">anyio::streams::tls::TLSStream</innerclass>
    <innerclass refid="classanyio_1_1streams_1_1tls_1_1_t_l_s_listener" prot="public">anyio::streams::tls::TLSListener</innerclass>
    <innerclass refid="classanyio_1_1streams_1_1tls_1_1_t_l_s_connectable" prot="public">anyio::streams::tls::TLSConnectable</innerclass>
    <innernamespace refid="namespaceanyio">anyio</innernamespace>
    <innernamespace refid="namespaceanyio_1_1streams">anyio::streams</innernamespace>
    <innernamespace refid="namespaceanyio_1_1streams_1_1tls">anyio::streams::tls</innernamespace>
    <briefdescription>
    </briefdescription>
    <detaileddescription>
    </detaileddescription>
    <programlisting>
<codeline lineno="1" refid="namespaceanyio_1_1streams_1_1tls" refkind="compound"><highlight class="keyword">from</highlight><highlight class="normal"><sp/>__future__<sp/></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>annotations</highlight></codeline>
<codeline lineno="2"><highlight class="normal"></highlight></codeline>
<codeline lineno="3"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>logging</highlight></codeline>
<codeline lineno="4"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>re</highlight></codeline>
<codeline lineno="5"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>ssl</highlight></codeline>
<codeline lineno="6"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>sys</highlight></codeline>
<codeline lineno="7"><highlight class="normal"></highlight><highlight class="keyword">from</highlight><highlight class="normal"><sp/><ref refid="namespacecollections_1_1abc" kindref="compound">collections.abc</ref><sp/></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>Callable,<sp/>Mapping</highlight></codeline>
<codeline lineno="8"><highlight class="normal"></highlight><highlight class="keyword">from</highlight><highlight class="normal"><sp/>dataclasses<sp/></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>dataclass</highlight></codeline>
<codeline lineno="9"><highlight class="normal"></highlight><highlight class="keyword">from</highlight><highlight class="normal"><sp/>functools<sp/></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>wraps</highlight></codeline>
<codeline lineno="10"><highlight class="normal"></highlight><highlight class="keyword">from</highlight><highlight class="normal"><sp/>ssl<sp/></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>SSLContext</highlight></codeline>
<codeline lineno="11"><highlight class="normal"></highlight><highlight class="keyword">from</highlight><highlight class="normal"><sp/>typing<sp/></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>Any,<sp/>TypeVar</highlight></codeline>
<codeline lineno="12"><highlight class="normal"></highlight></codeline>
<codeline lineno="13"><highlight class="normal"></highlight><highlight class="keyword">from</highlight><highlight class="normal"><sp/>..<sp/></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>(</highlight></codeline>
<codeline lineno="14"><highlight class="normal"><sp/><sp/><sp/><sp/>BrokenResourceError,</highlight></codeline>
<codeline lineno="15"><highlight class="normal"><sp/><sp/><sp/><sp/>EndOfStream,</highlight></codeline>
<codeline lineno="16"><highlight class="normal"><sp/><sp/><sp/><sp/>aclose_forcefully,</highlight></codeline>
<codeline lineno="17"><highlight class="normal"><sp/><sp/><sp/><sp/>get_cancelled_exc_class,</highlight></codeline>
<codeline lineno="18"><highlight class="normal"><sp/><sp/><sp/><sp/>to_thread,</highlight></codeline>
<codeline lineno="19"><highlight class="normal">)</highlight></codeline>
<codeline lineno="20"><highlight class="normal"></highlight><highlight class="keyword">from</highlight><highlight class="normal"><sp/>.._core._typedattr<sp/></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>TypedAttributeSet,<sp/>typed_attribute</highlight></codeline>
<codeline lineno="21"><highlight class="normal"></highlight><highlight class="keyword">from</highlight><highlight class="normal"><sp/>..abc<sp/></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>(</highlight></codeline>
<codeline lineno="22"><highlight class="normal"><sp/><sp/><sp/><sp/>AnyByteStream,</highlight></codeline>
<codeline lineno="23"><highlight class="normal"><sp/><sp/><sp/><sp/>AnyByteStreamConnectable,</highlight></codeline>
<codeline lineno="24"><highlight class="normal"><sp/><sp/><sp/><sp/>ByteStream,</highlight></codeline>
<codeline lineno="25"><highlight class="normal"><sp/><sp/><sp/><sp/>ByteStreamConnectable,</highlight></codeline>
<codeline lineno="26"><highlight class="normal"><sp/><sp/><sp/><sp/>Listener,</highlight></codeline>
<codeline lineno="27"><highlight class="normal"><sp/><sp/><sp/><sp/>TaskGroup,</highlight></codeline>
<codeline lineno="28"><highlight class="normal">)</highlight></codeline>
<codeline lineno="29"><highlight class="normal"></highlight></codeline>
<codeline lineno="30"><highlight class="normal"></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>sys.version_info<sp/>&gt;=<sp/>(3,<sp/>10):</highlight></codeline>
<codeline lineno="31"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">from</highlight><highlight class="normal"><sp/>typing<sp/></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>TypeAlias</highlight></codeline>
<codeline lineno="32"><highlight class="normal"></highlight><highlight class="keywordflow">else</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="33"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">from</highlight><highlight class="normal"><sp/>typing_extensions<sp/></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>TypeAlias</highlight></codeline>
<codeline lineno="34"><highlight class="normal"></highlight></codeline>
<codeline lineno="35"><highlight class="normal"></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>sys.version_info<sp/>&gt;=<sp/>(3,<sp/>11):</highlight></codeline>
<codeline lineno="36"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">from</highlight><highlight class="normal"><sp/>typing<sp/></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>TypeVarTuple,<sp/>Unpack</highlight></codeline>
<codeline lineno="37"><highlight class="normal"></highlight><highlight class="keywordflow">else</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="38"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">from</highlight><highlight class="normal"><sp/>typing_extensions<sp/></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>TypeVarTuple,<sp/>Unpack</highlight></codeline>
<codeline lineno="39"><highlight class="normal"></highlight></codeline>
<codeline lineno="40"><highlight class="normal"></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>sys.version_info<sp/>&gt;=<sp/>(3,<sp/>12):</highlight></codeline>
<codeline lineno="41"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">from</highlight><highlight class="normal"><sp/>typing<sp/></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>override</highlight></codeline>
<codeline lineno="42"><highlight class="normal"></highlight><highlight class="keywordflow">else</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="43"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">from</highlight><highlight class="normal"><sp/>typing_extensions<sp/></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>override</highlight></codeline>
<codeline lineno="44"><highlight class="normal"></highlight></codeline>
<codeline lineno="45" refid="namespaceanyio_1_1streams_1_1tls_1a24f77bd3b9457a34b4d94e68d4491138" refkind="member"><highlight class="normal">T_Retval<sp/>=<sp/>TypeVar(</highlight><highlight class="stringliteral">&quot;T_Retval&quot;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="46" refid="namespaceanyio_1_1streams_1_1tls_1ae2568a32cd22438716e14537c369b9fa" refkind="member"><highlight class="normal">PosArgsT<sp/>=<sp/><ref refid="classtyping__extensions_1_1_type_var_tuple" kindref="compound">TypeVarTuple</ref>(</highlight><highlight class="stringliteral">&quot;PosArgsT&quot;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="47" refid="namespaceanyio_1_1streams_1_1tls_1af47f3686272a78270a79edff4201fb6c" refkind="member"><highlight class="normal">_PCTRTT:<sp/>TypeAlias<sp/>=<sp/>tuple[tuple[str,<sp/>str],<sp/>...]</highlight></codeline>
<codeline lineno="48" refid="namespaceanyio_1_1streams_1_1tls_1ab07774b6f414d43e07c35b9fdcbdd11a" refkind="member"><highlight class="normal">_PCTRTTT:<sp/>TypeAlias<sp/>=<sp/>tuple[_PCTRTT,<sp/>...]</highlight></codeline>
<codeline lineno="49"><highlight class="normal"></highlight></codeline>
<codeline lineno="50"><highlight class="normal"></highlight></codeline>
<codeline lineno="51" refid="classanyio_1_1streams_1_1tls_1_1_t_l_s_attribute" refkind="compound"><highlight class="normal"></highlight><highlight class="keyword">class<sp/></highlight><highlight class="normal"><ref refid="classanyio_1_1streams_1_1tls_1_1_t_l_s_attribute" kindref="compound">TLSAttribute</ref>(<ref refid="classanyio_1_1__core_1_1__typedattr_1_1_typed_attribute_set" kindref="compound">TypedAttributeSet</ref>):</highlight></codeline>
<codeline lineno="52"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;&quot;&quot;Contains<sp/>Transport<sp/>Layer<sp/>Security<sp/>related<sp/>attributes.&quot;&quot;&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="53"><highlight class="normal"></highlight></codeline>
<codeline lineno="54"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#:<sp/>the<sp/>selected<sp/>ALPN<sp/>protocol</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="55" refid="classanyio_1_1streams_1_1tls_1_1_t_l_s_attribute_1a1b622247ffa25823c8569b00ca2f1cde" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/>alpn_protocol:<sp/>str<sp/>|<sp/></highlight><highlight class="keywordtype">None</highlight><highlight class="normal"><sp/>=<sp/>typed_attribute()</highlight></codeline>
<codeline lineno="56"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#:<sp/>the<sp/>channel<sp/>binding<sp/>for<sp/>type<sp/>``tls-unique``</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="57" refid="classanyio_1_1streams_1_1tls_1_1_t_l_s_attribute_1a556c3df2d3bb65b3ffae4956608bee75" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/>channel_binding_tls_unique:<sp/>bytes<sp/>=<sp/>typed_attribute()</highlight></codeline>
<codeline lineno="58"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#:<sp/>the<sp/>selected<sp/>cipher</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="59" refid="classanyio_1_1streams_1_1tls_1_1_t_l_s_attribute_1afa907dadb2f7148076e51b60b5406173" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/>cipher:<sp/>tuple[str,<sp/>str,<sp/>int]<sp/>=<sp/>typed_attribute()</highlight></codeline>
<codeline lineno="60"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#:<sp/>the<sp/>peer<sp/>certificate<sp/>in<sp/>dictionary<sp/>form<sp/>(see<sp/>:meth:`ssl.SSLSocket.getpeercert`</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="61"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>for<sp/>more<sp/>information)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="62" refid="classanyio_1_1streams_1_1tls_1_1_t_l_s_attribute_1ad238f67bb74fb8310ad4bbdfe550387d" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/>peer_certificate:<sp/></highlight><highlight class="keywordtype">None</highlight><highlight class="normal"><sp/>|<sp/>(dict[str,<sp/>str<sp/>|<sp/>_PCTRTTT<sp/>|<sp/>_PCTRTT])<sp/>=<sp/>typed_attribute()</highlight></codeline>
<codeline lineno="63"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#:<sp/>the<sp/>peer<sp/>certificate<sp/>in<sp/>binary<sp/>form</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="64" refid="classanyio_1_1streams_1_1tls_1_1_t_l_s_attribute_1a2c3ab1791267720124e6627a06d88e31" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/>peer_certificate_binary:<sp/>bytes<sp/>|<sp/></highlight><highlight class="keywordtype">None</highlight><highlight class="normal"><sp/>=<sp/>typed_attribute()</highlight></codeline>
<codeline lineno="65"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#:<sp/>``True``<sp/>if<sp/>this<sp/>is<sp/>the<sp/>server<sp/>side<sp/>of<sp/>the<sp/>connection</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="66" refid="classanyio_1_1streams_1_1tls_1_1_t_l_s_attribute_1acb1f20c0558620a7fd06b702819d0d9b" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/>server_side:<sp/>bool<sp/>=<sp/>typed_attribute()</highlight></codeline>
<codeline lineno="67"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#:<sp/>ciphers<sp/>shared<sp/>by<sp/>the<sp/>client<sp/>during<sp/>the<sp/>TLS<sp/>handshake<sp/>(``None``<sp/>if<sp/>this<sp/>is<sp/>the</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="68"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#:<sp/>client<sp/>side)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="69" refid="classanyio_1_1streams_1_1tls_1_1_t_l_s_attribute_1af5db1b3843c6679b92a5b8ab5679b047" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/>shared_ciphers:<sp/>list[tuple[str,<sp/>str,<sp/>int]]<sp/>|<sp/></highlight><highlight class="keywordtype">None</highlight><highlight class="normal"><sp/>=<sp/>typed_attribute()</highlight></codeline>
<codeline lineno="70"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#:<sp/>the<sp/>:class:`~ssl.SSLObject`<sp/>used<sp/>for<sp/>encryption</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="71" refid="classanyio_1_1streams_1_1tls_1_1_t_l_s_attribute_1a8fc4e2bef7722ea592cd486096a60156" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/>ssl_object:<sp/>ssl.SSLObject<sp/>=<sp/>typed_attribute()</highlight></codeline>
<codeline lineno="72"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#:<sp/>``True``<sp/>if<sp/>this<sp/>stream<sp/>does<sp/>(and<sp/>expects)<sp/>a<sp/>closing<sp/>TLS<sp/>handshake<sp/>when<sp/>the</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="73"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#:<sp/>stream<sp/>is<sp/>being<sp/>closed</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="74" refid="classanyio_1_1streams_1_1tls_1_1_t_l_s_attribute_1aff417448585854a44698cc3f8c8af12b" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/>standard_compatible:<sp/>bool<sp/>=<sp/>typed_attribute()</highlight></codeline>
<codeline lineno="75"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#:<sp/>the<sp/>TLS<sp/>protocol<sp/>version<sp/>(e.g.<sp/>``TLSv1.2``)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="76" refid="classanyio_1_1streams_1_1tls_1_1_t_l_s_attribute_1a6d598b100784cf43b85df4c4a44b3b5f" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/>tls_version:<sp/>str<sp/>=<sp/>typed_attribute()</highlight></codeline>
<codeline lineno="77"><highlight class="normal"></highlight></codeline>
<codeline lineno="78"><highlight class="normal"></highlight></codeline>
<codeline lineno="79"><highlight class="normal"></highlight><highlight class="preprocessor">@dataclass(eq=False)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="80" refid="classanyio_1_1streams_1_1tls_1_1_t_l_s_stream" refkind="compound"><highlight class="normal"></highlight><highlight class="keyword">class<sp/></highlight><highlight class="normal"><ref refid="classanyio_1_1streams_1_1tls_1_1_t_l_s_stream" kindref="compound">TLSStream</ref>(<ref refid="classanyio_1_1abc_1_1__streams_1_1_byte_stream" kindref="compound">ByteStream</ref>):</highlight></codeline>
<codeline lineno="81"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;&quot;&quot;</highlight></codeline>
<codeline lineno="82"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>A<sp/>stream<sp/>wrapper<sp/>that<sp/>encrypts<sp/>all<sp/>sent<sp/>data<sp/>and<sp/>decrypts<sp/>received<sp/>data.</highlight></codeline>
<codeline lineno="83"><highlight class="stringliteral"></highlight></codeline>
<codeline lineno="84"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>This<sp/>class<sp/>has<sp/>no<sp/>public<sp/>initializer;<sp/>use<sp/>:meth:`wrap`<sp/>instead.</highlight></codeline>
<codeline lineno="85"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>All<sp/>extra<sp/>attributes<sp/>from<sp/>:class:`~TLSAttribute`<sp/>are<sp/>supported.</highlight></codeline>
<codeline lineno="86"><highlight class="stringliteral"></highlight></codeline>
<codeline lineno="87"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>:var<sp/>AnyByteStream<sp/>transport_stream:<sp/>the<sp/>wrapped<sp/>stream</highlight></codeline>
<codeline lineno="88"><highlight class="stringliteral"></highlight></codeline>
<codeline lineno="89"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&quot;&quot;&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="90"><highlight class="normal"></highlight></codeline>
<codeline lineno="91"><highlight class="normal"><sp/><sp/><sp/><sp/>transport_stream:<sp/>AnyByteStream</highlight></codeline>
<codeline lineno="92"><highlight class="normal"><sp/><sp/><sp/><sp/>standard_compatible:<sp/>bool</highlight></codeline>
<codeline lineno="93" refid="classanyio_1_1streams_1_1tls_1_1_t_l_s_stream_1a875a449bb8308b80c2cb7d990ffe6d6f" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/>_ssl_object:<sp/>ssl.SSLObject</highlight></codeline>
<codeline lineno="94" refid="classanyio_1_1streams_1_1tls_1_1_t_l_s_stream_1a3780e958bb63959bee61bbec88e63c14" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/>_read_bio:<sp/>ssl.MemoryBIO</highlight></codeline>
<codeline lineno="95" refid="classanyio_1_1streams_1_1tls_1_1_t_l_s_stream_1a64fc9780919d955b612aa76af6aeb375" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/>_write_bio:<sp/>ssl.MemoryBIO</highlight></codeline>
<codeline lineno="96"><highlight class="normal"></highlight></codeline>
<codeline lineno="97"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="preprocessor">@classmethod</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="98" refid="classanyio_1_1streams_1_1tls_1_1_t_l_s_stream_1a923bd85d4767c39a8c1367ce93ee07d5" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">async<sp/>def<sp/></highlight><highlight class="normal"><ref refid="classanyio_1_1streams_1_1tls_1_1_t_l_s_stream_1a923bd85d4767c39a8c1367ce93ee07d5" kindref="member">wrap</ref>(</highlight></codeline>
<codeline lineno="99"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>cls,</highlight></codeline>
<codeline lineno="100"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>transport_stream:<sp/>AnyByteStream,</highlight></codeline>
<codeline lineno="101"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*,</highlight></codeline>
<codeline lineno="102"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>server_side:<sp/>bool<sp/>|<sp/></highlight><highlight class="keywordtype">None</highlight><highlight class="normal"><sp/>=<sp/></highlight><highlight class="keywordtype">None</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="103"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>hostname:<sp/>str<sp/>|<sp/></highlight><highlight class="keywordtype">None</highlight><highlight class="normal"><sp/>=<sp/></highlight><highlight class="keywordtype">None</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="104"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ssl_context:<sp/>ssl.SSLContext<sp/>|<sp/></highlight><highlight class="keywordtype">None</highlight><highlight class="normal"><sp/>=<sp/></highlight><highlight class="keywordtype">None</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="105"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>standard_compatible:<sp/>bool<sp/>=<sp/></highlight><highlight class="keyword">True</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="106"><highlight class="normal"><sp/><sp/><sp/><sp/>)<sp/>-&gt;<sp/>TLSStream:</highlight></codeline>
<codeline lineno="107"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;&quot;&quot;</highlight></codeline>
<codeline lineno="108"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>Wrap<sp/>an<sp/>existing<sp/>stream<sp/>with<sp/>Transport<sp/>Layer<sp/>Security.</highlight></codeline>
<codeline lineno="109"><highlight class="stringliteral"></highlight></codeline>
<codeline lineno="110"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>This<sp/>performs<sp/>a<sp/>TLS<sp/>handshake<sp/>with<sp/>the<sp/>peer.</highlight></codeline>
<codeline lineno="111"><highlight class="stringliteral"></highlight></codeline>
<codeline lineno="112"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>:param<sp/>transport_stream:<sp/>a<sp/>bytes-transporting<sp/>stream<sp/>to<sp/>wrap</highlight></codeline>
<codeline lineno="113"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>:param<sp/>server_side:<sp/>``True``<sp/>if<sp/>this<sp/>is<sp/>the<sp/>server<sp/>side<sp/>of<sp/>the<sp/>connection,</highlight></codeline>
<codeline lineno="114"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>``False``<sp/>if<sp/>this<sp/>is<sp/>the<sp/>client<sp/>side<sp/>(if<sp/>omitted,<sp/>will<sp/>be<sp/>set<sp/>to<sp/>``False``</highlight></codeline>
<codeline lineno="115"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>if<sp/>``hostname``<sp/>has<sp/>been<sp/>provided,<sp/>``False``<sp/>otherwise).<sp/>Used<sp/>only<sp/>to<sp/>create</highlight></codeline>
<codeline lineno="116"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>a<sp/>default<sp/>context<sp/>when<sp/>an<sp/>explicit<sp/>context<sp/>has<sp/>not<sp/>been<sp/>provided.</highlight></codeline>
<codeline lineno="117"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>:param<sp/>hostname:<sp/>host<sp/>name<sp/>of<sp/>the<sp/>peer<sp/>(if<sp/>host<sp/>name<sp/>checking<sp/>is<sp/>desired)</highlight></codeline>
<codeline lineno="118"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>:param<sp/>ssl_context:<sp/>the<sp/>SSLContext<sp/>object<sp/>to<sp/>use<sp/>(if<sp/>not<sp/>provided,<sp/>a<sp/>secure</highlight></codeline>
<codeline lineno="119"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>default<sp/>will<sp/>be<sp/>created)</highlight></codeline>
<codeline lineno="120"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>:param<sp/>standard_compatible:<sp/>if<sp/>``False``,<sp/>skip<sp/>the<sp/>closing<sp/>handshake<sp/>when</highlight></codeline>
<codeline lineno="121"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>closing<sp/>the<sp/>connection,<sp/>and<sp/>don&apos;t<sp/>raise<sp/>an<sp/>exception<sp/>if<sp/>the<sp/>peer<sp/>does<sp/>the</highlight></codeline>
<codeline lineno="122"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>same</highlight></codeline>
<codeline lineno="123"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>:raises<sp/>~ssl.SSLError:<sp/>if<sp/>the<sp/>TLS<sp/>handshake<sp/>fails</highlight></codeline>
<codeline lineno="124"><highlight class="stringliteral"></highlight></codeline>
<codeline lineno="125"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&quot;&quot;&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="126"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>server_side<sp/></highlight><highlight class="keywordflow">is</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">None</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="127"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>server_side<sp/>=<sp/></highlight><highlight class="keywordflow">not</highlight><highlight class="normal"><sp/>hostname</highlight></codeline>
<codeline lineno="128"><highlight class="normal"></highlight></codeline>
<codeline lineno="129"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">not</highlight><highlight class="normal"><sp/>ssl_context:</highlight></codeline>
<codeline lineno="130"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>purpose<sp/>=<sp/>(</highlight></codeline>
<codeline lineno="131"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ssl.Purpose.CLIENT_AUTH<sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>server_side<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>ssl.Purpose.SERVER_AUTH</highlight></codeline>
<codeline lineno="132"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>)</highlight></codeline>
<codeline lineno="133"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ssl_context<sp/>=<sp/>ssl.create_default_context(purpose)</highlight></codeline>
<codeline lineno="134"><highlight class="normal"></highlight></codeline>
<codeline lineno="135"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>Re-enable<sp/>detection<sp/>of<sp/>unexpected<sp/>EOFs<sp/>if<sp/>it<sp/>was<sp/>disabled<sp/>by<sp/>Python</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="136"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>hasattr(ssl,<sp/></highlight><highlight class="stringliteral">&quot;OP_IGNORE_UNEXPECTED_EOF&quot;</highlight><highlight class="normal">):</highlight></codeline>
<codeline lineno="137"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ssl_context.options<sp/>&amp;=<sp/>~ssl.OP_IGNORE_UNEXPECTED_EOF</highlight></codeline>
<codeline lineno="138"><highlight class="normal"></highlight></codeline>
<codeline lineno="139"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>bio_in<sp/>=<sp/>ssl.MemoryBIO()</highlight></codeline>
<codeline lineno="140"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>bio_out<sp/>=<sp/>ssl.MemoryBIO()</highlight></codeline>
<codeline lineno="141"><highlight class="normal"></highlight></codeline>
<codeline lineno="142"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>External<sp/>SSLContext<sp/>implementations<sp/>may<sp/>do<sp/>blocking<sp/>I/O<sp/>in<sp/>wrap_bio(),</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="143"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>but<sp/>the<sp/>standard<sp/>library<sp/>implementation<sp/>won&apos;t</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="144"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>type(ssl_context)<sp/></highlight><highlight class="keywordflow">is</highlight><highlight class="normal"><sp/>ssl.SSLContext:</highlight></codeline>
<codeline lineno="145"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ssl_object<sp/>=<sp/>ssl_context.wrap_bio(</highlight></codeline>
<codeline lineno="146"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>bio_in,<sp/>bio_out,<sp/>server_side=server_side,<sp/>server_hostname=hostname</highlight></codeline>
<codeline lineno="147"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>)</highlight></codeline>
<codeline lineno="148"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="149"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ssl_object<sp/>=<sp/>await<sp/>to_thread.run_sync(</highlight></codeline>
<codeline lineno="150"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ssl_context.wrap_bio,</highlight></codeline>
<codeline lineno="151"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>bio_in,</highlight></codeline>
<codeline lineno="152"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>bio_out,</highlight></codeline>
<codeline lineno="153"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>server_side,</highlight></codeline>
<codeline lineno="154"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>hostname,</highlight></codeline>
<codeline lineno="155"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">None</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="156"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>)</highlight></codeline>
<codeline lineno="157"><highlight class="normal"></highlight></codeline>
<codeline lineno="158"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>wrapper<sp/>=<sp/>cls(</highlight></codeline>
<codeline lineno="159"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>transport_stream=transport_stream,</highlight></codeline>
<codeline lineno="160"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>standard_compatible=standard_compatible,</highlight></codeline>
<codeline lineno="161"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>_ssl_object=ssl_object,</highlight></codeline>
<codeline lineno="162"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>_read_bio=bio_in,</highlight></codeline>
<codeline lineno="163"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>_write_bio=bio_out,</highlight></codeline>
<codeline lineno="164"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>)</highlight></codeline>
<codeline lineno="165"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>await<sp/>wrapper._call_sslobject_method(ssl_object.do_handshake)</highlight></codeline>
<codeline lineno="166"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>wrapper</highlight></codeline>
<codeline lineno="167"><highlight class="normal"></highlight></codeline>
<codeline lineno="168" refid="classanyio_1_1streams_1_1tls_1_1_t_l_s_stream_1a284ee2de9164a3780fcc75becb18ee09" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">async<sp/>def<sp/></highlight><highlight class="normal"><ref refid="classanyio_1_1streams_1_1tls_1_1_t_l_s_stream_1a284ee2de9164a3780fcc75becb18ee09" kindref="member">_call_sslobject_method</ref>(</highlight></codeline>
<codeline lineno="169"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self,<sp/>func:<sp/>Callable[[Unpack[PosArgsT]],<sp/>T_Retval],<sp/>*args:<sp/>Unpack[PosArgsT]</highlight></codeline>
<codeline lineno="170"><highlight class="normal"><sp/><sp/><sp/><sp/>)<sp/>-&gt;<sp/>T_Retval:</highlight></codeline>
<codeline lineno="171"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">while</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">True</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="172"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">try</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="173"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>result<sp/>=<sp/>func(*args)</highlight></codeline>
<codeline lineno="174"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">except</highlight><highlight class="normal"><sp/>ssl.SSLWantReadError:</highlight></codeline>
<codeline lineno="175"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">try</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="176"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>Flush<sp/>any<sp/>pending<sp/>writes<sp/>first</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="177"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>self.<ref refid="classanyio_1_1streams_1_1tls_1_1_t_l_s_stream_1a64fc9780919d955b612aa76af6aeb375" kindref="member">_write_bio</ref>.pending:</highlight></codeline>
<codeline lineno="178"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>await<sp/>self.<ref refid="classanyio_1_1streams_1_1tls_1_1_t_l_s_stream_1a344d8bccebe2d48d774ad5df2876d675" kindref="member">transport_stream</ref>.<ref refid="classanyio_1_1streams_1_1tls_1_1_t_l_s_stream_1ad69a4c9d9696241348bf165d78dce66a" kindref="member">send</ref>(self.<ref refid="classanyio_1_1streams_1_1tls_1_1_t_l_s_stream_1a64fc9780919d955b612aa76af6aeb375" kindref="member">_write_bio</ref>.read())</highlight></codeline>
<codeline lineno="179"><highlight class="normal"></highlight></codeline>
<codeline lineno="180"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>data<sp/>=<sp/>await<sp/>self.<ref refid="classanyio_1_1streams_1_1tls_1_1_t_l_s_stream_1a344d8bccebe2d48d774ad5df2876d675" kindref="member">transport_stream</ref>.<ref refid="classanyio_1_1streams_1_1tls_1_1_t_l_s_stream_1a794bf43a47f6a0b7a746319305da6198" kindref="member">receive</ref>()</highlight></codeline>
<codeline lineno="181"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">except</highlight><highlight class="normal"><sp/>EndOfStream:</highlight></codeline>
<codeline lineno="182"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.<ref refid="classanyio_1_1streams_1_1tls_1_1_t_l_s_stream_1a3780e958bb63959bee61bbec88e63c14" kindref="member">_read_bio</ref>.write_eof()</highlight></codeline>
<codeline lineno="183"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">except</highlight><highlight class="normal"><sp/>OSError<sp/></highlight><highlight class="keyword">as</highlight><highlight class="normal"><sp/>exc:</highlight></codeline>
<codeline lineno="184"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.<ref refid="classanyio_1_1streams_1_1tls_1_1_t_l_s_stream_1a3780e958bb63959bee61bbec88e63c14" kindref="member">_read_bio</ref>.write_eof()</highlight></codeline>
<codeline lineno="185"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.<ref refid="classanyio_1_1streams_1_1tls_1_1_t_l_s_stream_1a64fc9780919d955b612aa76af6aeb375" kindref="member">_write_bio</ref>.write_eof()</highlight></codeline>
<codeline lineno="186"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">raise</highlight><highlight class="normal"><sp/>BrokenResourceError<sp/></highlight><highlight class="keyword">from</highlight><highlight class="normal"><sp/>exc</highlight></codeline>
<codeline lineno="187"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="188"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.<ref refid="classanyio_1_1streams_1_1tls_1_1_t_l_s_stream_1a3780e958bb63959bee61bbec88e63c14" kindref="member">_read_bio</ref>.write(data)</highlight></codeline>
<codeline lineno="189"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">except</highlight><highlight class="normal"><sp/>ssl.SSLWantWriteError:</highlight></codeline>
<codeline lineno="190"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>await<sp/>self.<ref refid="classanyio_1_1streams_1_1tls_1_1_t_l_s_stream_1a344d8bccebe2d48d774ad5df2876d675" kindref="member">transport_stream</ref>.<ref refid="classanyio_1_1streams_1_1tls_1_1_t_l_s_stream_1ad69a4c9d9696241348bf165d78dce66a" kindref="member">send</ref>(self.<ref refid="classanyio_1_1streams_1_1tls_1_1_t_l_s_stream_1a64fc9780919d955b612aa76af6aeb375" kindref="member">_write_bio</ref>.read())</highlight></codeline>
<codeline lineno="191"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">except</highlight><highlight class="normal"><sp/>ssl.SSLSyscallError<sp/></highlight><highlight class="keyword">as</highlight><highlight class="normal"><sp/>exc:</highlight></codeline>
<codeline lineno="192"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.<ref refid="classanyio_1_1streams_1_1tls_1_1_t_l_s_stream_1a3780e958bb63959bee61bbec88e63c14" kindref="member">_read_bio</ref>.write_eof()</highlight></codeline>
<codeline lineno="193"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.<ref refid="classanyio_1_1streams_1_1tls_1_1_t_l_s_stream_1a64fc9780919d955b612aa76af6aeb375" kindref="member">_write_bio</ref>.write_eof()</highlight></codeline>
<codeline lineno="194"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">raise</highlight><highlight class="normal"><sp/>BrokenResourceError<sp/></highlight><highlight class="keyword">from</highlight><highlight class="normal"><sp/>exc</highlight></codeline>
<codeline lineno="195"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">except</highlight><highlight class="normal"><sp/>ssl.SSLError<sp/></highlight><highlight class="keyword">as</highlight><highlight class="normal"><sp/>exc:</highlight></codeline>
<codeline lineno="196"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.<ref refid="classanyio_1_1streams_1_1tls_1_1_t_l_s_stream_1a3780e958bb63959bee61bbec88e63c14" kindref="member">_read_bio</ref>.write_eof()</highlight></codeline>
<codeline lineno="197"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.<ref refid="classanyio_1_1streams_1_1tls_1_1_t_l_s_stream_1a64fc9780919d955b612aa76af6aeb375" kindref="member">_write_bio</ref>.write_eof()</highlight></codeline>
<codeline lineno="198"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>isinstance(exc,<sp/>ssl.SSLEOFError)<sp/></highlight><highlight class="keywordflow">or</highlight><highlight class="normal"><sp/>(</highlight></codeline>
<codeline lineno="199"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>exc.strerror<sp/></highlight><highlight class="keywordflow">and</highlight><highlight class="normal"><sp/></highlight><highlight class="stringliteral">&quot;UNEXPECTED_EOF_WHILE_READING&quot;</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">in</highlight><highlight class="normal"><sp/>exc.strerror</highlight></codeline>
<codeline lineno="200"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>):</highlight></codeline>
<codeline lineno="201" refid="classanyio_1_1streams_1_1tls_1_1_t_l_s_stream_1ae0e3cc9f53459762fa92a45d5a606ff9" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>self.<ref refid="classanyio_1_1streams_1_1tls_1_1_t_l_s_stream_1ae0e3cc9f53459762fa92a45d5a606ff9" kindref="member">standard_compatible</ref>:</highlight></codeline>
<codeline lineno="202"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">raise</highlight><highlight class="normal"><sp/>BrokenResourceError<sp/></highlight><highlight class="keyword">from</highlight><highlight class="normal"><sp/>exc</highlight></codeline>
<codeline lineno="203"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="204"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">raise</highlight><highlight class="normal"><sp/>EndOfStream<sp/></highlight><highlight class="keyword">from</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">None</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="205"><highlight class="normal"></highlight></codeline>
<codeline lineno="206"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">raise</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="207"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="208"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>Flush<sp/>any<sp/>pending<sp/>writes<sp/>first</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="209"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>self.<ref refid="classanyio_1_1streams_1_1tls_1_1_t_l_s_stream_1a64fc9780919d955b612aa76af6aeb375" kindref="member">_write_bio</ref>.pending:</highlight></codeline>
<codeline lineno="210"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>await<sp/>self.<ref refid="classanyio_1_1streams_1_1tls_1_1_t_l_s_stream_1a344d8bccebe2d48d774ad5df2876d675" kindref="member">transport_stream</ref>.<ref refid="classanyio_1_1streams_1_1tls_1_1_t_l_s_stream_1ad69a4c9d9696241348bf165d78dce66a" kindref="member">send</ref>(self.<ref refid="classanyio_1_1streams_1_1tls_1_1_t_l_s_stream_1a64fc9780919d955b612aa76af6aeb375" kindref="member">_write_bio</ref>.read())</highlight></codeline>
<codeline lineno="211"><highlight class="normal"></highlight></codeline>
<codeline lineno="212"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>result</highlight></codeline>
<codeline lineno="213"><highlight class="normal"></highlight></codeline>
<codeline lineno="214" refid="classanyio_1_1streams_1_1tls_1_1_t_l_s_stream_1a4a638402b904d83dbaa065614d858a54" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">async<sp/>def<sp/></highlight><highlight class="normal"><ref refid="classanyio_1_1streams_1_1tls_1_1_t_l_s_stream_1a4a638402b904d83dbaa065614d858a54" kindref="member">unwrap</ref>(self)<sp/>-&gt;<sp/>tuple[AnyByteStream,<sp/>bytes]:</highlight></codeline>
<codeline lineno="215"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;&quot;&quot;</highlight></codeline>
<codeline lineno="216"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>Does<sp/>the<sp/>TLS<sp/>closing<sp/>handshake.</highlight></codeline>
<codeline lineno="217"><highlight class="stringliteral"></highlight></codeline>
<codeline lineno="218"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>:return:<sp/>a<sp/>tuple<sp/>of<sp/>(wrapped<sp/>byte<sp/>stream,<sp/>bytes<sp/>left<sp/>in<sp/>the<sp/>read<sp/>buffer)</highlight></codeline>
<codeline lineno="219"><highlight class="stringliteral"></highlight></codeline>
<codeline lineno="220"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&quot;&quot;&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="221"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>await<sp/>self.<ref refid="classanyio_1_1streams_1_1tls_1_1_t_l_s_stream_1a284ee2de9164a3780fcc75becb18ee09" kindref="member">_call_sslobject_method</ref>(self.<ref refid="classanyio_1_1streams_1_1tls_1_1_t_l_s_stream_1a875a449bb8308b80c2cb7d990ffe6d6f" kindref="member">_ssl_object</ref>.unwrap)</highlight></codeline>
<codeline lineno="222"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.<ref refid="classanyio_1_1streams_1_1tls_1_1_t_l_s_stream_1a3780e958bb63959bee61bbec88e63c14" kindref="member">_read_bio</ref>.write_eof()</highlight></codeline>
<codeline lineno="223"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.<ref refid="classanyio_1_1streams_1_1tls_1_1_t_l_s_stream_1a64fc9780919d955b612aa76af6aeb375" kindref="member">_write_bio</ref>.write_eof()</highlight></codeline>
<codeline lineno="224" refid="classanyio_1_1streams_1_1tls_1_1_t_l_s_stream_1a344d8bccebe2d48d774ad5df2876d675" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>self.<ref refid="classanyio_1_1streams_1_1tls_1_1_t_l_s_stream_1a344d8bccebe2d48d774ad5df2876d675" kindref="member">transport_stream</ref>,<sp/>self.<ref refid="classanyio_1_1streams_1_1tls_1_1_t_l_s_stream_1a3780e958bb63959bee61bbec88e63c14" kindref="member">_read_bio</ref>.read()</highlight></codeline>
<codeline lineno="225"><highlight class="normal"></highlight></codeline>
<codeline lineno="226" refid="classanyio_1_1streams_1_1tls_1_1_t_l_s_stream_1a7852ecf735b1a38b8016319976e70db7" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">async<sp/>def<sp/></highlight><highlight class="normal"><ref refid="classanyio_1_1streams_1_1tls_1_1_t_l_s_stream_1a7852ecf735b1a38b8016319976e70db7" kindref="member">aclose</ref>(self)<sp/>-&gt;<sp/>None:</highlight></codeline>
<codeline lineno="227"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>self.<ref refid="classanyio_1_1streams_1_1tls_1_1_t_l_s_stream_1ae0e3cc9f53459762fa92a45d5a606ff9" kindref="member">standard_compatible</ref>:</highlight></codeline>
<codeline lineno="228"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">try</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="229"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>await<sp/>self.<ref refid="classanyio_1_1streams_1_1tls_1_1_t_l_s_stream_1a4a638402b904d83dbaa065614d858a54" kindref="member">unwrap</ref>()</highlight></codeline>
<codeline lineno="230"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">except</highlight><highlight class="normal"><sp/>BaseException:</highlight></codeline>
<codeline lineno="231"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>await<sp/>aclose_forcefully(self.<ref refid="classanyio_1_1streams_1_1tls_1_1_t_l_s_stream_1a344d8bccebe2d48d774ad5df2876d675" kindref="member">transport_stream</ref>)</highlight></codeline>
<codeline lineno="232"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">raise</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="233"><highlight class="normal"></highlight></codeline>
<codeline lineno="234"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>await<sp/>self.<ref refid="classanyio_1_1streams_1_1tls_1_1_t_l_s_stream_1a344d8bccebe2d48d774ad5df2876d675" kindref="member">transport_stream</ref>.<ref refid="classanyio_1_1streams_1_1tls_1_1_t_l_s_stream_1a7852ecf735b1a38b8016319976e70db7" kindref="member">aclose</ref>()</highlight></codeline>
<codeline lineno="235"><highlight class="normal"></highlight></codeline>
<codeline lineno="236" refid="classanyio_1_1streams_1_1tls_1_1_t_l_s_stream_1a794bf43a47f6a0b7a746319305da6198" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">async<sp/>def<sp/></highlight><highlight class="normal"><ref refid="classanyio_1_1streams_1_1tls_1_1_t_l_s_stream_1a794bf43a47f6a0b7a746319305da6198" kindref="member">receive</ref>(self,<sp/>max_bytes:<sp/>int<sp/>=<sp/>65536)<sp/>-&gt;<sp/>bytes:</highlight></codeline>
<codeline lineno="237"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>data<sp/>=<sp/>await<sp/>self.<ref refid="classanyio_1_1streams_1_1tls_1_1_t_l_s_stream_1a284ee2de9164a3780fcc75becb18ee09" kindref="member">_call_sslobject_method</ref>(self.<ref refid="classanyio_1_1streams_1_1tls_1_1_t_l_s_stream_1a875a449bb8308b80c2cb7d990ffe6d6f" kindref="member">_ssl_object</ref>.read,<sp/>max_bytes)</highlight></codeline>
<codeline lineno="238"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">not</highlight><highlight class="normal"><sp/>data:</highlight></codeline>
<codeline lineno="239"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">raise</highlight><highlight class="normal"><sp/>EndOfStream</highlight></codeline>
<codeline lineno="240"><highlight class="normal"></highlight></codeline>
<codeline lineno="241"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>data</highlight></codeline>
<codeline lineno="242"><highlight class="normal"></highlight></codeline>
<codeline lineno="243" refid="classanyio_1_1streams_1_1tls_1_1_t_l_s_stream_1ad69a4c9d9696241348bf165d78dce66a" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">async<sp/>def<sp/></highlight><highlight class="normal"><ref refid="classanyio_1_1streams_1_1tls_1_1_t_l_s_stream_1ad69a4c9d9696241348bf165d78dce66a" kindref="member">send</ref>(self,<sp/>item:<sp/>bytes)<sp/>-&gt;<sp/></highlight><highlight class="keywordtype">None</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="244"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>await<sp/>self.<ref refid="classanyio_1_1streams_1_1tls_1_1_t_l_s_stream_1a284ee2de9164a3780fcc75becb18ee09" kindref="member">_call_sslobject_method</ref>(self.<ref refid="classanyio_1_1streams_1_1tls_1_1_t_l_s_stream_1a875a449bb8308b80c2cb7d990ffe6d6f" kindref="member">_ssl_object</ref>.write,<sp/>item)</highlight></codeline>
<codeline lineno="245"><highlight class="normal"></highlight></codeline>
<codeline lineno="246" refid="classanyio_1_1streams_1_1tls_1_1_t_l_s_stream_1a592f16e310a367ee8aa50cd9acbdc69e" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">async<sp/>def<sp/></highlight><highlight class="normal"><ref refid="classanyio_1_1streams_1_1tls_1_1_t_l_s_stream_1a592f16e310a367ee8aa50cd9acbdc69e" kindref="member">send_eof</ref>(self)<sp/>-&gt;<sp/>None:</highlight></codeline>
<codeline lineno="247"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>tls_version<sp/>=<sp/>self.<ref refid="classanyio_1_1__core_1_1__typedattr_1_1_typed_attribute_provider_1a583ae05b3f4227569fd625724231f958" kindref="member">extra</ref>(TLSAttribute.tls_version)</highlight></codeline>
<codeline lineno="248"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>match<sp/>=<sp/>re.match(</highlight><highlight class="stringliteral">r&quot;TLSv(\d+)(?:\.(\d+))?&quot;</highlight><highlight class="normal">,<sp/>tls_version)</highlight></codeline>
<codeline lineno="249"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>match:</highlight></codeline>
<codeline lineno="250"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>major,<sp/>minor<sp/>=<sp/>int(match.group(1)),<sp/>int(match.group(2)<sp/></highlight><highlight class="keywordflow">or</highlight><highlight class="normal"><sp/>0)</highlight></codeline>
<codeline lineno="251"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(major,<sp/>minor)<sp/>&lt;<sp/>(1,<sp/>3):</highlight></codeline>
<codeline lineno="252"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">raise</highlight><highlight class="normal"><sp/>NotImplementedError(</highlight></codeline>
<codeline lineno="253"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>f</highlight><highlight class="stringliteral">&quot;send_eof()<sp/>requires<sp/>at<sp/>least<sp/>TLSv1.3;<sp/>current<sp/>&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="254"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>f</highlight><highlight class="stringliteral">&quot;session<sp/>uses<sp/>{tls_version}&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="255"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>)</highlight></codeline>
<codeline lineno="256"><highlight class="normal"></highlight></codeline>
<codeline lineno="257"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">raise</highlight><highlight class="normal"><sp/>NotImplementedError(</highlight></codeline>
<codeline lineno="258"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;send_eof()<sp/>has<sp/>not<sp/>yet<sp/>been<sp/>implemented<sp/>for<sp/>TLS<sp/>streams&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="259"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>)</highlight></codeline>
<codeline lineno="260"><highlight class="normal"></highlight></codeline>
<codeline lineno="261"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="preprocessor">@property</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="262" refid="classanyio_1_1streams_1_1tls_1_1_t_l_s_stream_1a51c0878ad7445818699eb14aa9e0350f" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal"><ref refid="classanyio_1_1streams_1_1tls_1_1_t_l_s_stream_1a51c0878ad7445818699eb14aa9e0350f" kindref="member">extra_attributes</ref>(self)<sp/>-&gt;<sp/>Mapping[Any,<sp/>Callable[[],<sp/>Any]]:</highlight></codeline>
<codeline lineno="263"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="264"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>**self.<ref refid="classanyio_1_1streams_1_1tls_1_1_t_l_s_stream_1a344d8bccebe2d48d774ad5df2876d675" kindref="member">transport_stream</ref>.extra_attributes,</highlight></codeline>
<codeline lineno="265"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>TLSAttribute.alpn_protocol:<sp/>self.<ref refid="classanyio_1_1streams_1_1tls_1_1_t_l_s_stream_1a875a449bb8308b80c2cb7d990ffe6d6f" kindref="member">_ssl_object</ref>.selected_alpn_protocol,</highlight></codeline>
<codeline lineno="266"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>TLSAttribute.channel_binding_tls_unique:<sp/>(</highlight></codeline>
<codeline lineno="267"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.<ref refid="classanyio_1_1streams_1_1tls_1_1_t_l_s_stream_1a875a449bb8308b80c2cb7d990ffe6d6f" kindref="member">_ssl_object</ref>.get_channel_binding</highlight></codeline>
<codeline lineno="268"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>),</highlight></codeline>
<codeline lineno="269"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>TLSAttribute.cipher:<sp/>self.<ref refid="classanyio_1_1streams_1_1tls_1_1_t_l_s_stream_1a875a449bb8308b80c2cb7d990ffe6d6f" kindref="member">_ssl_object</ref>.cipher,</highlight></codeline>
<codeline lineno="270"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>TLSAttribute.peer_certificate:<sp/></highlight><highlight class="keyword">lambda</highlight><highlight class="normal">:<sp/>self.<ref refid="classanyio_1_1streams_1_1tls_1_1_t_l_s_stream_1a875a449bb8308b80c2cb7d990ffe6d6f" kindref="member">_ssl_object</ref>.getpeercert(</highlight><highlight class="keyword">False</highlight><highlight class="normal">),</highlight></codeline>
<codeline lineno="271"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>TLSAttribute.peer_certificate_binary:<sp/></highlight><highlight class="keyword">lambda</highlight><highlight class="normal">:<sp/>self.<ref refid="classanyio_1_1streams_1_1tls_1_1_t_l_s_stream_1a875a449bb8308b80c2cb7d990ffe6d6f" kindref="member">_ssl_object</ref>.getpeercert(</highlight></codeline>
<codeline lineno="272"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">True</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="273"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>),</highlight></codeline>
<codeline lineno="274"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>TLSAttribute.server_side:<sp/></highlight><highlight class="keyword">lambda</highlight><highlight class="normal">:<sp/>self.<ref refid="classanyio_1_1streams_1_1tls_1_1_t_l_s_stream_1a875a449bb8308b80c2cb7d990ffe6d6f" kindref="member">_ssl_object</ref>.server_side,</highlight></codeline>
<codeline lineno="275"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>TLSAttribute.shared_ciphers:<sp/></highlight><highlight class="keyword">lambda</highlight><highlight class="normal">:<sp/>self.<ref refid="classanyio_1_1streams_1_1tls_1_1_t_l_s_stream_1a875a449bb8308b80c2cb7d990ffe6d6f" kindref="member">_ssl_object</ref>.shared_ciphers()</highlight></codeline>
<codeline lineno="276"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>self.<ref refid="classanyio_1_1streams_1_1tls_1_1_t_l_s_stream_1a875a449bb8308b80c2cb7d990ffe6d6f" kindref="member">_ssl_object</ref>.server_side</highlight></codeline>
<codeline lineno="277"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">None</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="278"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>TLSAttribute.standard_compatible:<sp/></highlight><highlight class="keyword">lambda</highlight><highlight class="normal">:<sp/>self.<ref refid="classanyio_1_1streams_1_1tls_1_1_t_l_s_stream_1ae0e3cc9f53459762fa92a45d5a606ff9" kindref="member">standard_compatible</ref>,</highlight></codeline>
<codeline lineno="279"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>TLSAttribute.ssl_object:<sp/></highlight><highlight class="keyword">lambda</highlight><highlight class="normal">:<sp/>self.<ref refid="classanyio_1_1streams_1_1tls_1_1_t_l_s_stream_1a875a449bb8308b80c2cb7d990ffe6d6f" kindref="member">_ssl_object</ref>,</highlight></codeline>
<codeline lineno="280"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>TLSAttribute.tls_version:<sp/>self.<ref refid="classanyio_1_1streams_1_1tls_1_1_t_l_s_stream_1a875a449bb8308b80c2cb7d990ffe6d6f" kindref="member">_ssl_object</ref>.version,</highlight></codeline>
<codeline lineno="281"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="282"><highlight class="normal"></highlight></codeline>
<codeline lineno="283"><highlight class="normal"></highlight></codeline>
<codeline lineno="284"><highlight class="normal"></highlight><highlight class="preprocessor">@dataclass(eq=False)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="285" refid="classanyio_1_1streams_1_1tls_1_1_t_l_s_listener" refkind="compound"><highlight class="normal"></highlight><highlight class="keyword">class<sp/></highlight><highlight class="normal"><ref refid="classanyio_1_1streams_1_1tls_1_1_t_l_s_listener" kindref="compound">TLSListener</ref>(<ref refid="classanyio_1_1abc_1_1__streams_1_1_listener" kindref="compound">Listener</ref>[TLSStream]):</highlight></codeline>
<codeline lineno="286"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;&quot;&quot;</highlight></codeline>
<codeline lineno="287"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>A<sp/>convenience<sp/>listener<sp/>that<sp/>wraps<sp/>another<sp/>listener<sp/>and<sp/>auto-negotiates<sp/>a<sp/>TLS<sp/>session</highlight></codeline>
<codeline lineno="288"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>on<sp/>every<sp/>accepted<sp/>connection.</highlight></codeline>
<codeline lineno="289"><highlight class="stringliteral"></highlight></codeline>
<codeline lineno="290"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>If<sp/>the<sp/>TLS<sp/>handshake<sp/>times<sp/>out<sp/>or<sp/>raises<sp/>an<sp/>exception,</highlight></codeline>
<codeline lineno="291"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>:meth:`handle_handshake_error`<sp/>is<sp/>called<sp/>to<sp/>do<sp/>whatever<sp/>post-mortem<sp/>processing<sp/>is</highlight></codeline>
<codeline lineno="292"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>deemed<sp/>necessary.</highlight></codeline>
<codeline lineno="293"><highlight class="stringliteral"></highlight></codeline>
<codeline lineno="294"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>Supports<sp/>only<sp/>the<sp/>:attr:`~TLSAttribute.standard_compatible`<sp/>extra<sp/>attribute.</highlight></codeline>
<codeline lineno="295"><highlight class="stringliteral"></highlight></codeline>
<codeline lineno="296"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>:param<sp/>Listener<sp/>listener:<sp/>the<sp/>listener<sp/>to<sp/>wrap</highlight></codeline>
<codeline lineno="297"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>:param<sp/>ssl_context:<sp/>the<sp/>SSL<sp/>context<sp/>object</highlight></codeline>
<codeline lineno="298"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>:param<sp/>standard_compatible:<sp/>a<sp/>flag<sp/>passed<sp/>through<sp/>to<sp/>:meth:`TLSStream.wrap`</highlight></codeline>
<codeline lineno="299"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>:param<sp/>handshake_timeout:<sp/>time<sp/>limit<sp/>for<sp/>the<sp/>TLS<sp/>handshake</highlight></codeline>
<codeline lineno="300"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>(passed<sp/>to<sp/>:func:`~anyio.fail_after`)</highlight></codeline>
<codeline lineno="301"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&quot;&quot;&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="302"><highlight class="normal"></highlight></codeline>
<codeline lineno="303" refid="classanyio_1_1streams_1_1tls_1_1_t_l_s_listener_1ab83891a56067f62cb48e4ba79465761c" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/>listener:<sp/>Listener[Any]</highlight></codeline>
<codeline lineno="304" refid="classanyio_1_1streams_1_1tls_1_1_t_l_s_listener_1aa81fed9952f31027f55cd9b77f153e54" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/>ssl_context:<sp/>ssl.SSLContext</highlight></codeline>
<codeline lineno="305" refid="classanyio_1_1streams_1_1tls_1_1_t_l_s_listener" refkind="compound"><highlight class="normal"><sp/><sp/><sp/><sp/>standard_compatible:<sp/>bool<sp/>=<sp/></highlight><highlight class="keyword">True</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="306" refid="classanyio_1_1streams_1_1tls_1_1_t_l_s_listener_1ad27f267c245ae0ddb247a9d87d8e9dbf" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/>handshake_timeout:<sp/>float<sp/>=<sp/>30</highlight></codeline>
<codeline lineno="307"><highlight class="normal"></highlight></codeline>
<codeline lineno="308"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="preprocessor">@staticmethod</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="309" refid="classanyio_1_1streams_1_1tls_1_1_t_l_s_listener_1a3a5491468b33ee7228883d6434277703" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">async<sp/>def<sp/></highlight><highlight class="normal"><ref refid="classanyio_1_1streams_1_1tls_1_1_t_l_s_listener_1a3a5491468b33ee7228883d6434277703" kindref="member">handle_handshake_error</ref>(exc:<sp/>BaseException,<sp/>stream:<sp/>AnyByteStream)<sp/>-&gt;<sp/></highlight><highlight class="keywordtype">None</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="310"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;&quot;&quot;</highlight></codeline>
<codeline lineno="311"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>Handle<sp/>an<sp/>exception<sp/>raised<sp/>during<sp/>the<sp/>TLS<sp/>handshake.</highlight></codeline>
<codeline lineno="312"><highlight class="stringliteral"></highlight></codeline>
<codeline lineno="313"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>This<sp/>method<sp/>does<sp/>3<sp/>things:</highlight></codeline>
<codeline lineno="314"><highlight class="stringliteral"></highlight></codeline>
<codeline lineno="315"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>#.<sp/>Forcefully<sp/>closes<sp/>the<sp/>original<sp/>stream</highlight></codeline>
<codeline lineno="316"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>#.<sp/>Logs<sp/>the<sp/>exception<sp/>(unless<sp/>it<sp/>was<sp/>a<sp/>cancellation<sp/>exception)<sp/>using<sp/>the</highlight></codeline>
<codeline lineno="317"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>``anyio.streams.tls``<sp/>logger</highlight></codeline>
<codeline lineno="318"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>#.<sp/>Reraises<sp/>the<sp/>exception<sp/>if<sp/>it<sp/>was<sp/>a<sp/>base<sp/>exception<sp/>or<sp/>a<sp/>cancellation<sp/>exception</highlight></codeline>
<codeline lineno="319"><highlight class="stringliteral"></highlight></codeline>
<codeline lineno="320"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>:param<sp/>exc:<sp/>the<sp/>exception</highlight></codeline>
<codeline lineno="321"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>:param<sp/>stream:<sp/>the<sp/>original<sp/>stream</highlight></codeline>
<codeline lineno="322"><highlight class="stringliteral"></highlight></codeline>
<codeline lineno="323"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&quot;&quot;&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="324"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>await<sp/>aclose_forcefully(stream)</highlight></codeline>
<codeline lineno="325"><highlight class="normal"></highlight></codeline>
<codeline lineno="326"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>Log<sp/>all<sp/>except<sp/>cancellation<sp/>exceptions</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="327"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">not</highlight><highlight class="normal"><sp/>isinstance(exc,<sp/>get_cancelled_exc_class()):</highlight></codeline>
<codeline lineno="328"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>CPython<sp/>(as<sp/>of<sp/>3.11.5)<sp/>returns<sp/>incorrect<sp/>`sys.exc_info()`<sp/>here<sp/>when<sp/>using</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="329"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>any<sp/>asyncio<sp/>implementation,<sp/>so<sp/>we<sp/>explicitly<sp/>pass<sp/>the<sp/>exception<sp/>to<sp/>log</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="330"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>(https://github.com/python/cpython/issues/108668).<sp/>Trio<sp/>does<sp/>not<sp/>have<sp/>this</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="331"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>issue<sp/>because<sp/>it<sp/>works<sp/>around<sp/>the<sp/>CPython<sp/>bug.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="332"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>logging.getLogger(__name__).exception(</highlight></codeline>
<codeline lineno="333"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;Error<sp/>during<sp/>TLS<sp/>handshake&quot;</highlight><highlight class="normal">,<sp/>exc_info=exc</highlight></codeline>
<codeline lineno="334"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>)</highlight></codeline>
<codeline lineno="335"><highlight class="normal"></highlight></codeline>
<codeline lineno="336"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>Only<sp/>reraise<sp/>base<sp/>exceptions<sp/>and<sp/>cancellation<sp/>exceptions</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="337"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">not</highlight><highlight class="normal"><sp/>isinstance(exc,<sp/>Exception)<sp/></highlight><highlight class="keywordflow">or</highlight><highlight class="normal"><sp/>isinstance(exc,<sp/>get_cancelled_exc_class()):</highlight></codeline>
<codeline lineno="338"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">raise</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="339"><highlight class="normal"></highlight></codeline>
<codeline lineno="340" refid="classanyio_1_1streams_1_1tls_1_1_t_l_s_listener_1af366b0790b1070f15d5a581731f85556" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">async<sp/>def<sp/></highlight><highlight class="normal"><ref refid="classanyio_1_1streams_1_1tls_1_1_t_l_s_listener_1af366b0790b1070f15d5a581731f85556" kindref="member">serve</ref>(</highlight></codeline>
<codeline lineno="341"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self,</highlight></codeline>
<codeline lineno="342"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>handler:<sp/>Callable[[TLSStream],<sp/>Any],</highlight></codeline>
<codeline lineno="343"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>task_group:<sp/>TaskGroup<sp/>|<sp/></highlight><highlight class="keywordtype">None</highlight><highlight class="normal"><sp/>=<sp/></highlight><highlight class="keywordtype">None</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="344"><highlight class="normal"><sp/><sp/><sp/><sp/>)<sp/>-&gt;<sp/></highlight><highlight class="keywordtype">None</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="345"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="preprocessor">@wraps(handler)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="346"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">async<sp/>def<sp/></highlight><highlight class="normal">handler_wrapper(stream:<sp/>AnyByteStream)<sp/>-&gt;<sp/></highlight><highlight class="keywordtype">None</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="347"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">from</highlight><highlight class="normal"><sp/>..<sp/></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>fail_after</highlight></codeline>
<codeline lineno="348"><highlight class="normal"></highlight></codeline>
<codeline lineno="349"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">try</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="350"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">with</highlight><highlight class="normal"><sp/>fail_after(self.<ref refid="classanyio_1_1streams_1_1tls_1_1_t_l_s_listener_1ad27f267c245ae0ddb247a9d87d8e9dbf" kindref="member">handshake_timeout</ref>):</highlight></codeline>
<codeline lineno="351"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>wrapped_stream<sp/>=<sp/>await<sp/>TLSStream.wrap(</highlight></codeline>
<codeline lineno="352"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>stream,</highlight></codeline>
<codeline lineno="353"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ssl_context=self.<ref refid="classanyio_1_1streams_1_1tls_1_1_t_l_s_listener_1aa81fed9952f31027f55cd9b77f153e54" kindref="member">ssl_context</ref>,</highlight></codeline>
<codeline lineno="354"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>standard_compatible=self.<ref refid="classanyio_1_1streams_1_1tls_1_1_t_l_s_stream_1ae0e3cc9f53459762fa92a45d5a606ff9" kindref="member">standard_compatible</ref>,</highlight></codeline>
<codeline lineno="355"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>)</highlight></codeline>
<codeline lineno="356"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">except</highlight><highlight class="normal"><sp/>BaseException<sp/></highlight><highlight class="keyword">as</highlight><highlight class="normal"><sp/>exc:</highlight></codeline>
<codeline lineno="357"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>await<sp/>self.<ref refid="classanyio_1_1streams_1_1tls_1_1_t_l_s_listener_1a3a5491468b33ee7228883d6434277703" kindref="member">handle_handshake_error</ref>(exc,<sp/>stream)</highlight></codeline>
<codeline lineno="358"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="359"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>await<sp/>handler(wrapped_stream)</highlight></codeline>
<codeline lineno="360"><highlight class="normal"></highlight></codeline>
<codeline lineno="361"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>await<sp/>self.<ref refid="classanyio_1_1streams_1_1tls_1_1_t_l_s_listener_1ab83891a56067f62cb48e4ba79465761c" kindref="member">listener</ref>.<ref refid="classanyio_1_1streams_1_1tls_1_1_t_l_s_listener_1af366b0790b1070f15d5a581731f85556" kindref="member">serve</ref>(handler_wrapper,<sp/>task_group)</highlight></codeline>
<codeline lineno="362"><highlight class="normal"></highlight></codeline>
<codeline lineno="363" refid="classanyio_1_1streams_1_1tls_1_1_t_l_s_listener_1a2f240f12624be65efbe8d5aa3833cfb2" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">async<sp/>def<sp/></highlight><highlight class="normal"><ref refid="classanyio_1_1streams_1_1tls_1_1_t_l_s_listener_1a2f240f12624be65efbe8d5aa3833cfb2" kindref="member">aclose</ref>(self)<sp/>-&gt;<sp/>None:</highlight></codeline>
<codeline lineno="364"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>await<sp/>self.<ref refid="classanyio_1_1streams_1_1tls_1_1_t_l_s_listener_1ab83891a56067f62cb48e4ba79465761c" kindref="member">listener</ref>.<ref refid="classanyio_1_1streams_1_1tls_1_1_t_l_s_listener_1a2f240f12624be65efbe8d5aa3833cfb2" kindref="member">aclose</ref>()</highlight></codeline>
<codeline lineno="365"><highlight class="normal"></highlight></codeline>
<codeline lineno="366"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="preprocessor">@property</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="367" refid="classanyio_1_1streams_1_1tls_1_1_t_l_s_listener_1a9abae58bd4bf2d340007bb7216a0b69e" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal"><ref refid="classanyio_1_1streams_1_1tls_1_1_t_l_s_listener_1a9abae58bd4bf2d340007bb7216a0b69e" kindref="member">extra_attributes</ref>(self)<sp/>-&gt;<sp/>Mapping[Any,<sp/>Callable[[],<sp/>Any]]:</highlight></codeline>
<codeline lineno="368"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="369"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>TLSAttribute.standard_compatible:<sp/></highlight><highlight class="keyword">lambda</highlight><highlight class="normal">:<sp/>self.<ref refid="classanyio_1_1streams_1_1tls_1_1_t_l_s_stream_1ae0e3cc9f53459762fa92a45d5a606ff9" kindref="member">standard_compatible</ref>,</highlight></codeline>
<codeline lineno="370"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="371"><highlight class="normal"></highlight></codeline>
<codeline lineno="372"><highlight class="normal"></highlight></codeline>
<codeline lineno="373" refid="classanyio_1_1streams_1_1tls_1_1_t_l_s_connectable" refkind="compound"><highlight class="normal"></highlight><highlight class="keyword">class<sp/></highlight><highlight class="normal"><ref refid="classanyio_1_1streams_1_1tls_1_1_t_l_s_connectable" kindref="compound">TLSConnectable</ref>(<ref refid="classanyio_1_1abc_1_1__streams_1_1_byte_stream_connectable" kindref="compound">ByteStreamConnectable</ref>):</highlight></codeline>
<codeline lineno="374"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;&quot;&quot;</highlight></codeline>
<codeline lineno="375"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>Wraps<sp/>another<sp/>connectable<sp/>and<sp/>does<sp/>TLS<sp/>negotiation<sp/>after<sp/>a<sp/>successful<sp/>connection.</highlight></codeline>
<codeline lineno="376"><highlight class="stringliteral"></highlight></codeline>
<codeline lineno="377"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>:param<sp/>connectable:<sp/>the<sp/>connectable<sp/>to<sp/>wrap</highlight></codeline>
<codeline lineno="378"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>:param<sp/>hostname:<sp/>host<sp/>name<sp/>of<sp/>the<sp/>server<sp/>(if<sp/>host<sp/>name<sp/>checking<sp/>is<sp/>desired)</highlight></codeline>
<codeline lineno="379"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>:param<sp/>ssl_context:<sp/>the<sp/>SSLContext<sp/>object<sp/>to<sp/>use<sp/>(if<sp/>not<sp/>provided,<sp/>a<sp/>secure<sp/>default</highlight></codeline>
<codeline lineno="380"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>will<sp/>be<sp/>created)</highlight></codeline>
<codeline lineno="381"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>:param<sp/>standard_compatible:<sp/>if<sp/>``False``,<sp/>skip<sp/>the<sp/>closing<sp/>handshake<sp/>when<sp/>closing</highlight></codeline>
<codeline lineno="382"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>the<sp/>connection,<sp/>and<sp/>don&apos;t<sp/>raise<sp/>an<sp/>exception<sp/>if<sp/>the<sp/>server<sp/>does<sp/>the<sp/>same</highlight></codeline>
<codeline lineno="383"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&quot;&quot;&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="384"><highlight class="normal"></highlight></codeline>
<codeline lineno="385"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal">__init__(</highlight></codeline>
<codeline lineno="386"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self,</highlight></codeline>
<codeline lineno="387"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>connectable:<sp/>AnyByteStreamConnectable,</highlight></codeline>
<codeline lineno="388"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*,</highlight></codeline>
<codeline lineno="389"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>hostname:<sp/>str<sp/>|<sp/></highlight><highlight class="keywordtype">None</highlight><highlight class="normal"><sp/>=<sp/></highlight><highlight class="keywordtype">None</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="390"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ssl_context:<sp/>ssl.SSLContext<sp/>|<sp/></highlight><highlight class="keywordtype">None</highlight><highlight class="normal"><sp/>=<sp/></highlight><highlight class="keywordtype">None</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="391"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>standard_compatible:<sp/>bool<sp/>=<sp/></highlight><highlight class="keyword">True</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="392"><highlight class="normal"><sp/><sp/><sp/><sp/>)<sp/>-&gt;<sp/></highlight><highlight class="keywordtype">None</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="393" refid="classanyio_1_1streams_1_1tls_1_1_t_l_s_connectable_1aab01b740bda8c518ec4cadf8b9d58274" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.<ref refid="classanyio_1_1streams_1_1tls_1_1_t_l_s_connectable_1aab01b740bda8c518ec4cadf8b9d58274" kindref="member">connectable</ref><sp/>=<sp/>connectable</highlight></codeline>
<codeline lineno="394" refid="classanyio_1_1streams_1_1tls_1_1_t_l_s_connectable_1ae67cd14ec7ffbe0ee2276820e48d3bcd" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.<ref refid="classanyio_1_1streams_1_1tls_1_1_t_l_s_connectable_1ae67cd14ec7ffbe0ee2276820e48d3bcd" kindref="member">ssl_context</ref>:<sp/>SSLContext<sp/>=<sp/>ssl_context<sp/></highlight><highlight class="keywordflow">or</highlight><highlight class="normal"><sp/>ssl.create_default_context(</highlight></codeline>
<codeline lineno="395"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ssl.Purpose.SERVER_AUTH</highlight></codeline>
<codeline lineno="396"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>)</highlight></codeline>
<codeline lineno="397"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">not</highlight><highlight class="normal"><sp/>isinstance(self.<ref refid="classanyio_1_1streams_1_1tls_1_1_t_l_s_connectable_1ae67cd14ec7ffbe0ee2276820e48d3bcd" kindref="member">ssl_context</ref>,<sp/>ssl.SSLContext):</highlight></codeline>
<codeline lineno="398"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">raise</highlight><highlight class="normal"><sp/>TypeError(</highlight></codeline>
<codeline lineno="399"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;ssl_context<sp/>must<sp/>be<sp/>an<sp/>instance<sp/>of<sp/>ssl.SSLContext,<sp/>not<sp/>&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="400"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>f</highlight><highlight class="stringliteral">&quot;{type(self.ssl_context).__name__}&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="401"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>)</highlight></codeline>
<codeline lineno="402" refid="classanyio_1_1streams_1_1tls_1_1_t_l_s_connectable_1a8104db93e03c9dce447a7b44217d0972" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.<ref refid="classanyio_1_1streams_1_1tls_1_1_t_l_s_connectable_1a8104db93e03c9dce447a7b44217d0972" kindref="member">hostname</ref><sp/>=<sp/>hostname</highlight></codeline>
<codeline lineno="403" refid="classanyio_1_1streams_1_1tls_1_1_t_l_s_connectable_1ac328b6bb19b3a8673fac99e74dff0c24" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.<ref refid="classanyio_1_1streams_1_1tls_1_1_t_l_s_connectable_1ac328b6bb19b3a8673fac99e74dff0c24" kindref="member">standard_compatible</ref><sp/>=<sp/>standard_compatible</highlight></codeline>
<codeline lineno="404"><highlight class="normal"></highlight></codeline>
<codeline lineno="405"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="preprocessor">@override</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="406" refid="classanyio_1_1streams_1_1tls_1_1_t_l_s_connectable_1a40a45922b6a00b2e1a5d6aa4492e034a" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">async<sp/>def<sp/></highlight><highlight class="normal"><ref refid="classanyio_1_1streams_1_1tls_1_1_t_l_s_connectable_1a40a45922b6a00b2e1a5d6aa4492e034a" kindref="member">connect</ref>(self)<sp/>-&gt;<sp/>TLSStream:</highlight></codeline>
<codeline lineno="407"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>stream<sp/>=<sp/>await<sp/>self.<ref refid="classanyio_1_1streams_1_1tls_1_1_t_l_s_connectable_1aab01b740bda8c518ec4cadf8b9d58274" kindref="member">connectable</ref>.<ref refid="classanyio_1_1streams_1_1tls_1_1_t_l_s_connectable_1a40a45922b6a00b2e1a5d6aa4492e034a" kindref="member">connect</ref>()</highlight></codeline>
<codeline lineno="408"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">try</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="409"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>await<sp/>TLSStream.wrap(</highlight></codeline>
<codeline lineno="410"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>stream,</highlight></codeline>
<codeline lineno="411"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>hostname=self.<ref refid="classanyio_1_1streams_1_1tls_1_1_t_l_s_connectable_1a8104db93e03c9dce447a7b44217d0972" kindref="member">hostname</ref>,</highlight></codeline>
<codeline lineno="412"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ssl_context=self.<ref refid="classanyio_1_1streams_1_1tls_1_1_t_l_s_connectable_1ae67cd14ec7ffbe0ee2276820e48d3bcd" kindref="member">ssl_context</ref>,</highlight></codeline>
<codeline lineno="413"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>standard_compatible=self.<ref refid="classanyio_1_1streams_1_1tls_1_1_t_l_s_connectable_1ac328b6bb19b3a8673fac99e74dff0c24" kindref="member">standard_compatible</ref>,</highlight></codeline>
<codeline lineno="414"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>)</highlight></codeline>
<codeline lineno="415"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">except</highlight><highlight class="normal"><sp/>BaseException:</highlight></codeline>
<codeline lineno="416"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>await<sp/>aclose_forcefully(stream)</highlight></codeline>
<codeline lineno="417"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">raise</highlight><highlight class="normal"></highlight></codeline>
    </programlisting>
    <location file="micro_gestion_objetos/venv/Lib/site-packages/anyio/streams/tls.py"/>
  </compounddef>
</doxygen>
