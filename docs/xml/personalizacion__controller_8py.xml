<?xml version='1.0' encoding='UTF-8' standalone='no'?>
<doxygen xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="compound.xsd" version="1.15.0" xml:lang="es">
  <compounddef id="personalizacion__controller_8py" kind="file" language="Python">
    <compoundname>personalizacion_controller.py</compoundname>
    <innernamespace refid="namespaceapp">app</innernamespace>
    <innernamespace refid="namespaceapp_1_1application">app::application</innernamespace>
    <innernamespace refid="namespaceapp_1_1application_1_1controllers">app::application::controllers</innernamespace>
    <innernamespace refid="namespaceapp_1_1application_1_1controllers_1_1personalizacion__controller">app::application::controllers::personalizacion_controller</innernamespace>
    <briefdescription>
    </briefdescription>
    <detaileddescription>
    </detaileddescription>
    <programlisting>
<codeline lineno="1" refid="namespaceapp_1_1application_1_1controllers_1_1personalizacion__controller" refkind="compound"><highlight class="stringliteral">&quot;&quot;&quot;</highlight></codeline>
<codeline lineno="2"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>@file<sp/>personalizacion_controller.py</highlight></codeline>
<codeline lineno="3"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>@brief<sp/>Controlador<sp/>REST<sp/>para<sp/>gestión<sp/>de<sp/>preferencias<sp/>e<sp/>interacciones<sp/>de<sp/>usuario.</highlight></codeline>
<codeline lineno="4"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>@details</highlight></codeline>
<codeline lineno="5"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>Proporciona<sp/>endpoints<sp/>para:</highlight></codeline>
<codeline lineno="6"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>-<sp/>Crear<sp/>preferencias/contratos<sp/>ECA<sp/>para<sp/>usuario</highlight></codeline>
<codeline lineno="7"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>-<sp/>Recibir<sp/>y<sp/>cargar<sp/>ontologías<sp/>de<sp/>perfil<sp/>de<sp/>usuario</highlight></codeline>
<codeline lineno="8"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>-<sp/>Notificar<sp/>salida<sp/>de<sp/>usuario<sp/>(desactivar<sp/>ECAs)</highlight></codeline>
<codeline lineno="9"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>-<sp/>Registrar<sp/>interacciones<sp/>usuario-objeto</highlight></codeline>
<codeline lineno="10"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>-<sp/>Health<sp/>check<sp/>del<sp/>servicio</highlight></codeline>
<codeline lineno="11"><highlight class="stringliteral"><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="12"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>@note<sp/>El<sp/>microservicio<sp/>integra<sp/>con<sp/>micro_gestion_conocimiento<sp/>y<sp/>micro_automatizacion.</highlight></codeline>
<codeline lineno="13"><highlight class="stringliteral"><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="14"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>@author<sp/><sp/>NexTech</highlight></codeline>
<codeline lineno="15"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>@version<sp/>1.0</highlight></codeline>
<codeline lineno="16"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>@date<sp/>2025-01-10</highlight></codeline>
<codeline lineno="17"><highlight class="stringliteral"><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="18"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>@see<sp/>PersonalizacionService<sp/>Para<sp/>lógica<sp/>de<sp/>negocio</highlight></codeline>
<codeline lineno="19"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>@see<sp/>micro_gestion_conocimiento<sp/>Para<sp/>ontologías</highlight></codeline>
<codeline lineno="20"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>@see<sp/>micro_automatizacion<sp/>Para<sp/>ECAs</highlight></codeline>
<codeline lineno="21"><highlight class="stringliteral">&quot;&quot;&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="22"><highlight class="normal"></highlight></codeline>
<codeline lineno="23"><highlight class="normal"></highlight><highlight class="keyword">from</highlight><highlight class="normal"><sp/>fastapi<sp/></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>APIRouter,<sp/>Depends,<sp/>HTTPException,<sp/>Query,<sp/>File,<sp/>Form,<sp/>UploadFile</highlight></codeline>
<codeline lineno="24"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>json</highlight></codeline>
<codeline lineno="25"><highlight class="normal"></highlight><highlight class="keyword">from</highlight><highlight class="normal"><sp/>application.dtos.request_dtos<sp/></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>CrearPreferenciaRequest,<sp/>MakeContractRequest,<sp/>RegistroInteraccionDTO</highlight></codeline>
<codeline lineno="26"><highlight class="normal"></highlight><highlight class="keyword">from</highlight><highlight class="normal"><sp/>domain.services.personalizacion_service<sp/></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>PersonalizacionService</highlight></codeline>
<codeline lineno="27"><highlight class="normal"></highlight><highlight class="keyword">from</highlight><highlight class="normal"><sp/>infrastructure.logging.Logging<sp/></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>logger</highlight></codeline>
<codeline lineno="28"><highlight class="normal"></highlight><highlight class="keyword">from</highlight><highlight class="normal"><sp/>deps<sp/></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>get_personalizacion_service</highlight></codeline>
<codeline lineno="29"><highlight class="normal"></highlight></codeline>
<codeline lineno="30"><highlight class="normal"></highlight></codeline>
<codeline lineno="31"><highlight class="normal"></highlight></codeline>
<codeline lineno="32" refid="namespaceapp_1_1application_1_1controllers_1_1personalizacion__controller_1a154e3756c89ab16af42620612f3de040" refkind="member"><highlight class="normal">router<sp/>=<sp/><ref refid="classfastapi_1_1routing_1_1_a_p_i_router" kindref="compound">APIRouter</ref>(prefix=</highlight><highlight class="stringliteral">&quot;/personalizacion&quot;</highlight><highlight class="normal">,<sp/>tags=[</highlight><highlight class="stringliteral">&quot;Gestión<sp/>de<sp/>Personalización<sp/>de<sp/>Usuario&quot;</highlight><highlight class="normal">])</highlight></codeline>
<codeline lineno="33"><highlight class="normal"></highlight><highlight class="stringliteral">&quot;&quot;&quot;@var<sp/>router<sp/>Router<sp/>principal<sp/>para<sp/>endpoints<sp/>de<sp/>personalización.&quot;&quot;&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="34"><highlight class="normal"></highlight></codeline>
<codeline lineno="35"><highlight class="normal"></highlight><highlight class="preprocessor">@router.post(&quot;/CrearPreferencia&quot;)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="36" refid="namespaceapp_1_1application_1_1controllers_1_1personalizacion__controller_1a892611f9f49670f35cdbd570095b6960" refkind="member"><highlight class="normal"></highlight><highlight class="keyword">async<sp/>def<sp/></highlight><highlight class="normal"><ref refid="namespaceapp_1_1application_1_1controllers_1_1personalizacion__controller_1a892611f9f49670f35cdbd570095b6960" kindref="member">crear_preferencia</ref>(</highlight></codeline>
<codeline lineno="37"><highlight class="normal"><sp/><sp/><sp/><sp/>data:MakeContractRequest,</highlight></codeline>
<codeline lineno="38"><highlight class="normal"><sp/><sp/><sp/><sp/>personalizacion_service:<sp/>PersonalizacionService<sp/>=<sp/>Depends(get_personalizacion_service)</highlight></codeline>
<codeline lineno="39"><highlight class="normal">):</highlight></codeline>
<codeline lineno="40"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;&quot;&quot;</highlight></codeline>
<codeline lineno="41"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>@brief<sp/>Crea<sp/>una<sp/>nueva<sp/>preferencia/contrato<sp/>ECA<sp/>para<sp/>el<sp/>usuario<sp/>actual.</highlight></codeline>
<codeline lineno="42"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="43"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>@param<sp/>data<sp/>DTO<sp/>MakeContractRequest<sp/>con<sp/>definición<sp/>del<sp/>contrato<sp/>ECA.</highlight></codeline>
<codeline lineno="44"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>@param<sp/>personalizacion_service<sp/>Servicio<sp/>de<sp/>personalización<sp/>(inyectado).</highlight></codeline>
<codeline lineno="45"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="46"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>@return<sp/>JSONResponse<sp/>con<sp/>status<sp/>200<sp/>si<sp/>exitoso,<sp/>o<sp/>error<sp/>400/500.</highlight></codeline>
<codeline lineno="47"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="48"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>@exception<sp/>HTTPException<sp/>Si<sp/>email<sp/>no<sp/>coincide<sp/>o<sp/>hay<sp/>error<sp/>en<sp/>micro_automatizacion.</highlight></codeline>
<codeline lineno="49"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="50"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>@details</highlight></codeline>
<codeline lineno="51"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>Crea<sp/>una<sp/>regla<sp/>ECA<sp/>(contrato)<sp/>que<sp/>automatiza<sp/>comportamientos<sp/>del<sp/>usuario.</highlight></codeline>
<codeline lineno="52"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="53"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>Flujo:</highlight></codeline>
<codeline lineno="54"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>1.<sp/>Verifica<sp/>que<sp/>el<sp/>email<sp/>del<sp/>DTO<sp/>coincida<sp/>con<sp/>el<sp/>usuario<sp/>actual</highlight></codeline>
<codeline lineno="55"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>2.<sp/>Envía<sp/>solicitud<sp/>al<sp/>microservicio<sp/>micro_automatizacion</highlight></codeline>
<codeline lineno="56"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>3.<sp/>Registra<sp/>la<sp/>preferencia<sp/>en<sp/>ontología<sp/>de<sp/>usuario</highlight></codeline>
<codeline lineno="57"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="58"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>@see<sp/>PersonalizacionService.crear_preferencia()</highlight></codeline>
<codeline lineno="59"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>@see<sp/>micro_automatizacion<sp/>Para<sp/>implementación<sp/>de<sp/>ECAs</highlight></codeline>
<codeline lineno="60"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&quot;&quot;&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="61"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">try</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="62"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>await<sp/>personalizacion_service.crear_preferencia(data)</highlight></codeline>
<codeline lineno="63"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">except</highlight><highlight class="normal"><sp/>HTTPException:</highlight></codeline>
<codeline lineno="64"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">raise</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="65"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">except</highlight><highlight class="normal"><sp/>Exception<sp/></highlight><highlight class="keyword">as</highlight><highlight class="normal"><sp/>e:</highlight></codeline>
<codeline lineno="66"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>logger.error(f</highlight><highlight class="stringliteral">&quot;Error<sp/>inesperado<sp/>en<sp/>CrearPreferencia:<sp/>{e}&quot;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="67"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">raise</highlight><highlight class="normal"><sp/><ref refid="classfastapi_1_1exceptions_1_1_h_t_t_p_exception" kindref="compound">HTTPException</ref>(status_code=500,<sp/>detail=</highlight><highlight class="stringliteral">&quot;Error<sp/>interno<sp/>del<sp/>servidor&quot;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="68"><highlight class="normal"></highlight></codeline>
<codeline lineno="69"><highlight class="normal"></highlight></codeline>
<codeline lineno="70"><highlight class="normal"></highlight><highlight class="preprocessor">@router.post(&quot;/RecibirOntologia&quot;)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="71" refid="namespaceapp_1_1application_1_1controllers_1_1personalizacion__controller_1a48b29fa9bd067de558e7e52065de6457" refkind="member"><highlight class="normal"></highlight><highlight class="keyword">async<sp/>def<sp/></highlight><highlight class="normal"><ref refid="namespaceapp_1_1application_1_1controllers_1_1personalizacion__controller_1a48b29fa9bd067de558e7e52065de6457" kindref="member">recibir_ontologia</ref>(</highlight></codeline>
<codeline lineno="72"><highlight class="normal"><sp/><sp/><sp/><sp/>file:<sp/>UploadFile<sp/>=<sp/>File(...,<sp/>description=</highlight><highlight class="stringliteral">&quot;Archivo<sp/>de<sp/>ontología<sp/>(.owl)&quot;</highlight><highlight class="normal">),</highlight></codeline>
<codeline lineno="73"><highlight class="normal"><sp/><sp/><sp/><sp/>nombre:<sp/>str<sp/>=<sp/>Form(...,<sp/>description=</highlight><highlight class="stringliteral">&quot;Nombre<sp/>de<sp/>la<sp/>ontología&quot;</highlight><highlight class="normal">),</highlight></codeline>
<codeline lineno="74"><highlight class="normal"><sp/><sp/><sp/><sp/>ipCoordinador:<sp/>str<sp/>=<sp/>Form(...,<sp/>description=</highlight><highlight class="stringliteral">&quot;IP<sp/>del<sp/>coordinador&quot;</highlight><highlight class="normal">),</highlight></codeline>
<codeline lineno="75"><highlight class="normal"><sp/><sp/><sp/><sp/>personalizacion_service:<sp/>PersonalizacionService<sp/>=<sp/>Depends(get_personalizacion_service)</highlight></codeline>
<codeline lineno="76"><highlight class="normal">):</highlight></codeline>
<codeline lineno="77"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;&quot;&quot;</highlight></codeline>
<codeline lineno="78"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>@brief<sp/>Recibe<sp/>y<sp/>carga<sp/>ontología<sp/>de<sp/>perfil<sp/>de<sp/>usuario.</highlight></codeline>
<codeline lineno="79"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="80"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>@param<sp/>file<sp/>Archivo<sp/>.owl<sp/>con<sp/>ontología<sp/>del<sp/>usuario.</highlight></codeline>
<codeline lineno="81"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>@param<sp/>nombre<sp/>Identificador<sp/>de<sp/>la<sp/>ontología.</highlight></codeline>
<codeline lineno="82"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>@param<sp/>ipCoordinador<sp/>IP<sp/>del<sp/>coordinador<sp/>(para<sp/>tracking/notificación).</highlight></codeline>
<codeline lineno="83"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>@param<sp/>personalizacion_service<sp/>Servicio<sp/>de<sp/>personalización.</highlight></codeline>
<codeline lineno="84"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="85"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>@return<sp/>JSONResponse<sp/>con<sp/>status<sp/>200<sp/>si<sp/>exitoso,<sp/>o<sp/>error<sp/>400/500.</highlight></codeline>
<codeline lineno="86"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="87"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>@exception<sp/>HTTPException<sp/>Si<sp/>hay<sp/>error<sp/>en<sp/>procesamiento<sp/>o<sp/>envío.</highlight></codeline>
<codeline lineno="88"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="89"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>@details</highlight></codeline>
<codeline lineno="90"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>Endpoint<sp/>de<sp/>integración:<sp/>recibe<sp/>ontología<sp/>del<sp/>coordinador<sp/>y<sp/>la<sp/>envía</highlight></codeline>
<codeline lineno="91"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>al<sp/>microservicio<sp/>micro_gestion_conocimiento<sp/>para<sp/>población.</highlight></codeline>
<codeline lineno="92"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="93"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>Flujo:</highlight></codeline>
<codeline lineno="94"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>1.<sp/>Valida<sp/>que<sp/>el<sp/>archivo<sp/>sea<sp/>.owl</highlight></codeline>
<codeline lineno="95"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>2.<sp/>Envía<sp/>al<sp/>microservicio<sp/>de<sp/>ontologías</highlight></codeline>
<codeline lineno="96"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>3.<sp/>Guarda<sp/>IP<sp/>del<sp/>coordinador<sp/>para<sp/>tracking</highlight></codeline>
<codeline lineno="97"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>4.<sp/>Activa<sp/>ECAs<sp/>del<sp/>usuario</highlight></codeline>
<codeline lineno="98"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="99"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>@see<sp/>PersonalizacionService.recibir_ontologia()</highlight></codeline>
<codeline lineno="100"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>@see<sp/>micro_gestion_conocimiento<sp/>Para<sp/>carga<sp/>de<sp/>ontologías</highlight></codeline>
<codeline lineno="101"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&quot;&quot;&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="102"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">try</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="103"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>await<sp/>personalizacion_service.recibir_ontologia(file,nombre,ipCoordinador)<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="104"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">except</highlight><highlight class="normal"><sp/>Exception<sp/></highlight><highlight class="keyword">as</highlight><highlight class="normal"><sp/>e:</highlight></codeline>
<codeline lineno="105"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>logger.error(f</highlight><highlight class="stringliteral">&quot;<sp/>Error<sp/>procesando<sp/>ontología:<sp/>{e}&quot;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="106"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">raise</highlight><highlight class="normal"><sp/><ref refid="classfastapi_1_1exceptions_1_1_h_t_t_p_exception" kindref="compound">HTTPException</ref>(status_code=500,<sp/>detail=</highlight><highlight class="stringliteral">&quot;Error<sp/>interno<sp/>del<sp/>servidor&quot;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="107"><highlight class="normal"></highlight></codeline>
<codeline lineno="108"><highlight class="normal"></highlight><highlight class="preprocessor">@router.post(&quot;/NotificarSalidaDeUsuario&quot;)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="109" refid="namespaceapp_1_1application_1_1controllers_1_1personalizacion__controller_1a429b450a48f045b0b0143521a67ae7af" refkind="member"><highlight class="normal"></highlight><highlight class="keyword">async<sp/>def<sp/></highlight><highlight class="normal"><ref refid="namespaceapp_1_1application_1_1controllers_1_1personalizacion__controller_1a429b450a48f045b0b0143521a67ae7af" kindref="member">notificar_salida_usuario</ref>(<sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="110"><highlight class="normal"><sp/><sp/><sp/><sp/>personalizacion_service:<sp/>PersonalizacionService<sp/>=<sp/>Depends(get_personalizacion_service)</highlight></codeline>
<codeline lineno="111"><highlight class="normal">):</highlight></codeline>
<codeline lineno="112"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;&quot;&quot;</highlight></codeline>
<codeline lineno="113"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>@brief<sp/>Notifica<sp/>la<sp/>salida<sp/>del<sp/>usuario<sp/>y<sp/>desactiva<sp/>sus<sp/>ECAs.</highlight></codeline>
<codeline lineno="114"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="115"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>@param<sp/>personalizacion_service<sp/>Servicio<sp/>de<sp/>personalización.</highlight></codeline>
<codeline lineno="116"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="117"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>@return<sp/>JSONResponse<sp/>con<sp/>status<sp/>200<sp/>si<sp/>exitoso,<sp/>o<sp/>error<sp/>500.</highlight></codeline>
<codeline lineno="118"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="119"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>@exception<sp/>HTTPException<sp/>Si<sp/>hay<sp/>error<sp/>coordinando<sp/>desactivación.</highlight></codeline>
<codeline lineno="120"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="121"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>@details</highlight></codeline>
<codeline lineno="122"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>Implementa<sp/>HU-2<sp/>(Historia<sp/>de<sp/>Usuario<sp/>2):<sp/>cuando<sp/>el<sp/>usuario<sp/>se<sp/>desconecta,</highlight></codeline>
<codeline lineno="123"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>desactiva<sp/>todas<sp/>sus<sp/>reglas<sp/>ECAs<sp/>en<sp/>el<sp/>microservicio<sp/>de<sp/>automatización.</highlight></codeline>
<codeline lineno="124"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="125"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>@note<sp/>Operación<sp/>de<sp/>coordinación<sp/>inter-servicios.</highlight></codeline>
<codeline lineno="126"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="127"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>@see<sp/>PersonalizacionService.desactivarEcasUsuarioActual()</highlight></codeline>
<codeline lineno="128"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>@see<sp/>micro_automatizacion<sp/>Para<sp/>desactivación<sp/>de<sp/>ECAs</highlight></codeline>
<codeline lineno="129"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&quot;&quot;&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="130"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">try</highlight><highlight class="normal">:<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="131"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>personalizacion_service.desactivarEcasUsuarioActual()</highlight></codeline>
<codeline lineno="132"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">except</highlight><highlight class="normal"><sp/>Exception<sp/></highlight><highlight class="keyword">as</highlight><highlight class="normal"><sp/>e:</highlight></codeline>
<codeline lineno="133"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>logger.error(f</highlight><highlight class="stringliteral">&quot;<sp/>Error<sp/>notificando<sp/>salida<sp/>de<sp/>usuario:<sp/>{e}&quot;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="134"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">raise</highlight><highlight class="normal"><sp/><ref refid="classfastapi_1_1exceptions_1_1_h_t_t_p_exception" kindref="compound">HTTPException</ref>(status_code=500,<sp/>detail=</highlight><highlight class="stringliteral">&quot;Error<sp/>interno<sp/>del<sp/>servidor&quot;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="135"><highlight class="normal"></highlight></codeline>
<codeline lineno="136"><highlight class="normal"></highlight><highlight class="preprocessor">@router.post(&quot;/RegistroInteraccionUsuarioObjeto&quot;)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="137" refid="namespaceapp_1_1application_1_1controllers_1_1personalizacion__controller_1aeb80e12c70c9905b4a7a3b87ee505bd4" refkind="member"><highlight class="normal"></highlight><highlight class="keyword">async<sp/>def<sp/></highlight><highlight class="normal"><ref refid="namespaceapp_1_1application_1_1controllers_1_1personalizacion__controller_1aeb80e12c70c9905b4a7a3b87ee505bd4" kindref="member">registro_interaccion_usuario_objeto</ref>(data:<sp/>RegistroInteraccionDTO,<sp/>personalizacion_service:<sp/>PersonalizacionService<sp/>=<sp/>Depends(get_personalizacion_service)):</highlight></codeline>
<codeline lineno="138"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;&quot;&quot;</highlight></codeline>
<codeline lineno="139"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>@brief<sp/>Registra<sp/>una<sp/>interacción<sp/>entre<sp/>usuario<sp/>y<sp/>objeto<sp/>inteligente.</highlight></codeline>
<codeline lineno="140"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="141"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>@param<sp/>data<sp/>DTO<sp/>RegistroInteraccionDTO<sp/>con<sp/>evento<sp/>de<sp/>interacción.</highlight></codeline>
<codeline lineno="142"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>@param<sp/>personalizacion_service<sp/>Servicio<sp/>de<sp/>personalización.</highlight></codeline>
<codeline lineno="143"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="144"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>@return<sp/>JSONResponse<sp/>con<sp/>status<sp/>200<sp/>si<sp/>exitoso,<sp/>o<sp/>error<sp/>500.</highlight></codeline>
<codeline lineno="145"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="146"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>@exception<sp/>HTTPException<sp/>Si<sp/>hay<sp/>error<sp/>al<sp/>registrar<sp/>interacción.</highlight></codeline>
<codeline lineno="147"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="148"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>@details</highlight></codeline>
<codeline lineno="149"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>Registra<sp/>eventos<sp/>de<sp/>interacción<sp/>(p.<sp/>ej.<sp/>usuario<sp/>accede<sp/>a<sp/>objeto,</highlight></codeline>
<codeline lineno="150"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>modifica<sp/>preferencias,<sp/>etc.)<sp/>para<sp/>crear<sp/>historial<sp/>y<sp/>base<sp/>para</highlight></codeline>
<codeline lineno="151"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>personalización<sp/>e<sp/>inferencia<sp/>de<sp/>patrones.</highlight></codeline>
<codeline lineno="152"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="153"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>@see<sp/>PersonalizacionService.registroInteraccionUsuarioObjeto()</highlight></codeline>
<codeline lineno="154"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&quot;&quot;&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="155"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">try</highlight><highlight class="normal">:<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="156"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>personalizacion_service.registroInteraccionUsuarioObjeto(data)<sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="157"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">except</highlight><highlight class="normal"><sp/>Exception<sp/></highlight><highlight class="keyword">as</highlight><highlight class="normal"><sp/>e:</highlight></codeline>
<codeline lineno="158"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>logger.error(f</highlight><highlight class="stringliteral">&quot;Error<sp/>registrando<sp/>interacción:<sp/>{e}&quot;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="159"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">raise</highlight><highlight class="normal"><sp/><ref refid="classfastapi_1_1exceptions_1_1_h_t_t_p_exception" kindref="compound">HTTPException</ref>(status_code=500,<sp/>detail=</highlight><highlight class="stringliteral">&quot;Error<sp/>interno<sp/>del<sp/>servidor&quot;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="160"><highlight class="normal"></highlight></codeline>
<codeline lineno="161"><highlight class="normal"></highlight><highlight class="preprocessor">@router.get(&quot;/health&quot;)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="162" refid="namespaceapp_1_1application_1_1controllers_1_1personalizacion__controller_1aa601f56d2df7723a033d1ff86144e976" refkind="member"><highlight class="normal"></highlight><highlight class="keyword">async<sp/>def<sp/></highlight><highlight class="normal"><ref refid="namespaceapp_1_1application_1_1controllers_1_1personalizacion__controller_1aa601f56d2df7723a033d1ff86144e976" kindref="member">health_check</ref>(</highlight></codeline>
<codeline lineno="163"><highlight class="normal"><sp/><sp/><sp/><sp/>personalizacion_service:<sp/>PersonalizacionService<sp/>=<sp/>Depends(get_personalizacion_service)</highlight></codeline>
<codeline lineno="164"><highlight class="normal">):</highlight></codeline>
<codeline lineno="165"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;&quot;&quot;</highlight></codeline>
<codeline lineno="166"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>@brief<sp/>Health<sp/>check<sp/>/<sp/>status<sp/>del<sp/>microservicio.</highlight></codeline>
<codeline lineno="167"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="168"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>@param<sp/>personalizacion_service<sp/>Servicio<sp/>de<sp/>personalización.</highlight></codeline>
<codeline lineno="169"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="170"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>@return<sp/>JSON<sp/>con<sp/>status:<sp/>&apos;healthy&apos;<sp/>o<sp/>&apos;degraded&apos;,<sp/>nombre<sp/>y<sp/>versión<sp/>del<sp/>servicio.</highlight></codeline>
<codeline lineno="171"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="172"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>@details</highlight></codeline>
<codeline lineno="173"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>Endpoint<sp/>para<sp/>monitoreo<sp/>y<sp/>orquestación<sp/>de<sp/>contenedores.</highlight></codeline>
<codeline lineno="174"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>Verifica<sp/>que<sp/>el<sp/>servicio<sp/>esté<sp/>disponible.</highlight></codeline>
<codeline lineno="175"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&quot;&quot;&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="176"><highlight class="normal"><sp/><sp/><sp/><sp/>status<sp/>=<sp/></highlight><highlight class="stringliteral">&quot;healthy&quot;</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>personalizacion_service<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/></highlight><highlight class="stringliteral">&quot;degraded&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="177"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="178"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;status&quot;</highlight><highlight class="normal">:<sp/>status,</highlight></codeline>
<codeline lineno="179"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;service&quot;</highlight><highlight class="normal">:<sp/></highlight><highlight class="stringliteral">&quot;microservicio_personalizacion&quot;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="180"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;version&quot;</highlight><highlight class="normal">:<sp/></highlight><highlight class="stringliteral">&quot;1.0.0&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="181"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
    </programlisting>
    <location file="microservicio_personalizacion/app/application/controllers/personalizacion_controller.py"/>
  </compounddef>
</doxygen>
