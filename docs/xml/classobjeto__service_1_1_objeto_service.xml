<?xml version='1.0' encoding='UTF-8' standalone='no'?>
<doxygen xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="compound.xsd" version="1.15.0" xml:lang="es">
  <compounddef id="classobjeto__service_1_1_objeto_service" kind="class" language="Python" prot="public">
    <compoundname>objeto_service::ObjetoService</compoundname>
    <sectiondef kind="public-attrib">
      <memberdef kind="variable" id="classobjeto__service_1_1_objeto_service_1aa655c94a8b2e89e43fdb66a7b708317e" prot="public" static="no" mutable="no">
        <type></type>
        <definition>objeto_service.ObjetoService::log_panel</definition>
        <argsstring></argsstring>
        <name>log_panel</name>
        <qualifiedname>objeto_service.ObjetoService.log_panel</qualifiedname>
        <initializer>=  log_panel</initializer>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="micro_gestion_objetos/app/application/objeto_service.py" line="93" column="1" bodyfile="micro_gestion_objetos/app/application/objeto_service.py" bodystart="93" bodyend="-1"/>
        <referencedby refid="classobjeto__service_1_1_objeto_service_1aa63f3b78f5246c50c8ea7a491cf22186" compoundref="objeto__service_8py" startline="310" endline="390">objeto_service.ObjetoService.get_state</referencedby>
        <referencedby refid="classobjeto__service_1_1_objeto_service_1ab6099fcce1bd3a003a91ecad3e645ca4" compoundref="objeto__service_8py" startline="125" endline="206">objeto_service.ObjetoService.getIdentificator</referencedby>
        <referencedby refid="classobjeto__service_1_1_objeto_service_1ac8d4cbd3fd1ac32e58ab625b67446806" compoundref="objeto__service_8py" startline="422" endline="472">objeto_service.ObjetoService.send_data</referencedby>
        <referencedby refid="classobjeto__service_1_1_objeto_service_1aeae5c6d6e41915ef0e8f9d9f06d9bd75" compoundref="objeto__service_8py" startline="391" endline="421">objeto_service.ObjetoService.send_service_state</referencedby>
        <referencedby refid="classobjeto__service_1_1_objeto_service_1a648c3879efddba25a26929db743dd40f" compoundref="objeto__service_8py" startline="207" endline="309">objeto_service.ObjetoService.startObject</referencedby>
      </memberdef>
      <memberdef kind="variable" id="classobjeto__service_1_1_objeto_service_1a9d33cc56721110014d500eca8c1da264" prot="public" static="no" mutable="no">
        <type><ref refid="namespace_objeto_inteligente" kindref="compound">ObjetoInteligente</ref></type>
        <definition>ObjetoInteligente objeto_service.ObjetoService::objetoInteligente</definition>
        <argsstring></argsstring>
        <name>objetoInteligente</name>
        <qualifiedname>objeto_service.ObjetoService.objetoInteligente</qualifiedname>
        <initializer>=  self.__initializeObjetoInteligente()</initializer>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="micro_gestion_objetos/app/application/objeto_service.py" line="94" column="1" bodyfile="micro_gestion_objetos/app/application/objeto_service.py" bodystart="94" bodyend="-1"/>
        <referencedby refid="classobjeto__service_1_1_objeto_service_1aa63f3b78f5246c50c8ea7a491cf22186" compoundref="objeto__service_8py" startline="310" endline="390">objeto_service.ObjetoService.get_state</referencedby>
        <referencedby refid="classobjeto__service_1_1_objeto_service_1ab6099fcce1bd3a003a91ecad3e645ca4" compoundref="objeto__service_8py" startline="125" endline="206">objeto_service.ObjetoService.getIdentificator</referencedby>
        <referencedby refid="classobjeto__service_1_1_objeto_service_1ac8d4cbd3fd1ac32e58ab625b67446806" compoundref="objeto__service_8py" startline="422" endline="472">objeto_service.ObjetoService.send_data</referencedby>
        <referencedby refid="classobjeto__service_1_1_objeto_service_1aeae5c6d6e41915ef0e8f9d9f06d9bd75" compoundref="objeto__service_8py" startline="391" endline="421">objeto_service.ObjetoService.send_service_state</referencedby>
        <referencedby refid="classobjeto__service_1_1_objeto_service_1a648c3879efddba25a26929db743dd40f" compoundref="objeto__service_8py" startline="207" endline="309">objeto_service.ObjetoService.startObject</referencedby>
      </memberdef>
      <memberdef kind="variable" id="classobjeto__service_1_1_objeto_service_1a9a545b2a9ad6061eca72bd20055365f3" prot="public" static="no" mutable="no">
        <type></type>
        <definition>objeto_service.ObjetoService::persistence</definition>
        <argsstring></argsstring>
        <name>persistence</name>
        <qualifiedname>objeto_service.ObjetoService.persistence</qualifiedname>
        <initializer>=  persistence</initializer>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="micro_gestion_objetos/app/application/objeto_service.py" line="95" column="1" bodyfile="micro_gestion_objetos/app/application/objeto_service.py" bodystart="95" bodyend="-1"/>
        <referencedby refid="classobjeto__service_1_1_objeto_service_1ab6099fcce1bd3a003a91ecad3e645ca4" compoundref="objeto__service_8py" startline="125" endline="206">objeto_service.ObjetoService.getIdentificator</referencedby>
        <referencedby refid="classobjeto__service_1_1_objeto_service_1a648c3879efddba25a26929db743dd40f" compoundref="objeto__service_8py" startline="207" endline="309">objeto_service.ObjetoService.startObject</referencedby>
      </memberdef>
    </sectiondef>
    <sectiondef kind="public-func">
      <memberdef kind="function" id="classobjeto__service_1_1_objeto_service_1ab6099fcce1bd3a003a91ecad3e645ca4" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>JSONResponse</type>
        <definition>JSONResponse objeto_service.ObjetoService.getIdentificator</definition>
        <argsstring>(self, int osid)</argsstring>
        <name>getIdentificator</name>
        <qualifiedname>objeto_service.ObjetoService.getIdentificator</qualifiedname>
        <param>
          <type>self</type>
          <defname>self</defname>
        </param>
        <param>
          <type>int</type>
          <declname>osid</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para><verbatim>    @brief Obtiene los metadatos del objeto inteligente.
    
    @param osid Identificador único del objeto inteligente (debe coincidir con el activo).
    
    @return JSONResponse con status 200 y metadatos si existe, o error 400/500.
    
    @exception ValueError Si osid no coincide.
    @exception RuntimeError Si falla la lectura de persistencia.
    
    @details
    Flujo:
    1. Valida que el osid coincida con el objeto activo
    2. Publica log raw en panel MQTT (inicio solicitud)
    3. Verifica que los metadatos existan en persistencia
    4. Retorna los metadatos en formato JSON con status 200
    5. Publica log de respuesta en panel MQTT
    
    Si el osid no coincide, retorna error 400.
    Si hay error al leer metadatos, retorna error 500.
    
    @see persistence.is_object_metadata_exists()
    @see persistence.get_object_metadata()
    @see log_panel.PubRawLog()
    @see log_panel.PubLog()
    
    @example
    200 OK:
    {
        &quot;status&quot;: &quot;success&quot;,
        &quot;message&quot;: &quot;Metadatos del objeto inteligente obtenidos correctamente.&quot;,
        &quot;data&quot;: {
            &quot;id&quot;: &quot;obj_001&quot;,
            &quot;title&quot;: &quot;Sensor Temperatura Sala A&quot;,
            &quot;datastreams&quot;: [...],
            ...
        }
    }
</verbatim> </para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="micro_gestion_objetos/app/application/objeto_service.py" line="125" column="1" bodyfile="micro_gestion_objetos/app/application/objeto_service.py" bodystart="125" bodyend="206"/>
        <references refid="classobjeto__service_1_1_objeto_service_1aa655c94a8b2e89e43fdb66a7b708317e" compoundref="objeto__service_8py" startline="93">objeto_service.ObjetoService.log_panel</references>
        <references refid="classobjeto__service_1_1_objeto_service_1a9d33cc56721110014d500eca8c1da264" compoundref="objeto__service_8py" startline="94">objeto_service.ObjetoService.objetoInteligente</references>
        <references refid="classobjeto__service_1_1_objeto_service_1a9a545b2a9ad6061eca72bd20055365f3" compoundref="objeto__service_8py" startline="95">objeto_service.ObjetoService.persistence</references>
      </memberdef>
      <memberdef kind="function" id="classobjeto__service_1_1_objeto_service_1a648c3879efddba25a26929db743dd40f" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>JSONResponse</type>
        <definition>JSONResponse objeto_service.ObjetoService.startObject</definition>
        <argsstring>(self, ObjectData data)</argsstring>
        <name>startObject</name>
        <qualifiedname>objeto_service.ObjetoService.startObject</qualifiedname>
        <param>
          <type>self</type>
          <defname>self</defname>
        </param>
        <param>
          <type>ObjectData</type>
          <declname>data</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para><verbatim>    @brief Inicia un nuevo objeto inteligente con datos proporcionados.
    
    @param data DTO ObjectData con configuración: feed (id, title, datastreams, etc.)
    
    @return JSONResponse con status 200 si exitoso, o error 400/500 si falla.
    
    @exception ValueError Si los datos del DTO son inválidos.
    @exception RuntimeError Si falla la población de ontología o persistencia.
    
    @details
    Operación compuesta y distribuida que:
    
    1. Valida que la ontología no esté ya activa (evita reinicios)
    2. Estructura los datos en formato JSON compatible con el objeto inteligente
    3. Puebla la ontología en micro_gestion_conocimiento (crea individuos OWL)
    4. Actualiza los atributos del modelo de dominio en memoria
    5. Persiste metadatos en JSON/DB mediante repositorio
    6. Crea dispositivo en ThingsBoard (IoT Platform) y obtiene token
    7. Publica mensaje en cola MQTT para que microservicio_data_stream
       registre los datastreams
    8. Registra eventos en panel MQTT para auditoría
    
    @note Esta es una operación **distribuida** que involucra múltiples
          microservicios. Si algún paso falla (ej. ThingsBoard no disponible),
          la ontología ya fue poblada y los metadatos ya se persistieron.
          Considerar implementar saga/compensación o transacciones distribuidas.
    
    @warning Si la población de ontología falla, retorna error 500.
             Posterior ejecución puede intentar reintentar con idempotencia.
    
    @see ontology_service.poblate_ontology()
    @see persistence.save_object_metadata()
    @see tb_client.create_device_with_token() Para ThingsBoard
    @see log_panel.Publicar() Para cola de datastreams
    @see docs/diagrams/flow_diagrams.md (StartObject sequence diagram)
    
    @example
    POST /objeto/StartObject
    {
        &quot;feed&quot;: {
            &quot;id&quot;: &quot;obj_sensor_001&quot;,
            &quot;title&quot;: &quot;Sensor Temperatura Sala&quot;,
            &quot;description&quot;: &quot;Sensor DHT22&quot;,
            &quot;datastreams&quot;: [&quot;temp&quot;, &quot;humidity&quot;]
        }
    }
    
    200 OK:
    {
        &quot;status&quot;: &quot;success&quot;,
        &quot;message&quot;: &quot;Objeto inteligente iniciado con éxito.&quot;,
        &quot;data&quot;: {}
    }
</verbatim> </para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="micro_gestion_objetos/app/application/objeto_service.py" line="207" column="1" bodyfile="micro_gestion_objetos/app/application/objeto_service.py" bodystart="207" bodyend="309"/>
        <references refid="namespaceontology__service_1ad1d75db7d2b40d16deff494adfc856d6" compoundref="micro__gestion__objetos_2app_2application_2ontology__service_8py" startline="8" endline="16">ontology_service.is_active</references>
        <references refid="classobjeto__service_1_1_objeto_service_1aa655c94a8b2e89e43fdb66a7b708317e" compoundref="objeto__service_8py" startline="93">objeto_service.ObjetoService.log_panel</references>
        <references refid="classobjeto__service_1_1_objeto_service_1a9d33cc56721110014d500eca8c1da264" compoundref="objeto__service_8py" startline="94">objeto_service.ObjetoService.objetoInteligente</references>
        <references refid="classobjeto__service_1_1_objeto_service_1a9a545b2a9ad6061eca72bd20055365f3" compoundref="objeto__service_8py" startline="95">objeto_service.ObjetoService.persistence</references>
        <references refid="namespaceontology__service_1a9b744e347f8745a90f27146fc35aaab3" compoundref="micro__gestion__objetos_2app_2application_2ontology__service_8py" startline="62" endline="101">ontology_service.poblate_ontology</references>
      </memberdef>
      <memberdef kind="function" id="classobjeto__service_1_1_objeto_service_1aa63f3b78f5246c50c8ea7a491cf22186" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>JSONResponse</type>
        <definition>JSONResponse objeto_service.ObjetoService.get_state</definition>
        <argsstring>(self, str osid)</argsstring>
        <name>get_state</name>
        <qualifiedname>objeto_service.ObjetoService.get_state</qualifiedname>
        <param>
          <type>self</type>
          <defname>self</defname>
        </param>
        <param>
          <type>str</type>
          <declname>osid</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para><verbatim>Obtiene el estado actual de los datastreams del objeto inteligente.

Esta implementación delega la obtención de estado al microservicio de
datastreams mediante `dataStream_service.send_state` y normaliza la
respuesta para mantener la forma esperada por la API.
</verbatim> </para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="micro_gestion_objetos/app/application/objeto_service.py" line="310" column="1" bodyfile="micro_gestion_objetos/app/application/objeto_service.py" bodystart="310" bodyend="390"/>
        <references refid="classobjeto__service_1_1_objeto_service_1aa655c94a8b2e89e43fdb66a7b708317e" compoundref="objeto__service_8py" startline="93">objeto_service.ObjetoService.log_panel</references>
        <references refid="classobjeto__service_1_1_objeto_service_1a9d33cc56721110014d500eca8c1da264" compoundref="objeto__service_8py" startline="94">objeto_service.ObjetoService.objetoInteligente</references>
      </memberdef>
      <memberdef kind="function" id="classobjeto__service_1_1_objeto_service_1aeae5c6d6e41915ef0e8f9d9f06d9bd75" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>JSONResponse</type>
        <definition>JSONResponse objeto_service.ObjetoService.send_service_state</definition>
        <argsstring>(self, str osid=None)</argsstring>
        <name>send_service_state</name>
        <qualifiedname>objeto_service.ObjetoService.send_service_state</qualifiedname>
        <param>
          <type>self</type>
          <defname>self</defname>
        </param>
        <param>
          <type>str</type>
          <declname>osid</declname>
          <defval>None</defval>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para><verbatim>Consulta la disponibilidad del microservicio de datastream.

Nota: el endpoint de datastream (`send_service_state`) no requiere
`osid`, por lo que aquí ignoramos el parámetro si se pasa desde la
ruta y delegamos directamente en `dataStream_service`.
</verbatim> </para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="micro_gestion_objetos/app/application/objeto_service.py" line="391" column="1" bodyfile="micro_gestion_objetos/app/application/objeto_service.py" bodystart="391" bodyend="421"/>
        <references refid="classobjeto__service_1_1_objeto_service_1aa655c94a8b2e89e43fdb66a7b708317e" compoundref="objeto__service_8py" startline="93">objeto_service.ObjetoService.log_panel</references>
        <references refid="classobjeto__service_1_1_objeto_service_1a9d33cc56721110014d500eca8c1da264" compoundref="objeto__service_8py" startline="94">objeto_service.ObjetoService.objetoInteligente</references>
      </memberdef>
      <memberdef kind="function" id="classobjeto__service_1_1_objeto_service_1ac8d4cbd3fd1ac32e58ab625b67446806" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>JSONResponse</type>
        <definition>JSONResponse objeto_service.ObjetoService.send_data</definition>
        <argsstring>(self, str osid, str variableEstado, str tipove=&apos;1&apos;)</argsstring>
        <name>send_data</name>
        <qualifiedname>objeto_service.ObjetoService.send_data</qualifiedname>
        <param>
          <type>self</type>
          <defname>self</defname>
        </param>
        <param>
          <type>str</type>
          <declname>osid</declname>
        </param>
        <param>
          <type>str</type>
          <declname>variableEstado</declname>
        </param>
        <param>
          <type>str</type>
          <declname>tipove</declname>
          <defval>&apos;1&apos;</defval>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para><verbatim>Solicita al microservicio de datastream el valor de un datastream espSecífico.</verbatim> </para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="micro_gestion_objetos/app/application/objeto_service.py" line="422" column="1" bodyfile="micro_gestion_objetos/app/application/objeto_service.py" bodystart="422" bodyend="472"/>
        <references refid="classobjeto__service_1_1_objeto_service_1aa655c94a8b2e89e43fdb66a7b708317e" compoundref="objeto__service_8py" startline="93">objeto_service.ObjetoService.log_panel</references>
        <references refid="classobjeto__service_1_1_objeto_service_1a9d33cc56721110014d500eca8c1da264" compoundref="objeto__service_8py" startline="94">objeto_service.ObjetoService.objetoInteligente</references>
      </memberdef>
    </sectiondef>
    <briefdescription>
    </briefdescription>
    <detaileddescription>
<para><verbatim>    @class ObjetoService
    @brief Servicio de aplicación para operaciones sobre objetos inteligentes.
    
    @details
    Implementa la lógica de negocio de alto nivel para:
    - Inicialización de objetos inteligentes con ontología y datastreams
    - Consultas de metadatos y estado
    - Envío de datos a datastreams
    - Monitoreo de disponibilidad de servicios
    
    Patrón: Application Service (Clean Architecture) + Dependency Injection
    
    Atributos:
    - log_panel: cliente para publicar logs/eventos MQTT (ILogPanelMQTT)
    - objetoInteligente: modelo de dominio del objeto activo (ObjetoInteligente)
    - persistence: repositorio de persistencia (IRepository)
    
    @note Mantiene en memoria un único objeto inteligente activo por instancia.
          Para múltiples objetos, considerar refactorizar con pattern Registry.
    
    @see ObjetoInteligente Para dominio
    @see IRepository Para persistencia (JSON/DB)
    @see ILogPanelMQTT Para logging distribuido
    
    @author Sistema Objeto Inteligente
    @date 2025-01-10
</verbatim> </para>
    </detaileddescription>
    <location file="micro_gestion_objetos/app/application/objeto_service.py" line="51" column="1" bodyfile="micro_gestion_objetos/app/application/objeto_service.py" bodystart="51" bodyend="472"/>
    <listofallmembers>
      <member refid="classobjeto__service_1_1_objeto_service_1aa63f3b78f5246c50c8ea7a491cf22186" prot="public" virt="non-virtual"><scope>objeto_service::ObjetoService</scope><name>get_state</name></member>
      <member refid="classobjeto__service_1_1_objeto_service_1ab6099fcce1bd3a003a91ecad3e645ca4" prot="public" virt="non-virtual"><scope>objeto_service::ObjetoService</scope><name>getIdentificator</name></member>
      <member refid="classobjeto__service_1_1_objeto_service_1aa655c94a8b2e89e43fdb66a7b708317e" prot="public" virt="non-virtual"><scope>objeto_service::ObjetoService</scope><name>log_panel</name></member>
      <member refid="classobjeto__service_1_1_objeto_service_1a9d33cc56721110014d500eca8c1da264" prot="public" virt="non-virtual"><scope>objeto_service::ObjetoService</scope><name>objetoInteligente</name></member>
      <member refid="classobjeto__service_1_1_objeto_service_1a9a545b2a9ad6061eca72bd20055365f3" prot="public" virt="non-virtual"><scope>objeto_service::ObjetoService</scope><name>persistence</name></member>
      <member refid="classobjeto__service_1_1_objeto_service_1ac8d4cbd3fd1ac32e58ab625b67446806" prot="public" virt="non-virtual"><scope>objeto_service::ObjetoService</scope><name>send_data</name></member>
      <member refid="classobjeto__service_1_1_objeto_service_1aeae5c6d6e41915ef0e8f9d9f06d9bd75" prot="public" virt="non-virtual"><scope>objeto_service::ObjetoService</scope><name>send_service_state</name></member>
      <member refid="classobjeto__service_1_1_objeto_service_1a648c3879efddba25a26929db743dd40f" prot="public" virt="non-virtual"><scope>objeto_service::ObjetoService</scope><name>startObject</name></member>
    </listofallmembers>
  </compounddef>
</doxygen>
