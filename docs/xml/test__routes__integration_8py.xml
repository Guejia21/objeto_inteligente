<?xml version='1.0' encoding='UTF-8' standalone='no'?>
<doxygen xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="compound.xsd" version="1.15.0" xml:lang="es">
  <compounddef id="test__routes__integration_8py" kind="file" language="Python">
    <compoundname>test_routes_integration.py</compoundname>
    <innerclass refid="classtest__routes__integration_1_1_fake_executor" prot="public">test_routes_integration::FakeExecutor</innerclass>
    <innernamespace refid="namespacetest__routes__integration">test_routes_integration</innernamespace>
    <briefdescription>
    </briefdescription>
    <detaileddescription>
    </detaileddescription>
    <programlisting>
<codeline lineno="1" refid="namespacetest__routes__integration" refkind="compound"><highlight class="comment">#<sp/>tests/test_routes_integration.py</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2"><highlight class="normal"></highlight><highlight class="comment">#<sp/>Prueba<sp/>de<sp/>integración:<sp/>DatastreamService<sp/>+<sp/>ResponseHelper<sp/>reales</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="3"><highlight class="normal"></highlight><highlight class="comment">#<sp/>con<sp/>metadata<sp/>inyectada<sp/>y<sp/>un<sp/>executor<sp/>fake.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="4"><highlight class="normal"></highlight></codeline>
<codeline lineno="5"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>json</highlight></codeline>
<codeline lineno="6"><highlight class="normal"></highlight></codeline>
<codeline lineno="7"><highlight class="normal"></highlight><highlight class="keyword">from</highlight><highlight class="normal"><sp/><ref refid="namespaceservices_1_1datastream__service" kindref="compound">services.datastream_service</ref><sp/></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>DatastreamService</highlight></codeline>
<codeline lineno="8"><highlight class="normal"></highlight><highlight class="keyword">from</highlight><highlight class="normal"><sp/>config<sp/></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>Config</highlight></codeline>
<codeline lineno="9"><highlight class="normal"></highlight></codeline>
<codeline lineno="10"><highlight class="normal"></highlight></codeline>
<codeline lineno="11" refid="classtest__routes__integration_1_1_fake_executor" refkind="compound"><highlight class="normal"></highlight><highlight class="keyword">class<sp/></highlight><highlight class="normal"><ref refid="classtest__routes__integration_1_1_fake_executor" kindref="compound">FakeExecutor</ref>:</highlight></codeline>
<codeline lineno="12"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;&quot;&quot;Executor<sp/>falso<sp/>que<sp/>simula<sp/>devolver<sp/>siempre<sp/>el<sp/>mismo<sp/>valor.&quot;&quot;&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="13"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal">__init__(self,<sp/>value):</highlight></codeline>
<codeline lineno="14" refid="classtest__routes__integration_1_1_fake_executor_1ae457276da084709f30d195f0f05f39af" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.<ref refid="classtest__routes__integration_1_1_fake_executor_1ae457276da084709f30d195f0f05f39af" kindref="member">value</ref><sp/>=<sp/>value</highlight></codeline>
<codeline lineno="15" refid="classtest__routes__integration_1_1_fake_executor_1a80883622b420a9496beb0d79b0acd9fa" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.<ref refid="classtest__routes__integration_1_1_fake_executor_1a80883622b420a9496beb0d79b0acd9fa" kindref="member">last_datastream</ref><sp/>=<sp/></highlight><highlight class="keywordtype">None</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="16"><highlight class="normal"></highlight></codeline>
<codeline lineno="17" refid="classtest__routes__integration_1_1_fake_executor_1a37b68b1cdbf84ca7a82bc99a39f410ba" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal"><ref refid="classtest__routes__integration_1_1_fake_executor_1a37b68b1cdbf84ca7a82bc99a39f410ba" kindref="member">get_value</ref>(self,<sp/>datastream_id):</highlight></codeline>
<codeline lineno="18"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.<ref refid="classtest__routes__integration_1_1_fake_executor_1a80883622b420a9496beb0d79b0acd9fa" kindref="member">last_datastream</ref><sp/>=<sp/>datastream_id</highlight></codeline>
<codeline lineno="19"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>self.<ref refid="classtest__routes__integration_1_1_fake_executor_1ae457276da084709f30d195f0f05f39af" kindref="member">value</ref></highlight></codeline>
<codeline lineno="20"><highlight class="normal"></highlight></codeline>
<codeline lineno="21"><highlight class="normal"></highlight></codeline>
<codeline lineno="22" refid="namespacetest__routes__integration_1a3f2c8c87a98e8cf449dca48f37cd08e5" refkind="member"><highlight class="normal"></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal"><ref refid="namespacetest__routes__integration_1a3f2c8c87a98e8cf449dca48f37cd08e5" kindref="member">test_send_data_integration_real_flow</ref>():</highlight></codeline>
<codeline lineno="23"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;&quot;&quot;</highlight></codeline>
<codeline lineno="24"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>Prueba<sp/>de<sp/>integración:</highlight></codeline>
<codeline lineno="25"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>-<sp/>Usa<sp/>DatastreamService<sp/>REAL<sp/>(ResponseHelper<sp/>real).</highlight></codeline>
<codeline lineno="26"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>-<sp/>Inyecta<sp/>metadata<sp/>de<sp/>datastreams<sp/>en<sp/>memoria.</highlight></codeline>
<codeline lineno="27"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>-<sp/>Inyecta<sp/>un<sp/>executor<sp/>falso<sp/>(simula<sp/>hardware).</highlight></codeline>
<codeline lineno="28"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>-<sp/>Ejecuta<sp/>send_data<sp/>y<sp/>valida<sp/>la<sp/>respuesta.</highlight></codeline>
<codeline lineno="29"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&quot;&quot;&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="30"><highlight class="normal"><sp/><sp/><sp/><sp/>service<sp/>=<sp/><ref refid="classservices_1_1datastream__service_1_1_datastream_service" kindref="compound">DatastreamService</ref>()</highlight></codeline>
<codeline lineno="31"><highlight class="normal"></highlight></codeline>
<codeline lineno="32"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>Inyectamos<sp/>metadata<sp/>manualmente<sp/>(en<sp/>vez<sp/>de<sp/>depender<sp/>de<sp/>metadata.json)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="33"><highlight class="normal"><sp/><sp/><sp/><sp/>service.datastreams<sp/>=<sp/>[</highlight></codeline>
<codeline lineno="34"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="35"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;datastream_id&quot;</highlight><highlight class="normal">:<sp/></highlight><highlight class="stringliteral">&quot;temp&quot;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="36"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;datastream_format&quot;</highlight><highlight class="normal">:<sp/></highlight><highlight class="stringliteral">&quot;int&quot;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="37"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;datastream_type&quot;</highlight><highlight class="normal">:<sp/></highlight><highlight class="stringliteral">&quot;sensor&quot;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="38"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="39"><highlight class="normal"><sp/><sp/><sp/><sp/>]</highlight></codeline>
<codeline lineno="40"><highlight class="normal"></highlight></codeline>
<codeline lineno="41"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>Inyectamos<sp/>un<sp/>executor<sp/>que<sp/>simula<sp/>un<sp/>valor<sp/>de<sp/>99</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="42"><highlight class="normal"><sp/><sp/><sp/><sp/>fake_exec<sp/>=<sp/><ref refid="classtest__routes__integration_1_1_fake_executor" kindref="compound">FakeExecutor</ref>(value=99)</highlight></codeline>
<codeline lineno="43"><highlight class="normal"><sp/><sp/><sp/><sp/>service.executor<sp/>=<sp/>fake_exec</highlight></codeline>
<codeline lineno="44"><highlight class="normal"></highlight></codeline>
<codeline lineno="45"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>OSID<sp/>correcto</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="46"><highlight class="normal"><sp/><sp/><sp/><sp/>Config.OSID<sp/>=<sp/></highlight><highlight class="stringliteral">&quot;ESP32_LED_01&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="47"><highlight class="normal"></highlight></codeline>
<codeline lineno="48"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>Ejecutamos<sp/>el<sp/>flujo<sp/>real<sp/>de<sp/>send_data</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="49"><highlight class="normal"><sp/><sp/><sp/><sp/>result<sp/>=<sp/>service.send_data(</highlight></codeline>
<codeline lineno="50"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>osid=</highlight><highlight class="stringliteral">&quot;ESP32_LED_01&quot;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="51"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>variable_estado=</highlight><highlight class="stringliteral">&quot;temp&quot;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="52"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>tipove=</highlight><highlight class="stringliteral">&quot;1&quot;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="53"><highlight class="normal"><sp/><sp/><sp/><sp/>)</highlight></codeline>
<codeline lineno="54"><highlight class="normal"></highlight></codeline>
<codeline lineno="55"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>La<sp/>respuesta<sp/>puede<sp/>ser<sp/>JSON<sp/>(str)<sp/>o<sp/>dict,<sp/>según<sp/>tu<sp/>ResponseHelper</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="56"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>isinstance(result,<sp/>str):</highlight></codeline>
<codeline lineno="57"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>data<sp/>=<sp/>json.loads(result)</highlight></codeline>
<codeline lineno="58"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">elif</highlight><highlight class="normal"><sp/>isinstance(result,<sp/>bytes):</highlight></codeline>
<codeline lineno="59"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>data<sp/>=<sp/>json.loads(result.decode())</highlight></codeline>
<codeline lineno="60"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">elif</highlight><highlight class="normal"><sp/>isinstance(result,<sp/>dict):</highlight></codeline>
<codeline lineno="61"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>data<sp/>=<sp/>result</highlight></codeline>
<codeline lineno="62"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="63"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">raise</highlight><highlight class="normal"><sp/>AssertionError(f</highlight><highlight class="stringliteral">&quot;Tipo<sp/>de<sp/>respuesta<sp/>no<sp/>esperado:<sp/>{type(result)}&quot;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="64"><highlight class="normal"></highlight></codeline>
<codeline lineno="65"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>Validaciones<sp/>mínimas<sp/>de<sp/>integración<sp/>según<sp/>la<sp/>estructura<sp/>REAL:</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="66"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>{&apos;osid&apos;,<sp/>&apos;datastream&apos;,<sp/>&apos;datatype&apos;,<sp/>&apos;value&apos;,<sp/>&apos;timestamp&apos;}</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="67"><highlight class="normal"></highlight></codeline>
<codeline lineno="68"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>1)<sp/>OSID<sp/>correcto</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="69"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">assert</highlight><highlight class="normal"><sp/>data.get(</highlight><highlight class="stringliteral">&quot;osid&quot;</highlight><highlight class="normal">)<sp/>==<sp/></highlight><highlight class="stringliteral">&quot;ESP32_LED_01&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="70"><highlight class="normal"></highlight></codeline>
<codeline lineno="71"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>2)<sp/>Datastream<sp/>correcto</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="72"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">assert</highlight><highlight class="normal"><sp/>data.get(</highlight><highlight class="stringliteral">&quot;datastream&quot;</highlight><highlight class="normal">)<sp/>==<sp/></highlight><highlight class="stringliteral">&quot;temp&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="73"><highlight class="normal"></highlight></codeline>
<codeline lineno="74"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>3)<sp/>Tipo<sp/>de<sp/>dato<sp/>coherente</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="75"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">assert</highlight><highlight class="normal"><sp/>data.get(</highlight><highlight class="stringliteral">&quot;datatype&quot;</highlight><highlight class="normal">)<sp/>==<sp/></highlight><highlight class="stringliteral">&quot;int&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="76"><highlight class="normal"></highlight></codeline>
<codeline lineno="77"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>4)<sp/>Valor<sp/>devuelto<sp/>por<sp/>el<sp/>servicio<sp/>(debe<sp/>venir<sp/>del<sp/>FakeExecutor)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="78"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">assert</highlight><highlight class="normal"><sp/>data.get(</highlight><highlight class="stringliteral">&quot;value&quot;</highlight><highlight class="normal">)<sp/>==<sp/>99</highlight></codeline>
<codeline lineno="79"><highlight class="normal"></highlight></codeline>
<codeline lineno="80"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>5)<sp/>Se<sp/>generó<sp/>un<sp/>timestamp<sp/>(no<sp/>validamos<sp/>formato,<sp/>solo<sp/>que<sp/>exista)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="81"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">assert</highlight><highlight class="normal"><sp/></highlight><highlight class="stringliteral">&quot;timestamp&quot;</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">in</highlight><highlight class="normal"><sp/>data</highlight></codeline>
<codeline lineno="82"><highlight class="normal"></highlight></codeline>
<codeline lineno="83"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>6)<sp/>El<sp/>executor<sp/>fue<sp/>llamado<sp/>con<sp/>el<sp/>datastream<sp/>correcto</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="84"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">assert</highlight><highlight class="normal"><sp/>fake_exec.last_datastream<sp/>==<sp/></highlight><highlight class="stringliteral">&quot;temp&quot;</highlight><highlight class="normal"></highlight></codeline>
    </programlisting>
    <location file="microservicio_data_stream/tests/test_routes_integration.py"/>
  </compounddef>
</doxygen>
